---
title: Azure Cloud Servicesből migrált Azure Service Fabric-alkalmazások újrabontása
description: Egy meglévő Azure Service Fabric-alkalmazás refactor hogyan átemelt Azure Cloud Services csomag
author: petertay
ms.date: 01/30/2018
ms.openlocfilehash: 08ef3af68b8eaba36a5b871449f0aba764fe5a04
ms.sourcegitcommit: 2123c25b1a0b5501ff1887f98030787191cf6994
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 03/08/2018
ms.locfileid: "29782546"
---
# <a name="refactor-an-azure-service-fabric-application-migrated-from-azure-cloud-services"></a><span data-ttu-id="c98a2-103">Azure Cloud Servicesből migrált Azure Service Fabric-alkalmazások újrabontása</span><span class="sxs-lookup"><span data-stu-id="c98a2-103">Refactor an Azure Service Fabric Application migrated from Azure Cloud Services</span></span>

<span data-ttu-id="c98a2-104">[![GitHub](../_images/github.png) Mintakód][sample-code]</span><span class="sxs-lookup"><span data-stu-id="c98a2-104">[![GitHub](../_images/github.png) Sample code][sample-code]</span></span>

<span data-ttu-id="c98a2-105">Ez a cikk ismerteti, hogy egy meglévő Azure Service Fabric-alkalmazás részletesebb architektúrát újrabontása.</span><span class="sxs-lookup"><span data-stu-id="c98a2-105">This article describes refactoring an existing Azure Service Fabric application to a more granular architecture.</span></span> <span data-ttu-id="c98a2-106">Ez a cikk a Tervező, csomagolása, teljesítmény és a refactored Service Fabric-alkalmazás központi telepítési szempontok összpontosít.</span><span class="sxs-lookup"><span data-stu-id="c98a2-106">This article focuses on the design, packaging, performance, and deployment considerations of the refactored Service Fabric application.</span></span>

## <a name="scenario"></a><span data-ttu-id="c98a2-107">Forgatókönyv</span><span class="sxs-lookup"><span data-stu-id="c98a2-107">Scenario</span></span>

<span data-ttu-id="c98a2-108">Az előző cikkben leírtaknak megfelelően [áttelepítése az Azure Cloud Services alkalmazás Azure Service Fabric][migrate-from-cloud-services], a minták és gyakorlatok team könyv 2012, a folyamat a dokumentált lett létrehozva. tervezése és megvalósítása a Felhőszolgáltatások alkalmazások az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="c98a2-108">As discussed in the previous article, [Migrating an Azure Cloud Services application to Azure Service Fabric][migrate-from-cloud-services], the patterns & practices team authored a book in 2012 that documented the process for designing and implementing a Cloud Services application in Azure.</span></span> <span data-ttu-id="c98a2-109">A címjegyzék ismerteti, amelyek szeretne létrehozni a Felhőszolgáltatások alkalmazást Dejójáték nevű fiktív vállalat **felmérések**.</span><span class="sxs-lookup"><span data-stu-id="c98a2-109">The book describes a fictitious company named Tailspin that wants to create a Cloud Services application named **Surveys**.</span></span> <span data-ttu-id="c98a2-110">A felmérések alkalmazás lehetővé teszi, hogy a felhasználók létrehozása és közzététele a nyilvános válaszoló felmérések.</span><span class="sxs-lookup"><span data-stu-id="c98a2-110">The Surveys application allows users to create and publish surveys that can be answered by the public.</span></span> <span data-ttu-id="c98a2-111">Az alábbi ábrán látható a felmérések alkalmazás ezen verziójára architektúrájának:</span><span class="sxs-lookup"><span data-stu-id="c98a2-111">The following diagram shows the architecture of this version of the Surveys application:</span></span>

![](./images/tailspin01.png)

<span data-ttu-id="c98a2-112">A **Tailspin.Web** webes szerepkör egy ASP.NET MVC-helyet, amely Dejójáték felhasználói futtatja:</span><span class="sxs-lookup"><span data-stu-id="c98a2-112">The **Tailspin.Web** web role hosts an ASP.NET MVC site that Tailspin customers use to:</span></span>
* <span data-ttu-id="c98a2-113">Iratkozzon fel a felmérések alkalmazás</span><span class="sxs-lookup"><span data-stu-id="c98a2-113">sign up for the Surveys application,</span></span>
* <span data-ttu-id="c98a2-114">Hozzon létre vagy egyetlen felmérés, törlése</span><span class="sxs-lookup"><span data-stu-id="c98a2-114">create or delete a single survey,</span></span>
* <span data-ttu-id="c98a2-115">egyetlen kérdőívet, az eredmények megtekintése</span><span class="sxs-lookup"><span data-stu-id="c98a2-115">view results for a single survey,</span></span>
* <span data-ttu-id="c98a2-116">kérelem, hogy az SQL, felméréseket exportálva és</span><span class="sxs-lookup"><span data-stu-id="c98a2-116">request that survey results be exported to SQL, and</span></span>
* <span data-ttu-id="c98a2-117">megtekintheti a összesített felmérés eredményét és elemzését.</span><span class="sxs-lookup"><span data-stu-id="c98a2-117">view aggregated survey results and analysis.</span></span>

<span data-ttu-id="c98a2-118">A **Tailspin.Web.Survey.Public** webes szerepkört is futtatja egy ASP.NET MVC-helyet, amely a nyilvános meglátogat felmérések kitöltéséhez.</span><span class="sxs-lookup"><span data-stu-id="c98a2-118">The **Tailspin.Web.Survey.Public** web role also hosts an ASP.NET MVC site that the public visits to fill out the surveys.</span></span> <span data-ttu-id="c98a2-119">Ezeket a válaszokat a sorhoz menteni kerüljenek.</span><span class="sxs-lookup"><span data-stu-id="c98a2-119">These responses are put in a queue to be saved.</span></span>

<span data-ttu-id="c98a2-120">A **Tailspin.Workers.Survey** feldolgozói szerepkör hajtja végre a háttérben történő feldolgozás által fel több várólistába érkező kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="c98a2-120">The **Tailspin.Workers.Survey** worker role performs background processing by picking up requests from multiple queues.</span></span>

<span data-ttu-id="c98a2-121">A minták és gyakorlatok csapata hozza létre egy új projektet az alkalmazás Azure Service Fabric port.</span><span class="sxs-lookup"><span data-stu-id="c98a2-121">The patterns & practices team then created a new project to port this application to Azure Service Fabric.</span></span> <span data-ttu-id="c98a2-122">A projekt célját volt a módosítások csak a szükséges kód egy Azure Service Fabric-fürtben futó alkalmazás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="c98a2-122">The goal of this project was to make only the necessary code changes to get the application running in an Azure Service Fabric cluster.</span></span> <span data-ttu-id="c98a2-123">Az eredeti webes és feldolgozói szerepkörök emiatt nem volt kiválasztott részletesebb architektúra be.</span><span class="sxs-lookup"><span data-stu-id="c98a2-123">As a result, the original web and worker roles were not decomposed into a more granular architecture.</span></span> <span data-ttu-id="c98a2-124">Az eredményül kapott architektúra nagyon hasonlít a felhőalapú szolgáltatás alkalmazásverziónként:</span><span class="sxs-lookup"><span data-stu-id="c98a2-124">The resulting architecture is very similar to the Cloud Service version of the application:</span></span>

![](./images/tailspin02.png)

<span data-ttu-id="c98a2-125">A **Tailspin.Web** szolgáltatást az eredeti van legelterjedtebb *Tailspin.Web* webes szerepkör.</span><span class="sxs-lookup"><span data-stu-id="c98a2-125">The **Tailspin.Web** service is ported from the original *Tailspin.Web* web role.</span></span>

<span data-ttu-id="c98a2-126">A **Tailspin.Web.Survey.Public** szolgáltatást az eredeti van legelterjedtebb *Tailspin.Web.Survey.Public* webes szerepkör.</span><span class="sxs-lookup"><span data-stu-id="c98a2-126">The **Tailspin.Web.Survey.Public** service is ported from the original *Tailspin.Web.Survey.Public* web role.</span></span>

<span data-ttu-id="c98a2-127">A **Tailspin.AnswerAnalysisService** szolgáltatást az eredeti van legelterjedtebb *Tailspin.Workers.Survey* feldolgozói szerepkör.</span><span class="sxs-lookup"><span data-stu-id="c98a2-127">The **Tailspin.AnswerAnalysisService** service is ported from the original *Tailspin.Workers.Survey* worker role.</span></span>

> [!NOTE] 
> <span data-ttu-id="c98a2-128">Amíg minimális kódmódosítással végzett webes és feldolgozói szerepkörök **Tailspin.Web** és **Tailspin.Web.Survey.Public** önálló gazdagép módosították egy [vércse] webes a kiszolgáló.</span><span class="sxs-lookup"><span data-stu-id="c98a2-128">While minimal code changes were made to each of the web and worker roles, **Tailspin.Web** and **Tailspin.Web.Survey.Public** were modified to self-host a [Kestrel] web server.</span></span> <span data-ttu-id="c98a2-129">A korábbi felmérések alkalmazás egy ASP.Net alkalmazás tárolt Interet Information Services (IIS) használatával, de nincs lehetőség, mint a Service Fabric szolgáltatás IIS futtatásához.</span><span class="sxs-lookup"><span data-stu-id="c98a2-129">The earlier Surveys application is an ASP.Net application that was hosted using Interet Information Services (IIS), but it is not possible to run IIS as a service in Service Fabric.</span></span> <span data-ttu-id="c98a2-130">Ezért bármilyen webkiszolgálót kell lennie arra, hogy önálló üzemeltetett, többek között [vércse].</span><span class="sxs-lookup"><span data-stu-id="c98a2-130">Therefore, any web server must be capable of being self-hosted, such as [Kestrel].</span></span> <span data-ttu-id="c98a2-131">Bizonyos esetekben a Service Fabric a tárolóban lévő IIS-t futtató lehetőség.</span><span class="sxs-lookup"><span data-stu-id="c98a2-131">It is possible to run IIS in a container in Service Fabric in some situations.</span></span> <span data-ttu-id="c98a2-132">Lásd: [tárolók használatára vonatkozó forgatókönyvek] [ container-scenarios] további információt.</span><span class="sxs-lookup"><span data-stu-id="c98a2-132">See [scenarios for using containers][container-scenarios] for more information.</span></span>  

<span data-ttu-id="c98a2-133">Most Dejójáték van újrabontása részletesebb architektúra felmérések alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-133">Now, Tailspin is refactoring the Surveys application to a more granular architecture.</span></span> <span data-ttu-id="c98a2-134">A újrabontása Dejójáték tartozó kifejlesztésének, hogy könnyebben fejleszthet, elkészítéséhez és a felmérések alkalmazás központi telepítése.</span><span class="sxs-lookup"><span data-stu-id="c98a2-134">Tailspin's motivation for refactoring is to make it easier to develop, build, and deploy the Surveys application.</span></span> <span data-ttu-id="c98a2-135">A meglévő webes és feldolgozói szerepkörök részletesebb architektúrát decomposing, amelyet Dejójáték azt szeretné, távolítsa el a meglévő szorosan összekapcsolt kommunikáció és függőségeket a szerepkörök között.</span><span class="sxs-lookup"><span data-stu-id="c98a2-135">By decomposing the existing web and worker roles to a more granular architecture, Tailspin wants to remove the existing tightly coupled communication and data dependencies between these roles.</span></span>

<span data-ttu-id="c98a2-136">Dejójáték más előnyöket is nyújt részletesebb architektúra felmérések alkalmazás mozgatása látja:</span><span class="sxs-lookup"><span data-stu-id="c98a2-136">Tailspin sees other benefits in moving the Surveys application to a more granular architecture:</span></span>
* <span data-ttu-id="c98a2-137">Minden szolgáltatás is csomagolja független projektek kicsi kell kezelnie egy kis csoport hatóköre.</span><span class="sxs-lookup"><span data-stu-id="c98a2-137">Each service can be packaged into independent projects with a scope small enough to be managed by a small team.</span></span>
* <span data-ttu-id="c98a2-138">Minden szolgáltatás egymástól függetlenül rendszerverzióval ellátott, telepített lehet.</span><span class="sxs-lookup"><span data-stu-id="c98a2-138">Each service can be independently versioned and deployed.</span></span>
* <span data-ttu-id="c98a2-139">Minden szolgáltatás a legjobb technológiával, hogy a szolgáltatás valósítható meg.</span><span class="sxs-lookup"><span data-stu-id="c98a2-139">Each service can be implemented using the best technology for that service.</span></span> <span data-ttu-id="c98a2-140">A service fabric-fürt is szerepelnek például a .net-keretrendszert, Java vagy egyéb nyelvek például C vagy C++ különböző verzióinak használatával készített szolgáltatások.</span><span class="sxs-lookup"><span data-stu-id="c98a2-140">For example, a service fabric cluster can include services built using different versions of the .Net Frameworks, Java, or other languages such as C or C++.</span></span>
* <span data-ttu-id="c98a2-141">Minden szolgáltatás egymástól függetlenül megadhat válaszoljon rá növekszik és csökken a terhelés.</span><span class="sxs-lookup"><span data-stu-id="c98a2-141">Each service can be independently scaled to respond to increases and decreases in load.</span></span>

> [!NOTE] 
> <span data-ttu-id="c98a2-142">Több vállalat kiszolgálása nem része ennek az alkalmazásnak újrabontása.</span><span class="sxs-lookup"><span data-stu-id="c98a2-142">Multitenancy is out of scope for the refactoring of this application.</span></span> <span data-ttu-id="c98a2-143">Dejójáték több vállalat kiszolgálása támogatásához több lehetőséggel rendelkezik, és lehetővé teszi a tervezési döntések később a kezdeti terv befolyásolása nélkül.</span><span class="sxs-lookup"><span data-stu-id="c98a2-143">Tailspin has several options to support multitenancy and can make these design decisions later without affecting the initial design.</span></span> <span data-ttu-id="c98a2-144">Például Dejójáték fürtön belül mindegyik bérlő külön szolgáltatáspéldánynak létrehozása vagy hozzon létre egy külön fürtöt az egyes bérlők számára.</span><span class="sxs-lookup"><span data-stu-id="c98a2-144">For example, Tailspin can create separate instances of the services for each tenant within a cluster or create a separate cluster for each tenant.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="c98a2-145">Kialakítási szempontok</span><span class="sxs-lookup"><span data-stu-id="c98a2-145">Design considerations</span></span>
 
<span data-ttu-id="c98a2-146">Az alábbi ábra a részletesebb architektúrát átkerült felmérések alkalmazás architektúráját mutatja be:</span><span class="sxs-lookup"><span data-stu-id="c98a2-146">The following diagram shows the architecture of the Surveys application refactored to a more granular architecture:</span></span>

![](./images/surveys_03.png)

<span data-ttu-id="c98a2-147">**Tailspin.Web** egy önálló helyet adó Dejójáték ügyfelek felmérések létrehozásához, és felmérések eredményeinek megtekintéséhez látogasson el az ASP.NET MVC alkalmazás állapot nélküli szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-147">**Tailspin.Web** is a stateless service self-hosting an ASP.NET MVC application that Tailspin customers visit to create surveys and view survey results.</span></span> <span data-ttu-id="c98a2-148">Ez a szolgáltatás osztja meg a kódot a legtöbb a *Tailspin.Web* szolgáltatás a merültek fel a Service Fabric-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-148">This service shares most of its code with the *Tailspin.Web* service from the ported Service Fabric application.</span></span> <span data-ttu-id="c98a2-149">Amint azt korábban említettük, ez a szolgáltatás az ASP.NET core használ, és vércse használja, mint egy WebListener végrehajtási webes előtér vált.</span><span class="sxs-lookup"><span data-stu-id="c98a2-149">As mentioned earlier, this service uses ASP.NET core and switches from using Kestrel as web frontend to implementing a WebListener.</span></span>

<span data-ttu-id="c98a2-150">**Tailspin.Web.Survey.Public** is egy ASP.NET MVC-helyek önálló üzemeltetéséhez állapot nélküli szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-150">**Tailspin.Web.Survey.Public** is a stateless service also self-hosting an ASP.NET MVC site.</span></span> <span data-ttu-id="c98a2-151">Felhasználók által felkeresett felmérések válasszon a listából, és töltse ki a helyet. Ez a szolgáltatás osztja meg a kódot a legtöbb a *Tailspin.Web.Survey.Public* szolgáltatás a merültek fel a Service Fabric-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-151">Users visit this site to select surveys from a list and then fill them out. This service shares most of its code with the *Tailspin.Web.Survey.Public* service from the ported Service Fabric application.</span></span> <span data-ttu-id="c98a2-152">Ez a szolgáltatás is használja az ASP.NET Core, és egy WebListener végrehajtási webes előtér vércse használatával is vált.</span><span class="sxs-lookup"><span data-stu-id="c98a2-152">This service also uses ASP.NET Core and also switches from using Kestrel as web frontend to implementing a WebListener.</span></span>

<span data-ttu-id="c98a2-153">**Tailspin.SurveyResponseService** , hogy a tároló válaszok az Azure Blob Storage felmérés állapotalapú szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-153">**Tailspin.SurveyResponseService** is a stateful service that stores survey answers in Azure Blob Storage.</span></span> <span data-ttu-id="c98a2-154">Azt is egyesít válaszok a felmérés analitikai adatokat.</span><span class="sxs-lookup"><span data-stu-id="c98a2-154">It also merges answers into the survey analysis data.</span></span> <span data-ttu-id="c98a2-155">A szolgáltatás, állapotalapú szolgáltatási lett megvalósítva, mert használ egy [ReliableConcurrentQueue] [ reliable-concurrent-queue] felmérés válaszok kötegekben feldolgozni.</span><span class="sxs-lookup"><span data-stu-id="c98a2-155">The service is implemented as a stateful service because it uses a [ReliableConcurrentQueue][reliable-concurrent-queue] to process survey answers in batches.</span></span> <span data-ttu-id="c98a2-156">Ez a funkció eredetileg lett megvalósítva a *Tailspin.AnswerAnalysisService* merültek fel a Service Fabric-alkalmazás szolgáltatással.</span><span class="sxs-lookup"><span data-stu-id="c98a2-156">This functionality was originally implemented in the *Tailspin.AnswerAnalysisService* service in the ported Service Fabric application.</span></span>

<span data-ttu-id="c98a2-157">**Tailspin.SurveyManagementService** állapotmentes szolgáltatások van, hogy tárolja és beolvassa kérdőívekkel és felmérés kérdéseket.</span><span class="sxs-lookup"><span data-stu-id="c98a2-157">**Tailspin.SurveyManagementService** is a stateless service that stores and retrieves surveys and survey questions.</span></span> <span data-ttu-id="c98a2-158">A szolgáltatás használja az Azure Blob Storage tárolóban.</span><span class="sxs-lookup"><span data-stu-id="c98a2-158">The service uses Azure Blob storage.</span></span> <span data-ttu-id="c98a2-159">Ez a funkció a data access Components az eredetileg is megtörtént a *Tailspin.Web* és *Tailspin.Web.Survey.Public* merültek fel a Service Fabric-alkalmazás szolgáltatásait.</span><span class="sxs-lookup"><span data-stu-id="c98a2-159">This functionality was also originally implemented in the data access components of the *Tailspin.Web* and *Tailspin.Web.Survey.Public* services in the ported Service Fabric application.</span></span> <span data-ttu-id="c98a2-160">Dejójáték átkerült az eredeti funkciókat ezt a szolgáltatást, hogy engedélyezi-méretezését.</span><span class="sxs-lookup"><span data-stu-id="c98a2-160">Tailspin refactored the original functionality into this service to allow it to scale independently.</span></span>

<span data-ttu-id="c98a2-161">**Tailspin.SurveyAnswerService** , hogy beolvassa válaszok megtekintheti, és megtekintheti a elemzési állapot nélküli szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-161">**Tailspin.SurveyAnswerService** is a stateless service that retrieves survey answers and survey analysis.</span></span> <span data-ttu-id="c98a2-162">A szolgáltatás is használja az Azure Blob Storage tárolóban.</span><span class="sxs-lookup"><span data-stu-id="c98a2-162">The service also uses Azure Blob storage.</span></span> <span data-ttu-id="c98a2-163">Ez a funkció a data access Components az eredetileg is megtörtént a *Tailspin.Web* merültek fel a Service Fabric-alkalmazás szolgáltatással.</span><span class="sxs-lookup"><span data-stu-id="c98a2-163">This functionality was also originally implemented in the data access components of the *Tailspin.Web* service in the ported Service Fabric application.</span></span> <span data-ttu-id="c98a2-164">Dejójáték átkerült az eredeti funkciókat ezt a szolgáltatást, mert kevesebb terhelés vár, és kevesebb példányt erőforrásokkal való takarékoskodáshoz használni szeretné.</span><span class="sxs-lookup"><span data-stu-id="c98a2-164">Tailspin refactored the original functionality into this service because it expects less load and wants to use fewer instances to conserve resources.</span></span>

<span data-ttu-id="c98a2-165">**Tailspin.SurveyAnalysisService** tartja fenn a felmérés válasz összegző adatokat a Redis gyorsítótár a gyors beolvasásához állapot nélküli szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-165">**Tailspin.SurveyAnalysisService** is a stateless service that persists survey answer summary data in a Redis cache for quick retrieval.</span></span> <span data-ttu-id="c98a2-166">Ez a szolgáltatás hívja a *Tailspin.SurveyResponseService* minden alkalommal, amikor egy felmérés melléket, és az új felmérés válasz oszlopneveit az az összegzett adatokat.</span><span class="sxs-lookup"><span data-stu-id="c98a2-166">This service is called by the *Tailspin.SurveyResponseService* each time a survey is answered and the new survey answer data is merged in the summary data.</span></span> <span data-ttu-id="c98a2-167">A szolgáltatás része az eredetileg megvalósított funkciókat a *Tailspin.AnswerAnalysisService* szolgáltatás a merültek fel a Service Fabric-alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-167">This service includes the functionality originally implemented in the *Tailspin.AnswerAnalysisService* service from the ported Service Fabric application.</span></span>

## <a name="stateless-versus-stateful-services"></a><span data-ttu-id="c98a2-168">Állapot nélküli és állapotalapú szolgáltatások</span><span class="sxs-lookup"><span data-stu-id="c98a2-168">Stateless versus stateful services</span></span>

<span data-ttu-id="c98a2-169">Az Azure Service Fabric támogatja a következő programozási modellek:</span><span class="sxs-lookup"><span data-stu-id="c98a2-169">Azure Service Fabric supports the following programming models:</span></span>
* <span data-ttu-id="c98a2-170">A Vendég végrehajtható modell lehetővé teszi, hogy a szolgáltatás csomagolni, és a Service Fabric-fürt központi telepítése a végrehajtható fájlok.</span><span class="sxs-lookup"><span data-stu-id="c98a2-170">The guest executable model allows any executable to be packaged as a service and deployed to a Service Fabric cluster.</span></span> <span data-ttu-id="c98a2-171">A Service Fabric koordinálja, és a Vendég végrehajtható végrehajtási kezeli.</span><span class="sxs-lookup"><span data-stu-id="c98a2-171">Service Fabric orchestrates and manages execution of the guest executable.</span></span>
* <span data-ttu-id="c98a2-172">A tároló modell lehetővé teszi, hogy a tároló-lemezképekben szolgáltatások telepítését.</span><span class="sxs-lookup"><span data-stu-id="c98a2-172">The container model allows for deployment of services in container images.</span></span> <span data-ttu-id="c98a2-173">A Service Fabric létrehozása és kezelése Linux kernel tárolók, valamint a Windows Server-tárolók fölött tárolók támogatja.</span><span class="sxs-lookup"><span data-stu-id="c98a2-173">Service Fabric supports creation and management of containers on top of Linux kernel containers as well as Windows Server containers.</span></span> 
* <span data-ttu-id="c98a2-174">A megbízható szolgáltatások programozási modell lehetővé teszi, hogy állapot nélküli és állapotalapú szolgáltatások, amelyek integrálják az összes Service Fabric platform szolgáltatás létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="c98a2-174">The reliable services programming model allows for the creation of stateless or stateful services that integrate with all Service Fabric platform features.</span></span> <span data-ttu-id="c98a2-175">Állapotalapú szolgáltatások lehetővé teszik a rendszer ne tárolja őket a Service Fabric-fürt replikált állapothoz.</span><span class="sxs-lookup"><span data-stu-id="c98a2-175">Stateful services allow for replicated state to be stored in the Service Fabric cluster.</span></span> <span data-ttu-id="c98a2-176">Állapotmentes szolgáltatások azonban nem.</span><span class="sxs-lookup"><span data-stu-id="c98a2-176">Stateless services do not.</span></span>
* <span data-ttu-id="c98a2-177">A megbízható actors programozási modell lehetővé teszi, hogy a virtuális szereplő mintát megvalósító szolgáltatások létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="c98a2-177">The reliable actors programming model allows for the creation of services that implement the virtual actor pattern.</span></span>

<span data-ttu-id="c98a2-178">Minden a szolgáltatások a felmérések alkalmazás csak megbízható állapotmentes szolgáltatásokhoz, kivéve a *Tailspin.SurveyResponseService* szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="c98a2-178">All the services in the Surveys application are stateless reliable services, except for the *Tailspin.SurveyResponseService* service.</span></span> <span data-ttu-id="c98a2-179">Ez a szolgáltatás biztosítja a [ReliableConcurrentQueue] [ reliable-concurrent-queue] felmérés válaszok akkor dolgozza fel, ha azokat.</span><span class="sxs-lookup"><span data-stu-id="c98a2-179">This service implements a [ReliableConcurrentQueue][reliable-concurrent-queue] to process survey answers when they are received.</span></span> <span data-ttu-id="c98a2-180">A ReliableConcurrentQueue válaszokat az Azure Blob Storage tárolási és átadott a *Tailspin.SurveyAnalysisService* elemzés céljából.</span><span class="sxs-lookup"><span data-stu-id="c98a2-180">Responses in the ReliableConcurrentQueue are saved into Azure Blob Storage and passed to the *Tailspin.SurveyAnalysisService* for analysis.</span></span> <span data-ttu-id="c98a2-181">Dejójáték egy ReliableConcurrentQueue úgy dönt, mert a válaszok nem igényelnek szigorú első-first out (FIFO) rendelési például az Azure Service Bus egy várólista által biztosított.</span><span class="sxs-lookup"><span data-stu-id="c98a2-181">Tailspin chooses a ReliableConcurrentQueue because responses do not require strict first-in-first-out (FIFO) ordering provided by a queue such as Azure Service Bus.</span></span> <span data-ttu-id="c98a2-182">Egy ReliableConcurrentQueue is célja, hogy nagyobb teljesítményt és alacsony késést várólista biztosítanak, és műveletek feldolgozásához.</span><span class="sxs-lookup"><span data-stu-id="c98a2-182">A ReliableConcurrentQueue is also designed to deliver high throughput and low latency for queue and dequeue operations.</span></span>

<span data-ttu-id="c98a2-183">Vegye figyelembe, hogy egy ReliableConcurrentQueue várólistából kivéve tételekhez megőrizni műveletek kell ideális esetben az idempotent.</span><span class="sxs-lookup"><span data-stu-id="c98a2-183">Note that operations to persist dequeued items from a ReliableConcurrentQueue should ideally be idempotent.</span></span> <span data-ttu-id="c98a2-184">Ha a rendszer kivételt hoz létre egy elem feldolgozása során az üzenetsorból, azonos elem egynél többször feldolgozása történhet.</span><span class="sxs-lookup"><span data-stu-id="c98a2-184">If an exception is thrown during the processing of an item from the queue, the same item may be processed more than once.</span></span> <span data-ttu-id="c98a2-185">Felmérések alkalmazás felmérés egyesíteni művelet választ a *Tailspin.SurveyAnalysisService* nem idempotent van, mert Dejójáték úgy döntött, hogy a felmérés analitikai adatokat csak a jelenlegi pillanatképét a analitikai adatokat, és nem kell lenniük.</span><span class="sxs-lookup"><span data-stu-id="c98a2-185">In the Surveys application, the operation to merge survey answers to the *Tailspin.SurveyAnalysisService* is not idempotent because Tailspin decided that the survey analysis data is only a current snapshot of the analysis data and does not need to be consistent.</span></span> <span data-ttu-id="c98a2-186">A felmérési válaszokat az Azure Blob Storage menteni végül megegyeznek, a felmérést végső analysis is mindig újra kell számolni megfelelően ezek az adatok a.</span><span class="sxs-lookup"><span data-stu-id="c98a2-186">The survey answers saved to Azure Blob Storage are eventually consistent, so the survey final analysis can always be recalculated correctly from this data.</span></span>

## <a name="communication-framework"></a><span data-ttu-id="c98a2-187">Kommunikációs keretrendszer</span><span class="sxs-lookup"><span data-stu-id="c98a2-187">Communication framework</span></span>

<span data-ttu-id="c98a2-188">Minden szolgáltatás a felmérések alkalmazás RESTful webes API-k segítségével kommunikál.</span><span class="sxs-lookup"><span data-stu-id="c98a2-188">Each service in the Surveys application communicates using a RESTful web API.</span></span> <span data-ttu-id="c98a2-189">RESTful API-k a következő előnyöket nyújtják:</span><span class="sxs-lookup"><span data-stu-id="c98a2-189">RESTful APIs offer the following benefits:</span></span>
* <span data-ttu-id="c98a2-190">Könnyű használat: minden service-t az ASP.Net Core MVC, amely natív módon támogatja a webes API-k létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="c98a2-190">Ease of use: each service is built using ASP.Net Core MVC, which natively supports the creation of Web APIs.</span></span>
* <span data-ttu-id="c98a2-191">Biztonsági: Minden egyes szolgáltatás SSL nem szükséges, miközben Dejójáték igényel minden egyes szolgáltatás ehhez.</span><span class="sxs-lookup"><span data-stu-id="c98a2-191">Security: While each service does not require SSL, Tailspin could require each service to do so.</span></span> 
* <span data-ttu-id="c98a2-192">Versioning: ügyfelek kell írni és tesztelése egy webes API-t egy adott verziójához.</span><span class="sxs-lookup"><span data-stu-id="c98a2-192">Versioning: clients can be written and tested against a specific version of a web API.</span></span>

<span data-ttu-id="c98a2-193">Az alkalmazás ellenőrizze felmérés szolgáltatások használata a [fordított proxy] [ reverse-proxy] Service Fabric által megvalósított.</span><span class="sxs-lookup"><span data-stu-id="c98a2-193">Services in the Survey application make use of the [reverse proxy][reverse-proxy] implemented by Service Fabric.</span></span> <span data-ttu-id="c98a2-194">Fordított proxy olyan szolgáltatás, amely a Service Fabric-fürt mindegyik csomópontján fut, és biztosítja az végpont, automatikus újra gombra, és más csatlakozási hibák típusú kezeli.</span><span class="sxs-lookup"><span data-stu-id="c98a2-194">Reverse proxy is a service that runs on each node in the Service Fabric cluster and provides endpoint resolution, automatic retry, and handles other types of connection failures.</span></span> <span data-ttu-id="c98a2-195">Fordított proxy használatára, minden egyes RESTful API egy adott szolgáltatáshoz kezdeményezték egy előre meghatározott fordított proxy-porton keresztül.</span><span class="sxs-lookup"><span data-stu-id="c98a2-195">To use the reverse proxy, each RESTful API call to a specific service is made using a predefined reverse proxy port.</span></span>  <span data-ttu-id="c98a2-196">Például, ha a fordított proxy port van beállítva **19081**, hívása a *Tailspin.SurveyAnswerService* tehető az alábbiak szerint:</span><span class="sxs-lookup"><span data-stu-id="c98a2-196">For example, if the reverse proxy port has been set to **19081**, a call to the *Tailspin.SurveyAnswerService* can be made as follows:</span></span>

```csharp
static SurveyAnswerService()
{
    httpClient = new HttpClient
    {
        BaseAddress = new Uri("http://localhost:19081/Tailspin/SurveyAnswerService/")
    };
}
```
<span data-ttu-id="c98a2-197">Fordított proxy engedélyezéséhez adjon meg egy fordított proxy portja a Service Fabric-fürt létrehozása során.</span><span class="sxs-lookup"><span data-stu-id="c98a2-197">To enable reverse proxy, specify a reverse proxy port during creation of the Service Fabric cluster.</span></span> <span data-ttu-id="c98a2-198">További információkért lásd: [fordított proxy] [ reverse-proxy] az Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="c98a2-198">For more information, see [reverse proxy][reverse-proxy] in Azure Service Fabric.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="c98a2-199">A teljesítménnyel kapcsolatos megfontolások</span><span class="sxs-lookup"><span data-stu-id="c98a2-199">Performance considerations</span></span>

<span data-ttu-id="c98a2-200">Dejójáték létrehozott az ASP.NET Core-szolgáltatások *Tailspin.Web* és *Tailspin.Web.Surveys.Public* Visual Studio-sablonokkal.</span><span class="sxs-lookup"><span data-stu-id="c98a2-200">Tailspin created the ASP.NET Core services for *Tailspin.Web* and *Tailspin.Web.Surveys.Public* using Visual Studio templates.</span></span> <span data-ttu-id="c98a2-201">Alapértelmezés szerint ezek-sablonjai tartalmazzák a naplózás a konzolhoz.</span><span class="sxs-lookup"><span data-stu-id="c98a2-201">By default, these templates include logging to the console.</span></span> <span data-ttu-id="c98a2-202">A konzol történő naplózás tehetik a fejlesztési és hibakeresés során, de a konzol összes naplózás el kell távolítani az alkalmazás üzemi környezetben való telepítésekor.</span><span class="sxs-lookup"><span data-stu-id="c98a2-202">Logging to the console may be done during development and debugging, but all logging to the console should be removed when the application is deployed to production.</span></span>

> [!NOTE]
> <span data-ttu-id="c98a2-203">Figyelés és az éles környezetben futó Service Fabric-alkalmazások diagnosztika beállításával kapcsolatos további információkért lásd: [figyelése és diagnosztikai] [ monitoring-diagnostics] az Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="c98a2-203">For more information about setting up monitoring and diagnostics for Service Fabric applications running in production, see [monitoring and diagnostics][monitoring-diagnostics] for Azure Service Fabric.</span></span>

<span data-ttu-id="c98a2-204">Például a következő sort *startup.cs* minden webes előtér-szolgáltatások kell megjegyzésként szerepel:</span><span class="sxs-lookup"><span data-stu-id="c98a2-204">For example, the following lines in *startup.cs* for each of the web front end services should be commented out:</span></span>

```csharp
// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
{
    //loggerFactory.AddConsole(Configuration.GetSection("Logging"));
    //loggerFactory.AddDebug();

    app.UseMvc();
}
```

> [!NOTE]
> <span data-ttu-id="c98a2-205">Ezek a sorok feltételesen kizárhatók a Visual Studio "kibocsátási" közzétételekor beállításakor.</span><span class="sxs-lookup"><span data-stu-id="c98a2-205">These lines may be conditionally excluded when Visual Studio is set to “release” when publishing.</span></span>

<span data-ttu-id="c98a2-206">Végezetül Dejójáték az Dejójáték alkalmazást üzemi környezetben telepíti, ha vált a Visual Studio segítségével **kiadási** mód.</span><span class="sxs-lookup"><span data-stu-id="c98a2-206">Finally, when Tailspin deploys the Tailspin application to production, they switch Visual Studio to **release** mode.</span></span>

## <a name="deployment-considerations"></a><span data-ttu-id="c98a2-207">Telepítési szempontok</span><span class="sxs-lookup"><span data-stu-id="c98a2-207">Deployment considerations</span></span>

<span data-ttu-id="c98a2-208">A refactored felmérések alkalmazások állnak öt állapotmentes szolgáltatások és egy állapotalapú szolgáltatás, így a fürt tervezési annak meghatározásában, a megfelelő Virtuálisgép-méretet és a csomópontok száma korlátozott.</span><span class="sxs-lookup"><span data-stu-id="c98a2-208">The refactored Surveys application is composed of five stateless services and one stateful service, so cluster planning is limited to determining the correct VM size and number of nodes.</span></span> <span data-ttu-id="c98a2-209">Az a *applicationmanifest.xml* fájl, amely leírja a fürt, Dejójáték beállítása a *InstanceCount* attribútuma a *StatelessService* címkén belül, hogy az egyes -1 a szolgáltatások.</span><span class="sxs-lookup"><span data-stu-id="c98a2-209">In the *applicationmanifest.xml* file that describes the cluster, Tailspin sets the *InstanceCount* attribute of the *StatelessService* tag to -1 for each of the services.</span></span> <span data-ttu-id="c98a2-210">A -1 érték a szolgáltatás példányának létrehozása a fürt mindegyik csomópontján Service Fabric irányítja.</span><span class="sxs-lookup"><span data-stu-id="c98a2-210">A value of -1 directs Service Fabric to create an instance of the service on each node in the cluster.</span></span>

> [!NOTE]
> <span data-ttu-id="c98a2-211">Állapotalapú szolgáltatások megfelelő számú partíciót és az adataikat replikáit tervezésének további lépés szükséges.</span><span class="sxs-lookup"><span data-stu-id="c98a2-211">Stateful services require the additional step of planning the correct number of partitions and replicas for their data.</span></span>

<span data-ttu-id="c98a2-212">Dejójáték telepíti a fürt az Azure portál használatával.</span><span class="sxs-lookup"><span data-stu-id="c98a2-212">Tailspin deploys the cluster using the Azure Portal.</span></span> <span data-ttu-id="c98a2-213">A Service Fabric-fürt erőforrástípus telepíti a szükséges infrastruktúra, beleértve a Virtuálisgép-méretezési készlet és a terheléselosztó mindegyikét.</span><span class="sxs-lookup"><span data-stu-id="c98a2-213">The Service Fabric Cluster resource type deploys all of the necessary infrastructure, including VM scale sets and a load balancer.</span></span> <span data-ttu-id="c98a2-214">Az ajánlott Virtuálisgép-méretek a Service Fabric-fürt üzembe helyezési folyamata során az Azure portálon jelennek meg.</span><span class="sxs-lookup"><span data-stu-id="c98a2-214">The recommended VM sizes are displayed in the Azure portal during the provisioning process for the Service Fabric cluster.</span></span> <span data-ttu-id="c98a2-215">Vegye figyelembe, hogy a virtuális gépek vannak telepítve, a Virtuálisgép-méretezési készlet, mert ezek mind akár is méretezhető, és ki felhasználóként a terhelés növekedésével.</span><span class="sxs-lookup"><span data-stu-id="c98a2-215">Note that because the VMs are deployed in a VM scale set, they can be both scaled up and out as user load increases.</span></span>

> [!NOTE]
> <span data-ttu-id="c98a2-216">A fentiekben taglaltak, az áttelepített alkalmazásverziónként felmérések a két előtér-webkiszolgálók voltak önálló üzemeltetett ASP.Net Core és vércse használatával a webkiszolgáló.</span><span class="sxs-lookup"><span data-stu-id="c98a2-216">As discussed earlier, in the migrated version of the Surveys application the two web front ends were self-hosted using ASP.Net Core and Kestrel as a web server.</span></span> <span data-ttu-id="c98a2-217">Amíg az áttelepített alkalmazásverziónként felmérés nem használ egy fordított proxy, erősen ajánlott például az IIS, Nginx vagy Apache egy fordított proxy használatára.</span><span class="sxs-lookup"><span data-stu-id="c98a2-217">While the migrated version of the Survey application does not use a reverse proxy, it is strongly recommended to use a reverse proxy such as IIS, Nginx, or Apache.</span></span> <span data-ttu-id="c98a2-218">További információ: [vércse web server ASP.NET core megvalósításának bemutatása][kestrel-intro].</span><span class="sxs-lookup"><span data-stu-id="c98a2-218">For more information see [introduction to Kestrel web server implementation in ASP.NET core][kestrel-intro].</span></span>
> <span data-ttu-id="c98a2-219">A refactored felmérések alkalmazásban, a két előtér-webkiszolgálók önálló üzemeltetett az ASP.Net Core segítségével [WebListener] [ weblistener] , így nem szükséges egy fordított proxy webkiszolgálót.</span><span class="sxs-lookup"><span data-stu-id="c98a2-219">In the refactored Surveys application, the two web front ends are self-hosted using ASP.Net Core with [WebListener][weblistener] as a web server so a reverse proxy is not necessary.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c98a2-220">További lépések</span><span class="sxs-lookup"><span data-stu-id="c98a2-220">Next steps</span></span>

<span data-ttu-id="c98a2-221">A felmérések alkalmazás kódja megtalálható [GitHub][sample-code].</span><span class="sxs-lookup"><span data-stu-id="c98a2-221">The Surveys application code is available on [GitHub][sample-code].</span></span>

<span data-ttu-id="c98a2-222">Ha most elkezdi az [Azure Service Fabric][service-fabric], először állítsa be a fejlesztési környezetet, akkor letöltheti a legújabb [Azure SDK] [ azure-sdk] és a [Azure Service Fabric SDK][service-fabric-sdk].</span><span class="sxs-lookup"><span data-stu-id="c98a2-222">If you are just getting started with [Azure Service Fabric][service-fabric], first set up your development environment then download the latest [Azure SDK][azure-sdk] and the [Azure Service Fabric SDK][service-fabric-sdk].</span></span> <span data-ttu-id="c98a2-223">Az SDK magában foglalja a OneBox-kezelőt, telepítheti és helyileg, a teljes F5 hibakeresés a felmérések alkalmazás teszteléséhez.</span><span class="sxs-lookup"><span data-stu-id="c98a2-223">The SDK includes the OneBox cluster manager so you can deploy and test the Surveys application locally with full F5 debugging.</span></span>

<!-- links -->
[azure-sdk]: https://azure.microsoft.com/downloads/archive-net-downloads/
[container-scenarios]: /azure/service-fabric/service-fabric-containers-overview
[kestrel]: https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel?tabs=aspnetcore2x
[kestrel-intro]: https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel?tabs=aspnetcore1x
[migrate-from-cloud-services]: migrate-from-cloud-services.md
[monitoring-diagnostics]: /azure/service-fabric/service-fabric-diagnostics-overview
[reliable-concurrent-queue]: /azure/service-fabric/service-fabric-reliable-services-reliable-concurrent-queue
[reverse-proxy]: /azure/service-fabric/service-fabric-reverseproxy
[sample-code]: https://github.com/mspnp/cloud-services-to-service-fabric/tree/master/servicefabric-phase-2
[service-fabric]: /azure/service-fabric/service-fabric-get-started
[service-fabric-sdk]: /azure/service-fabric/service-fabric-get-started
[weblistener]: https://docs.microsoft.com/aspnet/core/fundamentals/servers/weblistener
