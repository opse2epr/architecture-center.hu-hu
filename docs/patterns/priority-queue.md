---
title: Priority Queue
description: Priorizálhatja a szolgáltatásoknak küldött kéréseket úgy, hogy a magasabb prioritású kéréseket a rendszer gyorsabban fogadja és dolgozza fel, mint az alacsonyabb prioritásúakat.
keywords: tervezési minta
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- messaging
- performance-scalability
ms.openlocfilehash: 400bfbc03cf5640ff32a551636b01d60e6c0ec50
ms.sourcegitcommit: 94d50043db63416c4d00cebe927a0c88f78c3219
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 09/28/2018
ms.locfileid: "47428499"
---
# <a name="priority-queue-pattern"></a><span data-ttu-id="f746b-104">Elsőbbségi üzenetsor mintája</span><span class="sxs-lookup"><span data-stu-id="f746b-104">Priority Queue pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="f746b-105">Priorizálhatja a szolgáltatásoknak küldött kéréseket úgy, hogy a magasabb prioritású kéréseket a rendszer gyorsabban fogadja és dolgozza fel, mint az alacsonyabb prioritásúakat.</span><span class="sxs-lookup"><span data-stu-id="f746b-105">Prioritize requests sent to services so that requests with a higher priority are received and processed more quickly than those with a lower priority.</span></span> <span data-ttu-id="f746b-106">Ez a minta olyan alkalmazások esetében hasznos, amelyek különböző szolgáltatási szintre vonatkozó garanciákat kínálnak az egyes ügyfelek számára.</span><span class="sxs-lookup"><span data-stu-id="f746b-106">This pattern is useful in applications that offer different service level guarantees to individual clients.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="f746b-107">Kontextus és probléma</span><span class="sxs-lookup"><span data-stu-id="f746b-107">Context and Problem</span></span>

<span data-ttu-id="f746b-108">Az alkalmazások bizonyos feladatokat delegálhatnak más szolgáltatások számára, például a háttérfeldolgozás végrehajtását vagy a más alkalmazásokkal/szolgáltatásokkal való integrációt.</span><span class="sxs-lookup"><span data-stu-id="f746b-108">Applications can delegate specific tasks to other services, for example, to perform background processing or to integrate with other applications or services.</span></span> <span data-ttu-id="f746b-109">A felhőben az üzenetsorokat jellemzően a feladatok háttérbeli feldolgozásra való delegálására használjuk.</span><span class="sxs-lookup"><span data-stu-id="f746b-109">In the cloud, a message queue is typically used to delegate tasks to background processing.</span></span> <span data-ttu-id="f746b-110">Sok esetben a szolgáltatások által fogadott rendelési kérelmek nem lényegesek.</span><span class="sxs-lookup"><span data-stu-id="f746b-110">In many cases the order requests are received in by a service isn't important.</span></span> <span data-ttu-id="f746b-111">Néha azonban meg kell határozni bizonyos kérelmek prioritását.</span><span class="sxs-lookup"><span data-stu-id="f746b-111">In some cases, though, it's necessary to prioritize specific requests.</span></span> <span data-ttu-id="f746b-112">Ezeket a kérelmeket korábban kell feldolgozni, mint az alkalmazás által korábban küldött, alacsonyabb prioritású kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="f746b-112">These requests should be processed earlier than lower priority requests that were sent previously by the application.</span></span>

## <a name="solution"></a><span data-ttu-id="f746b-113">Megoldás</span><span class="sxs-lookup"><span data-stu-id="f746b-113">Solution</span></span>

<span data-ttu-id="f746b-114">Az üzenetsorok általában érkezési sorrend alapján végzik a feldolgozást, és a fogyasztók jellemzően az üzenetsorban való közzététel sorrendjében kapják meg az üzeneteket.</span><span class="sxs-lookup"><span data-stu-id="f746b-114">A queue is usually a first-in, first-out (FIFO) structure, and consumers typically receive messages in the same order that they were posted to the queue.</span></span> <span data-ttu-id="f746b-115">Bizonyos üzenetsorok azonban támogatják a prioritásalapú üzenetkezelést is.</span><span class="sxs-lookup"><span data-stu-id="f746b-115">However, some message queues support priority messaging.</span></span> <span data-ttu-id="f746b-116">Az üzenetet közzétevő alkalmazás prioritást rendelhet az üzenetekhez, és ekkor a rendszer az üzenetsorban lévő üzenetek sorrendjét automatikusan úgy rendezi át, hogy a magasabb prioritású üzenetek fogadása történjen meg előbb.</span><span class="sxs-lookup"><span data-stu-id="f746b-116">The application posting a message can assign a priority and the messages in the queue are automatically reordered so that those with a higher priority will be received before those with a lower priority.</span></span> <span data-ttu-id="f746b-117">Az ábrán egy prioritásalapú üzenetkezelést alkalmazó üzenetsor látható.</span><span class="sxs-lookup"><span data-stu-id="f746b-117">The figure illustrates a queue with priority messaging.</span></span>

![1. ábra – Üzenetpriorizálást támogató üzenetsor-kezelési mechanizmus használata](./_images/priority-queue-pattern.png)

> <span data-ttu-id="f746b-119">A legtöbb üzenetsor-implementáció támogatja a többfogyasztós megoldásokat (a [Versengő felhasználókat ismertető minta](https://msdn.microsoft.com/library/dn568101.aspx) szerint), és a fogyasztói folyamatok száma igény szerint skálázható vertikálisan.</span><span class="sxs-lookup"><span data-stu-id="f746b-119">Most message queue implementations support multiple consumers (following the [Competing Consumers pattern](https://msdn.microsoft.com/library/dn568101.aspx)), and the number of consumer processes can be scaled up or down depending on demand.</span></span>

<span data-ttu-id="f746b-120">Olyan rendszerekben, amelyek nem támogatják a prioritásalapú üzenetsorokat, alternatív megoldásként külön sorokat tarthatunk fenn a prioritások számára.</span><span class="sxs-lookup"><span data-stu-id="f746b-120">In systems that don't support priority-based message queues, an alternative solution is to maintain a separate queue for each priority.</span></span> <span data-ttu-id="f746b-121">Az alkalmazás feladata az üzenetek megfelelő üzenetsorban történő közzététele.</span><span class="sxs-lookup"><span data-stu-id="f746b-121">The application is responsible for posting messages to the appropriate queue.</span></span> <span data-ttu-id="f746b-122">Minden egyes üzenetsorhoz külön fogyasztók tartozhatnak.</span><span class="sxs-lookup"><span data-stu-id="f746b-122">Each queue can have a separate pool of consumers.</span></span> <span data-ttu-id="f746b-123">A magasabb prioritású üzenetsorokhoz több, gyorsabb hardveren futtatott fogyasztó tartozhat, mint az alacsonyabb prioritású üzenetsorokhoz.</span><span class="sxs-lookup"><span data-stu-id="f746b-123">Higher priority queues can have a larger pool of consumers running on faster hardware than lower priority queues.</span></span> <span data-ttu-id="f746b-124">A következő ábra azt mutatja be, amikor külön üzenetsorokat használunk minden egyes prioritáshoz.</span><span class="sxs-lookup"><span data-stu-id="f746b-124">The next figure illustrates using separate message queues for each priority.</span></span>

![2. ábra – Külön üzenetsor használata minden egyes prioritáshoz](./_images/priority-queue-separate.png)


<span data-ttu-id="f746b-126">Ennek a stratégiának egy variációja, ha egyetlen fogyasztókészlet először a magas prioritású üzenetsorok üzeneteit kérdezi le, majd azután az alacsonyabb prioritású üzenetsorok üzeneteit.</span><span class="sxs-lookup"><span data-stu-id="f746b-126">A variation on this strategy is to have a single pool of consumers that check for messages on high priority queues first, and only then start to fetch messages from lower priority queues.</span></span> <span data-ttu-id="f746b-127">Szemantikai különbségek vannak az egyetlen fogyasztófolyamat-készletet alkalmazó megoldások (ezek használhatnak egyetlen, különböző prioritású üzeneteket támogató üzenetsort vagy több üzenetsort, amelyek mindegyike adott prioritású üzeneteket kezel), illetve az olyan, több üzenetsort használó megoldások között, ahol minden egyes üzenetsorhoz külön készlet tartozik.</span><span class="sxs-lookup"><span data-stu-id="f746b-127">There are some semantic differences between a solution that uses a single pool of consumer processes (either with a single queue that supports messages with different priorities or with multiple queues that each handle messages of a single priority), and a solution that uses multiple queues with a separate pool for each queue.</span></span>

<span data-ttu-id="f746b-128">Az egykészletes módszer esetén a magasabb prioritású üzeneteket fogadása és feldolgozása mindig az alacsonyabb prioritású üzenetek előtt történik.</span><span class="sxs-lookup"><span data-stu-id="f746b-128">In the single pool approach, higher priority messages are always received and processed before lower priority messages.</span></span> <span data-ttu-id="f746b-129">Elméletileg előfordulhat, hogy a nagyon alacsony prioritású üzenetek folyamatosan kiszorulnak, és soha nem lesznek feldolgozva.</span><span class="sxs-lookup"><span data-stu-id="f746b-129">In theory, messages that have a very low priority could be continually superseded and might never be processed.</span></span> <span data-ttu-id="f746b-130">A többkészletes módszerben az alacsonyabb prioritású üzenetek minden esetben fel lesznek dolgozva, csak lassabban, mint a magasabb prioritásúak (a feldolgozás sebessége a készletek relatív méretétől és a rendelkezésre álló erőforrásoktól függ).</span><span class="sxs-lookup"><span data-stu-id="f746b-130">In the multiple pool approach, lower priority messages will always be processed, just not as quickly as those of a higher priority (depending on the relative size of the pools and the resources that they have available).</span></span>

<span data-ttu-id="f746b-131">A prioritásalapú üzenetsor-kezelés alkalmazása a következő előnyökkel jár:</span><span class="sxs-lookup"><span data-stu-id="f746b-131">Using a priority queuing mechanism can provide the following advantages:</span></span>

- <span data-ttu-id="f746b-132">Lehetővé teszi az alkalmazások számára, hogy megfeleljenek azon üzleti követelményeknek, amelyek a rendelkezésre állás vagy a teljesítmény priorizálását igénylik (például különböző szintű szolgáltatást nyújtanak adott ügyfélcsoportok számára).</span><span class="sxs-lookup"><span data-stu-id="f746b-132">It allows applications to meet business requirements that require prioritization of availability or performance, such as offering different levels of service to specific groups of customers.</span></span>

- <span data-ttu-id="f746b-133">Hozzájárulhat az üzemeltetési költségek minimálisra csökkentéséhez.</span><span class="sxs-lookup"><span data-stu-id="f746b-133">It can help to minimize operational costs.</span></span> <span data-ttu-id="f746b-134">Az egykészletes módszerben szükség esetén csökkenthetjük a fogyasztók számát.</span><span class="sxs-lookup"><span data-stu-id="f746b-134">In the single queue approach, you can scale back the number of consumers if necessary.</span></span> <span data-ttu-id="f746b-135">Továbbra is először a magas prioritású üzenetek lesznek feldolgozva (bár esetleg lassabban), az alacsonyabb prioritású üzenetek pedig hosszabb ideig késhetnek.</span><span class="sxs-lookup"><span data-stu-id="f746b-135">High priority messages will still be processed first (although possibly more slowly), and lower priority messages might be delayed for longer.</span></span> <span data-ttu-id="f746b-136">Ha több üzenetsoros megközelítést használ, ahol minden egyes üzenetsorhoz külön fogyasztókészlet tartozik, lecsökkentheti az alacsonyabb prioritású üzenetsorokhoz tartozó fogyasztókészlet nagyságát, vagy akár fel is függesztheti egyes nagyon alacsony prioritású üzenetsorok feldolgozását úgy, hogy leállítja a kérdéses üzenetsorok üzeneteit figyelő fogyasztókat.</span><span class="sxs-lookup"><span data-stu-id="f746b-136">If you've implemented the multiple message queue approach with separate pools of consumers for each queue, you can reduce the pool of consumers for lower priority queues, or even suspend processing for some very low priority queues by stopping all the consumers that listen for messages on those queues.</span></span>

- <span data-ttu-id="f746b-137">A többüzenetsoros megközelítés révén maximalizálható az alkalmazások teljesítménye és skálázhatósága az üzenetek feldolgozási követelményeken alapuló particionálásával.</span><span class="sxs-lookup"><span data-stu-id="f746b-137">The multiple message queue approach can help maximize application performance and scalability by partitioning messages based on processing requirements.</span></span> <span data-ttu-id="f746b-138">Például az alapvető fontosságú feladatok priorizálásával elérhető, hogy azokat azonnal futó fogadók dolgozzák fel, míg a kevésbé fontos háttérfeladatokat a kisebb terhelésű időszakokban futó fogadók kezelhetik.</span><span class="sxs-lookup"><span data-stu-id="f746b-138">For example, vital tasks can be prioritized to be handled by receivers that run immediately while less important background tasks can be handled by receivers that are scheduled to run at less busy periods.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="f746b-139">Problémák és megfontolandó szempontok</span><span class="sxs-lookup"><span data-stu-id="f746b-139">Issues and Considerations</span></span>

<span data-ttu-id="f746b-140">A minta megvalósítása során az alábbi pontokat vegye figyelembe:</span><span class="sxs-lookup"><span data-stu-id="f746b-140">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="f746b-141">Határozza meg a prioritásokat a megoldás tekintetében.</span><span class="sxs-lookup"><span data-stu-id="f746b-141">Define the priorities in the context of the solution.</span></span> <span data-ttu-id="f746b-142">A magas prioritás például azt jelentheti, hogy az üzeneteket tíz másodpercen belül fel kell dolgozni.</span><span class="sxs-lookup"><span data-stu-id="f746b-142">For example, high priority could mean that messages should be processed within ten seconds.</span></span> <span data-ttu-id="f746b-143">Határozza meg a magas prioritású elemek kezelésére vonatkozó követelményeket, valamint az ezen kritériumoknak való megfelelés céljából lefoglalni kívánt egyéb forrásokat.</span><span class="sxs-lookup"><span data-stu-id="f746b-143">Identify the requirements for handling high priority items, and the other resources that should be allocated to meet these criteria.</span></span>

<span data-ttu-id="f746b-144">Döntse el, hogy minden magas prioritású elemet az alacsonyabb prioritású elemek előtt kíván-e feldolgozni.</span><span class="sxs-lookup"><span data-stu-id="f746b-144">Decide if all high priority items must be processed before any lower priority items.</span></span> <span data-ttu-id="f746b-145">Ha az üzeneteket egyetlen fogyasztókészlet dolgozza fel, ehhez olyan mechanizmust kell biztosítani, amely képes visszasorolni és felfüggeszteni az alacsony prioritású üzeneteket kezelő feladatot, ha magasabb prioritású üzenet válik elérhetővé.</span><span class="sxs-lookup"><span data-stu-id="f746b-145">If the messages are being processed by a single pool of consumers, you have to provide a mechanism that can preempt and suspend a task that's handling a low priority message if a higher priority message becomes available.</span></span>

<span data-ttu-id="f746b-146">Ha a több üzenetsoros megközelítésben egyetlen olyan fogyasztófolyamat-készletet használunk, amely az összes üzenetsort, nem pedig az egyes üzenetsorokhoz tartozó dedikált fogyasztókészletet figyeli, a fogyasztónak olyan algoritmust kell alkalmaznia, amely biztosítja, hogy a rendszer mindig előbb a magasabb prioritású üzenetsorok üzeneteit szolgálja ki.</span><span class="sxs-lookup"><span data-stu-id="f746b-146">In the multiple queue approach, when using a single pool of consumer processes that listen on all queues rather than a dedicated consumer pool for each queue, the consumer must apply an algorithm that ensures it always services messages from higher priority queues before those from lower priority queues.</span></span>

<span data-ttu-id="f746b-147">A magas és alacsony prioritású üzenetsorok feldolgozási sebességének monitorozásával biztosítható, hogy az ezen üzenetsorokban lévő üzenetek feldolgozása a várt sebességgel történjen.</span><span class="sxs-lookup"><span data-stu-id="f746b-147">Monitor the processing speed on high and low priority queues to ensure that messages in these queues are processed at the expected rates.</span></span>

<span data-ttu-id="f746b-148">Ha garantálni kell, hogy az alacsony prioritású üzenetek feldolgozása megtörténik, a több üzenetsoros megközelítést több fogyasztókészlettel kell implementálni.</span><span class="sxs-lookup"><span data-stu-id="f746b-148">If you need to guarantee that low priority messages will be processed, it's necessary to implement the multiple message queue approach with multiple pools of consumers.</span></span> <span data-ttu-id="f746b-149">Alternatív megoldásként az üzenetpriorizálást támogató üzenetsorokban lehetséges az üzenetsorban található üzenetek prioritásának dinamikus növelése az idő előrehaladtával.</span><span class="sxs-lookup"><span data-stu-id="f746b-149">Alternatively, in a queue that supports message prioritization, it's possible to dynamically increase the priority of a queued message as it ages.</span></span> <span data-ttu-id="f746b-150">Ezen megközelítés megvalósíthatósága azonban a funkciót biztosító üzenetsortól függ.</span><span class="sxs-lookup"><span data-stu-id="f746b-150">However, this approach depends on the message queue providing this feature.</span></span>

<span data-ttu-id="f746b-151">Külön üzenetsor használata az egyes üzenetprioritásokhoz olyan rendszerek esetében működik a legjobban, amelyek kevés, jól meghatározott prioritással rendelkeznek.</span><span class="sxs-lookup"><span data-stu-id="f746b-151">Using a separate queue for each message priority works best for systems that have a small number of well-defined priorities.</span></span>

<span data-ttu-id="f746b-152">A rendszer képes logikai alapon meghatározni az üzenetprioritásokat.</span><span class="sxs-lookup"><span data-stu-id="f746b-152">Message priorities can be determined logically by the system.</span></span> <span data-ttu-id="f746b-153">Például ahelyett, hogy explicit módon magas és alacsony prioritású üzenetekről beszélnénk, ezek lehetnek „fizető ügyfelek” és „nem fizető ügyfelek”.</span><span class="sxs-lookup"><span data-stu-id="f746b-153">For example, rather than having explicit high and low priority messages, they could be designated as “fee paying customer,” or “non-fee paying customer.”</span></span> <span data-ttu-id="f746b-154">Az üzleti modelltől függően a rendszer több erőforrást foglalhat le a fizető ügyfelektől származó üzenetek feldolgozására, mint a nem fizető ügyfelek esetében.</span><span class="sxs-lookup"><span data-stu-id="f746b-154">Depending on your business model, your system can allocate more resources to processing messages from fee paying customers than non-fee paying ones.</span></span>

<span data-ttu-id="f746b-155">Előfordulhat, hogy pénzügyi és feldolgozási költséggel jár egy üzenet lekérdezése az üzenetsorból (egyes kereskedelmi forgalomban lévő üzenetkezelési rendszerek kis összegű díjat számítanak fel az üzenetek közzétételekor vagy lekérdezésekor, illetve az üzenetek üzenetsorból való lekérésekor).</span><span class="sxs-lookup"><span data-stu-id="f746b-155">There might be a financial and processing cost associated with checking a queue for a message (some commercial messaging systems charge a small fee each time a message is posted or retrieved, and each time a queue is queried for messages).</span></span> <span data-ttu-id="f746b-156">Több üzenetsor lekérdezésekor a költségek is növekednek.</span><span class="sxs-lookup"><span data-stu-id="f746b-156">This cost increases when checking multiple queues.</span></span>

<span data-ttu-id="f746b-157">A készlet által kiszolgált üzenetsor hossza alapján lehetséges a fogyasztókészlet méretének dinamikus módosítása.</span><span class="sxs-lookup"><span data-stu-id="f746b-157">It's possible to dynamically adjust the size of a pool of consumers based on the length of the queue that the pool is servicing.</span></span> <span data-ttu-id="f746b-158">További információ: [Automatikus skálázási útmutató](https://msdn.microsoft.com/library/dn589774.aspx).</span><span class="sxs-lookup"><span data-stu-id="f746b-158">For more information, see the [Autoscaling Guidance](https://msdn.microsoft.com/library/dn589774.aspx).</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="f746b-159">Mikor érdemes ezt a mintát használni?</span><span class="sxs-lookup"><span data-stu-id="f746b-159">When to use this pattern</span></span>

<span data-ttu-id="f746b-160">Ez a minta az alábbi forgatókönyvekben hasznos:</span><span class="sxs-lookup"><span data-stu-id="f746b-160">This pattern is useful in scenarios where:</span></span>

- <span data-ttu-id="f746b-161">A rendszernek több olyan feladatot kell kezelnie, amelyek eltérő prioritásokkal rendelkeznek.</span><span class="sxs-lookup"><span data-stu-id="f746b-161">The system must handle multiple tasks that have different priorities.</span></span>

- <span data-ttu-id="f746b-162">A különböző felhasználókat vagy bérlőket különböző prioritással kell kiszolgálni.</span><span class="sxs-lookup"><span data-stu-id="f746b-162">Different users or tenants should be served with different priority.</span></span>

## <a name="example"></a><span data-ttu-id="f746b-163">Példa</span><span class="sxs-lookup"><span data-stu-id="f746b-163">Example</span></span>

<span data-ttu-id="f746b-164">A Microsoft Azure nem biztosít olyan üzenetsor-kezelési mechanizmust, amely natív módon támogatja az üzenetek rendezéssel történő automatikus priorizálását.</span><span class="sxs-lookup"><span data-stu-id="f746b-164">Microsoft Azure doesn't provide a queuing mechanism that natively supports automatic prioritization of messages through sorting.</span></span> <span data-ttu-id="f746b-165">Biztosít azonban olyan Azure Service Bus-témaköröket és -előfizetéseket, amelyek támogatják az üzenetszűrési szolgáltatást nyújtó üzenetsor-kezelési mechanizmust, valamint számos olyan rugalmas képességet, amelyek ideálissá teszik azt a legtöbb prioritásalapú üzenetsor implementálásakor.</span><span class="sxs-lookup"><span data-stu-id="f746b-165">However, it does provide Azure Service Bus topics and subscriptions that support a queuing mechanism that provides message filtering, together with a wide range of flexible capabilities that make it ideal for use in most priority queue implementations.</span></span>

<span data-ttu-id="f746b-166">Az Azure-megoldások képesek olyan Service Bus-témakörök implementálására, amelybe az alkalmazások az üzenetsorokkal azonos módon üzeneteket tehetnek közzé.</span><span class="sxs-lookup"><span data-stu-id="f746b-166">An Azure solution can implement a Service Bus topic an application can post messages to, in the same way as a queue.</span></span> <span data-ttu-id="f746b-167">Az üzenetek alkalmazások által meghatározott egyéni tulajdonságok formájában metaadatokat tartalmazhatnak.</span><span class="sxs-lookup"><span data-stu-id="f746b-167">Messages can contain metadata in the form of application-defined custom properties.</span></span> <span data-ttu-id="f746b-168">Az adott témakörhöz Service Bus-előfizetések társíthatók, és ezek az előfizetések a tulajdonságaik alapján szűrhetik az üzeneteket.</span><span class="sxs-lookup"><span data-stu-id="f746b-168">Service Bus subscriptions can be associated with the topic, and these subscriptions can filter messages based on their properties.</span></span> <span data-ttu-id="f746b-169">Amikor egy alkalmazás üzenetet küld egy témakörnek, az üzenetet a rendszer a megfelelő előfizetéshez irányítja, ahol a fogyasztó elolvashatja azt.</span><span class="sxs-lookup"><span data-stu-id="f746b-169">When an application sends a message to a topic, the message is directed to the appropriate subscription where it can be read by a consumer.</span></span> <span data-ttu-id="f746b-170">A fogyasztófolyamatok az üzenetek előfizetésből történő lekérdezésére ugyanazt a szemantikát használhatják, mint az üzenetsorok (az előfizetés logikai üzenetsornak tekinthető).</span><span class="sxs-lookup"><span data-stu-id="f746b-170">Consumer processes can retrieve messages from a subscription using the same semantics as a message queue (a subscription is a logical queue).</span></span> <span data-ttu-id="f746b-171">A következő ábrán egy prioritásalapú üzenetsor Azure Service Bus-témakörök és -előfizetések felhasználásával történő implementálása látható.</span><span class="sxs-lookup"><span data-stu-id="f746b-171">The following figure illustrates implementing a priority queue with Azure Service Bus topics and subscriptions.</span></span>

![3. ábra – Prioritásalapú üzenetsor Azure Service Bus-témakörök és -előfizetések felhasználásával történő implementálása](./_images/priority-queue-service-bus.png)


<span data-ttu-id="f746b-173">A fenti ábrán szereplő alkalmazás több üzenetet hoz létre, és hozzájuk rendel egy `Priority` nevű egyéni tulajdonságot és egy értéket (ez `High` vagy `Low` lehet).</span><span class="sxs-lookup"><span data-stu-id="f746b-173">In the figure above, the application creates several messages and assigns a custom property called `Priority` in each message with a value, either `High` or `Low`.</span></span> <span data-ttu-id="f746b-174">Az alkalmazás ezeket az üzeneteket közzéteszi egy témakörbe.</span><span class="sxs-lookup"><span data-stu-id="f746b-174">The application posts these messages to a topic.</span></span> <span data-ttu-id="f746b-175">Ez a témakör két társított előfizetéssel rendelkezik, amelyek a `Priority` tulajdonság megvizsgálásával szűrik az üzeneteket.</span><span class="sxs-lookup"><span data-stu-id="f746b-175">The topic has two associated subscriptions that both filter messages by examining the `Priority` property.</span></span> <span data-ttu-id="f746b-176">Az egyik előfizetés akkor fogad üzeneteket, ha a `Priority` tulajdonság értéke `High`, a másik pedig akkor, ha a `Priority` tulajdonság értéke `Low`.</span><span class="sxs-lookup"><span data-stu-id="f746b-176">One subscription accepts messages where the `Priority` property is set to `High`, and the other accepts messages where the `Priority` property is set to `Low`.</span></span> <span data-ttu-id="f746b-177">Az egyes előfizetésekből fogyasztókészletek olvassák az üzeneteket.</span><span class="sxs-lookup"><span data-stu-id="f746b-177">A pool of consumers reads messages from each subscription.</span></span> <span data-ttu-id="f746b-178">A magas prioritású előfizetések nagyobb készlettel rendelkeznek, és ezek a fogyasztók nagyobb teljesítményű, több erőforrással rendelkező számítógépeken futhatnak, mint az alacsony prioritású készletek fogyasztói.</span><span class="sxs-lookup"><span data-stu-id="f746b-178">The high priority subscription has a larger pool, and these consumers might be running on more powerful computers with more resources available than the consumers in the low priority pool.</span></span>

<span data-ttu-id="f746b-179">Vegye figyelembe, hogy ebben a példában nincs jelentősége a magas és alacsony prioritású üzenetek megjelölésének.</span><span class="sxs-lookup"><span data-stu-id="f746b-179">Note that there's nothing special about the designation of high and low priority messages in this example.</span></span> <span data-ttu-id="f746b-180">Ezek egyszerűen az egyes üzenetekben tulajdonságokként megadott címkék, amelyeket a rendszer arra használ, hogy az üzeneteket egy adott előfizetéshez irányítsák.</span><span class="sxs-lookup"><span data-stu-id="f746b-180">They're simply labels specified as properties in each message, and are used to direct messages to a specific subscription.</span></span> <span data-ttu-id="f746b-181">Ha további priorizálásra van szükség, viszonylag könnyű létrehozni további előfizetéseket fogyasztófolyamat-készleteket ezen prioritások kezeléséhez.</span><span class="sxs-lookup"><span data-stu-id="f746b-181">If additional priorities are required, it's relatively easy to create further subscriptions and pools of consumer processes to handle these priorities.</span></span>

<span data-ttu-id="f746b-182">A [GitHubon](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue) elérhető PriorityQueue megoldás ezen megközelítés egyik implementálását tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="f746b-182">The PriorityQueue solution available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue) contains an implementation of this approach.</span></span> <span data-ttu-id="f746b-183">Ez a megoldás a következő két feldolgozóiszerepkör-projektet tartalmazza: `PriorityQueue.High` és `PriorityQueue.Low`.</span><span class="sxs-lookup"><span data-stu-id="f746b-183">This solution contains two worker role projects named `PriorityQueue.High` and `PriorityQueue.Low`.</span></span> <span data-ttu-id="f746b-184">Ezek a feldolgozói szerepkörök a `PriorityWorkerRole` osztály tulajdonságait öröklik, amely az adott előfizetéshez való csatlakozási funkciót tartalmazza az `OnStart` metódusban.</span><span class="sxs-lookup"><span data-stu-id="f746b-184">These worker roles inherit from the `PriorityWorkerRole` class that contains the functionality for connecting to a specified subscription in the `OnStart` method.</span></span>

<span data-ttu-id="f746b-185">A `PriorityQueue.High` és a `PriorityQueue.Low` feldolgozói szerepkör különböző előfizetésekhez csatlakozik, amelyet a konfigurációs beállítások határoznak meg.</span><span class="sxs-lookup"><span data-stu-id="f746b-185">The `PriorityQueue.High` and `PriorityQueue.Low` worker roles connect to different subscriptions, defined by their configuration settings.</span></span> <span data-ttu-id="f746b-186">A rendszergazdák külön-külön konfigurálhatják a futtatni kívánt szerepkörök számát.</span><span class="sxs-lookup"><span data-stu-id="f746b-186">An administrator can configure different numbers of each role to be run.</span></span> <span data-ttu-id="f746b-187">Jellemzően a `PriorityQueue.High` feldolgozói szerepkör több példánya fog futni, mint a `PriorityQueue.Low` feldolgozói szerepkörből.</span><span class="sxs-lookup"><span data-stu-id="f746b-187">Typically there'll be more instances of the `PriorityQueue.High` worker role than the `PriorityQueue.Low` worker role.</span></span>

<span data-ttu-id="f746b-188">A `PriorityWorkerRole` osztály `Run` metódusa kezeli az üzenetsorban fogadott üzenetek esetében futtatandó virtuális `ProcessMessage` metódust (amely szintén a `PriorityWorkerRole` osztályban van meghatározva).</span><span class="sxs-lookup"><span data-stu-id="f746b-188">The `Run` method in the `PriorityWorkerRole` class arranges for the virtual `ProcessMessage` method (also defined in the `PriorityWorkerRole` class) to be run for each message received on the queue.</span></span> <span data-ttu-id="f746b-189">A következő kód a `Run` és a `ProcessMessage` metódust mutatja be.</span><span class="sxs-lookup"><span data-stu-id="f746b-189">The following code shows the `Run` and `ProcessMessage` methods.</span></span> <span data-ttu-id="f746b-190">A PriorityQueue.Shared projektben meghatározott `QueueManager` osztály Azure Service Bus-üzenetsorok használatához biztosít segédmetódusokat.</span><span class="sxs-lookup"><span data-stu-id="f746b-190">The `QueueManager` class, defined in the PriorityQueue.Shared project, provides helper methods for using Azure Service Bus queues.</span></span>

```csharp
public class PriorityWorkerRole : RoleEntryPoint
{
  private QueueManager queueManager;
  ...

  public override void Run()
  {
    // Start listening for messages on the subscription.
    var subscriptionName = CloudConfigurationManager.GetSetting("SubscriptionName");
    this.queueManager.ReceiveMessages(subscriptionName, this.ProcessMessage);
    ...;
  }
  ...

  protected virtual async Task ProcessMessage(BrokeredMessage message)
  {
    // Simulating processing.
    await Task.Delay(TimeSpan.FromSeconds(2));
  }
}
```
<span data-ttu-id="f746b-191">A `PriorityQueue.High` és a `PriorityQueue.Low` feldolgozói szerepkör egyaránt felülírja a `ProcessMessage` metódus alapértelmezett funkcióját.</span><span class="sxs-lookup"><span data-stu-id="f746b-191">The `PriorityQueue.High` and `PriorityQueue.Low` worker roles both override the default functionality of the `ProcessMessage` method.</span></span> <span data-ttu-id="f746b-192">Az alábbi kód a `PriorityQueue.High` feldolgozói szerepkör `ProcessMessage` metódusát mutatja be.</span><span class="sxs-lookup"><span data-stu-id="f746b-192">The code below shows the `ProcessMessage` method for the `PriorityQueue.High` worker role.</span></span>

```csharp
protected override async Task ProcessMessage(BrokeredMessage message)
{
  // Simulate message processing for High priority messages.
  await base.ProcessMessage(message);
  Trace.TraceInformation("High priority message processed by " +
    RoleEnvironment.CurrentRoleInstance.Id + " MessageId: " + message.MessageId);
}
```

<span data-ttu-id="f746b-193">Ha egy alkalmazás a `PriorityQueue.High` és a `PriorityQueue.Low` feldolgozói szerepkör által használt előfizetésekhez rendelt témakörökben tesz közzé üzeneteket, akkor a `Priority` egyéni tulajdonság használatával adja meg azok prioritását, ahogyan az az alábbi mintakód esetében is látható.</span><span class="sxs-lookup"><span data-stu-id="f746b-193">When an application posts messages to the topic associated with the subscriptions used by the `PriorityQueue.High` and `PriorityQueue.Low` worker roles, it specifies the priority by using the `Priority` custom property, as shown in the following code example.</span></span> <span data-ttu-id="f746b-194">Ez a (PriorityQueue.Sender projekt `WorkerRole` osztályában implementált) kód a `QueueManager` osztály `SendBatchAsync` segédmetódusát használja az üzenetek témakörökben történő kötegelt közzétételéhez.</span><span class="sxs-lookup"><span data-stu-id="f746b-194">This code (implemented in the `WorkerRole` class in the PriorityQueue.Sender project), uses the `SendBatchAsync` helper method of the `QueueManager` class to post messages to a topic in batches.</span></span>

```csharp
// Send a low priority batch.
var lowMessages = new List<BrokeredMessage>();

for (int i = 0; i < 10; i++)
{
  var message = new BrokeredMessage() { MessageId = Guid.NewGuid().ToString() };
  message.Properties["Priority"] = Priority.Low;
  lowMessages.Add(message);
}

this.queueManager.SendBatchAsync(lowMessages).Wait();
...

// Send a high priority batch.
var highMessages = new List<BrokeredMessage>();

for (int i = 0; i < 10; i++)
{
  var message = new BrokeredMessage() { MessageId = Guid.NewGuid().ToString() };
  message.Properties["Priority"] = Priority.High;
  highMessages.Add(message);
}

this.queueManager.SendBatchAsync(highMessages).Wait();
```

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="f746b-195">Kapcsolódó minták és útmutatók</span><span class="sxs-lookup"><span data-stu-id="f746b-195">Related patterns and guidance</span></span>

<span data-ttu-id="f746b-196">Az alábbi minták és útmutatók szintén hasznosak lehetnek a minta megvalósításakor:</span><span class="sxs-lookup"><span data-stu-id="f746b-196">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="f746b-197">A [GitHubon](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue) talál egy, a minta bemutatására szolgáló példát.</span><span class="sxs-lookup"><span data-stu-id="f746b-197">A sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/priority-queue).</span></span>

- <span data-ttu-id="f746b-198">[Az aszinkron üzenetkezelés ismertetése](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="f746b-198">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="f746b-199">Lehetséges, hogy a kérelmet feldolgozó fogyasztói szolgáltatásnak választ kell küldenie a kérelmet közzétevő alkalmazáspéldány számára.</span><span class="sxs-lookup"><span data-stu-id="f746b-199">A consumer service that processes a request might need to send a reply to the instance of the application that posted the request.</span></span> <span data-ttu-id="f746b-200">Információkat nyújt a kérelem/válasz típusú üzenetkezelés implementálásakor használható stratégiákról.</span><span class="sxs-lookup"><span data-stu-id="f746b-200">Provides information on the strategies that you can use to implement request/response messaging.</span></span>

- <span data-ttu-id="f746b-201">[Versengő felhasználókat ismertető minta](competing-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="f746b-201">[Competing Consumers pattern](competing-consumers.md).</span></span> <span data-ttu-id="f746b-202">Az üzenetsorok átviteli sebességének növelése érdekében lehetséges, hogy több fogyasztó figyelje ugyanazt az üzenetsort, és egyidejűleg dolgozza fel a feladatokat.</span><span class="sxs-lookup"><span data-stu-id="f746b-202">To increase the throughput of the queues, it’s possible to have multiple consumers that listen on the same queue, and process the tasks in parallel.</span></span> <span data-ttu-id="f746b-203">Ezek a fogyasztók versenyezni fognak az üzenetekért, de egy adott üzenetet csak egy dolgozhat fel.</span><span class="sxs-lookup"><span data-stu-id="f746b-203">These consumers will compete for messages, but only one should be able to process each message.</span></span> <span data-ttu-id="f746b-204">További információkat biztosít ezen megközelítés implementálásának előnyeiről és hátrányairól.</span><span class="sxs-lookup"><span data-stu-id="f746b-204">Provides more information on the benefits and tradeoffs of implementing this approach.</span></span>

- <span data-ttu-id="f746b-205">[Szabályozási minta](throttling.md).</span><span class="sxs-lookup"><span data-stu-id="f746b-205">[Throttling pattern](throttling.md).</span></span> <span data-ttu-id="f746b-206">A szabályozás üzenetsorok használatával valósítható meg.</span><span class="sxs-lookup"><span data-stu-id="f746b-206">You can implement throttling by using queues.</span></span> <span data-ttu-id="f746b-207">A prioritásalapú üzenetkezelés annak biztosítására használható, hogy a kritikus vagy a fontos ügyfelek által futtatott alkalmazások elsőbbséget élvezzenek a kevésbé fontos alkalmazások kérelmeihez képest.</span><span class="sxs-lookup"><span data-stu-id="f746b-207">Priority messaging can be used to ensure that requests from critical applications, or applications being run by high-value customers, are given priority over requests from less important applications.</span></span>

- <span data-ttu-id="f746b-208">[Útmutató az automatikus skálázáshoz](https://msdn.microsoft.com/library/dn589774.aspx).</span><span class="sxs-lookup"><span data-stu-id="f746b-208">[Autoscaling Guidance](https://msdn.microsoft.com/library/dn589774.aspx).</span></span> <span data-ttu-id="f746b-209">Lehetségessé válhat az üzenetsorokat kezelő fogyasztófolyamat-készletek méretének skálázása az üzenetsor hosszától függően.</span><span class="sxs-lookup"><span data-stu-id="f746b-209">It might be possible to scale the size of the pool of consumer processes handling a queue depending on the length of the queue.</span></span> <span data-ttu-id="f746b-210">Ezzel a stratégiával javítható a teljesítmény, különösen a magas prioritású üzeneteket kezelő készletek esetében.</span><span class="sxs-lookup"><span data-stu-id="f746b-210">This strategy can help to improve performance, especially for pools handling high priority messages.</span></span>

- <span data-ttu-id="f746b-211">[Vállalati integrációs minták a Service Bus használatával](https://abhishekrlal.com/2013/01/11/enterprise-integration-patterns-with-service-bus-part-2/) Abhishek Lal blogjában.</span><span class="sxs-lookup"><span data-stu-id="f746b-211">[Enterprise Integration Patterns with Service Bus](https://abhishekrlal.com/2013/01/11/enterprise-integration-patterns-with-service-bus-part-2/) on Abhishek Lal’s blog.</span></span>

