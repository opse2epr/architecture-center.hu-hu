---
title: Horizontális
description: Adattároló felosztani vízszintes partíciók vagy szilánkok készlete.
keywords: Kialakítási mintája
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- data-management
- performance-scalability
ms.openlocfilehash: 328483e24c75137f07576104d50dc59d426b8ac4
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 11/14/2017
ms.locfileid: "24543017"
---
# <a name="sharding-pattern"></a><span data-ttu-id="0f1c8-104">Horizontális minta</span><span class="sxs-lookup"><span data-stu-id="0f1c8-104">Sharding pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="0f1c8-105">Adattároló felosztani vízszintes partíciók vagy szilánkok készlete.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-105">Divide a data store into a set of horizontal partitions or shards.</span></span> <span data-ttu-id="0f1c8-106">Ez javítja az méretezhetőséget, amikor tárolásához és eléréséhez nagy mennyiségű adatot.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-106">This can improve scalability when storing and accessing large volumes of data.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="0f1c8-107">A környezetben, és probléma</span><span class="sxs-lookup"><span data-stu-id="0f1c8-107">Context and problem</span></span>

<span data-ttu-id="0f1c8-108">Egyetlen kiszolgálón található adattároló lehet a következő korlátozások vonatkoznak:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-108">A data store hosted by a single server might be subject to the following limitations:</span></span>

- <span data-ttu-id="0f1c8-109">**Tárolóhely**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-109">**Storage space**.</span></span> <span data-ttu-id="0f1c8-110">A felügyeleti teendők központjaként felhőalapú alkalmazások tárolóban van kellett volna tartalmaznia túl nagy mennyiségű adatok, amelyek adott idő alatt jelentősen nő.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-110">A data store for a large-scale cloud application is expected to contain a huge volume of data that could increase significantly over time.</span></span> <span data-ttu-id="0f1c8-111">Egy kiszolgáló általában csak a lemezes tárolás véges mennyiségű tartalmaz, de cserélje le a meglévő lemezek és nagyobb, vagy vegye fel a gépek további lemezek adatmennyiség növekedésével.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-111">A server typically provides only a finite amount of disk storage, but you can replace existing disks with larger ones, or add further disks to a machine as data volumes grow.</span></span> <span data-ttu-id="0f1c8-112">Azonban a rendszer végül eléri a maximális ahol nem lehet könnyen növelje a tárolókapacitást a megadott kiszolgálón.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-112">However, the system will eventually reach a limit where it isn't possible to easily increase the storage capacity on a given server.</span></span>

- <span data-ttu-id="0f1c8-113">**Számítási erőforrások**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-113">**Computing resources**.</span></span> <span data-ttu-id="0f1c8-114">A felhőalapú alkalmazások szükség, hogy számos egyidejű felhasználók, amelyek az adattárból adatbeolvasás lekérdezések futtatásához.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-114">A cloud application is required to support a large number of concurrent users, each of which run queries that retrieve information from the data store.</span></span> <span data-ttu-id="0f1c8-115">Az adattár üzemeltető egyetlen kiszolgálót nem lehet a terhelés, ami hosszú válaszidejét a felhasználók és a gyakori hibák alkalmazásokat tárolásához és lekéréséhez adatok túllépi az időkorlátot, támogatásához szükséges számítási teljesítményt nyújt. Lehetséges, memória- vagy frissítési processzorok hozzáadása, de a rendszer eléri a határértéket során nem lehet növelni a számítási erőforrásokat minden további.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-115">A single server hosting the data store might not be able to provide the necessary computing power to support this load, resulting in extended response times for users and frequent failures as applications attempting to store and retrieve data time out. It might be possible to add memory or upgrade processors, but the system will reach a limit when it isn't possible to increase the compute resources any further.</span></span>

- <span data-ttu-id="0f1c8-116">**A hálózati sávszélesség**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-116">**Network bandwidth**.</span></span> <span data-ttu-id="0f1c8-117">Végső soron a tárolóban futó egyetlen kiszolgáló teljesítményének vonatkozik az átviteli sebesség a kiszolgáló fogadhatók kérések és válaszok küldhet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-117">Ultimately, the performance of a data store running on a single server is governed by the rate the server can receive requests and send replies.</span></span> <span data-ttu-id="0f1c8-118">Akkor lehet, hogy a hálózati forgalom mennyiségének meghaladhatja a hálózat, a kiszolgáló, ami azt eredményezi, a sikertelen kérelmek való kapcsolódáshoz használt kapacitás.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-118">It's possible that the volume of network traffic might exceed the capacity of the network used to connect to the server, resulting in failed requests.</span></span>

- <span data-ttu-id="0f1c8-119">**A földrajzi**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-119">**Geography**.</span></span> <span data-ttu-id="0f1c8-120">Azoknak a felhasználóknak a jogi, a megfelelőségi vagy a teljesítmény szempontjából ugyanabban a régióban adott felhasználók által létrehozott adatok tárolására, vagy adatokhoz való hozzáférés késés csökkentése érdekében szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-120">It might be necessary to store data generated by specific users in the same region as those users for legal, compliance, or performance reasons, or to reduce latency of data access.</span></span> <span data-ttu-id="0f1c8-121">Ha a felhasználók kerülnek át más országokból vagy régiókból között, hogy előfordulhat, hogy nem lehet az alkalmazás teljes adat egyetlen adattárolóban tárolja.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-121">If the users are dispersed across different countries or regions, it might not be possible to store the entire data for the application in a single data store.</span></span>

<span data-ttu-id="0f1c8-122">Skálázás függőleges adja hozzá a további lemezkapacitást, a feldolgozási teljesítmény, a memória és a hálózati kapcsolatok halaszthatják el a ezek a korlátozások némelyike hatásait, de valószínűleg csak egy ideiglenes megoldás.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-122">Scaling vertically by adding more disk capacity, processing power, memory, and network connections can postpone the effects of some of these limitations, but it's likely to only be a temporary solution.</span></span> <span data-ttu-id="0f1c8-123">Egy kereskedelmi felhő alkalmazás képes nagyszámú felhasználó és a nagy mennyiségű adatot a méretezési szinte határozatlan ideig, képesnek kell lennie, így függőleges skálázás nem feltétlenül a legjobb megoldás.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-123">A commercial cloud application capable of supporting large numbers of users and high volumes of data must be able to scale almost indefinitely, so vertical scaling isn't necessarily the best solution.</span></span>

## <a name="solution"></a><span data-ttu-id="0f1c8-124">Megoldás</span><span class="sxs-lookup"><span data-stu-id="0f1c8-124">Solution</span></span>

<span data-ttu-id="0f1c8-125">Az adattár felosztani vízszintes partíciók, sem a szilánkok.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-125">Divide the data store into horizontal partitions or shards.</span></span> <span data-ttu-id="0f1c8-126">Minden egyes shard ugyanazon séma rendelkezik, de a saját az adatok különböző részét tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-126">Each shard has the same schema, but holds its own distinct subset of the data.</span></span> <span data-ttu-id="0f1c8-127">A szilánkok a saját jobb (az adatok különböző típusú számos olyan entitás tartalmazhat), a tárolási csomópontnak működő kiszolgálón fusson a tárolóban.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-127">A shard is a data store in its own right (it can contain the data for many entities of different types), running on a server acting as a storage node.</span></span>

<span data-ttu-id="0f1c8-128">Ebben a mintában használata a következő előnyökkel jár:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-128">This pattern has the following benefits:</span></span>

- <span data-ttu-id="0f1c8-129">További tárhely csomópontokon futó szilánkok hozzáadásával, méretezhető, a rendszer.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-129">You can scale the system out by adding further shards running on additional storage nodes.</span></span>

- <span data-ttu-id="0f1c8-130">A rendszer minden egyes tárhely csomópontot is használhat speciális és költséges számítógépek helyett a vásárolt hardver.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-130">A system can use off-the-shelf hardware rather than specialized and expensive computers for each storage node.</span></span>

- <span data-ttu-id="0f1c8-131">Csökkentse a versengés, és a jobb teljesítmény érdekében a munkaterhelés terheléselosztás szilánkok között.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-131">You can reduce contention and improve performance by balancing the workload across shards.</span></span>

- <span data-ttu-id="0f1c8-132">A felhőben szilánkok lesz fér hozzá az adatokhoz, a felhasználók fizikailag közel található lehet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-132">In the cloud, shards can be located physically close to the users that'll access the data.</span></span>

<span data-ttu-id="0f1c8-133">A szilánkok felosztásával az adatok tárolja, amikor döntse el, mely adatokra minden shard kell helyezni.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-133">When dividing a data store up into shards, decide which data should be placed in each shard.</span></span> <span data-ttu-id="0f1c8-134">A szilánkok általában olyan elemeket tartalmaz, az adatok egy vagy több attribútum határozza meg a meghatározott tartományba tartoznak.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-134">A shard typically contains items that fall within a specified range determined by one or more attributes of the data.</span></span> <span data-ttu-id="0f1c8-135">Ezek az attribútumok alkotják a shard kulcsot (más néven a partíciós kulcs).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-135">These attributes form the shard key (sometimes referred to as the partition key).</span></span> <span data-ttu-id="0f1c8-136">A szilánkok kulcs lehet statikus.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-136">The shard key should be static.</span></span> <span data-ttu-id="0f1c8-137">Azt nem kell adatok alapján, amely módosíthatja.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-137">It shouldn't be based on data that might change.</span></span>

<span data-ttu-id="0f1c8-138">Horizontális fizikailag rendezi az adatokat.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-138">Sharding physically organizes the data.</span></span> <span data-ttu-id="0f1c8-139">Ha egy alkalmazás tárolja, és olvassa ki az adatokat, a horizontális logika irányítja az alkalmazást a megfelelő szilánkcímtárban.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-139">When an application stores and retrieves data, the sharding logic directs the application to the appropriate shard.</span></span> <span data-ttu-id="0f1c8-140">A horizontális logika valósítható meg az adatok hozzáférési kódot az alkalmazás részeként, vagy azt lehetett végrehajtani az adatok tárolási rendszer Ha transzparens módon támogatja a horizontális.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-140">This sharding logic can be implemented as part of the data access code in the application, or it could be implemented by the data storage system if it transparently supports sharding.</span></span>

<span data-ttu-id="0f1c8-141">A horizontális logika adatainak fizikai helyét absztrakt biztosít egy magas szintű szabályozást, amelyben a szilánkok milyen adatokat tartalmaznak.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-141">Abstracting the physical location of the data in the sharding logic provides a high level of control over which shards contain which data.</span></span> <span data-ttu-id="0f1c8-142">Azt is lehetővé teszi az adatok anélkül, hogy az üzleti logika egy alkalmazás reworking, ha az adatokat a szilánkok kell (például, ha a szilánkok válnak egyenetlen) később terjeszthető szilánkok közötti áttelepítése.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-142">It also enables data to migrate between shards without reworking the business logic of an application if the data in the shards need to be redistributed later (for example, if the shards become unbalanced).</span></span> <span data-ttu-id="0f1c8-143">Az kompromisszumot meghatározni, hogy a hely minden egyes adatelem, lekéri azt terhet szükséges további adatok hozzáférést.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-143">The tradeoff is the additional data access overhead required in determining the location of each data item as it's retrieved.</span></span>

<span data-ttu-id="0f1c8-144">Optimális teljesítményének és méretezhetőségének biztosításához fontos az adatok úgy, hogy megfelelő-e a lekérdezések, az alkalmazás végző típusú.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-144">To ensure optimal performance and scalability, it's important to split the data in a way that's appropriate for the types of queries that the application performs.</span></span> <span data-ttu-id="0f1c8-145">Sok esetben nem valószínű, hogy a horizontális rendszer pontosan megegyeznek minden egyes lekérdezés követelményeinek.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-145">In many cases, it's unlikely that the sharding scheme will exactly match the requirements of every query.</span></span> <span data-ttu-id="0f1c8-146">Például egy több-bérlős rendszerben az alkalmazás módosítania kell a bérlő azonosítójával bérlői adatok beolvasásához, de azt is módosítania kell az adatokat, például a bérlő nevét vagy helyét néhány más attribútum alapján kereshet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-146">For example, in a multi-tenant system an application might need to retrieve tenant data using the tenant ID, but it might also need to look up this data based on some other attribute such as the tenant’s name or location.</span></span> <span data-ttu-id="0f1c8-147">Ezek közül valamelyik helyzet kezelésére, egy horizontális skálázási stratégia végrehajtása, amely támogatja a leggyakrabban végrehajtott lekérdezések shard kulccsal.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-147">To handle these situations, implement a sharding strategy with a shard key that supports the most commonly performed queries.</span></span>

<span data-ttu-id="0f1c8-148">Ha lekérdezések rendszeresen lekéréséhez használata az attribútumértékek adatok attribútumok összekapcsoló által valószínűleg határozhat meg egy összetett shard kulcsot.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-148">If queries regularly retrieve data using a combination of attribute values, you can likely define a composite shard key by linking attributes together.</span></span> <span data-ttu-id="0f1c8-149">Másik megoldásként használhatja például a minta [Index táblázat](index-table.md) arra, hogy gyors értékét a adatokat olyan attribútumok, amelyek nem fedi le a shard kulcs alapján.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-149">Alternatively, use a pattern such as [Index Table](index-table.md) to provide fast lookup to data based on attributes that aren't covered by the shard key.</span></span>

## <a name="sharding-strategies"></a><span data-ttu-id="0f1c8-150">Horizontális stratégiák</span><span class="sxs-lookup"><span data-stu-id="0f1c8-150">Sharding strategies</span></span>

<span data-ttu-id="0f1c8-151">Három stratégiák gyakran használják a shard kiválasztásakor kulcs és az adatok szét szilánkok módjának.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-151">Three strategies are commonly used when selecting the shard key and deciding how to distribute data across shards.</span></span> <span data-ttu-id="0f1c8-152">Vegye figyelembe, hogy nem kell lennie egy-az-egyhez levelezés szilánkok és az azokat üzemeltető kiszolgálók között&mdash;egyetlen kiszolgáló, rendelkezhet több szegmensben osztják.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-152">Note that there doesn't have to be a one-to-one correspondence between shards and the servers that host them&mdash;a single server can host multiple shards.</span></span> <span data-ttu-id="0f1c8-153">A stratégia a következő:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-153">The strategies are:</span></span>

<span data-ttu-id="0f1c8-154">**A keresési stratégia**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-154">**The Lookup strategy**.</span></span> <span data-ttu-id="0f1c8-155">Ezt a stratégiát a horizontális logika valósítja meg, hogy a shard shard kulcs használatával adatokat tartalmazó továbbítja az adatokat kér.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-155">In this strategy the sharding logic implements a map that routes a request for data to the shard that contains that data using the shard key.</span></span> <span data-ttu-id="0f1c8-156">Egy több-bérlős alkalmazásban egy bérlő számára az adatok tárolódhat együtt egy shard shard kulcsként bérlői azonosító használatával.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-156">In a multi-tenant application all the data for a tenant might be stored together in a shard using the tenant ID as the shard key.</span></span> <span data-ttu-id="0f1c8-157">Több bérlő megosztott ugyanazt a shard, de egyetlen bérlő számára az adatok nem lehet több szilánkok elosztva.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-157">Multiple tenants might share the same shard, but the data for a single tenant won't be spread across multiple shards.</span></span> <span data-ttu-id="0f1c8-158">Az ábrán láthatja a horizontális bérlői adatokat a bérlői azonosító alapján.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-158">The figure illustrates sharding tenant data based on tenant IDs.</span></span>

   ![1. ábra – horizontális bérlői adatokat a bérlői azonosító alapján](./_images/sharding-tenant.png)


   <span data-ttu-id="0f1c8-160">A szilánkok kulcs és a tárolóhely közötti leképezést is alapulhat fizikai szilánkok, ahol minden shard kulcs van leképezve a fizikai partícióján.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-160">The mapping between the shard key and the physical storage can be based on physical shards where each shard key maps to a physical partition.</span></span> <span data-ttu-id="0f1c8-161">Azt is megteheti a szilánkok újraelosztás rugalmasabb módszer virtuális particionálás, ahol shard kulcsok virtuális szilánkok, amely pedig kevesebb fizikai partíciók leképezése azonos számú hozzárendelését.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-161">Alternatively, a more flexible technique for rebalancing shards is virtual partitioning, where shard keys map to the same number of virtual shards, which in turn map to fewer physical partitions.</span></span> <span data-ttu-id="0f1c8-162">Ezt a módszert használja egy alkalmazás megkeresi, hogy egy virtuális shard hivatkozik a shard kulccsal adatok, és a rendszer transzparens módon van leképezve virtuális szilánkok fizikai partíciók.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-162">In this approach, an application locates data using a shard key that refers to a virtual shard, and the system transparently maps virtual shards to physical partitions.</span></span> <span data-ttu-id="0f1c8-163">Egy virtuális shard és egy fizikai partíció közötti leképezést anélkül, hogy az alkalmazáskódban shard kulcsok különböző szabálykészleteket használnak módosítani módosíthatja.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-163">The mapping between a virtual shard and a physical partition can change without requiring the application code be modified to use a different set of shard keys.</span></span>

<span data-ttu-id="0f1c8-164">**A tartomány stratégia**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-164">**The Range strategy**.</span></span> <span data-ttu-id="0f1c8-165">Ezt a stratégiát kapcsolódó elemeket együtt ugyanazt a shard csoportosítja, és rendelések azokat a shard kulcs által&mdash;a shard kulcsokban szekvenciális.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-165">This strategy groups related items together in the same shard, and orders them by shard key&mdash;the shard keys are sequential.</span></span> <span data-ttu-id="0f1c8-166">Érdemes gyakran beolvasása (lekérdezések tér vissza, amely a megadott tartományba esik shard kulcsok adatelemek) tartománya lekérdezések alkalmazásával készleteinek alkalmazások esetében.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-166">It's useful for applications that frequently retrieve sets of items using range queries (queries that return a set of data items for a shard key that falls within a given range).</span></span> <span data-ttu-id="0f1c8-167">Például ha egy alkalmazás rendszeresen meg kell keresnie egy adott hónap összes megrendelések, ezek az adatok gyorsabban esetén lekérhetők ugyanazt a shard dátum és idő sorrendben összes rendelés egy hónapig tárolódnak.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-167">For example, if an application regularly needs to find all orders placed in a given month, this data can be retrieved more quickly if all orders for a month are stored in date and time order in the same shard.</span></span> <span data-ttu-id="0f1c8-168">Ha egy másik shard minden rendelés tárolta, azok kellene (egyetlen adatelemet visszaadó lekérdezések) pont lekérdezések nagy számú elvégzésével külön-külön lehet lekérni.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-168">If each order was stored in a different shard, they'd have to be fetched individually by performing a large number of point queries (queries that return a single data item).</span></span> <span data-ttu-id="0f1c8-169">Az alábbi ábrán láthatja a szekvenciális beállítása (tartományok) az adatok tárolása a shard.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-169">The next figure illustrates storing sequential sets (ranges) of data in shard.</span></span>

   ![2. ábra – szilánkok szekvenciális beállítása (tartományok) az adatok tárolása](./_images/sharding-sequential-sets.png)

<span data-ttu-id="0f1c8-171">Ebben a példában a shard kulcsa, mint a legjelentősebb elem, amelyeket az a sorrend idő a rendelés hónapot tartalmazó összetett kulcsot.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-171">In this example, the shard key is a composite key containing the order month as the most significant element, followed by the order day and the time.</span></span> <span data-ttu-id="0f1c8-172">Rendelések adatok természetes van rendezve, amikor új rendelések létrehozása és egy shard hozzáadni.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-172">The data for orders is naturally sorted when new orders are created and added to a shard.</span></span> <span data-ttu-id="0f1c8-173">Néhány tárolók támogatási kétrészes shard kulcsokat tartalmazó partíció fő eleme, amely azonosítja a shard és egy sor kulcsot, amely egyedileg azonosít egy elem található a szilánkcímtárban.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-173">Some data stores support two-part shard keys containing a partition key element that identifies the shard and a row key that uniquely identifies an item in the shard.</span></span> <span data-ttu-id="0f1c8-174">Adatok sor a shard kulcs sorrend általában használatban van.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-174">Data is usually held in row key order in the shard.</span></span> <span data-ttu-id="0f1c8-175">Lekérdezések vonatkoznak, és csoportosíthatók kell elemekre billentyűvel a shard a partíciós kulcs ugyanazt az értéket, de a sorkulcs egy egyedi értéket.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-175">Items that are subject to range queries and need to be grouped together can use a shard key that has the same value for the partition key but a unique value for the row key.</span></span>

<span data-ttu-id="0f1c8-176">**A kivonatoló stratégia**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-176">**The Hash strategy**.</span></span> <span data-ttu-id="0f1c8-177">Ezt a stratégiát célja az esélye, interaktív (szilánkok terhelés le aránytalanul nagy mennyiségű fogadó) csökkentése érdekében.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-177">The purpose of this strategy is to reduce the chance of hotspots (shards that receive a disproportionate amount of load).</span></span> <span data-ttu-id="0f1c8-178">Az adatok elosztja a szilánkok oly módon, hogy éri el az egyes shard méretét és az átlagos terhelés, amely minden shard fog történni.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-178">It distributes the data across the shards in a way that achieves a balance between the size of each shard and the average load that each shard will encounter.</span></span> <span data-ttu-id="0f1c8-179">A horizontális logika kiszámítja elemének tárolására a shard kivonatát, egy vagy több attribútumai alapján.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-179">The sharding logic computes the shard to store an item in based on a hash of one or more attributes of the data.</span></span> <span data-ttu-id="0f1c8-180">A választott kivonatolási függvény kell szét adatok egyenletesen a szilánkok valószínűleg azokat a számítási néhány véletlenszerű elem bevezetésével.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-180">The chosen hashing function should distribute data evenly across the shards, possibly by introducing some random element into the computation.</span></span> <span data-ttu-id="0f1c8-181">Az alábbi ábrán láthatja a horizontális bérlői adatokat egy kivonatoló azonosítók bérlő alapján.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-181">The next figure illustrates sharding tenant data based on a hash of tenant IDs.</span></span>

   ![3. ábra – horizontális bérlői adatokat egy kivonatoló azonosítók bérlő alapján](./_images/sharding-data-hash.png)

<span data-ttu-id="0f1c8-183">Tudni, hogy az az előnye, hogy a kivonat stratégia keresztül más horizontális stratégiák, fontolja meg, hogyan egy több-bérlős alkalmazás, amely új bérlők egymás után előfordulhat, hogy hozzárendelése a bérlők szilánkok szerepel az adattárban.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-183">To understand the advantage of the Hash strategy over other sharding strategies, consider how a multi-tenant application that enrolls new tenants sequentially might assign the tenants to shards in the data store.</span></span> <span data-ttu-id="0f1c8-184">Ha a tartomány stratégia, az adatokat a bérlők számára 1-n használata az összes tárolódnak shard A, az adatokat a bérlők n + 1 m összes tárolódnak a shard B, és így tovább.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-184">When using the Range strategy, the data for tenants 1 to n will all be stored in shard A, the data for tenants n+1 to m will all be stored in shard B, and so on.</span></span> <span data-ttu-id="0f1c8-185">Ha a közelmúltban regisztrált bérlők is a legaktívabb, a legtöbb tevékenység szilánkok, így elérési pontokhoz való kis számú történik.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-185">If the most recently registered tenants are also the most active, most data activity will occur in a small number of shards, which could cause hotspots.</span></span> <span data-ttu-id="0f1c8-186">Ezzel szemben a kivonat stratégia foglal le bérlők számára szilánkok alapján kivonatát, a bérlő azonosítója.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-186">In contrast, the Hash strategy allocates tenants to shards based on a hash of their tenant ID.</span></span> <span data-ttu-id="0f1c8-187">Ez azt jelenti, hogy a soros bérlők várhatóan osztható ki másik szilánkok, amely lesz a terhelés szétosztását őket.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-187">This means that sequential tenants are most likely to be allocated to different shards, which will distribute the load across them.</span></span> <span data-ttu-id="0f1c8-188">Az előző ábra ezt mutatja be a bérlők számára 55 és 56.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-188">The previous figure shows this for tenants 55 and 56.</span></span>

<span data-ttu-id="0f1c8-189">A három horizontális stratégiák rendelkezik, a következő előnyöket és szempontok:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-189">The three sharding strategies have the following advantages and considerations:</span></span>

- <span data-ttu-id="0f1c8-190">**Keresési**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-190">**Lookup**.</span></span> <span data-ttu-id="0f1c8-191">Ez kínál a úgy, hogy szilánkok konfigurálható és használható teljesebb körű vezérlése.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-191">This offers more control over the way that shards are configured and used.</span></span> <span data-ttu-id="0f1c8-192">Virtuális szilánkok használata csökkenti a hatása, ha újraelosztás adatok, mert az új fizikai partíciók felveheti a terhelés kiegyenlítése érdekében.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-192">Using virtual shards reduces the impact when rebalancing data because new physical partitions can be added to even out the workload.</span></span> <span data-ttu-id="0f1c8-193">A virtuális shard és a fizikai partíciók, amelyek megvalósítják a szilánkok leképezése nem befolyásolja az alkalmazáskódban shard kulcsot tárolásához és lekéréséhez adatokat használó lehet módosítani.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-193">The mapping between a virtual shard and the physical partitions that implement the shard can be modified without affecting application code that uses a shard key to store and retrieve data.</span></span> <span data-ttu-id="0f1c8-194">A shard helyek keresésekor adhat egy többletterhelést.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-194">Looking up shard locations can impose an additional overhead.</span></span>

- <span data-ttu-id="0f1c8-195">**Tartomány**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-195">**Range**.</span></span> <span data-ttu-id="0f1c8-196">Ez könnyű, és jól működik lekérdezések mert azok több adatelemek gyakran beolvasása a egy egyetlen shard egyetlen műveletben.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-196">This is easy to implement and works well with range queries because they can often fetch multiple data items from a single shard in a single operation.</span></span> <span data-ttu-id="0f1c8-197">Ezt a stratégiát adatok könnyebb kezelést biztosít.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-197">This strategy offers easier data management.</span></span> <span data-ttu-id="0f1c8-198">Például ha ugyanabban a régióban lévő felhasználók ugyanazt a shard, frissítések az egyes időzónában, a helyi terhelés és igény szerint minta alapján ütemezhető.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-198">For example, if users in the same region are in the same shard, updates can be scheduled in each time zone based on the local load and demand pattern.</span></span> <span data-ttu-id="0f1c8-199">Ezt a stratégiát azonban nem biztosít, optimális terheléselosztás szilánkok között.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-199">However, this strategy doesn't provide optimal balancing between shards.</span></span> <span data-ttu-id="0f1c8-200">Szilánkok újraelosztás nehéz feladat, és nem a probléma megoldására egyenetlen terhelés szomszédos shard kulcsok a legtöbb tevékenység esetén.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-200">Rebalancing shards is difficult and might not resolve the problem of uneven load if the majority of activity is for adjacent shard keys.</span></span>

- <span data-ttu-id="0f1c8-201">**Kivonatoló**.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-201">**Hash**.</span></span> <span data-ttu-id="0f1c8-202">Ezt a stratégiát nyújt további még adatok és a terjesztési jobb esélyét.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-202">This strategy offers a better chance of more even data and load distribution.</span></span> <span data-ttu-id="0f1c8-203">Irányítása a kivonatoló függvényt segítségével közvetlenül is elvégezhető.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-203">Request routing can be accomplished directly by using the hash function.</span></span> <span data-ttu-id="0f1c8-204">Nincs szükség a térkép fenntartásához.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-204">There's no need to maintain a map.</span></span> <span data-ttu-id="0f1c8-205">Vegye figyelembe, hogy a kivonat számítástechnikai előfordulhat, hogy ugyanazok egy többletterhelést.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-205">Note that computing the hash might impose an additional overhead.</span></span> <span data-ttu-id="0f1c8-206">Szilánkok újraelosztás is nehézkes.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-206">Also, rebalancing shards is difficult.</span></span>

<span data-ttu-id="0f1c8-207">Leggyakoribb horizontális rendszerek valósítják meg a fent ismertetett módszerek valamelyikét, de azt is figyelembe kell venni az alkalmazások üzleti követelmények és a használati adatok mintáinak.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-207">Most common sharding systems implement one of the approaches described above, but you should also consider the business requirements of your applications and their patterns of data usage.</span></span> <span data-ttu-id="0f1c8-208">Például egy több-bérlős alkalmazásban:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-208">For example, in a multi-tenant application:</span></span>

- <span data-ttu-id="0f1c8-209">Alkalmazások és szolgáltatások alapján részekre bonthatók az adatok is.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-209">You can shard data based on workload.</span></span> <span data-ttu-id="0f1c8-210">Külön szilánkok kevéssé permanens bérlők esetén sikerült elkülönítse az adatait.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-210">You could segregate the data for highly volatile tenants in separate shards.</span></span> <span data-ttu-id="0f1c8-211">Más bérlők engedélyezik a hozzáférést a sebessége Emiatt előfordulhat, hogy javítani.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-211">The speed of data access for other tenants might be improved as a result.</span></span>

- <span data-ttu-id="0f1c8-212">A bérlő helye alapján részekre bonthatók az adatok is.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-212">You can shard data based on the location of tenants.</span></span> <span data-ttu-id="0f1c8-213">Végre az adatokat a bérlők számára egy adott földrajzi régióban offline biztonsági mentésre és karbantartásra csúcsidőn az adott régióban, míg más bérlők számára az adatok online és elérhető a munkaidő alatt marad.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-213">You can take the data for tenants in a specific geographic region offline for backup and maintenance during off-peak hours in that region, while the data for tenants in other regions remains online and accessible during their business hours.</span></span>

- <span data-ttu-id="0f1c8-214">Nagy értékű bérlők rendelhető a saját személyes, magas hajt végre, mivel alacsonyabb értékű bérlők várható megosztása több sűrűn csomagolt, foglalt szilánkok enyhén betöltve a szilánkok.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-214">High-value tenants could be assigned their own private, high performing, lightly loaded shards, whereas lower-value tenants might be expected to share more densely-packed, busy shards.</span></span>

- <span data-ttu-id="0f1c8-215">Adatok elkülönítése és adatvédelmi magas fokú igénylő bérlők számára az adatok tárolhatók egy teljesen különálló kiszolgálón.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-215">The data for tenants that need a high degree of data isolation and privacy can be stored on a completely separate server.</span></span>

## <a name="scaling-and-data-movement-operations"></a><span data-ttu-id="0f1c8-216">Méretezés és az adatok mozgási műveletek</span><span class="sxs-lookup"><span data-stu-id="0f1c8-216">Scaling and data movement operations</span></span>

<span data-ttu-id="0f1c8-217">A horizontális stratégiák mindegyikének azt jelenti, különböző képességeket, és a skála, kibővítési adatátvitel kezelése, és fenntartásáért állapot összetettségi szintek.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-217">Each of the sharding strategies implies different capabilities and levels of complexity for managing scale in, scale out, data movement, and maintaining state.</span></span>

<span data-ttu-id="0f1c8-218">A keresési stratégia lehetővé teszi a méretezés és az adatok mozgási műveletek végzett felhasználói szinten, online vagy offline állapotú.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-218">The Lookup strategy permits scaling and data movement operations to be carried out at the user level, either online or offline.</span></span> <span data-ttu-id="0f1c8-219">A módszer akkor felfüggesztése néhány vagy minden olyan felhasználói tevékenység (például során csúcsidőn kívüli időszakok), helyezze át az adatokat az új virtuális partíciót és a fizikai horizontális skálázás, a leképezések módosításához, érvénytelenné válnak vagy frissítse a gyorsítótárak, hogy ezek az adatok tárolásához, majd engedélyezi a felhasználói tevékenység folytatása.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-219">The technique is to suspend some or all user activity (perhaps during off-peak periods), move the data to the new virtual partition or physical shard, change the mappings, invalidate or refresh any caches that hold this data, and then allow user activity to resume.</span></span> <span data-ttu-id="0f1c8-220">Gyakran ilyen művelet központilag kezelhetők.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-220">Often this type of operation can be centrally managed.</span></span> <span data-ttu-id="0f1c8-221">A keresési stratégia magas kérelmeznék állapotot és a replika rövid igényel.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-221">The Lookup strategy requires state to be highly cacheable and replica friendly.</span></span>

<span data-ttu-id="0f1c8-222">A tartomány stratégia méretezés és az adatok adatátviteli műveletek, amelyek általában kell végrehajtani, ha egy részét vagy egészét az adattár offline állapotban, mert kell felosztása és egyesíti a szilánkok keresztül az adatok néhány korlátozást ír elő.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-222">The Range strategy imposes some limitations on scaling and data movement operations, which must typically be carried out when a part or all of the data store is offline because the data must be split and merged across the shards.</span></span> <span data-ttu-id="0f1c8-223">Az adatok szilánkok egyensúlyba áthelyezése nem a probléma megoldására egyenetlen terhelés szomszédos shard kulcsok vagy az azonos tartományba adatokat azonosítókat a legtöbb tevékenység esetén.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-223">Moving the data to rebalance shards might not resolve the problem of uneven load if the majority of activity is for adjacent shard keys or data identifiers that are within the same range.</span></span> <span data-ttu-id="0f1c8-224">A tartomány stratégia is szükség lehet néhány állapotban ahhoz, hogy a tartomány leképezése a fizikai partíciók fenntartásához.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-224">The Range strategy might also require some state to be maintained in order to map ranges to the physical partitions.</span></span>

<span data-ttu-id="0f1c8-225">A kivonatoló stratégia teszi méretezés és az adatok mozgási műveletek összetettebb, mivel a partíciós kulcsok kivonatokat a shard kulcsok vagy az adatok azonosítók.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-225">The Hash strategy makes scaling and data movement operations more complex because the partition keys are hashes of the shard keys or data identifiers.</span></span> <span data-ttu-id="0f1c8-226">Minden shard új helyének meg kell határozni a kivonatoló függvényt a, vagy adja meg a megfelelő leképezések módosítani a függvény.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-226">The new location of each shard must be determined from the hash function, or the function modified to provide the correct mappings.</span></span> <span data-ttu-id="0f1c8-227">A kivonatoló stratégia azonban nincs szükség szerinti karbantartási.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-227">However, the Hash strategy doesn't require maintenance of state.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="0f1c8-228">Problémákat és szempontok</span><span class="sxs-lookup"><span data-stu-id="0f1c8-228">Issues and considerations</span></span>

<span data-ttu-id="0f1c8-229">Ebben a mintában megvalósításához meghatározásakor, vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-229">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="0f1c8-230">Horizontális skálázási értéke más típusú particionálás, például a függőleges particionálásból, és működési particionálás kiegészítő.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-230">Sharding is complementary to other forms of partitioning, such as vertical partitioning and functional partitioning.</span></span> <span data-ttu-id="0f1c8-231">Például egyetlen shard függőleges particionálva entitásokat is tartalmazhat, és egy működő partíció is implementálható több szegmensben osztják.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-231">For example, a single shard can contain entities that have been partitioned vertically, and a functional partition can be implemented as multiple shards.</span></span> <span data-ttu-id="0f1c8-232">Partícionálásra vonatkozó további információkért lásd: a [adatok particionálása útmutatást](https://msdn.microsoft.com/library/dn589795.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-232">For more information about partitioning, see the [Data Partitioning Guidance](https://msdn.microsoft.com/library/dn589795.aspx).</span></span>

- <span data-ttu-id="0f1c8-233">Elosztott terhelésű, így azok minden kezelni hasonló mennyiségű i/o szilánkok tartsa.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-233">Keep shards balanced so they all handle a similar volume of I/O.</span></span> <span data-ttu-id="0f1c8-234">Adatokat beszúrni, törölni, mivel fontos rendszeresen egyensúlyba a szilánkok garantálja az még akkor is, terjesztési, és csökkenti annak esélyét, a csatlakozási pontokhoz.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-234">As data is inserted and deleted, it's necessary to periodically rebalance the shards to guarantee an even distribution and to reduce the chance of hotspots.</span></span> <span data-ttu-id="0f1c8-235">Újraelosztás lehet egy drága művelet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-235">Rebalancing can be an expensive operation.</span></span> <span data-ttu-id="0f1c8-236">A szükségességét újraelosztás csökkentéséhez tervezze meg a növekedési biztosításával, hogy minden egyes shard tartalmazza-e elegendő szabad terület a várt kötet változások kezelésére.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-236">To reduce the necessity of rebalancing, plan for growth by ensuring that each shard contains sufficient free space to handle the expected volume of changes.</span></span> <span data-ttu-id="0f1c8-237">Akkor is kell kidolgozni, azokat a stratégiákat és parancsfájlok segítségével gyorsan egyensúlyba szilánkok, ha erre akkor van szükség.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-237">You should also develop strategies and scripts you can use to quickly rebalance shards if this becomes necessary.</span></span>

- <span data-ttu-id="0f1c8-238">A szilánkok kulcs stabil adatokat használjon.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-238">Use stable data for the shard key.</span></span> <span data-ttu-id="0f1c8-239">Ha megváltozik a shard kulcsot, a megfelelő adatelem előfordulhat között szilánkok, a frissítési műveletek által végzett munka mennyiségének növelését.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-239">If the shard key changes, the corresponding data item might have to move between shards, increasing the amount of work performed by update operations.</span></span> <span data-ttu-id="0f1c8-240">Ezért ne a shard kulcs alapozva potenciálisan "volatile" információkat.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-240">For this reason, avoid basing the shard key on potentially volatile information.</span></span> <span data-ttu-id="0f1c8-241">Ehelyett attribútumokat, amelyek állandó keresse meg, vagy természetes alkotnak, amely egy kulcsot.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-241">Instead, look for attributes that are invariant or that naturally form a key.</span></span>

- <span data-ttu-id="0f1c8-242">Győződjön meg arról, hogy a shard kulcsok egyediek-e.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-242">Ensure that shard keys are unique.</span></span> <span data-ttu-id="0f1c8-243">Például ne autoincrementing mezőkkel shard kulcsként.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-243">For example, avoid using autoincrementing fields as the shard key.</span></span> <span data-ttu-id="0f1c8-244">Egyes rendszerek, a autoincremented mező nem lehet koordinált szilánkok, valószínűleg eredményezve ugyanazt a shard kulcsa eltérő szilánkok elemek között.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-244">Is some systems, autoincremented fields can't be coordinated across shards, possibly resulting in items in different shards having the same shard key.</span></span>

    >  <span data-ttu-id="0f1c8-245">Más mezők, amelyek nincsenek shard kulcsok Autoincremented értékeinek hibákat is okozhat.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-245">Autoincremented values in other fields that are not shard keys can also cause problems.</span></span> <span data-ttu-id="0f1c8-246">Például ha autoincremented mezők létrehozásához használt egyedi azonosítót, majd két különböző elem található különböző szilánkok hozzárendelhető ugyanezzel az azonosítóval.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-246">For example, if you use autoincremented fields to generate unique IDs, then two different items located in different shards might be assigned the same ID.</span></span>

- <span data-ttu-id="0f1c8-247">Nem lehet megtervezésére shard kulcsa megegyezik a követelmények minden lehetséges lekérdezés az adatok alapján lehetséges.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-247">It might not be possible to design a shard key that matches the requirements of every possible query against the data.</span></span> <span data-ttu-id="0f1c8-248">Az adatok a legtöbb gyakran végre shard lekérdezése, és szükség esetén hozzon létre másodlagos index táblákat támogatja az, hogy a feltétel alapján attribútumokat, amelyek nem részei a shard kulcs használatával adatainak beolvasása.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-248">Shard the data to support the most frequently performed queries, and if necessary create secondary index tables to support queries that retrieve data using criteria based on attributes that aren't part of the shard key.</span></span> <span data-ttu-id="0f1c8-249">További információkért lásd: a [Index táblázat mintát](index-table.md).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-249">For more information, see the [Index Table pattern](index-table.md).</span></span>

- <span data-ttu-id="0f1c8-250">Csak egyetlen shard elérő lekérdezésekben, hatékonyabbak, mint adatainak lekérése több szegmensben osztják, így csak a végrehajtási egy horizontális skálázási rendszer, amely számos különböző szilánkok-ban tárolt adatok lekérdezés alkalmazások eredményez.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-250">Queries that access only a single shard are more efficient than those that retrieve data from multiple shards, so avoid implementing a sharding system that results in applications performing large numbers of queries that join data held in different shards.</span></span> <span data-ttu-id="0f1c8-251">Ne feledje, hogy egyetlen shard entitások többféle típusú adatok is tartalmazhat.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-251">Remember that a single shard can contain the data for multiple types of entities.</span></span> <span data-ttu-id="0f1c8-252">Ugyanazt a shard alkalmazás hajtja végre külön olvasások számának csökkentése érdekében az adatokat, hogy a kapcsolódó entitásokból, amely általában a rendszer megkérdezi együtt (például az ügyfelek és az azok elhelyezett rendeléseket részleteit) megtartása denormalizing figyelembe kell venni.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-252">Consider denormalizing your data to keep related entities that are commonly queried together (such as the details of customers and the orders that they have placed) in the same shard to reduce the number of separate reads that an application performs.</span></span>

    >  <span data-ttu-id="0f1c8-253">Ha egy shard az entitás egy másik shard tárolt entitás hivatkozik, tartalmazza a shard kulcsot az első entitás séma részeként a második entitás.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-253">If an entity in one shard references an entity stored in another shard, include the shard key for the second entity as part of the schema for the first entity.</span></span> <span data-ttu-id="0f1c8-254">Ez segít szilánkok keresztül kapcsolódó adatokra hivatkozó lekérdezések teljesítményének javítása érdekében.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-254">This can help to improve the performance of queries that reference related data across shards.</span></span>

- <span data-ttu-id="0f1c8-255">Ha egy alkalmazás adatainak lekérése több szilánkok lekérdezések kell végrehajtani, esetleg az adatok beolvasása a párhuzamos tevékenységek.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-255">If an application must perform queries that retrieve data from multiple shards, it might be possible to fetch this data by using parallel tasks.</span></span> <span data-ttu-id="0f1c8-256">Például szétterítési lekérdezések, ahol több szilánkok adatait párhuzamosan beolvasni, és egyetlen eredmény majd összesítése.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-256">Examples include fan-out queries, where data from multiple shards is retrieved in parallel and then aggregated into a single result.</span></span> <span data-ttu-id="0f1c8-257">Azonban ez a megközelítés mindenképpen ad hozzá néhány összetettsége a megoldás az adatok hozzáférési logikai.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-257">However, this approach inevitably adds some complexity to the data access logic of a solution.</span></span>

- <span data-ttu-id="0f1c8-258">Számos alkalmazás létrehozásakor kis szilánkok nagyobb számú lehet hatékonyabb, mint használjon nagy szilánkok kis mennyiségű, mert nagyobb teret hagynak a terheléselosztást is biztosítanak.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-258">For many applications, creating a larger number of small shards can be more efficient than having a small number of large shards because they can offer increased opportunities for load balancing.</span></span> <span data-ttu-id="0f1c8-259">Ez is lehet hasznos, ha várhatóan szilánkok áttelepítését egyik fizikai helyről a másikra szeretné.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-259">This can also be useful if you anticipate the need to migrate shards from one physical location to another.</span></span> <span data-ttu-id="0f1c8-260">Helyezze át egy kis shard gyorsabb, mint a nagy egy áthelyezését.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-260">Moving a small shard is quicker than moving a large one.</span></span>

- <span data-ttu-id="0f1c8-261">Ellenőrizze, hogy minden shard tárhely csomópontot számára elérhető erőforrások elegendőek a méretezhetőségi követelményeinek adatméret és átviteli sebesség kezelésére.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-261">Make sure the resources available to each shard storage node are sufficient to handle the scalability requirements in terms of data size and throughput.</span></span> <span data-ttu-id="0f1c8-262">További információkért lásd: "Tervezése partíciók a méretezhetőség" szakasz a a [adatok particionálása útmutatást](https://msdn.microsoft.com/library/dn589795.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-262">For more information, see the section “Designing Partitions for Scalability” in the [Data Partitioning Guidance](https://msdn.microsoft.com/library/dn589795.aspx).</span></span>

- <span data-ttu-id="0f1c8-263">Vegye figyelembe, hogy minden szilánkok referenciaadatok replikálása.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-263">Consider replicating reference data to all shards.</span></span> <span data-ttu-id="0f1c8-264">Ha egy művelet kiolvassa az adatokat a shard statikusak vagy lassan adatokat is hivatkozik ugyanabban a lekérdezésben részeként, adatok hozzáadása a szilánkcímtárban.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-264">If an operation that retrieves data from a shard also references static or slow-moving data as part of the same query, add this data to the shard.</span></span> <span data-ttu-id="0f1c8-265">Az alkalmazás is majd beolvasni az összes adat a lekérdezés könnyen, anélkül, hogy egy további oda-vissza legyen egy külön adattároló.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-265">The application can then fetch all of the data for the query easily, without having to make an additional round trip to a separate data store.</span></span>

    >  <span data-ttu-id="0f1c8-266">Ha a referenciaadatok több szegmensben osztják megváltozik, a rendszer minden szilánkok ezeket a módosításokat kell szinkronizálnia.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-266">If reference data held in multiple shards changes, the system must synchronize these changes across all shards.</span></span> <span data-ttu-id="0f1c8-267">A rendszer inkonzisztenciát fokú tapasztalhat, a szinkronizálásra kerül sor.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-267">The system can experience a degree of inconsistency while this synchronization occurs.</span></span> <span data-ttu-id="0f1c8-268">Ha így tesz, akkor tervezzen a tudja kezelni az alkalmazásokat.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-268">If you do this, you should design your applications to be able to handle it.</span></span>

- <span data-ttu-id="0f1c8-269">A hivatkozási integritás-és szilánkok, így, csökkentse minimálisra több szilánkok adatokat érintő műveletek közötti konzisztencia nehézkes lehet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-269">It can be difficult to maintain referential integrity and consistency between shards, so you should minimize operations that affect data in multiple shards.</span></span> <span data-ttu-id="0f1c8-270">Ha egy alkalmazás közötti szilánkok adatok módosítania kell, értékelje ki a teljes adatkonzisztencia ténylegesen szükséges-e.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-270">If an application must modify data across shards, evaluate whether complete data consistency is actually required.</span></span> <span data-ttu-id="0f1c8-271">Ehelyett egy általánosan használt megközelítés a felhőben, hogy alkalmazza a végleges konzisztencia.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-271">Instead, a common approach in the cloud is to implement eventual consistency.</span></span> <span data-ttu-id="0f1c8-272">Mindegyik partíció adatait a külön-külön frissül, és az alkalmazáslogikát kell venniük biztosításáért, hogy a frissítések összes végrehajtása sikeres legyen, valamint lekérdezése az adatok egy idővel konzisztenssé során felmerülő inkonzisztenciák kezelése a művelet fut.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-272">The data in each partition is updated separately, and the application logic must take responsibility for ensuring that the updates all complete successfully, as well as handling the inconsistencies that can arise from querying data while an eventually consistent operation is running.</span></span> <span data-ttu-id="0f1c8-273">A végleges konzisztencia kapcsolatos további információkért lásd: a [adatok konzisztencia ismertetése](https://msdn.microsoft.com/library/dn589800.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-273">For more information about implementing eventual consistency, see the [Data Consistency Primer](https://msdn.microsoft.com/library/dn589800.aspx).</span></span>

- <span data-ttu-id="0f1c8-274">Konfigurálása és kezelése a szilánkok sok bonyolult lehet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-274">Configuring and managing a large number of shards can be a challenge.</span></span> <span data-ttu-id="0f1c8-275">Feladatok, például a figyelés, biztonsági mentése, konzisztencia-ellenőrzés és naplózás vagy naplózás jellegétől több szegmensben osztják és-kiszolgálók, valószínűleg tárolt több helyen.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-275">Tasks such as monitoring, backing up, checking for consistency, and logging or auditing must be accomplished on multiple shards and servers, possibly held in multiple locations.</span></span> <span data-ttu-id="0f1c8-276">Ezek a feladatok valószínűleg parancsprogramokkal vagy más automatizálási megoldásokat kell végrehajtani, de, előfordulhat, hogy nem szünteti meg teljesen a további felügyeleti követelményeket.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-276">These tasks are likely to be implemented using scripts or other automation solutions, but that might not completely eliminate the additional administrative requirements.</span></span>

- <span data-ttu-id="0f1c8-277">Szilánkok geolocated lehet, hogy a bennük lévő adatok mérete megközelítőleg, az azt használó alkalmazás példányait.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-277">Shards can be geolocated so that the data that they contain is close to the instances of an application that use it.</span></span> <span data-ttu-id="0f1c8-278">Ez a megközelítés jelentősen javíthatja a teljesítményt, de más-más helyen több szegmensben osztják el kell érnie feladatokhoz több figyelmet igényel.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-278">This approach can considerably improve performance, but requires additional consideration for tasks that must access multiple shards in different locations.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="0f1c8-279">Mikor érdemes használni ezt a mintát</span><span class="sxs-lookup"><span data-stu-id="0f1c8-279">When to use this pattern</span></span>

<span data-ttu-id="0f1c8-280">Használja ezt a mintát, ha a adattárat valószínű, hogy szükség van egy egyetlen tárolási csomópont számára elérhető erőforrások felüli vagy csökkenti a tárolóban a versengés a teljesítmény javítása érdekében.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-280">Use this pattern when a data store is likely to need to scale beyond the resources available to a single storage node, or to improve performance by reducing contention in a data store.</span></span>

>  <span data-ttu-id="0f1c8-281">A horizontális elsősorban a jobb teljesítmény és méretezhetőség rendszert, de módszer továbbá akkor is tovább fejlesztheti rendelkezésre állási módját az adatokat külön partíciókra oszlik miatt.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-281">The primary focus of sharding is to improve the performance and scalability of a system, but as a by-product it can also improve availability due to how the data is divided into separate partitions.</span></span> <span data-ttu-id="0f1c8-282">Egy partíció hibája miatt nem feltétlenül megakadályozhatja, hogy egy alkalmazás nem férhet hozzá a többi partíció-ban tárolt adatok, és egy olyan operátort hajthat végre karbantartás vagy egy vagy több partíció helyreállítását anélkül, hogy az alkalmazás teljes adatai nem érhetők el.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-282">A failure in one partition doesn't necessarily prevent an application from accessing data held in other partitions, and an operator can perform maintenance or recovery of one or more partitions without making the entire data for an application inaccessible.</span></span> <span data-ttu-id="0f1c8-283">További információkért lásd: a [adatok particionálása útmutatást](https://msdn.microsoft.com/library/dn589795.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-283">For more information, see the [Data Partitioning Guidance](https://msdn.microsoft.com/library/dn589795.aspx).</span></span>

## <a name="example"></a><span data-ttu-id="0f1c8-284">Példa</span><span class="sxs-lookup"><span data-stu-id="0f1c8-284">Example</span></span>

<span data-ttu-id="0f1c8-285">A következő példa a C# használ az SQL Server-adatbázisok szilánkok működött.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-285">The following example in C# uses a set of SQL Server databases acting as shards.</span></span> <span data-ttu-id="0f1c8-286">Minden adatbázis tárolja az alkalmazások által használt adatok egy részét.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-286">Each database holds a subset of the data used by an application.</span></span> <span data-ttu-id="0f1c8-287">Az alkalmazás lekéri az adatokat, amelyek segítségével a saját horizontális programot (Itt látható egy példa a kívánt szétterítési lekérdezések) szilánkok között van elosztva.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-287">The application retrieves data that's distributed across the shards using its own sharding logic (this is an example of a fan-out query).</span></span> <span data-ttu-id="0f1c8-288">Az egyes shard található adatok részleteit a hívott metódus által visszaadott `GetShards`.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-288">The details of the data that's located in each shard is returned by a method called `GetShards`.</span></span> <span data-ttu-id="0f1c8-289">Ez a módszer egy enumerálható listáját adja vissza `ShardInformation` objektumok, ahol a `ShardInformation` típus minden shard és az SQL Server kapcsolati karakterlánc egy alkalmazás kell használni (a kapcsolati karakterláncok nem látható a shard csatlakozni azonosítót tartalmaz. a kódpéldát).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-289">This method returns an enumerable list of `ShardInformation` objects, where the `ShardInformation` type contains an identifier for each shard and the SQL Server connection string that an application should use to connect to the shard (the connection strings aren't shown in the code example).</span></span>

```csharp
private IEnumerable<ShardInformation> GetShards()
{
  // This retrieves the connection information from a shard store
  // (commonly a root database).
  return new[]
  {
    new ShardInformation
    {
      Id = 1,
      ConnectionString = ...
    },
    new ShardInformation
    {
      Id = 2,
      ConnectionString = ...
    }
  };
}
```

<span data-ttu-id="0f1c8-290">Az alábbi kód bemutatja, hogyan az alkalmazás használja listáját `ShardInformation` objektumok kér le adatokat az egyes shard párhuzamos lekérdezés végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-290">The code below shows how the application uses the list of `ShardInformation` objects to perform a query that fetches data from each shard in parallel.</span></span> <span data-ttu-id="0f1c8-291">A részletek a lekérdezés nem látható, de ebben a példában a beolvasott adatok egy karakterláncot tartalmaz, amely sikerült egy ügyfél például a név adatok tárolásához, ha a szilánkok ügyfelek részleteit tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-291">The details of the query aren't shown, but in this example the data that's retrieved contains a string that could hold information such as the name of a customer if the shards contain the details of customers.</span></span> <span data-ttu-id="0f1c8-292">Az eredmények összesítése egy `ConcurrentBag` gyűjtemény az alkalmazás által a feldolgozás céljából.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-292">The results are aggregated into a `ConcurrentBag` collection for processing by the application.</span></span>

```csharp
// Retrieve the shards as a ShardInformation[] instance.
var shards = GetShards();

var results = new ConcurrentBag<string>();

// Execute the query against each shard in the shard list.
// This list would typically be retrieved from configuration
// or from a root/master shard store.
Parallel.ForEach(shards, shard =>
{
  // NOTE: Transient fault handling isn't included,
  // but should be incorporated when used in a real world application.
  using (var con = new SqlConnection(shard.ConnectionString))
  {
    con.Open();
    var cmd = new SqlCommand("SELECT ... FROM ...", con);

    Trace.TraceInformation("Executing command against shard: {0}", shard.Id);

    var reader = cmd.ExecuteReader();
    // Read the results in to a thread-safe data structure.
    while (reader.Read())
    {
      results.Add(reader.GetString(0));
    }
  }
});

Trace.TraceInformation("Fanout query complete - Record Count: {0}",
                        results.Count);
```

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="0f1c8-293">Útmutató és a kapcsolódó minták</span><span class="sxs-lookup"><span data-stu-id="0f1c8-293">Related patterns and guidance</span></span>

<span data-ttu-id="0f1c8-294">A következő mintákat és útmutatókat is lehet releváns ebben a mintában végrehajtása során:</span><span class="sxs-lookup"><span data-stu-id="0f1c8-294">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="0f1c8-295">[Adatok konzisztencia ismertetése](https://msdn.microsoft.com/library/dn589800.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-295">[Data Consistency Primer](https://msdn.microsoft.com/library/dn589800.aspx).</span></span> <span data-ttu-id="0f1c8-296">Biztosítja az egységességet az adatok különböző szilánkok pontjain szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-296">It might be necessary to maintain consistency for data distributed across different shards.</span></span> <span data-ttu-id="0f1c8-297">Összesíti a kérdésekkel karbantartása konzisztencia elosztott adatokon keresztül, és ismerteti az előnyöket és a különböző konzisztencia modellek kompromisszumot.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-297">Summarizes the issues surrounding maintaining consistency over distributed data, and describes the benefits and tradeoffs of different consistency models.</span></span>
- <span data-ttu-id="0f1c8-298">[Útmutatás particionálás adatok](https://msdn.microsoft.com/library/dn589795.aspx).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-298">[Data Partitioning Guidance](https://msdn.microsoft.com/library/dn589795.aspx).</span></span> <span data-ttu-id="0f1c8-299">A további problémák széles horizontális adattárat vethet fel.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-299">Sharding a data store can introduce a range of additional issues.</span></span> <span data-ttu-id="0f1c8-300">A méretezhetőség javítása, versengés csökkentése, és a teljesítmény optimalizálása érdekében a felhőben adattárolókhoz particionálás viszonyítva problémákat ismerteti.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-300">Describes these issues in relation to partitioning data stores in the cloud to improve scalability, reduce contention, and optimize performance.</span></span>
- <span data-ttu-id="0f1c8-301">[Index táblázat mintát](index-table.md).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-301">[Index Table pattern](index-table.md).</span></span> <span data-ttu-id="0f1c8-302">Néha nem lehet teljes mértékben támogatja az csak a shard kulcs kialakításának keresztül.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-302">Sometimes it isn't possible to completely support queries just through the design of the shard key.</span></span> <span data-ttu-id="0f1c8-303">Lehetővé teszi az alkalmazás gyorsan adatainak lekérése nagy adattároló eltérő a shard kulcs kulcs megadásával.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-303">Enables an application to quickly retrieve data from a large data store by specifying a key other than the shard key.</span></span>
- <span data-ttu-id="0f1c8-304">[Materializált nézet mintát](materialized-view.md).</span><span class="sxs-lookup"><span data-stu-id="0f1c8-304">[Materialized View pattern](materialized-view.md).</span></span> <span data-ttu-id="0f1c8-305">Az egyes lekérdezési műveletek teljesítményének fenntartása érdekében célszerű összesítése és adatösszegzés, materializált nézetek létrehozására, különösen akkor, ha az összegzett adatokat a szilánkok között van elosztva információkat alapul.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-305">To maintain the performance of some query operations, it's useful to create materialized views that aggregate and summarize data, especially if this summary data is based on information that's distributed across shards.</span></span> <span data-ttu-id="0f1c8-306">Ismerteti, hogyan hozhat létre, és ezek a nézetek feltöltéséhez.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-306">Describes how to generate and populate these views.</span></span>
- <span data-ttu-id="0f1c8-307">[A shard során tapasztalatokat](http://www.addsimplicity.com/adding_simplicity_an_engi/2008/08/shard-lessons.html) az egyszerűség kedvéért hozzáadása blogjában.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-307">[Shard Lessons](http://www.addsimplicity.com/adding_simplicity_an_engi/2008/08/shard-lessons.html) on the Adding Simplicity blog.</span></span>
- <span data-ttu-id="0f1c8-308">[Adatbázis-horizontális](http://dbshards.com/database-sharding/) CodeFutures webhelyén.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-308">[Database Sharding](http://dbshards.com/database-sharding/) on the CodeFutures web site.</span></span>
- <span data-ttu-id="0f1c8-309">[Méretezhetőség stratégiák ismertetése: Adatbázis horizontális](http://blog.maxindelicato.com/2008/12/scalability-strategies-primer-database-sharding.html) maximális Indelicato blogjában.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-309">[Scalability Strategies Primer: Database Sharding](http://blog.maxindelicato.com/2008/12/scalability-strategies-primer-database-sharding.html) on Max Indelicato's blog.</span></span>
- <span data-ttu-id="0f1c8-310">[Épület méretezhető adatbázisok: Informatikai szakemberek és hátrányának a különböző adatbázis horizontális programok](http://www.25hoursaday.com/weblog/2009/01/16/BuildingScalableDatabasesProsAndConsOfVariousDatabaseShardingSchemes.aspx) Dare Obasanjo blogjában.</span><span class="sxs-lookup"><span data-stu-id="0f1c8-310">[Building Scalable Databases: Pros and Cons of Various Database Sharding Schemes](http://www.25hoursaday.com/weblog/2009/01/16/BuildingScalableDatabasesProsAndConsOfVariousDatabaseShardingSchemes.aspx) on Dare Obasanjo's blog.</span></span>
