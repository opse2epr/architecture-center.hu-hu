---
title: Kulcs valet
description: A token vagy a kulcs, amely egy meghatározott erőforrás vagy a szolgáltatás korlátozott közvetlen hozzáférést biztosít az ügyfelek használja.
keywords: Kialakítási mintája
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- data-management
- security
ms.openlocfilehash: 791132eabf926cc285567454c60f894efa286433
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 11/14/2017
ms.locfileid: "24542041"
---
# <a name="valet-key-pattern"></a><span data-ttu-id="ba374-104">Valet kulcs minta</span><span class="sxs-lookup"><span data-stu-id="ba374-104">Valet Key pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="ba374-105">Egy, az ügyfelek egy adott erőforrás korlátozott közvetlen hozzáférést biztosít ahhoz, hogy az adatok átvitele az alkalmazás-kiszervezés jogkivonatot használja.</span><span class="sxs-lookup"><span data-stu-id="ba374-105">Use a token that provides clients with restricted direct access to a specific resource, in order to offload data transfer from the application.</span></span> <span data-ttu-id="ba374-106">Ez különösen fontos az alkalmazásokat, amelyek a felhőben üzemeltetett tárolórendszerek vagy várólisták, és kis méretűvé teheti költség és méretezhetőség és teljesítmény maximalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="ba374-106">This is particularly useful in applications that use cloud-hosted storage systems or queues, and can minimize cost and maximize scalability and performance.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="ba374-107">A környezetben, és probléma</span><span class="sxs-lookup"><span data-stu-id="ba374-107">Context and problem</span></span>

<span data-ttu-id="ba374-108">Ügyfél programok és a böngészők gyakran kell írási és olvasási fájlokat vagy adatokat adatfolyamokat, és onnan egy kiszolgálóalkalmazás-tároló.</span><span class="sxs-lookup"><span data-stu-id="ba374-108">Client programs and web browsers often need to read and write files or data streams to and from an application’s storage.</span></span> <span data-ttu-id="ba374-109">Általában az alkalmazás fogja kezelni az adatok mozgása &mdash; beolvasása, a tárolási és adatfolyamként történő továbbítását, az ügyfél számára, vagy a feltöltött adatfolyam olvasásakor az ügyfél és az adattár tárolásához.</span><span class="sxs-lookup"><span data-stu-id="ba374-109">Typically, the application will handle the movement of the data &mdash; either by fetching it from storage and streaming it to the client, or by reading the uploaded stream from the client and storing it in the data store.</span></span> <span data-ttu-id="ba374-110">Azonban ez a megközelítés elnyeli értékes erőforrások, például a számítási, memória és a sávszélesség.</span><span class="sxs-lookup"><span data-stu-id="ba374-110">However, this approach absorbs valuable resources such as compute, memory, and bandwidth.</span></span>

<span data-ttu-id="ba374-111">Adattároló képesek legyenek kezelni feltöltése és letöltéséhez az adatok közvetlenül, anélkül, hogy az alkalmazás hajtsa végre a feldolgozási ezek az adatok áthelyezése.</span><span class="sxs-lookup"><span data-stu-id="ba374-111">Data stores have the ability to handle upload and download of data directly, without requiring that the application perform any processing to move this data.</span></span> <span data-ttu-id="ba374-112">De általában ehhez az ügyfél rendelkezik hozzáféréssel a tárolóhoz a hitelesítő adatokat.</span><span class="sxs-lookup"><span data-stu-id="ba374-112">But, this typically requires the client to have access to the security credentials for the store.</span></span> <span data-ttu-id="ba374-113">Ez akkor lehet hasznos módszer adatátvitel költségei és az alkalmazás horizontális, és a teljesítmény maximalizálásához a követelmény minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="ba374-113">This can be a useful technique to minimize data transfer costs and the requirement to scale out the application, and to maximize performance.</span></span> <span data-ttu-id="ba374-114">Azt jelenti, azonban, hogy az alkalmazás már nem tudja kezelni az adatok biztonságát.</span><span class="sxs-lookup"><span data-stu-id="ba374-114">It means, though, that the application is no longer able to manage the security of the data.</span></span> <span data-ttu-id="ba374-115">Miután az ügyfél közvetlenül elérheti az adattárolóhoz kapcsolattal rendelkezik, az alkalmazás nem jogcímszabálykészlet(ek) a.</span><span class="sxs-lookup"><span data-stu-id="ba374-115">After the client has a connection to the data store for direct access, the application can't act as the gatekeeper.</span></span> <span data-ttu-id="ba374-116">Már nem az irányítást a folyamat, és sem akadályozható meg a későbbi feltöltések vagy letölti az adattárolóból.</span><span class="sxs-lookup"><span data-stu-id="ba374-116">It's no longer in control of the process and can't prevent subsequent uploads or downloads from the data store.</span></span>

<span data-ttu-id="ba374-117">Ez nem fog reális megközelítés elosztott rendszerek, amelyek nem megbízható ügyfelek kiszolgálásához szükséges.</span><span class="sxs-lookup"><span data-stu-id="ba374-117">This isn't a realistic approach in distributed systems that need to serve untrusted clients.</span></span> <span data-ttu-id="ba374-118">Ehelyett alkalmazások biztonságosan részletes módon az adatok hozzáférésének vezérléséhez, de továbbra is csökkenthető a kiszolgáló terhelése beállítása az ezt a kapcsolatot, és majd így az ügyfél közvetlenül kommunikálnak az adattároló hajtsa végre a szükséges olvasására vagy írására, képesnek kell lennie műveletek.</span><span class="sxs-lookup"><span data-stu-id="ba374-118">Instead, applications must be able to securely control access to data in a granular way, but still reduce the load on the server by setting up this connection and then allowing the client to communicate directly with the data store to perform the required read or write operations.</span></span>

## <a name="solution"></a><span data-ttu-id="ba374-119">Megoldás</span><span class="sxs-lookup"><span data-stu-id="ba374-119">Solution</span></span>

<span data-ttu-id="ba374-120">Szabályozására számára egy adattárból, ahol nem tudja kezelni a tároló hitelesítési és engedélyezési az ügyfelek a probléma megoldásához szükséges.</span><span class="sxs-lookup"><span data-stu-id="ba374-120">You need to resolve the problem of controlling access to a data store where the store can't manage authentication and authorization of clients.</span></span> <span data-ttu-id="ba374-121">Egy tipikus megoldás, hogy korlátozza a hozzáférést az adattár nyilvános kapcsolat, és adja meg az ügyfél egy kulcs, vagy a jogkivonatot, amely az adattár azt is ellenőrzi.</span><span class="sxs-lookup"><span data-stu-id="ba374-121">One typical solution is to restrict access to the data store’s public connection and provide the client with a key or token that the data store can validate.</span></span>

<span data-ttu-id="ba374-122">A kulcs vagy a token általában nevezzük valet kulcs.</span><span class="sxs-lookup"><span data-stu-id="ba374-122">This key or token is usually referred to as a valet key.</span></span> <span data-ttu-id="ba374-123">Egy adott erőforráshoz időben korlátozott hozzáférést biztosít, és lehetővé teszi, hogy csak előre definiált műveletek, például a olvasása és írása tárolóra vagy várólisták, vagy feltöltését és egy webböngészőben letöltésekor.</span><span class="sxs-lookup"><span data-stu-id="ba374-123">It provides time-limited access to specific resources and allows only predefined operations such as reading and writing to storage or queues, or uploading and downloading in a web browser.</span></span> <span data-ttu-id="ba374-124">Alkalmazások is létrehozása és kiállítása valet kulcsok böngészők és ügyféleszközök gyorsan és egyszerűen, így az ügyfelek anélkül, hogy közvetlenül a az adatátvitel kezeléséhez szükséges műveleteket.</span><span class="sxs-lookup"><span data-stu-id="ba374-124">Applications can create and issue valet keys to client devices and web browsers quickly and easily, allowing clients to perform the required operations without requiring the application to directly handle the data transfer.</span></span> <span data-ttu-id="ba374-125">Ezzel eltávolítja a feldolgozási terhelést, és a hatása a teljesítményre és méretezhetőségre, az alkalmazás és a kiszolgáló.</span><span class="sxs-lookup"><span data-stu-id="ba374-125">This removes the processing overhead, and the impact on performance and scalability, from the application and the server.</span></span>

<span data-ttu-id="ba374-126">Az ügyfél a a token csak egy adott időszakban, és a hozzáférési engedélyeket adott korlátozások egy adott erőforrás szerepel az adattárban elérésére használt, az ábrán látható módon.</span><span class="sxs-lookup"><span data-stu-id="ba374-126">The client uses this token to access a specific resource in the data store for only a specific period, and with specific restrictions on access permissions, as shown in the figure.</span></span> <span data-ttu-id="ba374-127">A megadott időszak után a kulcs érvénytelenné válik, és nem engedélyezik az erőforrás elérésére.</span><span class="sxs-lookup"><span data-stu-id="ba374-127">After the specified period, the key becomes invalid and won't allow access to the resource.</span></span>

![1. ábra – a minta áttekintése](./_images/valet-key-pattern.png)

<span data-ttu-id="ba374-129">Akkor is, amelyen más függőségek, például az adatok köre kulcs konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="ba374-129">It's also possible to configure a key that has other dependencies, such as the scope of the data.</span></span> <span data-ttu-id="ba374-130">Például attól függően, hogy az áruház képességek, a kulcs megadhat egy teljes tábla adattárat, vagy csak adott sorokra a táblában.</span><span class="sxs-lookup"><span data-stu-id="ba374-130">For example, depending on the data store capabilities, the key can specify a complete table in a data store, or only specific rows in a table.</span></span> <span data-ttu-id="ba374-131">A felhőalapú tárolás rendszerek egy tárolót, vagy csak olyan tárolóban egy cikket a kulcs adja meg.</span><span class="sxs-lookup"><span data-stu-id="ba374-131">In cloud storage systems the key can specify a container, or just a specific item within a container.</span></span>

<span data-ttu-id="ba374-132">A kulcs is az alkalmazás érvénytelenítve lenne.</span><span class="sxs-lookup"><span data-stu-id="ba374-132">The key can also be invalidated by the application.</span></span> <span data-ttu-id="ba374-133">Ez az a hasznos megközelítést, abban az esetben, ha az ügyfél értesíti a kiszolgálót, hogy helyesek-e az adatátviteli művelet.</span><span class="sxs-lookup"><span data-stu-id="ba374-133">This is a useful approach if the client notifies the server that the data transfer operation is complete.</span></span> <span data-ttu-id="ba374-134">A kiszolgáló majd érvénytelenné tehetik kulcs további megelőzése érdekében.</span><span class="sxs-lookup"><span data-stu-id="ba374-134">The server can then invalidate that key to prevent further.</span></span>

<span data-ttu-id="ba374-135">Ezt a mintát használja egyszerűbbé teheti az erőforrásokhoz való hozzáférés kezelése mert létrehozására és a felhasználó hitelesítéséhez, engedélyeket, és távolítsa el a felhasználó nem kötelező.</span><span class="sxs-lookup"><span data-stu-id="ba374-135">Using this pattern can simplify managing access to resources because there's no requirement to create and authenticate a user, grant permissions, and then remove the user again.</span></span> <span data-ttu-id="ba374-136">Emellett a hellyel, az engedély és az érvényességi időszak szűkítse&mdash;mind szerint egyszerűen a futási időben egyik kulcs létrehozásakor.</span><span class="sxs-lookup"><span data-stu-id="ba374-136">It also makes it easy to limit the location, the permission, and the validity period&mdash;all by simply generating a key at runtime.</span></span> <span data-ttu-id="ba374-137">A fontos tényezők, melyeknek az érvényességi időszak, és különösen az erőforrás helye olyan szorosan korlátozása, hogy a címzett csak azt az adott célra.</span><span class="sxs-lookup"><span data-stu-id="ba374-137">The important factors are to limit the validity period, and especially the location of the resource, as tightly as possible so that the recipient can only use it for the intended purpose.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="ba374-138">Problémákat és szempontok</span><span class="sxs-lookup"><span data-stu-id="ba374-138">Issues and considerations</span></span>

<span data-ttu-id="ba374-139">Ebben a mintában megvalósításához meghatározásakor, vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="ba374-139">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="ba374-140">**Kezelje az érvényességi állapot és a kulcs időszak**.</span><span class="sxs-lookup"><span data-stu-id="ba374-140">**Manage the validity status and period of the key**.</span></span> <span data-ttu-id="ba374-141">Ha kiszivárogniuk vagy sérült, a kulcs hatékonyan feloldja a cél elemet, és lehetővé teszi a rosszindulatú visszaélések az érvényességi időszak alatt.</span><span class="sxs-lookup"><span data-stu-id="ba374-141">If leaked or compromised, the key effectively unlocks the target item and makes it available for malicious use during the validity period.</span></span> <span data-ttu-id="ba374-142">A kulcs általában visszavonva, vagy le van tiltva, attól függően, hogy hogyan állította ki.</span><span class="sxs-lookup"><span data-stu-id="ba374-142">A key can usually be revoked or disabled, depending on how it was issued.</span></span> <span data-ttu-id="ba374-143">Kiszolgálóoldali házirendek módosítható, vagy a kiszolgáló kulccsal van aláírva érvénytelenítve lenne.</span><span class="sxs-lookup"><span data-stu-id="ba374-143">Server-side policies can be changed or, the server key it was signed with can be invalidated.</span></span> <span data-ttu-id="ba374-144">Adja meg egy rövid érvényességi, ha engedélyezi a nem engedélyezett műveletek elleni az adattár csökkentése érdekében.</span><span class="sxs-lookup"><span data-stu-id="ba374-144">Specify a short validity period to minimize the risk of allowing unauthorized operations to take place against the data store.</span></span> <span data-ttu-id="ba374-145">Azonban ha az érvényességi időtartama túl rövid, az ügyfél nem feltétlenül tudja elvégezni a műveletet, a kulcs érvényességének lejárta előtt.</span><span class="sxs-lookup"><span data-stu-id="ba374-145">However, if the validity period is too short, the client might not be able to complete the operation before the key expires.</span></span> <span data-ttu-id="ba374-146">A kulcs megújításához, mielőtt az érvényességi idejük lejárata, ha a védett erőforrásokhoz való több hozzáférések szükség a hitelesített felhasználóknak engedélyezik.</span><span class="sxs-lookup"><span data-stu-id="ba374-146">Allow authorized users to renew the key before the validity period expires if multiple accesses to the protected resource are required.</span></span>

<span data-ttu-id="ba374-147">**Vezérelhető a nyújt a kulcs hozzáférési szint**.</span><span class="sxs-lookup"><span data-stu-id="ba374-147">**Control the level of access the key will provide**.</span></span> <span data-ttu-id="ba374-148">A kulcs általában a felhasználó csak műveleteket kell végrehajtani a műveletet, például ha az ügyfél nem lesz képes feltölteni az adatokat az adattár csak olvasási hozzáféréssel kell lehetővé.</span><span class="sxs-lookup"><span data-stu-id="ba374-148">Typically, the key should allow the user to only perform the actions necessary to complete the operation, such as read-only access if the client shouldn't be able to upload data to the data store.</span></span> <span data-ttu-id="ba374-149">A fájlfeltöltés közös adható meg a kulcs, amely csak írási engedéllyel, valamint a hely és az érvényességi időtartam esetén.</span><span class="sxs-lookup"><span data-stu-id="ba374-149">For file uploads, it's common to specify a key that provides write-only permission, as well as the location and the validity period.</span></span> <span data-ttu-id="ba374-150">Nagyon fontos pontosan határozza meg az erőforrás vagy a kulcs hatálya alá tartozó erőforrások készletét.</span><span class="sxs-lookup"><span data-stu-id="ba374-150">It's critical to accurately specify the resource or the set of resources to which the key applies.</span></span>

<span data-ttu-id="ba374-151">**Vegye figyelembe a felhasználó viselkedésének vezérlése**.</span><span class="sxs-lookup"><span data-stu-id="ba374-151">**Consider how to control users’ behavior**.</span></span> <span data-ttu-id="ba374-152">Ez a kialakítás megvalósítása azt jelenti, hogy az erőforrások felhasználók szabályozhatják adatvesztés hozzáférési engedéllyel.</span><span class="sxs-lookup"><span data-stu-id="ba374-152">Implementing this pattern means some loss of control over the resources users are granted access to.</span></span> <span data-ttu-id="ba374-153">A képességek a házirendeket és az engedélyek érhető el a szolgáltatás vagy a cél-tárolót, amely képes lehet kifejtett felügyeleti korlátozza.</span><span class="sxs-lookup"><span data-stu-id="ba374-153">The level of control that can be exerted is limited by the capabilities of the policies and permissions available for the service or the target data store.</span></span> <span data-ttu-id="ba374-154">Például nincs általában lehetőség, amely korlátozza az adatok tárolására, vagy a kulcs használható próbál hozzáférni egy fájlhoz hányszor írandó méretének kulcs létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="ba374-154">For example, it's usually not possible to create a key that limits the size of the data to be written to storage, or the number of times the key can be used to access a file.</span></span> <span data-ttu-id="ba374-155">Ennek eredményeként hatalmas váratlan adatátvitel költségeit, akkor, amikor az adott ügyfél által használt, és a kód a hiba oka lehet, ami ismételt feltöltés és letöltés választható.</span><span class="sxs-lookup"><span data-stu-id="ba374-155">This can result in huge unexpected costs for data transfer, even when used by the intended client, and might be caused by an error in the code that causes repeated upload or download.</span></span> <span data-ttu-id="ba374-156">Egy fájl is feltölthetők, ahol csak lehetséges száma korlátozza, force az ügyfél számára, hogy az alkalmazás értesítése, ha egy művelet befejeződött.</span><span class="sxs-lookup"><span data-stu-id="ba374-156">To limit the number of times a file can be uploaded, where possible, force the client to notify the application when one operation has completed.</span></span> <span data-ttu-id="ba374-157">Néhány adattárolókhoz például az alkalmazás kódjának segítségével műveletek figyelése, és szabályozhatja a felhasználó működését események ablakába.</span><span class="sxs-lookup"><span data-stu-id="ba374-157">For example, some data stores raise events the application code can use to monitor operations and control user behavior.</span></span> <span data-ttu-id="ba374-158">Azt azonban nem szigorú kvóták az egyes felhasználók olyan több-bérlős forgatókönyvekben, ahol a ugyanazzal a kulccsal egy bérlőhöz tartozó felhasználók kényszerítéséhez.</span><span class="sxs-lookup"><span data-stu-id="ba374-158">However, it's hard to enforce quotas for individual users in a multi-tenant scenario where the same key is used by all the users from one tenant.</span></span>

<span data-ttu-id="ba374-159">**Ellenőrzi, és opcionálisan sanitize, minden feltöltött adatok**.</span><span class="sxs-lookup"><span data-stu-id="ba374-159">**Validate, and optionally sanitize, all uploaded data**.</span></span> <span data-ttu-id="ba374-160">Egy rosszindulatú felhasználó, amely hozzáfér a kulcs sikerült feltölteni az adatokat úgy tervezték, hogy okoz a rendszerben.</span><span class="sxs-lookup"><span data-stu-id="ba374-160">A malicious user that gains access to the key could upload data designed to compromise the system.</span></span> <span data-ttu-id="ba374-161">Másik lehetőségként jogosult felhasználók előfordulhat, hogy feltölteni az adatokat, amely nem érvényes, és feldolgozásakor hiba vagy a rendszer hibát eredményezhet.</span><span class="sxs-lookup"><span data-stu-id="ba374-161">Alternatively, authorized users might upload data that's invalid and, when processed, could result in an error or system failure.</span></span> <span data-ttu-id="ba374-162">Ez elleni védelem érdekében, győződjön meg arról, hogy minden feltöltött adatok érvényesítve, és be van jelölve, a használat előtt rosszindulatú tartalmat.</span><span class="sxs-lookup"><span data-stu-id="ba374-162">To protect against this, ensure that all uploaded data is validated and checked for malicious content before use.</span></span>

<span data-ttu-id="ba374-163">**Összes művelet naplózási**.</span><span class="sxs-lookup"><span data-stu-id="ba374-163">**Audit all operations**.</span></span> <span data-ttu-id="ba374-164">Sok kulcs alapú mechanizmusok műveletek, például a feltöltések, a letöltéseket és a hibák jelentkezhetnek.</span><span class="sxs-lookup"><span data-stu-id="ba374-164">Many key-based mechanisms can log operations such as uploads, downloads, and failures.</span></span> <span data-ttu-id="ba374-165">Ezek a naplók általában lehet egy naplózási folyamat építve, és számlázási, ha a felhasználó a fájl mérete vagy az adatok kötet díjfizetéssel is használt.</span><span class="sxs-lookup"><span data-stu-id="ba374-165">These logs can usually be incorporated into an audit process, and also used for billing if the user is charged based on file size or data volume.</span></span> <span data-ttu-id="ba374-166">A naplók segítségével észleli a hitelesítési hibák száma, amelyek a kulcsszolgáltató, vagy egy tárolt házirend véletlen eltávolítását problémákat okozhatja.</span><span class="sxs-lookup"><span data-stu-id="ba374-166">Use the logs to detect authentication failures that might be caused by issues with the key provider, or accidental removal of a stored access policy.</span></span>

<span data-ttu-id="ba374-167">**A kulcs biztonságos biztosításához**.</span><span class="sxs-lookup"><span data-stu-id="ba374-167">**Deliver the key securely**.</span></span> <span data-ttu-id="ba374-168">A felhasználó egy weblapon aktiválja az URL-ágyazni, vagy használható server átirányítási műveletben, hogy a letöltés automatikusan megtörténik.</span><span class="sxs-lookup"><span data-stu-id="ba374-168">It can be embedded in a URL that the user activates in a web page, or it can be used in a server redirection operation so that the download occurs automatically.</span></span> <span data-ttu-id="ba374-169">Mindig HTTPS használatára képes biztosítani a kulcsot egy biztonságos csatornán keresztül.</span><span class="sxs-lookup"><span data-stu-id="ba374-169">Always use HTTPS to deliver the key over a secure channel.</span></span>

<span data-ttu-id="ba374-170">**Bizalmas adatok védelmére átvitel**.</span><span class="sxs-lookup"><span data-stu-id="ba374-170">**Protect sensitive data in transit**.</span></span> <span data-ttu-id="ba374-171">Az alkalmazás keresztül érzékeny adatokat általában akkor kerül sor SSL vagy TLS használatával, és ez kell kikényszeríteni, az ügyfelek a-adattároló elérése közvetlenül.</span><span class="sxs-lookup"><span data-stu-id="ba374-171">Sensitive data delivered through the application will usually take place using SSL or TLS, and this should be enforced for clients accessing the data store directly.</span></span>

<span data-ttu-id="ba374-172">Egyéb problémák az ebben a mintában végrehajtásakor a következők:</span><span class="sxs-lookup"><span data-stu-id="ba374-172">Other issues to be aware of when implementing this pattern are:</span></span>

- <span data-ttu-id="ba374-173">Ha az ügyfél nem, vagy nem, értesítse a kiszolgáló, a művelet befejezése és a csak határérték a lejárati időt, a kulcs, az alkalmazás nem fog tudni elvégezni naplózási műveletek, például a leltározási feltöltések vagy letöltések számát, vagy megakadályozza az több feltöltések vagy letöltések.</span><span class="sxs-lookup"><span data-stu-id="ba374-173">If the client doesn't, or can't, notify the server of completion of the operation, and the only limit is the expiration period of the key, the application won't be able to perform auditing operations such as counting the number of uploads or downloads, or preventing multiple uploads or downloads.</span></span>

- <span data-ttu-id="ba374-174">Kulcs házirendjei létrehozható rugalmasan korlátozott lehet.</span><span class="sxs-lookup"><span data-stu-id="ba374-174">The flexibility of key policies that can be generated might be limited.</span></span> <span data-ttu-id="ba374-175">Például bizonyos mechanizmusok csak egy időzített lejárati idővel használatának engedélyezése.</span><span class="sxs-lookup"><span data-stu-id="ba374-175">For example, some mechanisms only allow the use of a timed expiration period.</span></span> <span data-ttu-id="ba374-176">Mások számára nem adhat meg a megfelelő lépésköz legyen olvasási/írási engedéllyel.</span><span class="sxs-lookup"><span data-stu-id="ba374-176">Others aren't able to specify a sufficient granularity of read/write permissions.</span></span>

- <span data-ttu-id="ba374-177">Ha a kulcs vagy a token érvényességi időtartam kezdési időpontja meg van adva, győződjön meg arról, hogy az kissé korábbi, hogy az ügyfél órák nem szinkronizált némileg elképzelhető, hogy engedélyezze az aktuális kiszolgáló időnél.</span><span class="sxs-lookup"><span data-stu-id="ba374-177">If the start time for the key or token validity period is specified, ensure that it's a little earlier than the current server time to allow for client clocks that might be slightly out of synchronization.</span></span> <span data-ttu-id="ba374-178">Az alapértelmezett értéket, ha nincs megadva, az általában aktuális server idő.</span><span class="sxs-lookup"><span data-stu-id="ba374-178">The default, if not specified, is usually the current server time.</span></span>

- <span data-ttu-id="ba374-179">Az URL-címet a kulcsot tartalmazó kiszolgáló naplófájljainak lesznek rögzítve.</span><span class="sxs-lookup"><span data-stu-id="ba374-179">The URL containing the key will be recorded in server log files.</span></span> <span data-ttu-id="ba374-180">Amíg a kulcs általában lejártak, előtt a naplófájlok használt elemzés, győződjön meg arról, hogy korlátozza a hozzáférést.</span><span class="sxs-lookup"><span data-stu-id="ba374-180">While the key will typically have expired before the log files are used for analysis, ensure that you limit access to them.</span></span> <span data-ttu-id="ba374-181">Naplóadatok továbbított adatok köre a figyelési rendszerben vagy egy másik helyen tárolja, ha vegye fontolóra a késés, amíg kulcsok kiszivárgásának elkerülésére, az érvényességi időszak lejárta után.</span><span class="sxs-lookup"><span data-stu-id="ba374-181">If log data is transmitted to a monitoring system or stored in another location, consider implementing a delay to prevent leakage of keys until after their validity period has expired.</span></span>

- <span data-ttu-id="ba374-182">Ha az Ügyfélkód webböngészőben fut, a böngésző támogatja az eltérő eredetű erőforrások megosztása (CORS) engedélyezéséhez a kódot, amely végrehajtja az szolgáltatott a lap egy másik tartományban található adatok eléréséhez a böngészőben módosítania.</span><span class="sxs-lookup"><span data-stu-id="ba374-182">If the client code runs in a web browser, the browser might need to support cross-origin resource sharing (CORS) to enable code that executes within the web browser to access data in a different domain from the one that served the page.</span></span> <span data-ttu-id="ba374-183">Egyes régebbi böngészők és néhány adattároló nem támogatják a CORS, és előfordulhat, hogy a kód a böngészők futó tudja valet kulcsot használ egy másik tartományban, például a felhőalapú társzolgáltatás fiókja adatainak eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="ba374-183">Some older browsers and some data stores don't support CORS, and code that runs in these browsers might be able to use a valet key to provide access to data in a different domain, such as a cloud storage account.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="ba374-184">Mikor érdemes használni ezt a mintát</span><span class="sxs-lookup"><span data-stu-id="ba374-184">When to use this pattern</span></span>

<span data-ttu-id="ba374-185">Ebben a mintában akkor hasznos, ha az alábbi helyzetekben:</span><span class="sxs-lookup"><span data-stu-id="ba374-185">This pattern is useful for the following situations:</span></span>

- <span data-ttu-id="ba374-186">Minimálisra csökkentése erőforrás betöltése, és maximalizálhatja a teljesítményét és méretezhetőségét.</span><span class="sxs-lookup"><span data-stu-id="ba374-186">To minimize resource loading and maximize performance and scalability.</span></span> <span data-ttu-id="ba374-187">Valet kulccsal zárolva lesz az erőforrás nem igényel, nincs távoli kiszolgáló hívás szükséges, a kibocsáthatja valet kulcsok száma nincs korlátozva, és ezzel elkerülheti a hibaérzékeny pontok kialakulását, az alkalmazáson keresztül az adatátvitel végrehajtása eredő a kódot.</span><span class="sxs-lookup"><span data-stu-id="ba374-187">Using a valet key doesn't require the resource to be locked, no remote server call is required, there's no limit on the number of valet keys that can be issued, and it avoids a single point of failure resulting from performing the data transfer through the application code.</span></span> <span data-ttu-id="ba374-188">Valet kulcs létrehozása az általában egy egyszerű kriptográfiai művelet karakterlánc aláírási kulccsal.</span><span class="sxs-lookup"><span data-stu-id="ba374-188">Creating a valet key is typically a simple cryptographic operation of signing a string with a key.</span></span>

- <span data-ttu-id="ba374-189">Működési költségek csökkentése érdekében.</span><span class="sxs-lookup"><span data-stu-id="ba374-189">To minimize operational cost.</span></span> <span data-ttu-id="ba374-190">Tárolók és a várólisták közvetlen hozzáférést tesz lehetővé a erőforrás és hatékony költség, a is kevesebb hálózati eredményez kerekíteni való adatváltások számát, és lehetővé teheti a szükséges számítási erőforrások számának csökkentése.</span><span class="sxs-lookup"><span data-stu-id="ba374-190">Enabling direct access to stores and queues is resource and cost efficient, can result in fewer network round trips, and might allow for a reduction in the number of compute resources required.</span></span>

- <span data-ttu-id="ba374-191">Az ügyfelek mikor rendszeresen feltölteni, vagy adatletöltéshez, különösen akkor, ha van egy nagy méretű, vagy ha az egyes műveletek magában foglalja a nagy fájlok.</span><span class="sxs-lookup"><span data-stu-id="ba374-191">When clients regularly upload or download data, particularly where there's a large volume or when each operation involves large files.</span></span>

- <span data-ttu-id="ba374-192">Ha az alkalmazás csak korlátozott számítási erőforrásai, vagy üzemeltető korlátozásai miatt, vagy szempontok költsége.</span><span class="sxs-lookup"><span data-stu-id="ba374-192">When the application has limited compute resources available, either due to hosting limitations or cost considerations.</span></span> <span data-ttu-id="ba374-193">Ebben a forgatókönyvben a minta továbbiakat is lehet hasznos, ha sok egyidejű adatok feltöltését, vagy tölti le, mert azt mentesíti az alkalmazást az adatátvitel kezelése.</span><span class="sxs-lookup"><span data-stu-id="ba374-193">In this scenario, the pattern is even more helpful if there are many concurrent data uploads or downloads because it relieves the application from handling the data transfer.</span></span>

- <span data-ttu-id="ba374-194">Amikor az adatok tárolása egy távoli tárolót vagy egy ugyanabban az adatközpontban.</span><span class="sxs-lookup"><span data-stu-id="ba374-194">When the data is stored in a remote data store or a different datacenter.</span></span> <span data-ttu-id="ba374-195">Ha az alkalmazás jogcímszabálykészlet(ek) a kellett, valószínűleg az adatátvitel az Adatközpont között, vagy a saját vagy nyilvános hálózaton keresztül az ügyfél és az alkalmazás között, majd az alkalmazás között további sávszélességet díjat és az adatok tárolásához.</span><span class="sxs-lookup"><span data-stu-id="ba374-195">If the application was required to act as a gatekeeper, there might be a charge for the additional bandwidth of transferring the data between datacenters, or across public or private networks between the client and the application, and then between the application and the data store.</span></span>

<span data-ttu-id="ba374-196">Ez a minta nem lehet a következő esetekben lehet hasznos:</span><span class="sxs-lookup"><span data-stu-id="ba374-196">This pattern might not be useful in the following situations:</span></span>

- <span data-ttu-id="ba374-197">Ha az alkalmazás kell végezni néhány feladatot az adatok tárolása előtt vagy azt megelőzően azt az ügyfél küldte.</span><span class="sxs-lookup"><span data-stu-id="ba374-197">If the application must perform some task on the data before it's stored or before it's sent to the client.</span></span> <span data-ttu-id="ba374-198">Például ha az alkalmazás-ellenőrzéshez van szüksége, hozzáférés sikeres bejelentkezés, vagy hajtsa végre a átalakítás az adatokon.</span><span class="sxs-lookup"><span data-stu-id="ba374-198">For example, if the application needs to perform validation, log access success, or execute a transformation on the data.</span></span> <span data-ttu-id="ba374-199">Azonban bizonyos adatokat tárolja és az ügyfelek képesek és például tömörítése és egyszerű átalakítások végez (például egy webes böngésző általában kezelni tud a GZip-formátumok).</span><span class="sxs-lookup"><span data-stu-id="ba374-199">However, some data stores and clients are able to negotiate and carry out simple transformations such as compression and decompression (for example, a web browser can usually handle GZip formats).</span></span>

- <span data-ttu-id="ba374-200">Ha egy meglévő alkalmazást kialakításának megnehezíti a minta tartalmaznia.</span><span class="sxs-lookup"><span data-stu-id="ba374-200">If the design of an existing application makes it difficult to incorporate the pattern.</span></span> <span data-ttu-id="ba374-201">Ebben a mintában általában használatához egy másik architekturális megközelítés továbbítása és az adatok fogadása.</span><span class="sxs-lookup"><span data-stu-id="ba374-201">Using this pattern typically requires a different architectural approach for delivering and receiving data.</span></span>

- <span data-ttu-id="ba374-202">Ha elkérése karbantartása vagy hány alkalommal kell egy adatátviteli művelet végrehajtása, és használja a valet kulcs mechanizmus nem támogatja az értesítéseket, amelyek a kiszolgáló segítségével kezelheti ezeket a műveleteket.</span><span class="sxs-lookup"><span data-stu-id="ba374-202">If it's necessary to maintain audit trails or control the number of times a data transfer operation is executed, and the valet key mechanism in use doesn't support notifications that the server can use to manage these operations.</span></span>

- <span data-ttu-id="ba374-203">Ha szükséges, különösen a feltöltési művelet során az adatok méretének korlátozására.</span><span class="sxs-lookup"><span data-stu-id="ba374-203">If it's necessary to limit the size of the data, especially during upload operations.</span></span> <span data-ttu-id="ba374-204">Ez az egyetlen megoldásként van, ellenőrizze az adatok méretét, a művelet befejezése után, vagy ellenőrizze a megadott időszak után, vagy egy ütemezés szerint feltöltések méretét az alkalmazásra vonatkozóan.</span><span class="sxs-lookup"><span data-stu-id="ba374-204">The only solution to this is for the application to check the data size after the operation is complete, or check the size of uploads after a specified period or on a scheduled basis.</span></span>

## <a name="example"></a><span data-ttu-id="ba374-205">Példa</span><span class="sxs-lookup"><span data-stu-id="ba374-205">Example</span></span>

<span data-ttu-id="ba374-206">Az Azure által támogatott közös hozzáférésű jogosultságkód Azure Storage a blobot, táblát és üzenetsort adatainak részletes hozzáférés-vezérléshez, valamint a Service Bus-üzenetsorok és témakörök.</span><span class="sxs-lookup"><span data-stu-id="ba374-206">Azure supports shared access signatures on Azure Storage for granular access control to data in blobs, tables, and queues, and for Service Bus queues and topics.</span></span> <span data-ttu-id="ba374-207">Egy megosztott hozzáférési aláírást jogkivonat beállítható úgy, hogy egy adott táblához; például az olvasási, írási, frissítési és törlési speciális hozzáférési jogot biztosít a táblázatban lévő kulcs tartomány a várólista; egy blob; vagy a blob-tároló.</span><span class="sxs-lookup"><span data-stu-id="ba374-207">A shared access signature token can be configured to provide specific access rights such as read, write, update, and delete to a specific table; a key range within a table; a queue; a blob; or a blob container.</span></span> <span data-ttu-id="ba374-208">Az érvényességi időszak vagy időkorlátozás nélkül lehet egy meghatározott ideig.</span><span class="sxs-lookup"><span data-stu-id="ba374-208">The validity can be a specified time period or with no time limit.</span></span>

<span data-ttu-id="ba374-209">Azure közös hozzáférésű jogosultságkód is támogatja a kiszolgálón tárolt hozzáférési házirendeket, amelyek egy adott erőforrás, például egy táblázat vagy a blob társítható.</span><span class="sxs-lookup"><span data-stu-id="ba374-209">Azure shared access signatures also support server-stored access policies that can be associated with a specific resource such as a table or blob.</span></span> <span data-ttu-id="ba374-210">Ez a szolgáltatás vezérelhetőséget és rugalmasságot alkalmazás által létrehozott megosztott hozzáférési aláírást jogkivonatok képest, és kell használni, amikor csak lehetséges.</span><span class="sxs-lookup"><span data-stu-id="ba374-210">This feature provides additional control and flexibility compared to application-generated shared access signature tokens, and should be used whenever possible.</span></span> <span data-ttu-id="ba374-211">Egy kiszolgálón tárolja a házirendben meghatározott beállítások módosíthatók, és anélkül, hogy egy új jogkivonatot kell végezni a token megjelennek, de a jogkivonat megadott beállítások nem módosítható egy új jogkivonatot kiadása nélkül.</span><span class="sxs-lookup"><span data-stu-id="ba374-211">Settings defined in a server-stored policy can be changed and are reflected in the token without requiring a new token to be issued, but settings defined in the token can't be changed without issuing a new token.</span></span> <span data-ttu-id="ba374-212">Ezt a módszert is lehetővé teszi egy érvényes megosztott hozzáférési aláírást jogkivonat visszavonása lejárta előtt.</span><span class="sxs-lookup"><span data-stu-id="ba374-212">This approach also makes it possible to revoke a valid shared access signature token before it's expired.</span></span>

> <span data-ttu-id="ba374-213">További információ: [bevezetéséről tábla SAS (közös hozzáférésű Jogosultságkód), üzenetsor SAS és a Blob SAS-frissítés](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) és [megosztott hozzáférési aláírásokkal használatával](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/) az MSDN Webhelyén.</span><span class="sxs-lookup"><span data-stu-id="ba374-213">For more information see [Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) and [Using Shared Access Signatures](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/) on MSDN.</span></span>

<span data-ttu-id="ba374-214">A következő kód bemutatja, hogyan hozzon létre egy megosztott hozzáférési aláírást tokent, amely érvényes 5 percig.</span><span class="sxs-lookup"><span data-stu-id="ba374-214">The following code shows how to create a shared access signature token that's valid for five minutes.</span></span> <span data-ttu-id="ba374-215">A `GetSharedAccessReferenceForUpload` módszer segítségével feltölteni a fájlt az Azure Blob Storage közös hozzáférésű aláírások tokenre adja vissza.</span><span class="sxs-lookup"><span data-stu-id="ba374-215">The `GetSharedAccessReferenceForUpload` method returns a shared access signatures token that can be used to upload a file to Azure Blob Storage.</span></span>

```csharp
public class ValuesController : ApiController
{
  private readonly CloudStorageAccount account;
  private readonly string blobContainer;
  ...
  /// <summary>
  /// Return a limited access key that allows the caller to upload a file
  /// to this specific destination for a defined period of time.
  /// </summary>
  private StorageEntitySas GetSharedAccessReferenceForUpload(string blobName)
  {
    var blobClient = this.account.CreateCloudBlobClient();
    var container = blobClient.GetContainerReference(this.blobContainer);

    var blob = container.GetBlockBlobReference(blobName);

    var policy = new SharedAccessBlobPolicy
    {
      Permissions = SharedAccessBlobPermissions.Write,

      // Specify a start time five minutes earlier to allow for client clock skew.
      SharedAccessStartTime = DateTime.UtcNow.AddMinutes(-5),

      // Specify a validity period of five minutes starting from now.
      SharedAccessExpiryTime = DateTime.UtcNow.AddMinutes(5)
    };

    // Create the signature.
    var sas = blob.GetSharedAccessSignature(policy);

    return new StorageEntitySas
    {
      BlobUri = blob.Uri,
      Credentials = sas,
      Name = blobName
    };
  }

  public struct StorageEntitySas
  {
    public string Credentials;
    public Uri BlobUri;
    public string Name;
  }
}
```

> <span data-ttu-id="ba374-216">A teljes minta érhető el a letölthető ValetKey megoldás [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span><span class="sxs-lookup"><span data-stu-id="ba374-216">The complete sample is available in the ValetKey solution available for download from [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span> <span data-ttu-id="ba374-217">Ebben a megoldásban a ValetKey.Web projekt tartalmazza a webes alkalmazás, amely tartalmazza a `ValuesController` osztály fent látható.</span><span class="sxs-lookup"><span data-stu-id="ba374-217">The ValetKey.Web project in this solution contains a web application that includes the `ValuesController` class shown above.</span></span> <span data-ttu-id="ba374-218">Ügyfél mintaalkalmazás, amely a webes alkalmazás használ az egy megosztott hozzáférési aláírásokkal kulcs lekérése, valamint a fájl feltöltése a blob storage a ValetKey.Client projekt érhető el.</span><span class="sxs-lookup"><span data-stu-id="ba374-218">A sample client application that uses this web application to retrieve a shared access signatures key and upload a file to blob storage is available in the ValetKey.Client project.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ba374-219">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="ba374-219">Next steps</span></span>

<span data-ttu-id="ba374-220">A következő mintákat és útmutatókat is lehet releváns ebben a mintában végrehajtása során:</span><span class="sxs-lookup"><span data-stu-id="ba374-220">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="ba374-221">Minta bemutatja, ebben a mintában érhető el a [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span><span class="sxs-lookup"><span data-stu-id="ba374-221">A sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span>
- <span data-ttu-id="ba374-222">[Forgalomirányító mintát](gatekeeper.md).</span><span class="sxs-lookup"><span data-stu-id="ba374-222">[Gatekeeper pattern](gatekeeper.md).</span></span> <span data-ttu-id="ba374-223">Ebben a mintában a Valet kulcs mintát együtt használható alkalmazások és szolgáltatások védelmét, hogy az ügyfelek és az alkalmazás vagy szolgáltatás közötti közvetítőként dedikált gazdagép példánnyal.</span><span class="sxs-lookup"><span data-stu-id="ba374-223">This pattern can be used in conjunction with the Valet Key pattern to protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service.</span></span> <span data-ttu-id="ba374-224">A forgalomirányító ellenőrzi kérelmek sanitizes, és továbbítja a kérelmek és az adatok az ügyfél és az alkalmazás között.</span><span class="sxs-lookup"><span data-stu-id="ba374-224">The gatekeeper validates and sanitizes requests, and passes requests and data between the client and the application.</span></span> <span data-ttu-id="ba374-225">Adjon meg egy további biztonsági réteget és csökkenteni a támadási felületet, a rendszer.</span><span class="sxs-lookup"><span data-stu-id="ba374-225">Can provide an additional layer of security, and reduce the attack surface of the system.</span></span>
- <span data-ttu-id="ba374-226">[Statikus tartalom üzemeltető mintát](static-content-hosting.md).</span><span class="sxs-lookup"><span data-stu-id="ba374-226">[Static Content Hosting pattern](static-content-hosting.md).</span></span> <span data-ttu-id="ba374-227">Egy felhőalapú tárolási szolgáltatás által biztosított ezeket az erőforrásokat közvetlenül az ügyfél, olcsóbbá számítási példányokért kapcsolatos követelmények csökkentése érdekében a statikus erőforrások telepítésének módját ismerteti.</span><span class="sxs-lookup"><span data-stu-id="ba374-227">Describes how to deploy static resources to a cloud-based storage service that can deliver these resources directly to the client to reduce the requirement for expensive compute instances.</span></span> <span data-ttu-id="ba374-228">Ha az erőforrások nem kell nyilvánosan elérhető, a Valet kulcs minta segítségével biztonságos őket.</span><span class="sxs-lookup"><span data-stu-id="ba374-228">Where the resources aren't intended to be publicly available, the Valet Key pattern can be used to secure them.</span></span>
- [<span data-ttu-id="ba374-229">Tábla SAS (közös hozzáférésű Jogosultságkód), üzenetsor SAS és a Blob SAS-frissítés bemutatása</span><span class="sxs-lookup"><span data-stu-id="ba374-229">Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS</span></span>](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/)
- [<span data-ttu-id="ba374-230">Közös hozzáférésű Jogosultságkód használatával</span><span class="sxs-lookup"><span data-stu-id="ba374-230">Using Shared Access Signatures</span></span>](https://azure.microsoft.com/documentation/articles/storage-dotnet-shared-access-signature-part-1/)
- [<span data-ttu-id="ba374-231">A Service busszal aláírás hitelesítés megosztott</span><span class="sxs-lookup"><span data-stu-id="ba374-231">Shared Access Signature Authentication with Service Bus</span></span>](https://azure.microsoft.com/documentation/articles/service-bus-shared-access-signature-authentication/)
