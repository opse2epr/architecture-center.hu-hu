---
title: Pótkulcs minta
titleSuffix: Cloud Design Patterns
description: Jogkivonatot vagy kulcsot használhat, amely korlátozott közvetlen hozzáférést biztosít az ügyfelek számára egy adott erőforráshoz vagy szolgáltatáshoz.
keywords: tervezési minta
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: c0d507a1826716f6d4f2bab9a894be2fe941f3a3
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 03/20/2019
ms.locfileid: "58298830"
---
# <a name="valet-key-pattern"></a><span data-ttu-id="30513-104">Pótkulcs minta</span><span class="sxs-lookup"><span data-stu-id="30513-104">Valet Key pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="30513-105">Egy jogkivonat használatával korlátozott közvetlen hozzáférést biztosíthat az ügyfelek számára egy adott erőforráshoz, hogy így csökkentse egy alkalmazás adatátviteli követelményeit.</span><span class="sxs-lookup"><span data-stu-id="30513-105">Use a token that provides clients with restricted direct access to a specific resource, in order to offload data transfer from the application.</span></span> <span data-ttu-id="30513-106">Ez különösen hasznos olyan alkalmazások esetében, amelyek felhőben futtatott tárolórendszereket vagy üzenetsorokat használnak, mert minimalizálja a költségeket és maximalizálja a skálázhatóságot és a teljesítményt.</span><span class="sxs-lookup"><span data-stu-id="30513-106">This is particularly useful in applications that use cloud-hosted storage systems or queues, and can minimize cost and maximize scalability and performance.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="30513-107">Kontextus és probléma</span><span class="sxs-lookup"><span data-stu-id="30513-107">Context and problem</span></span>

<span data-ttu-id="30513-108">Az ügyfélprogramoknak és a böngészőknek gyakran kell fájlokat vagy adatstreameket olvasniuk, illetve írniuk az alkalmazás tárolójában.</span><span class="sxs-lookup"><span data-stu-id="30513-108">Client programs and web browsers often need to read and write files or data streams to and from an application’s storage.</span></span> <span data-ttu-id="30513-109">Általában az alkalmazás fogja kezelni az adatok mozgását – vagy lekérdezi a tárolóból és streameli az ügyfélnek, vagy beolvassa az ügyfél által feltöltött streamet, és menti az adattárba.</span><span class="sxs-lookup"><span data-stu-id="30513-109">Typically, the application will handle the movement of the data &mdash; either by fetching it from storage and streaming it to the client, or by reading the uploaded stream from the client and storing it in the data store.</span></span> <span data-ttu-id="30513-110">Azonban ez a megközelítés értékes erőforrásokat foglal le, például számítási, memória- és sávszélesség-erőforrásokat.</span><span class="sxs-lookup"><span data-stu-id="30513-110">However, this approach absorbs valuable resources such as compute, memory, and bandwidth.</span></span>

<span data-ttu-id="30513-111">Az adattárak képesek közvetlenül kezelni az adatfeltöltést és -letöltést, így az alkalmazás részéről nincs szükség semmilyen feldolgozási tevékenységre az adatok mozgatásához.</span><span class="sxs-lookup"><span data-stu-id="30513-111">Data stores have the ability to handle upload and download of data directly, without requiring that the application perform any processing to move this data.</span></span> <span data-ttu-id="30513-112">Ehhez viszont általában az ügyfélnek hozzá kell férnie a tároló biztonsági hitelesítő adataihoz.</span><span class="sxs-lookup"><span data-stu-id="30513-112">But, this typically requires the client to have access to the security credentials for the store.</span></span> <span data-ttu-id="30513-113">Ez hasznos módszer lehet, ha minimalizálni szeretné az adatátvitel költségeit és szükség van az alkalmazás horizontális felskálázására, valamint maximalizálni szeretné a teljesítményt.</span><span class="sxs-lookup"><span data-stu-id="30513-113">This can be a useful technique to minimize data transfer costs and the requirement to scale out the application, and to maximize performance.</span></span> <span data-ttu-id="30513-114">Azonban ez azt jelenti, hogy az alkalmazás már nem fogja tudni kezelni az adatok biztonságát.</span><span class="sxs-lookup"><span data-stu-id="30513-114">It means, though, that the application is no longer able to manage the security of the data.</span></span> <span data-ttu-id="30513-115">Miután az ügyfél közvetlen hozzáféréssel tud kapcsolódni az adattárhoz, az alkalmazás már nem töltheti be a forgalomirányító szerepét.</span><span class="sxs-lookup"><span data-stu-id="30513-115">After the client has a connection to the data store for direct access, the application can't act as the gatekeeper.</span></span> <span data-ttu-id="30513-116">Már nem az alkalmazás szabályozza a folyamatot, és nem akadályozhatja meg a későbbi feltöltéseket vagy letöltéseket az adattárolóban.</span><span class="sxs-lookup"><span data-stu-id="30513-116">It's no longer in control of the process and can't prevent subsequent uploads or downloads from the data store.</span></span>

<span data-ttu-id="30513-117">Ez nem reális megközelítés elosztott rendszerek esetében, amelyek nem megbízható ügyfeleket is kiszolgálnak.</span><span class="sxs-lookup"><span data-stu-id="30513-117">This isn't a realistic approach in distributed systems that need to serve untrusted clients.</span></span> <span data-ttu-id="30513-118">Ehelyett az alkalmazásoknak képesnek kell lenniük az adathozzáférést biztonságosan és részletesen szabályozni, ugyanakkor csökkenteniük kell a kiszolgáló terheltségét is, méghozzá úgy, hogy először létre kell hozniuk a kapcsolatot, majd engedélyezniük kell az ügyfél számára a közvetlen kommunikációt az adattárral, hogy az végrehajthassa a szükséges olvasási vagy írási műveleteket.</span><span class="sxs-lookup"><span data-stu-id="30513-118">Instead, applications must be able to securely control access to data in a granular way, but still reduce the load on the server by setting up this connection and then allowing the client to communicate directly with the data store to perform the required read or write operations.</span></span>

## <a name="solution"></a><span data-ttu-id="30513-119">Megoldás</span><span class="sxs-lookup"><span data-stu-id="30513-119">Solution</span></span>

<span data-ttu-id="30513-120">Meg kell oldania az adattárhoz való hozzáférés szabályozását olyan esetben, amikor a tároló nem képes kezelni az ügyfelek hitelesítését és ellenőrzését.</span><span class="sxs-lookup"><span data-stu-id="30513-120">You need to resolve the problem of controlling access to a data store where the store can't manage authentication and authorization of clients.</span></span> <span data-ttu-id="30513-121">Egy tipikus megoldási lehetőség, hogy korlátozza a hozzáférést az adattár nyilvános kapcsolatához, és biztosít egy kulcsot vagy jogkivonatot az ügyfélnek, amelyet az adattár ellenőrizni tud.</span><span class="sxs-lookup"><span data-stu-id="30513-121">One typical solution is to restrict access to the data store’s public connection and provide the client with a key or token that the data store can validate.</span></span>

<span data-ttu-id="30513-122">Ezt a kulcsot vagy a jogkivonatot általában pótkulcsnak nevezzük.</span><span class="sxs-lookup"><span data-stu-id="30513-122">This key or token is usually referred to as a valet key.</span></span> <span data-ttu-id="30513-123">A kulcs időkorlátos hozzáférést biztosít bizonyos erőforrásokhoz, és csak előre meghatározott műveleteket tesz lehetővé, például írást és olvasást a tárolón vagy üzenetsorban, vagy fel- és letöltést böngészőn keresztül.</span><span class="sxs-lookup"><span data-stu-id="30513-123">It provides time-limited access to specific resources and allows only predefined operations such as reading and writing to storage or queues, or uploading and downloading in a web browser.</span></span> <span data-ttu-id="30513-124">Az alkalmazások gyorsan és könnyen létrehozhatnak és kioszthatnak pótkulcsokat ügyféleszközök és böngészők számára, amelyekkel az ügyfelek elvégezhetik a szükséges műveleteket anélkül, hogy az alkalmazásnak közvetlenül kezelni kellene az adatátvitelt.</span><span class="sxs-lookup"><span data-stu-id="30513-124">Applications can create and issue valet keys to client devices and web browsers quickly and easily, allowing clients to perform the required operations without requiring the application to directly handle the data transfer.</span></span> <span data-ttu-id="30513-125">Ezzel megszűnik az alkalmazás és a kiszolgáló feldolgozási többletterhelése, a teljesítményre és skálázhatóságra gyakorolt hatásával együtt.</span><span class="sxs-lookup"><span data-stu-id="30513-125">This removes the processing overhead, and the impact on performance and scalability, from the application and the server.</span></span>

<span data-ttu-id="30513-126">Az ügyfél a jogkivonattal az adattár egy kijelölt erőforrásához férhet hozzá, csak meghatározott ideig, és a hozzáférési engedélyek bizonyos mértékű korlátozásával, mint ahogy az ábrán látható.</span><span class="sxs-lookup"><span data-stu-id="30513-126">The client uses this token to access a specific resource in the data store for only a specific period, and with specific restrictions on access permissions, as shown in the figure.</span></span> <span data-ttu-id="30513-127">A megadott időszak után a kulcs érvénytelenné válik, és többé nem ad hozzáférést az erőforráshoz.</span><span class="sxs-lookup"><span data-stu-id="30513-127">After the specified period, the key becomes invalid and won't allow access to the resource.</span></span>

![1. ábra – A minta áttekintése](./_images/valet-key-pattern.png)

<span data-ttu-id="30513-129">Ezen felül lehetősége van más függőségekkel (például az adatok hatóköre) rendelkező kulcs konfigurálására.</span><span class="sxs-lookup"><span data-stu-id="30513-129">It's also possible to configure a key that has other dependencies, such as the scope of the data.</span></span> <span data-ttu-id="30513-130">Például az adattár képességeihez mérten a kulcs meghatározhat egy teljes táblát az adattáron belül, vagy akár csak egy tábla bizonyos sorait.</span><span class="sxs-lookup"><span data-stu-id="30513-130">For example, depending on the data store capabilities, the key can specify a complete table in a data store, or only specific rows in a table.</span></span> <span data-ttu-id="30513-131">Felhőalapú tárolórendszerek esetében a kulcs megadhat egy tárolót, vagy csak egy adott elemet egy tárolón belül.</span><span class="sxs-lookup"><span data-stu-id="30513-131">In cloud storage systems the key can specify a container, or just a specific item within a container.</span></span>

<span data-ttu-id="30513-132">A kulcsot az alkalmazás is képes érvényteleníteni.</span><span class="sxs-lookup"><span data-stu-id="30513-132">The key can also be invalidated by the application.</span></span> <span data-ttu-id="30513-133">Ez hasznos megközelítés abban az esetben, ha az ügyfél értesíti a kiszolgálót az adatátvitel befejeztéről.</span><span class="sxs-lookup"><span data-stu-id="30513-133">This is a useful approach if the client notifies the server that the data transfer operation is complete.</span></span> <span data-ttu-id="30513-134">A kiszolgáló majd érvénytelenné tehetik a kulcsot a további hozzáférés megakadályozása.</span><span class="sxs-lookup"><span data-stu-id="30513-134">The server can then invalidate that key to prevent further access.</span></span>

<span data-ttu-id="30513-135">A minta használatával leegyszerűsítheti az erőforrásokhoz való hozzáférés kezelését, mert nem kell létrehozni és hitelesíteni a felhasználót, engedélyeket megadni, majd végül eltávolítani a felhasználót.</span><span class="sxs-lookup"><span data-stu-id="30513-135">Using this pattern can simplify managing access to resources because there's no requirement to create and authenticate a user, grant permissions, and then remove the user again.</span></span> <span data-ttu-id="30513-136">Emellett könnyű korlátozni a helyet, az engedélyt és az érvényességi időszakot – ehhez csupán létre kell hoznia egy kulcsot futtatáskor.</span><span class="sxs-lookup"><span data-stu-id="30513-136">It also makes it easy to limit the location, the permission, and the validity period&mdash;all by simply generating a key at runtime.</span></span> <span data-ttu-id="30513-137">A legfontosabb tényező az érvényességi időszak, és különösen az erőforrás helyének minél szigorúbb korlátozása, hogy a kulcs birtokosa azt csak rendeltetésszerű célokra használhassa.</span><span class="sxs-lookup"><span data-stu-id="30513-137">The important factors are to limit the validity period, and especially the location of the resource, as tightly as possible so that the recipient can only use it for the intended purpose.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="30513-138">Problémák és megfontolandó szempontok</span><span class="sxs-lookup"><span data-stu-id="30513-138">Issues and considerations</span></span>

<span data-ttu-id="30513-139">A minta megvalósítása során az alábbi pontokat vegye figyelembe:</span><span class="sxs-lookup"><span data-stu-id="30513-139">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="30513-140">**Kezelje a kulcs érvényességi állapotát és időtartamát**.</span><span class="sxs-lookup"><span data-stu-id="30513-140">**Manage the validity status and period of the key**.</span></span> <span data-ttu-id="30513-141">Ha a kulcs kiszivárog vagy megsérül, az gyakorlatilag szabaddá teszi a célelemet, amely az érvényességi idő alatt kártékony használat áldozata lehet.</span><span class="sxs-lookup"><span data-stu-id="30513-141">If leaked or compromised, the key effectively unlocks the target item and makes it available for malicious use during the validity period.</span></span> <span data-ttu-id="30513-142">A kiállítás módjától függően a kulcsot általában visszavonhatja vagy letilthatja.</span><span class="sxs-lookup"><span data-stu-id="30513-142">A key can usually be revoked or disabled, depending on how it was issued.</span></span> <span data-ttu-id="30513-143">A kiszolgálóoldali szabályzatok módosíthatók, illetve az aláírást biztosító kiszolgálói kulcs érvényteleníthető.</span><span class="sxs-lookup"><span data-stu-id="30513-143">Server-side policies can be changed or, the server key it was signed with can be invalidated.</span></span> <span data-ttu-id="30513-144">Adjon meg rövid érvényességi időt, hogy a minimálisra csökkentse az adattárra irányuló jogosulatlan műveletek kockázatát.</span><span class="sxs-lookup"><span data-stu-id="30513-144">Specify a short validity period to minimize the risk of allowing unauthorized operations to take place against the data store.</span></span> <span data-ttu-id="30513-145">Ha azonban az érvényességi időtartam túl rövid, előfordulhat, hogy az ügyfél nem tudja elvégezni a kívánt műveletet a kulcs érvényességének lejárta előtt.</span><span class="sxs-lookup"><span data-stu-id="30513-145">However, if the validity period is too short, the client might not be able to complete the operation before the key expires.</span></span> <span data-ttu-id="30513-146">Engedélyezze a jogosult felhasználók számára a kulcs megújítását az érvényesség lejárta előtt arra az esetre, ha többszöri hozzáférésre van szükség a védett erőforráshoz.</span><span class="sxs-lookup"><span data-stu-id="30513-146">Allow authorized users to renew the key before the validity period expires if multiple accesses to the protected resource are required.</span></span>

<span data-ttu-id="30513-147">**Szabályozza a kulcs által biztosított hozzáférési szintet**.</span><span class="sxs-lookup"><span data-stu-id="30513-147">**Control the level of access the key will provide**.</span></span> <span data-ttu-id="30513-148">A kulcs általában csak a művelethez szükséges tevékenységek végrehajtását engedélyezi a felhasználó számára, például csak olvasható hozzáférést ad, ha az ügyfélnek nem szabadna adatot feltöltenie az adattárba.</span><span class="sxs-lookup"><span data-stu-id="30513-148">Typically, the key should allow the user to only perform the actions necessary to complete the operation, such as read-only access if the client shouldn't be able to upload data to the data store.</span></span> <span data-ttu-id="30513-149">Fájlfeltöltés esetén olyan kulcsot szokás megadni, amely csak írási engedélyt biztosít, valamint meghatározza a helyet és az érvényességi időt.</span><span class="sxs-lookup"><span data-stu-id="30513-149">For file uploads, it's common to specify a key that provides write-only permission, as well as the location and the validity period.</span></span> <span data-ttu-id="30513-150">Döntően fontos pontosan meghatározni azt az erőforrást vagy azt az erőforráskészletet, amelyre a kulcs érvényes.</span><span class="sxs-lookup"><span data-stu-id="30513-150">It's critical to accurately specify the resource or the set of resources to which the key applies.</span></span>

<span data-ttu-id="30513-151">**Gondolja át, hogyan fogja szabályozni a felhasználó viselkedését**.</span><span class="sxs-lookup"><span data-stu-id="30513-151">**Consider how to control users’ behavior**.</span></span> <span data-ttu-id="30513-152">Az ilyen minta megvalósításával együtt jár az, hogy kevésbé tudja szabályozni azokat az erőforrásokat, amelyekhez hozzáférést biztosít a felhasználóknak.</span><span class="sxs-lookup"><span data-stu-id="30513-152">Implementing this pattern means some loss of control over the resources users are granted access to.</span></span> <span data-ttu-id="30513-153">A szabályozás mértékét korlátozzák a szolgáltatás vagy a célzott adattár esetében elérhető szabályzatok és engedélyek képességei.</span><span class="sxs-lookup"><span data-stu-id="30513-153">The level of control that can be exerted is limited by the capabilities of the policies and permissions available for the service or the target data store.</span></span> <span data-ttu-id="30513-154">Például általában nincs lehetőség egy olyan kulcs létrehozására, amely korlátozza a tárolóra írható adat méretét, vagy azt, hogy egy kulccsal hányszor férhetnek hozzá egy adott fájlhoz.</span><span class="sxs-lookup"><span data-stu-id="30513-154">For example, it's usually not possible to create a key that limits the size of the data to be written to storage, or the number of times the key can be used to access a file.</span></span> <span data-ttu-id="30513-155">Ez váratlanul hatalmas adatátviteli költséget eredményezhet, még akkor is, ha az az ügyfél használja a kulcsot, akinek szánták, és a kód olyan hibájából adódhat, amely ismétlődő fel- vagy letöltést okoz.</span><span class="sxs-lookup"><span data-stu-id="30513-155">This can result in huge unexpected costs for data transfer, even when used by the intended client, and might be caused by an error in the code that causes repeated upload or download.</span></span> <span data-ttu-id="30513-156">A fájlfeltöltések számának korlátozásához ahol lehetséges, kényszerítse az ügyfelet, hogy értesítse az alkalmazást a feltöltés befejezéséről.</span><span class="sxs-lookup"><span data-stu-id="30513-156">To limit the number of times a file can be uploaded, where possible, force the client to notify the application when one operation has completed.</span></span> <span data-ttu-id="30513-157">Néhány adattár például eseményeket hoz létre, amelyeket az alkalmazás felhasználhat a műveletek monitorozására és a felhasználói viselkedés szabályozására.</span><span class="sxs-lookup"><span data-stu-id="30513-157">For example, some data stores raise events the application code can use to monitor operations and control user behavior.</span></span> <span data-ttu-id="30513-158">Azonban nehéz kvótákat előírni az egyéni felhasználók számára egy több bérlős helyzet esetén, ahol egyetlen bérlő összes felhasználója ugyanazt a kulcsot használja.</span><span class="sxs-lookup"><span data-stu-id="30513-158">However, it's hard to enforce quotas for individual users in a multi-tenant scenario where the same key is used by all the users from one tenant.</span></span>

<span data-ttu-id="30513-159">**Érvényesítsen és igény szerint vírusmentesítsen minden feltöltött adatot**.</span><span class="sxs-lookup"><span data-stu-id="30513-159">**Validate, and optionally sanitize, all uploaded data**.</span></span> <span data-ttu-id="30513-160">Ha egy kártevő felhasználó hozzáférést szerzett a kulcshoz, feltölthet olyan adatot, amelyet a rendszer károsítására terveztek.</span><span class="sxs-lookup"><span data-stu-id="30513-160">A malicious user that gains access to the key could upload data designed to compromise the system.</span></span> <span data-ttu-id="30513-161">Más esetekben az engedélyezett felhasználók feltölthetnek érvénytelen adatokat, amelyek feldolgozáskor hibához vagy a rendszer meghibásodásához vezethetnek.</span><span class="sxs-lookup"><span data-stu-id="30513-161">Alternatively, authorized users might upload data that's invalid and, when processed, could result in an error or system failure.</span></span> <span data-ttu-id="30513-162">Ez ellen úgy védekezhet, hogy gondoskodik az összes adat érvényesítéséről és rosszindulatú kódok ellenőrzéséről a használat előtt.</span><span class="sxs-lookup"><span data-stu-id="30513-162">To protect against this, ensure that all uploaded data is validated and checked for malicious content before use.</span></span>

<span data-ttu-id="30513-163">**Naplózzon minden műveletet**.</span><span class="sxs-lookup"><span data-stu-id="30513-163">**Audit all operations**.</span></span> <span data-ttu-id="30513-164">Sok kulcsalapú mechanizmus képes olyan műveletek naplózására, mint a feltöltések, a letöltések és a hibák.</span><span class="sxs-lookup"><span data-stu-id="30513-164">Many key-based mechanisms can log operations such as uploads, downloads, and failures.</span></span> <span data-ttu-id="30513-165">Ezeket a naplókat általában beépítheti egy naplózási folyamatba, illetve számlázáshoz is használhatja, ha a felhasználónak fájlméret vagy adatmennyiség alapján számláz.</span><span class="sxs-lookup"><span data-stu-id="30513-165">These logs can usually be incorporated into an audit process, and also used for billing if the user is charged based on file size or data volume.</span></span> <span data-ttu-id="30513-166">A naplók segítségével észlelheti az olyan hitelesítési hibákat, amelyek esetlegesen a kulcsszolgáltató hibájából vagy egy tárolt hozzáférési szabályzat nem szándékos eltávolításából adódnak.</span><span class="sxs-lookup"><span data-stu-id="30513-166">Use the logs to detect authentication failures that might be caused by issues with the key provider, or accidental removal of a stored access policy.</span></span>

<span data-ttu-id="30513-167">**A kulcsot biztonságosan adja át**.</span><span class="sxs-lookup"><span data-stu-id="30513-167">**Deliver the key securely**.</span></span> <span data-ttu-id="30513-168">URL-be ágyazhatja, amelyet a felhasználó egy weblapon tud aktiválni, vagy használhatja egy kiszolgáló-átirányítási műveletben, így a letöltés automatikusan megindul.</span><span class="sxs-lookup"><span data-stu-id="30513-168">It can be embedded in a URL that the user activates in a web page, or it can be used in a server redirection operation so that the download occurs automatically.</span></span> <span data-ttu-id="30513-169">Mindig használjon HTTPS-t, hogy biztonságos csatornán keresztül adja át a kulcsot.</span><span class="sxs-lookup"><span data-stu-id="30513-169">Always use HTTPS to deliver the key over a secure channel.</span></span>

<span data-ttu-id="30513-170">**Védje a bizalmas adatokat az átvitel során**.</span><span class="sxs-lookup"><span data-stu-id="30513-170">**Protect sensitive data in transit**.</span></span> <span data-ttu-id="30513-171">A bizalmas adatok szállítása az alkalmazáson keresztül általában SSL vagy TLS használatával történik, és ezt elő kell írni az olyan ügyfelek számára, akik közvetlen hozzáféréssel rendelkeznek az adattárhoz.</span><span class="sxs-lookup"><span data-stu-id="30513-171">Sensitive data delivered through the application will usually take place using SSL or TLS, and this should be enforced for clients accessing the data store directly.</span></span>

<span data-ttu-id="30513-172">A minta megvalósításakor érdemes egyéb problémákról is tájékozódnia:</span><span class="sxs-lookup"><span data-stu-id="30513-172">Other issues to be aware of when implementing this pattern are:</span></span>

- <span data-ttu-id="30513-173">Ha az ügyfél nem jelzi vagy nem tudja jelezni a kiszolgáló felé a művelet befejeződését, és csak a kulcs lejárati ideje korlátozza, az alkalmazás nem lesz képes naplózási műveletek végrehajtására, például a feltöltések vagy letöltések számának nyomon követésére, és nem képes megakadályozni a többszöri fel- vagy letöltést.</span><span class="sxs-lookup"><span data-stu-id="30513-173">If the client doesn't, or can't, notify the server of completion of the operation, and the only limit is the expiration period of the key, the application won't be able to perform auditing operations such as counting the number of uploads or downloads, or preventing multiple uploads or downloads.</span></span>

- <span data-ttu-id="30513-174">A létrehozható kulcskezelési szabályzatok esetenként nem eléggé rugalmasak.</span><span class="sxs-lookup"><span data-stu-id="30513-174">The flexibility of key policies that can be generated might be limited.</span></span> <span data-ttu-id="30513-175">Például bizonyos mechanizmusok csak időzített lejárati idő használatát engedik.</span><span class="sxs-lookup"><span data-stu-id="30513-175">For example, some mechanisms only allow the use of a timed expiration period.</span></span> <span data-ttu-id="30513-176">Más mechanizmusok nem engedik az olvasási/írási engedélyek kellőképpen részletes meghatározását.</span><span class="sxs-lookup"><span data-stu-id="30513-176">Others aren't able to specify a sufficient granularity of read/write permissions.</span></span>

- <span data-ttu-id="30513-177">Ha meg van adva a kulcs vagy a jogkivonat érvényességi időtartamának kezdeti időpontja, győződjön meg róla, hogy az a jelenlegi kiszolgálóidőnél egy kicsit korábbi időpont, hogy az ügyfelek akkor is kaphassanak hozzáférést, ha a rendszeróra nem teljesen szinkronizált.</span><span class="sxs-lookup"><span data-stu-id="30513-177">If the start time for the key or token validity period is specified, ensure that it's a little earlier than the current server time to allow for client clocks that might be slightly out of synchronization.</span></span> <span data-ttu-id="30513-178">Az alapértelmezett érték a kiszolgáló aktuális rendszerideje, ha nincs egyéb megadva.</span><span class="sxs-lookup"><span data-stu-id="30513-178">The default, if not specified, is usually the current server time.</span></span>

- <span data-ttu-id="30513-179">A kulcsot tartalmazó URL-cím a kiszolgáló naplófájljaiban lesz rögzítve.</span><span class="sxs-lookup"><span data-stu-id="30513-179">The URL containing the key will be recorded in server log files.</span></span> <span data-ttu-id="30513-180">Bár a kulcs általában már lejár, mire a naplófájlokat a rendszer felhasználná elemzések készítéséhez, gondoskodjon a hozzáférés korlátozásáról.</span><span class="sxs-lookup"><span data-stu-id="30513-180">While the key will typically have expired before the log files are used for analysis, ensure that you limit access to them.</span></span> <span data-ttu-id="30513-181">Ha a naplózási adatokat továbbítja egy monitorozási rendszernek vagy más helyen tárolja őket, fontolja meg egy késleltetési idő bevezetését, amellyel megakadályozza a kulcsok kiszivárgását az érvényességi idejük lejárta előtt.</span><span class="sxs-lookup"><span data-stu-id="30513-181">If log data is transmitted to a monitoring system or stored in another location, consider implementing a delay to prevent leakage of keys until after their validity period has expired.</span></span>

- <span data-ttu-id="30513-182">Ha az ügyfélkód webböngészőben fut, előfordulhat, hogy a böngészőnek támogatnia kell az eltérő eredetű erőforrások megosztását (CORS), így a webböngészőben lefuthatnak olyan kódok, amelyekkel a weblapot kiszolgáló tartományon keresztül hozzáférhet egy másik tartomány adataihoz.</span><span class="sxs-lookup"><span data-stu-id="30513-182">If the client code runs in a web browser, the browser might need to support cross-origin resource sharing (CORS) to enable code that executes within the web browser to access data in a different domain from the one that served the page.</span></span> <span data-ttu-id="30513-183">Egyes régebbi böngészők és néhány adattároló nem támogatja a CORS-t, és az ezekben a böngészőkben futó kódok képesek lehetnek pótkulcs használatára, hogy így biztosítsák a hozzáférést egy másik tartomány adataihoz, például egy felhőalapú tárfiók esetében.</span><span class="sxs-lookup"><span data-stu-id="30513-183">Some older browsers and some data stores don't support CORS, and code that runs in these browsers might be able to use a valet key to provide access to data in a different domain, such as a cloud storage account.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="30513-184">Mikor érdemes ezt a mintát használni?</span><span class="sxs-lookup"><span data-stu-id="30513-184">When to use this pattern</span></span>

<span data-ttu-id="30513-185">Ez a minta az alábbi helyzetekben lehet hasznos:</span><span class="sxs-lookup"><span data-stu-id="30513-185">This pattern is useful for the following situations:</span></span>

- <span data-ttu-id="30513-186">Ha az erőforrások terhelésének minimálisra csökkentésére, illetve a lehető legnagyobb teljesítményre és skálázhatóságra van szükség.</span><span class="sxs-lookup"><span data-stu-id="30513-186">To minimize resource loading and maximize performance and scalability.</span></span> <span data-ttu-id="30513-187">Pótkulcs használatakor nem kell zárolni az erőforrást, nem szükséges a távoli kiszolgáló meghívása, nincs korlátozva a kiadható pótkulcsok száma, és elkerülheti, hogy az alkalmazáskódon keresztüli adatátvitel miatt egyetlen meghibásodási pont alakuljon ki.</span><span class="sxs-lookup"><span data-stu-id="30513-187">Using a valet key doesn't require the resource to be locked, no remote server call is required, there's no limit on the number of valet keys that can be issued, and it avoids a single point of failure resulting from performing the data transfer through the application code.</span></span> <span data-ttu-id="30513-188">A pótkulcs létrehozása általában egy egyszerű kriptográfiai művelet, amelynek során aláír egy sztringet egy kulccsal.</span><span class="sxs-lookup"><span data-stu-id="30513-188">Creating a valet key is typically a simple cryptographic operation of signing a string with a key.</span></span>

- <span data-ttu-id="30513-189">Ha az üzemeltetési költségek csökkentésére van szükség.</span><span class="sxs-lookup"><span data-stu-id="30513-189">To minimize operational cost.</span></span> <span data-ttu-id="30513-190">A közvetlen hozzáférés engedélyezése a tárolókhoz és az üzenetsorokhoz erőforrás- és költséghatékony, lecsökkentheti a hálózaton belüli oda-vissza áramló adatok mennyiségét, és lehetővé teheti a szükséges számítási erőforrások számának lecsökkentését.</span><span class="sxs-lookup"><span data-stu-id="30513-190">Enabling direct access to stores and queues is resource and cost efficient, can result in fewer network round trips, and might allow for a reduction in the number of compute resources required.</span></span>

- <span data-ttu-id="30513-191">Ha az ügyfelek rendszeresen töltenek fel vagy le adatot, különösen nagy forgalom esetén, vagy ha minden művelet nagy méretű fájlok mozgatásával jár.</span><span class="sxs-lookup"><span data-stu-id="30513-191">When clients regularly upload or download data, particularly where there's a large volume or when each operation involves large files.</span></span>

- <span data-ttu-id="30513-192">Ha az alkalmazásnak csak korlátozott számítási erőforrásai vannak az üzemeltetési korlátozások vagy költségvetési szempontok miatt.</span><span class="sxs-lookup"><span data-stu-id="30513-192">When the application has limited compute resources available, either due to hosting limitations or cost considerations.</span></span> <span data-ttu-id="30513-193">Ebben a helyzetben a minta még hasznosabb lehet akkor, ha sok az egyidejű adatfeltöltés és -letöltés, mert mentesíti az alkalmazást az adatátvitel kezelése alól.</span><span class="sxs-lookup"><span data-stu-id="30513-193">In this scenario, the pattern is even more helpful if there are many concurrent data uploads or downloads because it relieves the application from handling the data transfer.</span></span>

- <span data-ttu-id="30513-194">Ha az adatok tárolását egy távoli tárolóban vagy egy másik adatközpontban oldja meg.</span><span class="sxs-lookup"><span data-stu-id="30513-194">When the data is stored in a remote data store or a different datacenter.</span></span> <span data-ttu-id="30513-195">Ha az alkalmazásnak be kellett töltenie a forgalomirányító szerepét is, további költséget okozhat az a plusz sávszélesség, amely az adatközpontok közötti adatátvitelből fakad, vagy pedig az ügyfél és az alkalmazás közötti átvitelből nyilvános vagy magánhálózatokon keresztül, majd ezután az alkalmazás és az adatközpont közötti adatátvitelből adódik.</span><span class="sxs-lookup"><span data-stu-id="30513-195">If the application was required to act as a gatekeeper, there might be a charge for the additional bandwidth of transferring the data between datacenters, or across public or private networks between the client and the application, and then between the application and the data store.</span></span>

<span data-ttu-id="30513-196">Nem érdemes ezt a mintát használni a következő helyzetekben:</span><span class="sxs-lookup"><span data-stu-id="30513-196">This pattern might not be useful in the following situations:</span></span>

- <span data-ttu-id="30513-197">Ha az alkalmazásnak el kell végeznie még néhány feladatot az adatokon, mielőtt azokat a rendszer eltárolja vagy elküldi őket az ügyfélnek.</span><span class="sxs-lookup"><span data-stu-id="30513-197">If the application must perform some task on the data before it's stored or before it's sent to the client.</span></span> <span data-ttu-id="30513-198">Ha például az alkalmazásnak érvényesítést kell végeznie, feltétel a naplófájl sikeres elérése vagy átalakítást kell végezni az adatokon.</span><span class="sxs-lookup"><span data-stu-id="30513-198">For example, if the application needs to perform validation, log access success, or execute a transformation on the data.</span></span> <span data-ttu-id="30513-199">Azonban bizonyos adattárak és ügyfelek képesek egyszerű átalakítások egyeztetésére és végrehajtására, például tömörítésre vagy kibontásra (például egy webböngésző általában tudja kezelni a Gzip formátumokat).</span><span class="sxs-lookup"><span data-stu-id="30513-199">However, some data stores and clients are able to negotiate and carry out simple transformations such as compression and decompression (for example, a web browser can usually handle GZip formats).</span></span>

- <span data-ttu-id="30513-200">Ha a meglévő alkalmazáskialakítás megnehezíti a minta beépítését.</span><span class="sxs-lookup"><span data-stu-id="30513-200">If the design of an existing application makes it difficult to incorporate the pattern.</span></span> <span data-ttu-id="30513-201">A minta használatához általában egy másik architekturális megközelítés szükséges az adatok szállításához és fogadásához.</span><span class="sxs-lookup"><span data-stu-id="30513-201">Using this pattern typically requires a different architectural approach for delivering and receiving data.</span></span>

- <span data-ttu-id="30513-202">Ha szükség van auditnaplóra és az adatátviteli műveletek számának szabályozására, és az alkalmazott pótkulcs-mechanizmus nem támogatja azokat az értesítéseket, amelyeket a kiszolgáló ezen műveletek kezeléséhez használhatna.</span><span class="sxs-lookup"><span data-stu-id="30513-202">If it's necessary to maintain audit trails or control the number of times a data transfer operation is executed, and the valet key mechanism in use doesn't support notifications that the server can use to manage these operations.</span></span>

- <span data-ttu-id="30513-203">Ha korlátozni kell az adatok méretét, különösen feltöltési műveleteknél.</span><span class="sxs-lookup"><span data-stu-id="30513-203">If it's necessary to limit the size of the data, especially during upload operations.</span></span> <span data-ttu-id="30513-204">Az egyetlen megoldás az, ha az alkalmazás a művelet befejezte után ellenőrzi az adatméretet, vagy ellenőrzi a feltöltések nagyságát egy megadott idő eltelte után vagy egy megadott ütemezés szerint.</span><span class="sxs-lookup"><span data-stu-id="30513-204">The only solution to this is for the application to check the data size after the operation is complete, or check the size of uploads after a specified period or on a scheduled basis.</span></span>

## <a name="example"></a><span data-ttu-id="30513-205">Példa</span><span class="sxs-lookup"><span data-stu-id="30513-205">Example</span></span>

<span data-ttu-id="30513-206">Az Azure támogatja a közös hozzáférésű jogosultságkódot az Azure Storage-en, hogy lehetővé tegye az adatok részletes hozzáférés-szabályozását a blobokban, a táblákban és az üzenetsorokban, valamint Service Bus-üzenetsorok és -témakörök esetében.</span><span class="sxs-lookup"><span data-stu-id="30513-206">Azure supports shared access signatures on Azure Storage for granular access control to data in blobs, tables, and queues, and for Service Bus queues and topics.</span></span> <span data-ttu-id="30513-207">A közös hozzáférésű jogosultságkód konfigurálható úgy, hogy meghatározott hozzáférést biztosítson, például olvasási, írási, frissítési és törlési engedélyt egy adott táblához, egy táblán belüli kulcstartományhoz, egy üzenetsorhoz, egy blobhoz vagy egy blobtárolóhoz.</span><span class="sxs-lookup"><span data-stu-id="30513-207">A shared access signature token can be configured to provide specific access rights such as read, write, update, and delete to a specific table; a key range within a table; a queue; a blob; or a blob container.</span></span> <span data-ttu-id="30513-208">Az érvényesség lehet egy adott időszak, vagy akár lejárati idő nélküli is.</span><span class="sxs-lookup"><span data-stu-id="30513-208">The validity can be a specified time period or with no time limit.</span></span>

<span data-ttu-id="30513-209">Az Azure közös hozzáférésű jogosultságkódja emellett támogatja a kiszolgálón tárolt hozzáférési szabályzatokat, amelyeket összekapcsolhat egy adott erőforrással, például egy táblával vagy blobbal.</span><span class="sxs-lookup"><span data-stu-id="30513-209">Azure shared access signatures also support server-stored access policies that can be associated with a specific resource such as a table or blob.</span></span> <span data-ttu-id="30513-210">Ez a szolgáltatás további szabályozhatóságot és rugalmasságot biztosít, szemben az alkalmazás által létrehozott közös hozzáférésű jogosultságkódok jogkivonataival. Amikor csak lehetséges, javasolt a használata.</span><span class="sxs-lookup"><span data-stu-id="30513-210">This feature provides additional control and flexibility compared to application-generated shared access signature tokens, and should be used whenever possible.</span></span> <span data-ttu-id="30513-211">A kiszolgálón tárolt szabályzatokban módosíthatók a meghatározott beállítások, és a jogkivonatban megjelennek a változások anélkül, hogy új jogkivonatot kellene kibocsátani. A jogkivonatban meghatározott beállítások azonban nem módosíthatók új jogkivonat kiadása nélkül.</span><span class="sxs-lookup"><span data-stu-id="30513-211">Settings defined in a server-stored policy can be changed and are reflected in the token without requiring a new token to be issued, but settings defined in the token can't be changed without issuing a new token.</span></span> <span data-ttu-id="30513-212">Ez a módszer azt is lehetővé teszi, hogy visszavonja egy érvényes közös hozzáférésű jogosultságkód jogkivonatát még annak lejárta előtt.</span><span class="sxs-lookup"><span data-stu-id="30513-212">This approach also makes it possible to revoke a valid shared access signature token before it's expired.</span></span>

> <span data-ttu-id="30513-213">További információkat [a táblákra és üzenetsorokra vonatkozó SAS (közös hozzáférésű jogosultságkód) bemutatását és a blobokra vonatkozó SAS frissítését leíró cikkben](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) és az MSDN [közös hozzáférésű jogosultságkódok használatát ismertető cikkében](/azure/storage/common/storage-dotnet-shared-access-signature-part-1) talál.</span><span class="sxs-lookup"><span data-stu-id="30513-213">For more information see [Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/) and [Using Shared Access Signatures](/azure/storage/common/storage-dotnet-shared-access-signature-part-1) on MSDN.</span></span>

<span data-ttu-id="30513-214">Az alábbi kód bemutatja, hogyan hozhat létre egy olyan jogkivonatot egy közös hozzáférésű jogosultságkódhoz, amely öt percig érvényes.</span><span class="sxs-lookup"><span data-stu-id="30513-214">The following code shows how to create a shared access signature token that's valid for five minutes.</span></span> <span data-ttu-id="30513-215">A `GetSharedAccessReferenceForUpload` metódus a közös hozzáférésű jogosultságkód olyan jogkivonatát adja vissza, amellyel feltölthet egy fájlt az Azure Blob Storage-ba.</span><span class="sxs-lookup"><span data-stu-id="30513-215">The `GetSharedAccessReferenceForUpload` method returns a shared access signatures token that can be used to upload a file to Azure Blob Storage.</span></span>

```csharp
public class ValuesController : ApiController
{
  private readonly CloudStorageAccount account;
  private readonly string blobContainer;
  ...
  /// <summary>
  /// Return a limited access key that allows the caller to upload a file
  /// to this specific destination for a defined period of time.
  /// </summary>
  private StorageEntitySas GetSharedAccessReferenceForUpload(string blobName)
  {
    var blobClient = this.account.CreateCloudBlobClient();
    var container = blobClient.GetContainerReference(this.blobContainer);

    var blob = container.GetBlockBlobReference(blobName);

    var policy = new SharedAccessBlobPolicy
    {
      Permissions = SharedAccessBlobPermissions.Write,

      // Specify a start time five minutes earlier to allow for client clock skew.
      SharedAccessStartTime = DateTime.UtcNow.AddMinutes(-5),

      // Specify a validity period of five minutes starting from now.
      SharedAccessExpiryTime = DateTime.UtcNow.AddMinutes(5)
    };

    // Create the signature.
    var sas = blob.GetSharedAccessSignature(policy);

    return new StorageEntitySas
    {
      BlobUri = blob.Uri,
      Credentials = sas,
      Name = blobName
    };
  }

  public struct StorageEntitySas
  {
    public string Credentials;
    public Uri BlobUri;
    public string Name;
  }
}
```

> <span data-ttu-id="30513-216">A teljes minta megtalálható a ValetKey megoldásban, amelyet a [GitHubról](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key) tölthet le.</span><span class="sxs-lookup"><span data-stu-id="30513-216">The complete sample is available in the ValetKey solution available for download from [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span> <span data-ttu-id="30513-217">Az ebben a megoldásban található ValetKey.Web projekt egy olyan webalkalmazást tartalmaz, amely tartalmazza a fent említett `ValuesController` osztályt.</span><span class="sxs-lookup"><span data-stu-id="30513-217">The ValetKey.Web project in this solution contains a web application that includes the `ValuesController` class shown above.</span></span> <span data-ttu-id="30513-218">A ValetKey.Client projektben egy olyan ügyfélalkalmazásra láthat példát, amely ezzel a webalkalmazással kéri le a közös hozzáférésű jogosultságkódhoz tartozó kulcsot, és feltölt egy fájlt a blobtárolóba.</span><span class="sxs-lookup"><span data-stu-id="30513-218">A sample client application that uses this web application to retrieve a shared access signatures key and upload a file to blob storage is available in the ValetKey.Client project.</span></span>

## <a name="next-steps"></a><span data-ttu-id="30513-219">További lépések</span><span class="sxs-lookup"><span data-stu-id="30513-219">Next steps</span></span>

<span data-ttu-id="30513-220">Az alábbi minták és útmutatók szintén hasznosak lehetnek a minta megvalósításakor:</span><span class="sxs-lookup"><span data-stu-id="30513-220">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="30513-221">A [GitHubon](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key) talál egy, a minta bemutatására szolgáló példát.</span><span class="sxs-lookup"><span data-stu-id="30513-221">A sample that demonstrates this pattern is available on [GitHub](https://github.com/mspnp/cloud-design-patterns/tree/master/valet-key).</span></span>
- <span data-ttu-id="30513-222">[Forgalomirányító minta](./gatekeeper.md).</span><span class="sxs-lookup"><span data-stu-id="30513-222">[Gatekeeper pattern](./gatekeeper.md).</span></span> <span data-ttu-id="30513-223">Ez a minta a Pótkulcs mintával együtt használható fel arra, hogy az alkalmazások és szolgáltatások védelmét egy dedikált gazdapéldánnyal valósítsa meg, amely közvetítőként szolgál az ügyfelek és az alkalmazás vagy szolgáltatás között.</span><span class="sxs-lookup"><span data-stu-id="30513-223">This pattern can be used in conjunction with the Valet Key pattern to protect applications and services by using a dedicated host instance that acts as a broker between clients and the application or service.</span></span> <span data-ttu-id="30513-224">A forgalomirányító érvényesíti és vírusmentesíti a kéréseket, valamint közvetíti a kéréseket és az adatokat az ügyfél és az alkalmazás között.</span><span class="sxs-lookup"><span data-stu-id="30513-224">The gatekeeper validates and sanitizes requests, and passes requests and data between the client and the application.</span></span> <span data-ttu-id="30513-225">Ez egy további biztonsági réteget biztosíthat, és csökkenti a számítógép támadható felületét.</span><span class="sxs-lookup"><span data-stu-id="30513-225">Can provide an additional layer of security, and reduce the attack surface of the system.</span></span>
- <span data-ttu-id="30513-226">[Statikus tartalom üzemeltetési minta](./static-content-hosting.md).</span><span class="sxs-lookup"><span data-stu-id="30513-226">[Static Content Hosting pattern](./static-content-hosting.md).</span></span> <span data-ttu-id="30513-227">Leírja, hogyan kell üzembe helyezni statikus tartalmakat egy felhőalapú társzolgáltatásban, amely közvetlenül az ügyfélnek közvetíti az erőforrásokat, hogy ezzel visszaszorítsa a költséges számítási példányok szükségességét.</span><span class="sxs-lookup"><span data-stu-id="30513-227">Describes how to deploy static resources to a cloud-based storage service that can deliver these resources directly to the client to reduce the requirement for expensive compute instances.</span></span> <span data-ttu-id="30513-228">Abban az esetben, ha az erőforrásoknak nem kell nyilvánosan elérhetőnek lenniük, azokat a Pótkulcs minta segítségével védheti meg.</span><span class="sxs-lookup"><span data-stu-id="30513-228">Where the resources aren't intended to be publicly available, the Valet Key pattern can be used to secure them.</span></span>
- [<span data-ttu-id="30513-229">Táblákra és üzenetsorokra vonatkozó SAS (közös hozzáférésű jogosultságkód) bemutatása és a blobokra vonatkozó SAS frissítése</span><span class="sxs-lookup"><span data-stu-id="30513-229">Introducing Table SAS (Shared Access Signature), Queue SAS and update to Blob SAS</span></span>](https://blogs.msdn.microsoft.com/windowsazurestorage/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas/)
- [<span data-ttu-id="30513-230">Közös hozzáférésű jogosultságkódok használata</span><span class="sxs-lookup"><span data-stu-id="30513-230">Using Shared Access Signatures</span></span>](/azure/storage/common/storage-dotnet-shared-access-signature-part-1)
- [<span data-ttu-id="30513-231">Közös hozzáférésű jogosultságkódos hitelesítés Service Bus használatával</span><span class="sxs-lookup"><span data-stu-id="30513-231">Shared Access Signature Authentication with Service Bus</span></span>](/azure/service-bus-messaging/service-bus-sas)
