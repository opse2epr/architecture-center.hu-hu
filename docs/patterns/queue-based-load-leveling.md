---
title: Üzenetsor-alapú terheléskiegyenlítési minta
titleSuffix: Cloud Design Patterns
description: Használhat egy pufferként szolgáló üzenetsort egy feladat és az általa meghívott szolgáltatás között, hogy kiegyenlítse az időszakos nagy terheléseket.
keywords: tervezési minta
author: dragon119
ms.date: 01/02/2019
ms.custom: seodec18
ms.openlocfilehash: bb519fa52fcb6472733b6e52d7332d470eda8349
ms.sourcegitcommit: 680c9cef945dff6fee5e66b38e24f07804510fa9
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/04/2019
ms.locfileid: "54011548"
---
# <a name="queue-based-load-leveling-pattern"></a><span data-ttu-id="c8fa8-104">Üzenetsor-alapú terheléskiegyenlítési minta</span><span class="sxs-lookup"><span data-stu-id="c8fa8-104">Queue-Based Load Leveling pattern</span></span>

<span data-ttu-id="c8fa8-105">Használhat egy pufferként szolgáló üzenetsort egy feladat és az általa meghívott szolgáltatás között, hogy kiegyenlítse az időszakos nagy terheléseket, amelyek miatt a szolgáltatás meghiúsulhat vagy a feladaton időtúllépés történhet. Ez segít minimálisra csökkenteni a rendelkezésre állásra és a válaszképességre irányuló igényekben jelentkező csúcsok hatását mind a feladat, mind a szolgáltatás esetében.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-105">Use a queue that acts as a buffer between a task and a service it invokes in order to smooth intermittent heavy loads that can cause the service to fail or the task to time out. This can help to minimize the impact of peaks in demand on availability and responsiveness for both the task and the service.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="c8fa8-106">Kontextus és probléma</span><span class="sxs-lookup"><span data-stu-id="c8fa8-106">Context and problem</span></span>

<span data-ttu-id="c8fa8-107">A felhőben számos megoldás futtat szolgáltatásokat meghívó feladatokat.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-107">Many solutions in the cloud involve running tasks that invoke services.</span></span> <span data-ttu-id="c8fa8-108">Ebben a környezetben ha egy szolgáltatás időszakos nagy terheléseknek van kitéve, az a teljesítménnyel és a megbízhatósággal kapcsolatos problémákat okozhat.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-108">In this environment, if a service is subjected to intermittent heavy loads, it can cause performance or reliability issues.</span></span>

<span data-ttu-id="c8fa8-109">A szolgáltatások ugyanazon megoldás részei lehetnek, mint az azt használó feladatok, vagy külső szolgáltatások lehetnek, amelyek hozzáférést nyújtanak a gyakran használt erőforrásokhoz, például egy gyorsítótárhoz vagy egy társzolgáltatáshoz.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-109">A service could be part of the same solution as the tasks that use it, or it could be a third-party service providing access to frequently used resources such as a cache or a storage service.</span></span> <span data-ttu-id="c8fa8-110">Ha több egyidejűleg futó feladat ugyanazt a szolgáltatást használja, egy adott időpillanatban nehéz lehet megjósolni a szolgáltatás felé irányuló kérések mennyiségét.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-110">If the same service is used by a number of tasks running concurrently, it can be difficult to predict the volume of requests to the service at any time.</span></span>

<span data-ttu-id="c8fa8-111">A szolgáltatásban időszakonként csúcsok jelentkezhetnek az igényekben, amelyek túlterhelést okozhatnak, így a szolgáltatás nem tud időben válaszolni a kérésekre.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-111">A service might experience peaks in demand that cause it to overload and be unable to respond to requests in a timely manner.</span></span> <span data-ttu-id="c8fa8-112">A szolgáltatások számos egyidejű kéréssel való elárasztása is a szolgáltatás meghiúsulását eredményezheti, ha nem tudja kezelni a kérések okozta versenyt.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-112">Flooding a service with a large number of concurrent requests can also result in the service failing if it's unable to handle the contention these requests cause.</span></span>

## <a name="solution"></a><span data-ttu-id="c8fa8-113">Megoldás</span><span class="sxs-lookup"><span data-stu-id="c8fa8-113">Solution</span></span>

<span data-ttu-id="c8fa8-114">Bontsa újra a megoldást, és vezessen be egy üzenetsort a feladat és a szolgáltatás között.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-114">Refactor the solution and introduce a queue between the task and the service.</span></span> <span data-ttu-id="c8fa8-115">A feladatok és a szolgáltatás aszinkron módon fut.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-115">The task and the service run asynchronously.</span></span> <span data-ttu-id="c8fa8-116">A feladat közzéteszi a szolgáltatás számára szükséges adatokat tartalmazó üzenetet egy üzenetsorba.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-116">The task posts a message containing the data required by the service to a queue.</span></span> <span data-ttu-id="c8fa8-117">Az üzenetsor pufferként működik, addig tárolja az üzenetet, amíg azt a szolgáltatás le nem kéri.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-117">The queue acts as a buffer, storing the message until it's retrieved by the service.</span></span> <span data-ttu-id="c8fa8-118">A szolgáltatás lekéri az üzeneteket az üzenetsorból, és feldolgozza őket.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-118">The service retrieves the messages from the queue and processes them.</span></span> <span data-ttu-id="c8fa8-119">Egy adott üzenetsorban számos különféle feladatból származó kérés adható át a szolgáltatásnak, amelyek rendkívül változó sebességgel jöhetnek létre.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-119">Requests from a number of tasks, which can be generated at a highly variable rate, can be passed to the service through the same message queue.</span></span> <span data-ttu-id="c8fa8-120">Ez az ábra egy szolgáltatás terhelésének kiegyenlítésére szolgáló üzenetsor használatát mutatja be.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-120">This figure shows using a queue to level the load on a service.</span></span>

![1. ábra – Szolgáltatás terhelésének kiegyenlítésére szolgáló üzenetsor használata](./_images/queue-based-load-leveling-pattern.png)

<span data-ttu-id="c8fa8-122">Az üzenetsor leválasztja a feladatokat a szolgáltatásról, és a szolgáltatás a saját tempójában tudja kezelni az üzeneteket az egyidejű feladatoktól érkező kérések mennyiségétől függetlenül.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-122">The queue decouples the tasks from the service, and the service can handle the messages at its own pace regardless of the volume of requests from concurrent tasks.</span></span> <span data-ttu-id="c8fa8-123">Emellett a feladatok nem késnek, ha a szolgáltatás nem érhető el, amikor üzenetet tesznek közzé az üzenetsorba.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-123">Additionally, there's no delay to a task if the service isn't available at the time it posts a message to the queue.</span></span>

<span data-ttu-id="c8fa8-124">Ez a minta az alábbi előnyökkel jár:</span><span class="sxs-lookup"><span data-stu-id="c8fa8-124">This pattern provides the following benefits:</span></span>

- <span data-ttu-id="c8fa8-125">Maximálisra növeli a rendelkezésre állást, mert a szolgáltatásokban felmerülő késések nincsenek azonnali és közvetlen hatással az alkalmazásra, amely akkor is folytathatja az üzenetek üzenetsorba való közzétételét, amikor a szolgáltatás nem érhető el vagy épp nem dolgoz fel üzeneteket.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-125">It can help to maximize availability because delays arising in services won't have an immediate and direct impact on the application, which can continue to post messages to the queue even when the service isn't available or isn't currently processing messages.</span></span>
- <span data-ttu-id="c8fa8-126">Segít a skálázhatóság maximalizálásában, mert az üzenetsorok száma és a szolgáltatások száma is módosítható igény szerint.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-126">It can help to maximize scalability because both the number of queues and the number of services can be varied to meet demand.</span></span>
- <span data-ttu-id="c8fa8-127">A segítségével kézben tarthatók a költségek, mert az üzembe helyezett szolgáltatáspéldányok számának csak az átlagos terheléshez kell elegendőnek lennie, a csúcsterheléshez nem.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-127">It can help to control costs because the number of service instances deployed only have to be adequate to meet average load rather than the peak load.</span></span>

    >  <span data-ttu-id="c8fa8-128">Egyes szolgáltatások szabályozást alkalmaznak, amikor az igények elérnek egy olyan küszöbértéket, amelyet követően a rendszer meghibásodhat.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-128">Some services implement throttling when demand reaches a threshold beyond which the system could fail.</span></span> <span data-ttu-id="c8fa8-129">A szabályozás csökkentheti az elérhető funkciókat.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-129">Throttling can reduce the functionality available.</span></span> <span data-ttu-id="c8fa8-130">Ezekkel a szolgáltatásokkal terheléskiegyenlítést valósíthat meg annak érdekében, hogy ne érje el ezt a küszöbértéket.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-130">You can implement load leveling with these services to ensure that this threshold isn't reached.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="c8fa8-131">Problémák és megfontolandó szempontok</span><span class="sxs-lookup"><span data-stu-id="c8fa8-131">Issues and considerations</span></span>

<span data-ttu-id="c8fa8-132">A minta megvalósítása során az alábbi pontokat vegye figyelembe:</span><span class="sxs-lookup"><span data-stu-id="c8fa8-132">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="c8fa8-133">Olyan alkalmazáslogikát kell megvalósítani, amely szabályozza a szolgáltatások általi üzenetkezelés sebességét, hogy a cél erőforrás ne legyen túlterhelve.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-133">It's necessary to implement application logic that controls the rate at which services handle messages to avoid overwhelming the target resource.</span></span> <span data-ttu-id="c8fa8-134">Ne adjon át igénybevételi csúcsokat a rendszer más részeinek.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-134">Avoid passing spikes in demand to the next stage of the system.</span></span> <span data-ttu-id="c8fa8-135">Tesztelje a terhelés alatti rendszert annak ellenőrzéséhez, hogy az biztosítja-e a megfelelő terheléskiegyenlítést, és ennek megfelelően módosítsa az üzeneteket kezelő üzenetsorok és szolgáltatáspéldányok számát.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-135">Test the system under load to ensure that it provides the required leveling, and adjust the number of queues and the number of service instances that handle messages to achieve this.</span></span>
- <span data-ttu-id="c8fa8-136">Az üzenetsorok egyirányú kommunikációs mechanizmusok.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-136">Message queues are a one-way communication mechanism.</span></span> <span data-ttu-id="c8fa8-137">Ha egy feladat válaszra vár egy szolgáltatástól, előfordulhat, hogy olyan mechanizmust kell implementálni, amellyel a szolgáltatás választ tud küldeni.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-137">If a task expects a reply from a service, it might be necessary to implement a mechanism that the service can use to send a response.</span></span> <span data-ttu-id="c8fa8-138">További információkért lásd [az aszinkron üzenetkezelés ismertetését](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="c8fa8-138">For more information, see the [Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span>
- <span data-ttu-id="c8fa8-139">Legyen körültekintő, ha az üzenetsor kéréseit figyelő szolgáltatásokra automatikus skálázást alkalmaz.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-139">Be careful if you apply autoscaling to services that are listening for requests on the queue.</span></span> <span data-ttu-id="c8fa8-140">Ez megnövekedett versenyt eredményezhet az ezen szolgáltatások által megosztott erőforrásokért, és csökkenti az üzenetsor hatékonyságát a terhelés kiegyenlítése terén.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-140">This can result in increased contention for any resources that these services share and diminish the effectiveness of using the queue to level the load.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="c8fa8-141">Mikor érdemes ezt a mintát használni?</span><span class="sxs-lookup"><span data-stu-id="c8fa8-141">When to use this pattern</span></span>

<span data-ttu-id="c8fa8-142">Ez a minta olyan alkalmazásokhoz hasznos, amelyek gyakran túlterhelt szolgáltatásokat használnak.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-142">This pattern is useful to any application that uses services that are subject to overloading.</span></span>

<span data-ttu-id="c8fa8-143">Ez a minta nem használható jól, ha az alkalmazás minimális késéssel vár választ a szolgáltatástól.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-143">This pattern isn't useful if the application expects a response from the service with minimal latency.</span></span>

## <a name="example"></a><span data-ttu-id="c8fa8-144">Példa</span><span class="sxs-lookup"><span data-stu-id="c8fa8-144">Example</span></span>

<span data-ttu-id="c8fa8-145">Webes alkalmazás írja az adatokat egy külső adattárba.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-145">A web app writes data to an external data store.</span></span> <span data-ttu-id="c8fa8-146">A nagy mennyiségű példánnyal a webalkalmazás fut egyidejűleg, ha az adattár nem elég gyorsan válaszolni a kérésekre, kérelmek okoz időtúllépést, szabályozva, vagy ellenkező esetben sikertelen lehet.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-146">If a large number of instances of the web app run concurrently, the data store might be unable to respond to requests quickly enough, causing requests to time out, be throttled, or otherwise fail.</span></span> <span data-ttu-id="c8fa8-147">Az alábbi ábrán látható egy adattár példányairól nagyszámú egyidejű kéréseit alkalmazáspéldányok által.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-147">The following diagram shows a data store being overwhelmed by a large number of concurrent requests from instances of an application.</span></span>

![2. ábra – példányairól nagyszámú egyidejű kéréseit webalkalmazás példánya által szolgáltatásként](./_images/queue-based-load-leveling-overwhelmed.png)

<span data-ttu-id="c8fa8-149">A probléma megoldásához használhatja az alkalmazáspéldányok és az adattároló közötti terhelés kiegyenlítése érdekében egy üzenetsorba.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-149">To resolve this, you can use a queue to level the load between the application instances and the data store.</span></span> <span data-ttu-id="c8fa8-150">Az Azure Functions-alkalmazás beolvassa az üzeneteket az üzenetsorból, és hajtja végre az olvasási/írási kérések az adattárba.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-150">An Azure Functions app reads the messages from the queue and performs the read/write requests to the data store.</span></span> <span data-ttu-id="c8fa8-151">A függvényalkalmazás az alkalmazáslogikát szabályozhatja a sebesség, amellyel kéréseket továbbít a tárolót, a tároló legyenek kihasznált elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-151">The application logic in the function app can control the rate at which it passes requests to the data store, to prevent the store from being overwhelmed.</span></span> <span data-ttu-id="c8fa8-152">(Ellenkező esetben a függvényalkalmazás csak újra vezet be, a háttéralkalmazás ugyanez a probléma.)</span><span class="sxs-lookup"><span data-stu-id="c8fa8-152">(Otherwise the function app will just re-introduce the same problem at the back end.)</span></span>

![3. ábra – üzenetsor és a egy függvényalkalmazás használata a terhelés kiegyenlítése érdekében](./_images/queue-based-load-leveling-function.png)



## <a name="related-patterns-and-guidance"></a><span data-ttu-id="c8fa8-154">Kapcsolódó minták és útmutatók</span><span class="sxs-lookup"><span data-stu-id="c8fa8-154">Related patterns and guidance</span></span>

<span data-ttu-id="c8fa8-155">Az alábbi minták és útmutatók szintén hasznosak lehetnek a minta megvalósításakor:</span><span class="sxs-lookup"><span data-stu-id="c8fa8-155">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="c8fa8-156">[Az aszinkron üzenetkezelés ismertetése](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="c8fa8-156">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="c8fa8-157">Az üzenetsorok eredendően aszinkron típusúak.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-157">Message queues are inherently asynchronous.</span></span> <span data-ttu-id="c8fa8-158">Előfordulhat, hogy egy feladatban újra kell tervezni az alkalmazáslogikát a szolgáltatással való közvetlen kommunikációról üzenetsor használatára.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-158">It might be necessary to redesign the application logic in a task if it's adapted from communicating directly with a service to using a message queue.</span></span> <span data-ttu-id="c8fa8-159">Hasonlóképpen szükség lehet a szolgáltatások újrabontására, hogy kéréseket fogadjanak el egy üzenetsortól.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-159">Similarly, it might be necessary to refactor a service to accept requests from a message queue.</span></span> <span data-ttu-id="c8fa8-160">Másik lehetőségként meg lehet valósítani egy proxyszolgáltatást a példában bemutatott módon.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-160">Alternatively, it might be possible to implement a proxy service, as described in the example.</span></span>

- <span data-ttu-id="c8fa8-161">[Versengő felhasználókat ismertető minta](./competing-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="c8fa8-161">[Competing Consumers pattern](./competing-consumers.md).</span></span> <span data-ttu-id="c8fa8-162">Egy szolgáltatás több példánya is futtatható lehet, amelyek mindegyike üzenetfogyasztóként viselkedik a terheléskiegyenlítő üzenetsorból.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-162">It might be possible to run multiple instances of a service, each acting as a message consumer from the load-leveling queue.</span></span> <span data-ttu-id="c8fa8-163">Ezzel a módszerrel beállíthatja az üzenetek szolgáltatásból való fogadásának és a szolgáltatásba küldésének sebességét.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-163">You can use this approach to adjust the rate at which messages are received and passed to a service.</span></span>

- <span data-ttu-id="c8fa8-164">[Szabályozási minta](./throttling.md).</span><span class="sxs-lookup"><span data-stu-id="c8fa8-164">[Throttling pattern](./throttling.md).</span></span> <span data-ttu-id="c8fa8-165">A szolgáltatás általi szabályozás megvalósításának egyszerű módja az üzenetsoralapú terheléskiegyenlítés és a szolgáltatásokra érkező összes kérés átirányítása egy üzenetsorba.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-165">A simple way to implement throttling with a service is to use queue-based load leveling and route all requests to a service through a message queue.</span></span> <span data-ttu-id="c8fa8-166">A szolgáltatás olyan sebességgel dolgozza fel a kéréseket, amely biztosítja, hogy a szolgáltatás számára szükséges erőforrások ne merüljenek ki, és hogy csökkenjen az esetleges verseny mennyisége.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-166">The service can process requests at a rate that ensures that resources required by the service aren't exhausted, and to reduce the amount of contention that could occur.</span></span>

- <span data-ttu-id="c8fa8-167">[Válassza ki Azure-üzenetkezelési szolgáltatások közötti](/azure/event-grid/compare-messaging-services).</span><span class="sxs-lookup"><span data-stu-id="c8fa8-167">[Choose between Azure messaging services](/azure/event-grid/compare-messaging-services).</span></span> <span data-ttu-id="c8fa8-168">Információkat biztosít az üzenetkezelési és sorkezelési mechanizmusok kiválasztásáról Azure-alkalmazásokban.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-168">Information about choosing a messaging and queuing mechanism in Azure applications.</span></span>

- <span data-ttu-id="c8fa8-169">[Azure-webalkalmazások méretezhetőség javítása](../reference-architectures/app-service-web-app/scalable-web-app.md).</span><span class="sxs-lookup"><span data-stu-id="c8fa8-169">[Improve scalability in an Azure web application](../reference-architectures/app-service-web-app/scalable-web-app.md).</span></span> <span data-ttu-id="c8fa8-170">Ez a referenciaarchitektúra magában foglalja a üzenetsor-alapú terheléskiegyenlítési az architektúra részeként.</span><span class="sxs-lookup"><span data-stu-id="c8fa8-170">This reference architecture includes queue-based load leveling as part of the architecture.</span></span>
