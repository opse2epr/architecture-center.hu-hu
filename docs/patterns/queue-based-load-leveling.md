---
title: Queue-Based Load Leveling
description: Használhat egy pufferként szolgáló üzenetsort egy feladat és az általa meghívott szolgáltatás között, hogy kiegyenlítse az időszakos nagy terheléseket.
keywords: Kialakítási mintája
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- messaging
- availability
- performance-scalability
- resiliency
ms.openlocfilehash: 99b226511fe14bffdab3cdcf65d4e6cffe89bba6
ms.sourcegitcommit: 8ab30776e0c4cdc16ca0dcc881960e3108ad3e94
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 12/08/2017
ms.locfileid: "26359319"
---
# <a name="queue-based-load-leveling-pattern"></a><span data-ttu-id="d76c5-104">Betöltési simítás mintát várólista-alapú</span><span class="sxs-lookup"><span data-stu-id="d76c5-104">Queue-Based Load Leveling pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="d76c5-105">Egy feladatot, és meghívja a ahhoz, hogy a szolgáltatás leáll vagy a feladat időtúllépést okozó időszakos nagy terhelések sima szolgáltatás közötti pufferként a várólista használja. Ez segít az igény a rendelkezésre állási és reakcióidőt, mind a tevékenységhez, és a szolgáltatás csúcsait hatás minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="d76c5-105">Use a queue that acts as a buffer between a task and a service it invokes in order to smooth intermittent heavy loads that can cause the service to fail or the task to time out. This can help to minimize the impact of peaks in demand on availability and responsiveness for both the task and the service.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="d76c5-106">A környezetben, és probléma</span><span class="sxs-lookup"><span data-stu-id="d76c5-106">Context and problem</span></span>

<span data-ttu-id="d76c5-107">Sok megoldásokat a felhőben tartalmaz, amely éppen futó feladatok, amelyek szolgáltatások meghívni.</span><span class="sxs-lookup"><span data-stu-id="d76c5-107">Many solutions in the cloud involve running tasks that invoke services.</span></span> <span data-ttu-id="d76c5-108">Ebben a környezetben a szolgáltatás van kitéve időszakos túl nagy terhelés esetén okozhat teljesítményt és megbízhatósági hibákat.</span><span class="sxs-lookup"><span data-stu-id="d76c5-108">In this environment, if a service is subjected to intermittent heavy loads, it can cause performance or reliability issues.</span></span>

<span data-ttu-id="d76c5-109">Egy szolgáltatás, az azt használó feladatok azonos megoldás részét képező, vagy egy külső szolgáltatás elérését biztosító gyakran használt erőforrások, például a gyorsítótár vagy egy társzolgáltatás lehet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-109">A service could be part of the same solution as the tasks that use it, or it could be a third-party service providing access to frequently used resources such as a cache or a storage service.</span></span> <span data-ttu-id="d76c5-110">Ha ugyanazt a szolgáltatást használják a párhuzamosan futó feladatok száma, előre jelezni mennyiségű kérést a szolgáltatás bármikor nehézkes lehet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-110">If the same service is used by a number of tasks running concurrently, it can be difficult to predict the volume of requests to the service at any time.</span></span>

<span data-ttu-id="d76c5-111">Egy szolgáltatás esetleges időszakos csúcsidőkbe az igény szerinti azt túlterhelés, és nem válaszol a kérelmekre időben is szembesülhet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-111">A service might experience peaks in demand that cause it to overload and be unable to respond to requests in a timely manner.</span></span> <span data-ttu-id="d76c5-112">Sok egyidejű kérés szolgáltatás elárasztás is eredményezhet a szolgáltatás hiányában nem tudja kezelni a versengés miatt ezek a kérelmek esetén.</span><span class="sxs-lookup"><span data-stu-id="d76c5-112">Flooding a service with a large number of concurrent requests can also result in the service failing if it's unable to handle the contention these requests cause.</span></span>

## <a name="solution"></a><span data-ttu-id="d76c5-113">Megoldás</span><span class="sxs-lookup"><span data-stu-id="d76c5-113">Solution</span></span>

<span data-ttu-id="d76c5-114">A megoldás refactor és között a feladatok és a várólista bevezetése.</span><span class="sxs-lookup"><span data-stu-id="d76c5-114">Refactor the solution and introduce a queue between the task and the service.</span></span> <span data-ttu-id="d76c5-115">A feladatok és az aszinkron módon futnak.</span><span class="sxs-lookup"><span data-stu-id="d76c5-115">The task and the service run asynchronously.</span></span> <span data-ttu-id="d76c5-116">A feladat várólistára szolgáltatáshoz szükséges adatokat tartalmazó üzenet küldi.</span><span class="sxs-lookup"><span data-stu-id="d76c5-116">The task posts a message containing the data required by the service to a queue.</span></span> <span data-ttu-id="d76c5-117">A várólista pufferként működik egy, az üzenet tárolja, amíg a szolgáltatás lekéri azt.</span><span class="sxs-lookup"><span data-stu-id="d76c5-117">The queue acts as a buffer, storing the message until it's retrieved by the service.</span></span> <span data-ttu-id="d76c5-118">A szolgáltatás beolvassa a a várólistából, és feldolgozza azokat.</span><span class="sxs-lookup"><span data-stu-id="d76c5-118">The service retrieves the messages from the queue and processes them.</span></span> <span data-ttu-id="d76c5-119">Számos feladatot, amely magas változó jönnek létre, érkező kérelmeket is átadható a szolgáltatásnak ugyanazon üzenetsorból.</span><span class="sxs-lookup"><span data-stu-id="d76c5-119">Requests from a number of tasks, which can be generated at a highly variable rate, can be passed to the service through the same message queue.</span></span> <span data-ttu-id="d76c5-120">Az ábrán látható, hogy egy szolgáltatás terhelése szinten várólista segítségével.</span><span class="sxs-lookup"><span data-stu-id="d76c5-120">This figure shows using a queue to level the load on a service.</span></span>

![1. ábra - várólista segítségével szolgáltatás terhelése szinten](./_images/queue-based-load-leveling-pattern.png)

<span data-ttu-id="d76c5-122">A várólista leválasztja a feladatokat a szolgáltatásból, és a szolgáltatás képes kezelni a saját tempójában függetlenül mennyiségű kérést az egyidejű feladatok üzenetekben.</span><span class="sxs-lookup"><span data-stu-id="d76c5-122">The queue decouples the tasks from the service, and the service can handle the messages at its own pace regardless of the volume of requests from concurrent tasks.</span></span> <span data-ttu-id="d76c5-123">Emellett nem lesz késleltetés tevékenységhez Ha a szolgáltatás nem érhető el, egy üzenetet az üzenetsornak visszaküldés időpontjában.</span><span class="sxs-lookup"><span data-stu-id="d76c5-123">Additionally, there's no delay to a task if the service isn't available at the time it posts a message to the queue.</span></span>

<span data-ttu-id="d76c5-124">Ez a minta a következő előnyöket nyújtja:</span><span class="sxs-lookup"><span data-stu-id="d76c5-124">This pattern provides the following benefits:</span></span>

- <span data-ttu-id="d76c5-125">Segíthet rendelkezésre állásának maximalizálását, mert késleltetések felmerülő, Services nem rendelkezik az azonnali és közvetlen hatással lehet az alkalmazásról, így továbbra is küldje a várólista-üzenetek, akkor is, ha a szolgáltatás nem érhető el, vagy jelenleg nem dolgoz fel üzenetet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-125">It can help to maximize availability because delays arising in services won't have an immediate and direct impact on the application, which can continue to post messages to the queue even when the service isn't available or isn't currently processing messages.</span></span>
- <span data-ttu-id="d76c5-126">Segíthet maximalizálása a méretezhetőség, mert mind a várólisták számát és a szolgáltatások számát is eltérőek lehetnek a igény kielégítéséhez.</span><span class="sxs-lookup"><span data-stu-id="d76c5-126">It can help to maximize scalability because both the number of queues and the number of services can be varied to meet demand.</span></span>
- <span data-ttu-id="d76c5-127">Költségek szabályozása segítségével, mert a telepített service példányok száma csak kell lennie a csúcsterhelés helyett az átlagos terheléssel teljesítéséhez megfelelő.</span><span class="sxs-lookup"><span data-stu-id="d76c5-127">It can help to control costs because the number of service instances deployed only have to be adequate to meet average load rather than the peak load.</span></span>

    >  <span data-ttu-id="d76c5-128">Egyes szolgáltatások valósítja meg, amelyek sikertelen lehet, a rendszer a küszöbérték elérésekor igény szerinti szabályozás.</span><span class="sxs-lookup"><span data-stu-id="d76c5-128">Some services implement throttling when demand reaches a threshold beyond which the system could fail.</span></span> <span data-ttu-id="d76c5-129">Sávszélesség-szabályozás csökkentheti a funkció érhető el.</span><span class="sxs-lookup"><span data-stu-id="d76c5-129">Throttling can reduce the functionality available.</span></span> <span data-ttu-id="d76c5-130">Ezekkel a szolgáltatásokkal győződjön meg arról, hogy a ezt a küszöbértéket nem elérte-e simítás terhelés valósíthatja meg.</span><span class="sxs-lookup"><span data-stu-id="d76c5-130">You can implement load leveling with these services to ensure that this threshold isn't reached.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="d76c5-131">Problémákat és szempontok</span><span class="sxs-lookup"><span data-stu-id="d76c5-131">Issues and considerations</span></span>

<span data-ttu-id="d76c5-132">Ebben a mintában megvalósításához meghatározásakor, vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="d76c5-132">Consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="d76c5-133">Is végre kell hajtani az alkalmazáslogikát, amely meghatározza, mely szolgáltatások leíró üzeneteket elkerülése érdekében a célerőforrás overwhelming aránya.</span><span class="sxs-lookup"><span data-stu-id="d76c5-133">It's necessary to implement application logic that controls the rate at which services handle messages to avoid overwhelming the target resource.</span></span> <span data-ttu-id="d76c5-134">Ne igényeiben jelentkező benyújtása igény szerint a rendszer a következő szakaszára.</span><span class="sxs-lookup"><span data-stu-id="d76c5-134">Avoid passing spikes in demand to the next stage of the system.</span></span> <span data-ttu-id="d76c5-135">Tesztelje a rendszer biztosítja a szükséges simítás betöltés alatt, és módosítsa úgy a várólisták száma és a szolgáltatáspéldány, amelyek kezelik ennek érdekében üzenetek számát.</span><span class="sxs-lookup"><span data-stu-id="d76c5-135">Test the system under load to ensure that it provides the required leveling, and adjust the number of queues and the number of service instances that handle messages to achieve this.</span></span>
- <span data-ttu-id="d76c5-136">Üzenetsorok egyirányú kommunikációs mechanizmusra.</span><span class="sxs-lookup"><span data-stu-id="d76c5-136">Message queues are a one-way communication mechanism.</span></span> <span data-ttu-id="d76c5-137">Ha egy feladat válaszára a szolgáltatás vár, egy olyan mechanizmus, amellyel a szolgáltatás visszajelzés végrehajtásához szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-137">If a task expects a reply from a service, it might be necessary to implement a mechanism that the service can use to send a response.</span></span> <span data-ttu-id="d76c5-138">További információkért lásd: a [aszinkron üzenetkezelési ismertetése](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="d76c5-138">For more information, see the [Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span>
- <span data-ttu-id="d76c5-139">Ügyeljen arra, hogy ha automatikus skálázás alkalmaz a szolgáltatásokról, amelyek a figyelő a várólista-kérésekre.</span><span class="sxs-lookup"><span data-stu-id="d76c5-139">Be careful if you apply autoscaling to services that are listening for requests on the queue.</span></span> <span data-ttu-id="d76c5-140">Ez minden olyan erőforrásnál, hogy ezek a szolgáltatások megosztani, és a várólista segítségével a terhelés szinten hatékonyságát megnövekedett versengés eredményezhet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-140">This can result in increased contention for any resources that these services share and diminish the effectiveness of using the queue to level the load.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="d76c5-141">Mikor érdemes használni ezt a mintát</span><span class="sxs-lookup"><span data-stu-id="d76c5-141">When to use this pattern</span></span>

<span data-ttu-id="d76c5-142">Ebben a mintában akkor hasznos, bármely alkalmazás által használt szolgáltatások lépnek túl van terhelve.</span><span class="sxs-lookup"><span data-stu-id="d76c5-142">This pattern is useful to any application that uses services that are subject to overloading.</span></span>

<span data-ttu-id="d76c5-143">Ez a minta nem lehet hasznos, ha az alkalmazás és a minimális mértékű a szolgáltatás választ vár.</span><span class="sxs-lookup"><span data-stu-id="d76c5-143">This pattern isn't useful if the application expects a response from the service with minimal latency.</span></span>

## <a name="example"></a><span data-ttu-id="d76c5-144">Példa</span><span class="sxs-lookup"><span data-stu-id="d76c5-144">Example</span></span>

<span data-ttu-id="d76c5-145">A Microsoft Azure webes szerepkör tárolja az adatokat egy különálló tárhelyet szolgáltatással.</span><span class="sxs-lookup"><span data-stu-id="d76c5-145">A Microsoft Azure web role stores data using a separate storage service.</span></span> <span data-ttu-id="d76c5-146">A webes szerepkör példánya nagy számú egyszerre fut, akkor lehetséges, hogy a tároló szolgáltatás nem válaszol a kérelmekre elég gyorsan megakadályozhatja, hogy ezeket a kéréseket a időzítése vagy meghibásodása lesz.</span><span class="sxs-lookup"><span data-stu-id="d76c5-146">If a large number of instances of the web role run concurrently, it's possible that the storage service will be unable to respond to requests quickly enough to prevent these requests from timing out or failing.</span></span> <span data-ttu-id="d76c5-147">Ezt az értéket kiemeli folyamatban túl sok egyidejű kéréseinek webes szerepkör példánya nagy számú szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="d76c5-147">This figure highlights a service being overwhelmed by a large number of concurrent requests from instances of a web role.</span></span>

![2. ábra – folyamatban túl sok egyidejű kéréseinek webes szerepkör példánya nagy számú szolgáltatás](./_images/queue-based-load-leveling-overwhelmed.png)


<span data-ttu-id="d76c5-149">A probléma megoldásához, várólista segítségével szinten a terhelést a webes szerepkörpéldányokat és a tárolási szolgáltatás között.</span><span class="sxs-lookup"><span data-stu-id="d76c5-149">To resolve this, you can use a queue to level the load between the web role instances and the storage service.</span></span> <span data-ttu-id="d76c5-150">Azonban a társzolgáltatás szinkron kérések fogadására van tervezve, és nem lehet egyszerűen módosítani olvashatja és teljesítmény kezelését.</span><span class="sxs-lookup"><span data-stu-id="d76c5-150">However, the storage service is designed to accept synchronous requests and can't be easily modified to read messages and manage throughput.</span></span> <span data-ttu-id="d76c5-151">A feldolgozói szerepkör kéréseket fogad a várólistából, és továbbítja őket a társzolgáltatás proxy szolgáltatás ügyfélgépként is vezethet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-151">You can introduce a worker role to act as a proxy service that receives requests from the queue and forwards them to the storage service.</span></span> <span data-ttu-id="d76c5-152">Az alkalmazás logikája a feldolgozói szerepkör szabályozhatják a sebesség, amellyel kérelmeket továbbítja a társzolgáltatás, hogy megakadályozza a társzolgáltatás nem egyszerre.</span><span class="sxs-lookup"><span data-stu-id="d76c5-152">The application logic in the worker role can control the rate at which it passes requests to the storage service to prevent the storage service from being overwhelmed.</span></span> <span data-ttu-id="d76c5-153">Az ábra azt mutatja be, várólistát és a feldolgozói szerepkör segítségével szinten a terhelést a webes szerepkör példánya és a szolgáltatás között.</span><span class="sxs-lookup"><span data-stu-id="d76c5-153">This figure illustrates using a queue and a worker role to level the load between instances of the web role and the service.</span></span>

![3. ábra - várólista és a feldolgozói szerepkör segítségével szinten a terhelést a webes szerepkör példánya és a szolgáltatás között](./_images/queue-based-load-leveling-worker-role.png)

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="d76c5-155">Útmutató és a kapcsolódó minták</span><span class="sxs-lookup"><span data-stu-id="d76c5-155">Related patterns and guidance</span></span>

<span data-ttu-id="d76c5-156">A következő mintákat és útmutatókat is lehet releváns ebben a mintában végrehajtása során:</span><span class="sxs-lookup"><span data-stu-id="d76c5-156">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="d76c5-157">[Aszinkron üzenetkezelési ismertetése](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="d76c5-157">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="d76c5-158">Üzenet-várólistákból eredendően aszinkron.</span><span class="sxs-lookup"><span data-stu-id="d76c5-158">Message queues are inherently asynchronous.</span></span> <span data-ttu-id="d76c5-159">Az alkalmazás logikája feladat átírása, ha közvetlenül kommunikálni a szolgáltatás számára egy üzenet-várólista használata alkalmazkodik szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="d76c5-159">It might be necessary to redesign the application logic in a task if it's adapted from communicating directly with a service to using a message queue.</span></span> <span data-ttu-id="d76c5-160">Hasonlóképpen szükség lehet a refactor egy szolgáltatást, hogy az üzenet-várólista kéréseket fogad.</span><span class="sxs-lookup"><span data-stu-id="d76c5-160">Similarly, it might be necessary to refactor a service to accept requests from a message queue.</span></span> <span data-ttu-id="d76c5-161">Másik lehetőségként lehet valósíthat meg a proxy szolgáltatás, a példában bemutatott módon.</span><span class="sxs-lookup"><span data-stu-id="d76c5-161">Alternatively, it might be possible to implement a proxy service, as described in the example.</span></span>
- <span data-ttu-id="d76c5-162">[Versengő fogyasztók mintát](competing-consumers.md).</span><span class="sxs-lookup"><span data-stu-id="d76c5-162">[Competing Consumers pattern](competing-consumers.md).</span></span> <span data-ttu-id="d76c5-163">Esetleg a szolgáltatás, minden egyes nevében jár el a terhelés simítás várólistából üzenetfogyasztó több példányát futtatni.</span><span class="sxs-lookup"><span data-stu-id="d76c5-163">It might be possible to run multiple instances of a service, each acting as a message consumer from the load-leveling queue.</span></span> <span data-ttu-id="d76c5-164">Ez a módszer segítségével a sebességének, ahol az üzenetek fogadott és átadhat.</span><span class="sxs-lookup"><span data-stu-id="d76c5-164">You can use this approach to adjust the rate at which messages are received and passed to a service.</span></span>
- <span data-ttu-id="d76c5-165">[Sávszélesség-szabályozási mintát](throttling.md).</span><span class="sxs-lookup"><span data-stu-id="d76c5-165">[Throttling pattern](throttling.md).</span></span> <span data-ttu-id="d76c5-166">Egy olyan szabályozás megvalósításához legegyszerűbb várólista alapú terhelés simítás és összes kérelem átirányítása egy szolgáltatást, egy üzenet-várólista keresztül.</span><span class="sxs-lookup"><span data-stu-id="d76c5-166">A simple way to implement throttling with a service is to use queue-based load leveling and route all requests to a service through a message queue.</span></span> <span data-ttu-id="d76c5-167">A szolgáltatás, amely biztosítja, hogy a szolgáltatás működéséhez szükséges erőforrások nem nagyon gyorsan kimerítették sebességgel, és kevesebb a versengés, amely akkor fordulhat kérelmek feldolgozásának.</span><span class="sxs-lookup"><span data-stu-id="d76c5-167">The service can process requests at a rate that ensures that resources required by the service aren't exhausted, and to reduce the amount of contention that could occur.</span></span>
- <span data-ttu-id="d76c5-168">[Feldolgozási sor szolgáltatással kapcsolatos fogalmak](https://msdn.microsoft.com/library/azure/dd179353.aspx).</span><span class="sxs-lookup"><span data-stu-id="d76c5-168">[Queue Service Concepts](https://msdn.microsoft.com/library/azure/dd179353.aspx).</span></span> <span data-ttu-id="d76c5-169">Az Azure-alkalmazások egy üzenetkezelési és üzenetsor-kezelési mechanizmust kiválasztására vonatkozó adatokat.</span><span class="sxs-lookup"><span data-stu-id="d76c5-169">Information about choosing a messaging and queuing mechanism in Azure applications.</span></span>
