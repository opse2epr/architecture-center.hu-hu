---
title: "Tranzakció Compensating"
description: "Több lépésből áll, amelyek együtt határozza meg, hogy idővel konzisztenssé művelet által végzett munka visszavonása."
keywords: "Kialakítási mintája"
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories: resiliency
ms.openlocfilehash: f8337717c4afd6b558f0da8e1ded3a8071340db7
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: hu-HU
ms.lasthandoff: 11/14/2017
---
# <a name="compensating-transaction-pattern"></a><span data-ttu-id="77cdd-104">Tranzakció mintát Compensating</span><span class="sxs-lookup"><span data-stu-id="77cdd-104">Compensating Transaction pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="77cdd-105">A lépésekre, és mindezek együtt meghatározzák az idővel konzisztenssé művelet, ha egy vagy több lépést meghibásodik sorozata által végzett munka visszavonása.</span><span class="sxs-lookup"><span data-stu-id="77cdd-105">Undo the work performed by a series of steps, which together define an eventually consistent operation, if one or more of the steps fail.</span></span> <span data-ttu-id="77cdd-106">A végleges konzisztencia modell az alábbi műveletek általában felhőben üzemeltetett alkalmazások, amelyek megvalósítják az összetett üzleti folyamatokat és munkafolyamatok találhatók.</span><span class="sxs-lookup"><span data-stu-id="77cdd-106">Operations that follow the eventual consistency model are commonly found in cloud-hosted applications that implement complex business processes and workflows.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="77cdd-107">A környezetben, és probléma</span><span class="sxs-lookup"><span data-stu-id="77cdd-107">Context and problem</span></span>

<span data-ttu-id="77cdd-108">Gyakran a felhőben futó alkalmazások módosíthatják az adatokat.</span><span class="sxs-lookup"><span data-stu-id="77cdd-108">Applications running in the cloud frequently modify data.</span></span> <span data-ttu-id="77cdd-109">Ezeket az adatokat a előfordulhat, hogy különböző földrajzi helyen lévő különböző adatforrások között ossza szét.</span><span class="sxs-lookup"><span data-stu-id="77cdd-109">This data might be spread across various data sources held in different geographic locations.</span></span> <span data-ttu-id="77cdd-110">Versengés elkerülése érdekében, és javíthatja a teljesítményt elosztott környezetben, egy alkalmazás nem próbálja meg az erős tranzakciós konzisztencia biztosításához.</span><span class="sxs-lookup"><span data-stu-id="77cdd-110">To avoid contention and improve performance in a distributed environment, an application shouldn't try to provide strong transactional consistency.</span></span> <span data-ttu-id="77cdd-111">Ehelyett az alkalmazás meg kell valósítania végleges konzisztencia.</span><span class="sxs-lookup"><span data-stu-id="77cdd-111">Rather, the application should implement eventual consistency.</span></span> <span data-ttu-id="77cdd-112">Ebben a modellben egy tipikus munkaidejét művelet külön lépések egy sorozatát áll.</span><span class="sxs-lookup"><span data-stu-id="77cdd-112">In this model, a typical business operation consists of a series of separate steps.</span></span> <span data-ttu-id="77cdd-113">A lépések végrehajtása közben a rendszer szerinti átfogó képet inkonzisztens lehet, de a művelet befejeződött, és az összes lépést végre a rendszer kell válnia konzisztens újra.</span><span class="sxs-lookup"><span data-stu-id="77cdd-113">While these steps are being performed, the overall view of the system state might be inconsistent, but when the operation has completed and all of the steps have been executed the system should become consistent again.</span></span>

> <span data-ttu-id="77cdd-114">A [adatok konzisztencia ismertetése](https://msdn.microsoft.com/library/dn589800.aspx) információkat nyújt azokról az elosztott tranzakciók miért nem méretezhető well, és a végleges konzisztencia modell ezeket az alapelveket.</span><span class="sxs-lookup"><span data-stu-id="77cdd-114">The [Data Consistency Primer](https://msdn.microsoft.com/library/dn589800.aspx) provides information about why distributed transactions don't scale well, and the principles of the eventual consistency model.</span></span>

<span data-ttu-id="77cdd-115">A végleges konzisztencia modell kihívást, hogyan kezeli a lépést, amely nem sikerült.</span><span class="sxs-lookup"><span data-stu-id="77cdd-115">A challenge in the eventual consistency model is how to handle a step that has failed.</span></span> <span data-ttu-id="77cdd-116">Ebben az esetben szükség lehet visszavonja az összes a munkát az előző lépésekben a művelet befejeződött.</span><span class="sxs-lookup"><span data-stu-id="77cdd-116">In this case it might be necessary to undo all of the work completed by the previous steps in the operation.</span></span> <span data-ttu-id="77cdd-117">Azonban az adatok nem egyszerűen állítható vissza, mert az alkalmazás más egyidejű példányok módosulhatott azt.</span><span class="sxs-lookup"><span data-stu-id="77cdd-117">However, the data can't simply be rolled back because other concurrent instances of the application might have changed it.</span></span> <span data-ttu-id="77cdd-118">Olyan esetekben, ahol az adatok még nem lett módosítva, egyidejű példánya, még akkor is, egy lépés visszavonása nem egyszerűen lehet kell az eredeti állapot-visszaállítást.</span><span class="sxs-lookup"><span data-stu-id="77cdd-118">Even in cases where the data hasn't been changed by a concurrent instance, undoing a step might not simply be a matter of restoring the original state.</span></span> <span data-ttu-id="77cdd-119">Különböző üzleti vonatkozó szabályok alkalmazásához szükséges lehet (lásd a példa részben leírt utazás webhely).</span><span class="sxs-lookup"><span data-stu-id="77cdd-119">It might be necessary to apply various business-specific rules (see the travel website described in the Example section).</span></span>

<span data-ttu-id="77cdd-120">Egy művelet, amely megvalósítja a végleges konzisztencia több heterogén adattárolókhoz is, ha visszavonása a művelet lépéseit szükséges minden egyes adattár pedig látogató.</span><span class="sxs-lookup"><span data-stu-id="77cdd-120">If an operation that implements eventual consistency spans several heterogeneous data stores, undoing the steps in the operation will require visiting each data store in turn.</span></span> <span data-ttu-id="77cdd-121">Minden-tárolóban végzett munka kell vonható megbízhatóan, hogy a rendszer megakadályozza az fennmaradó inkonzisztens.</span><span class="sxs-lookup"><span data-stu-id="77cdd-121">The work performed in every data store must be undone reliably to prevent the system from remaining inconsistent.</span></span>

<span data-ttu-id="77cdd-122">Nem minden adat, amely megvalósítja a végleges konzisztencia művelet hatással lehet, hogy tárolható egy adatbázis.</span><span class="sxs-lookup"><span data-stu-id="77cdd-122">Not all data affected by an operation that implements eventual consistency might be held in a database.</span></span> <span data-ttu-id="77cdd-123">Szolgáltatás objektumorientált architektúra (SOA) környezetben egy művelet sikerült el művelet egy szolgáltatás, és a szolgáltatás által tárolt állapota megváltozhat.</span><span class="sxs-lookup"><span data-stu-id="77cdd-123">In a service oriented architecture (SOA) environment an operation could invoke an action in a service, and cause a change in the state held by that service.</span></span> <span data-ttu-id="77cdd-124">A művelet visszavonja, az állapotváltozás kell is vonható vissza.</span><span class="sxs-lookup"><span data-stu-id="77cdd-124">To undo the operation, this state change must also be undone.</span></span> <span data-ttu-id="77cdd-125">Ez a szolgáltatás újra meghívása és egy másik művelet, amely az első eredő megfordítja végrehajtása magába foglaló.</span><span class="sxs-lookup"><span data-stu-id="77cdd-125">This can involve invoking the service again and performing another action that reverses the effects of the first.</span></span>

## <a name="solution"></a><span data-ttu-id="77cdd-126">Megoldás</span><span class="sxs-lookup"><span data-stu-id="77cdd-126">Solution</span></span>

<span data-ttu-id="77cdd-127">A megoldás, hogy a kompenzációs tranzakció alkalmazza.</span><span class="sxs-lookup"><span data-stu-id="77cdd-127">The solution is to implement a compensating transaction.</span></span> <span data-ttu-id="77cdd-128">A lépéseket egy kompenzációs tranzakcióban vissza kell vonnia az eredeti művelet lépéseit hatásait.</span><span class="sxs-lookup"><span data-stu-id="77cdd-128">The steps in a compensating transaction must undo the effects of the steps in the original operation.</span></span> <span data-ttu-id="77cdd-129">Előfordulhat, hogy a kompenzációs tranzakció nem egyszerűen az állapot, a rendszer nem a elején. a művelet, mert ez a megközelítés végrehajtott változtatások felülírhatják a jelenlegi állapotában más egyidejű alkalmazáspéldányra cserélje.</span><span class="sxs-lookup"><span data-stu-id="77cdd-129">A compensating transaction might not be able to simply replace the current state with the state the system was in at the start of the operation because this approach could overwrite changes made by other concurrent instances of an application.</span></span> <span data-ttu-id="77cdd-130">Ehelyett egy intelligens folyamat, amely az egyidejű példányok által végzett munka figyelembe veszi kell lennie.</span><span class="sxs-lookup"><span data-stu-id="77cdd-130">Instead, it must be an intelligent process that takes into account any work done by concurrent instances.</span></span> <span data-ttu-id="77cdd-131">Ez a folyamat általában lesz adott, alkalmazás, az eredeti művelet által végzett munka jellege által vezérelt.</span><span class="sxs-lookup"><span data-stu-id="77cdd-131">This process will usually be application specific, driven by the nature of the work performed by the original operation.</span></span>

<span data-ttu-id="77cdd-132">Általános gyakorlatként javasolt, hogy a munkafolyamat használja compensation igénylő idővel konzisztenssé művelet végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="77cdd-132">A common approach is to use a workflow to implement an eventually consistent operation that requires compensation.</span></span> <span data-ttu-id="77cdd-133">Az eredeti műveletet halad, akkor a rendszer minden lépés, és hogyan lehet visszavonni a lépés által végzett munka kapcsolatos adatokat rögzíti.</span><span class="sxs-lookup"><span data-stu-id="77cdd-133">As the original operation proceeds, the system records information about each step and how the work performed by that step can be undone.</span></span> <span data-ttu-id="77cdd-134">A művelet sikertelen lesz, bármikor, ha a munkafolyamat gyors visszatekerés vissza végig a lépéseken, befejeződött, és a munkát, amely visszavonja az egyes lépéseket hajtja végre.</span><span class="sxs-lookup"><span data-stu-id="77cdd-134">If the operation fails at any point, the workflow rewinds back through the steps it's completed and performs the work that reverses each step.</span></span> <span data-ttu-id="77cdd-135">Ne feledje, hogy kompenzációs tranzakció előfordulhat, hogy nem vonható vissza a munkát az eredeti műveletet pontos fordított sorrendben, és lehetséges, párhuzamos egyes visszavonási lépések végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="77cdd-135">Note that a compensating transaction might not have to undo the work in the exact reverse order of the original operation, and it might be possible to perform some of the undo steps in parallel.</span></span>

> <span data-ttu-id="77cdd-136">Ez a megközelítés hasonlít a tárgyalt Sagas stratégia [Clemens Vasters blog](http://vasters.com/clemensv/2012/09/01/Sagas.aspx).</span><span class="sxs-lookup"><span data-stu-id="77cdd-136">This approach is similar to the Sagas strategy discussed in [Clemens Vasters’ blog](http://vasters.com/clemensv/2012/09/01/Sagas.aspx).</span></span>

<span data-ttu-id="77cdd-137">A kompenzációs tranzakció során is idővel konzisztenssé és is meghiúsulhat.</span><span class="sxs-lookup"><span data-stu-id="77cdd-137">A compensating transaction is also an eventually consistent operation and it could also fail.</span></span> <span data-ttu-id="77cdd-138">A rendszer kell tudni folytatni a kompenzációs tranzakció helyén sikertelen, és továbbra is.</span><span class="sxs-lookup"><span data-stu-id="77cdd-138">The system should be able to resume the compensating transaction at the point of failure and continue.</span></span> <span data-ttu-id="77cdd-139">A lépést, amely nem sikerült, ismétlődő kompenzációs tranzakcióban lépéseket definiálni kell az idempotent parancsként, szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="77cdd-139">It might be necessary to repeat a step that's failed, so the steps in a compensating transaction should be defined as idempotent commands.</span></span> <span data-ttu-id="77cdd-140">További információkért lásd: [idempotencia minták](http://blog.jonathanoliver.com/2010/04/idempotency-patterns/) Jonathan Oliver blogjában.</span><span class="sxs-lookup"><span data-stu-id="77cdd-140">For more information, see [Idempotency Patterns](http://blog.jonathanoliver.com/2010/04/idempotency-patterns/) on Jonathan Oliver’s blog.</span></span>

<span data-ttu-id="77cdd-141">Bizonyos esetekben nem esetleg helyreállítása a lépést, amely manuális beavatkozásra keresztül kivételével nem sikerült.</span><span class="sxs-lookup"><span data-stu-id="77cdd-141">In some cases it might not be possible to recover from a step that has failed except through manual intervention.</span></span> <span data-ttu-id="77cdd-142">Ilyen helyzetekben a rendszer kell hoz létre riasztást, és adja meg a hiba okát a lehető legtöbb információ.</span><span class="sxs-lookup"><span data-stu-id="77cdd-142">In these situations the system should raise an alert and provide as much information as possible about the reason for the failure.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="77cdd-143">Problémákat és szempontok</span><span class="sxs-lookup"><span data-stu-id="77cdd-143">Issues and considerations</span></span>

<span data-ttu-id="77cdd-144">Ebben a mintában megvalósításához meghatározásakor, vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="77cdd-144">Consider the following points when deciding how to implement this pattern:</span></span>

<span data-ttu-id="77cdd-145">Nem lehet könnyen határozható meg, hogy egy lépést, amely megvalósítja a végleges konzisztencia művelet sikertelen volt.</span><span class="sxs-lookup"><span data-stu-id="77cdd-145">It might not be easy to determine when a step in an operation that implements eventual consistency has failed.</span></span> <span data-ttu-id="77cdd-146">A lépés nem meghiúsulhat azonnal, de ehelyett letiltása sikerült.</span><span class="sxs-lookup"><span data-stu-id="77cdd-146">A step might not fail immediately, but instead could block.</span></span> <span data-ttu-id="77cdd-147">Időtúllépési mechanizmus valamilyen végrehajtásához szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="77cdd-147">It might be necessary to implement some form of time-out mechanism.</span></span>

<span data-ttu-id="77cdd-148">-A compensation logika könnyen nincs általánosítva.</span><span class="sxs-lookup"><span data-stu-id="77cdd-148">-Compensation logic isn't easily generalized.</span></span> <span data-ttu-id="77cdd-149">Egy kompenzációs tranzakció az adott alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="77cdd-149">A compensating transaction is application specific.</span></span> <span data-ttu-id="77cdd-150">Az alkalmazás, elegendő adatnak lehet visszavonni a sikertelen művelettel lévő egyes lépések hatásait támaszkodik.</span><span class="sxs-lookup"><span data-stu-id="77cdd-150">It relies on the application having sufficient information to be able to undo the effects of each step in a failed operation.</span></span>

<span data-ttu-id="77cdd-151">Az idempotent parancsként kompenzációs tranzakción belül meg kell határozni a lépéseket.</span><span class="sxs-lookup"><span data-stu-id="77cdd-151">You should define the steps in a compensating transaction as idempotent commands.</span></span> <span data-ttu-id="77cdd-152">Ez lehetővé teszi a lépéseket kell ismételni, ha a kompenzációs tranzakció maga sikertelen.</span><span class="sxs-lookup"><span data-stu-id="77cdd-152">This enables the steps to be repeated if the compensating transaction itself fails.</span></span>

<span data-ttu-id="77cdd-153">Az infrastruktúra, amely kezeli a lépéseket az eredeti műveletet, és a kompenzációs tranzakció rugalmas kell lennie.</span><span class="sxs-lookup"><span data-stu-id="77cdd-153">The infrastructure that handles the steps in the original operation, and the compensating transaction, must be resilient.</span></span> <span data-ttu-id="77cdd-154">Kell veszítse el egy hibás lépés szükséges információkat, és megbízhatóan nyomon a kompenzáció logika képesnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="77cdd-154">It must not lose the information required to compensate for a failing step, and it must be able to reliably monitor the progress of the compensation logic.</span></span>

<span data-ttu-id="77cdd-155">A kompenzációs tranzakció nem feltétlenül vissza az adatokat a rendszer, mint az eredeti műveletet elején.</span><span class="sxs-lookup"><span data-stu-id="77cdd-155">A compensating transaction doesn't necessarily return the data in the system to the state it was in at the start of the original operation.</span></span> <span data-ttu-id="77cdd-156">Ehelyett azt kiegyenlíti a lépéseket, amelyek sikeresen befejeződött, mielőtt a művelet nem sikerült által végzett munka.</span><span class="sxs-lookup"><span data-stu-id="77cdd-156">Instead, it compensates for the work performed by the steps that completed successfully before the operation failed.</span></span>

<span data-ttu-id="77cdd-157">A lépéseket a kompenzációs tranzakcióban sorrendje nem feltétlenül pontos ellenkező az eredeti művelet lépéseit.</span><span class="sxs-lookup"><span data-stu-id="77cdd-157">The order of the steps in the compensating transaction doesn't necessarily have to be the exact opposite of the steps in the original operation.</span></span> <span data-ttu-id="77cdd-158">Például lehet, hogy egy adattár érzékenyebb a inkonzisztenciákat, mint a többi, és így a kompenzációs tranzakció a lépéseket, visszavonja a módosításokat az tárolóba jöjjön létre először.</span><span class="sxs-lookup"><span data-stu-id="77cdd-158">For example, one data store might be more sensitive to inconsistencies than another, and so the steps in the compensating transaction that undo the changes to this store should occur first.</span></span>

<span data-ttu-id="77cdd-159">A rövid távú időkorlát-alapú zárolási helyezi az egyes erőforrások, amely egy művelet befejezéséhez szükséges, és előre lehet beszerezni ezeket az erőforrásokat segítségével érdekében, hogy az általános tevékenység sikeres lesz.</span><span class="sxs-lookup"><span data-stu-id="77cdd-159">Placing a short-term timeout-based lock on each resource that's required to complete an operation, and obtaining these resources in advance, can help increase the likelihood that the overall activity will succeed.</span></span> <span data-ttu-id="77cdd-160">A munkahelyi csak azt követően minden erőforrás beszerzett kell végrehajtani.</span><span class="sxs-lookup"><span data-stu-id="77cdd-160">The work should be performed only after all the resources have been acquired.</span></span> <span data-ttu-id="77cdd-161">Minden művelet kell, mielőtt kivonatértékeket kér a zárolásokat lejár.</span><span class="sxs-lookup"><span data-stu-id="77cdd-161">All actions must be finalized before the locks expire.</span></span>

<span data-ttu-id="77cdd-162">Érdemes lehet újrapróbálkozási logika, amely további forgiving kompenzációs tranzakció kiváltó hibák minimalizálása érdekében a szokásosnál.</span><span class="sxs-lookup"><span data-stu-id="77cdd-162">Consider using retry logic that is more forgiving than usual to minimize failures that trigger a compensating transaction.</span></span> <span data-ttu-id="77cdd-163">Ha egy lépés, amely megvalósítja a végleges konzisztencia művelet sikertelen, próbálja meg a hiba átmeneti kivételként kezeli, és ismételje meg a.</span><span class="sxs-lookup"><span data-stu-id="77cdd-163">If a step in an operation that implements eventual consistency fails, try handling the failure as a transient exception and repeat the step.</span></span> <span data-ttu-id="77cdd-164">Csak a leállításához, és kompenzációs tranzakció kezdeményezése, ha a lépés sikertelen, ismételten vagy visszavonhatatlanul.</span><span class="sxs-lookup"><span data-stu-id="77cdd-164">Only stop the operation and initiate a compensating transaction if a step fails repeatedly or irrecoverably.</span></span>

> <span data-ttu-id="77cdd-165">Végrehajtási kompenzációs tranzakció kihívásai számos ugyanazok, mint a végleges konzisztencia megvalósítása.</span><span class="sxs-lookup"><span data-stu-id="77cdd-165">Many of the challenges of implementing a compensating transaction are the same as those with implementing eventual consistency.</span></span> <span data-ttu-id="77cdd-166">Lásd: a végleges konzisztencia végrehajtási szakasz szempontjai a [adatok konzisztencia ismertetése](https://msdn.microsoft.com/library/dn589800.aspx) további információt.</span><span class="sxs-lookup"><span data-stu-id="77cdd-166">See the section Considerations for Implementing Eventual Consistency in the [Data Consistency Primer](https://msdn.microsoft.com/library/dn589800.aspx) for more information.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="77cdd-167">Mikor érdemes használni ezt a mintát</span><span class="sxs-lookup"><span data-stu-id="77cdd-167">When to use this pattern</span></span>

<span data-ttu-id="77cdd-168">Ez a minta csak visszavont kell lennie, ha azt elmulasztják műveletek használják.</span><span class="sxs-lookup"><span data-stu-id="77cdd-168">Use this pattern only for operations that must be undone if they fail.</span></span> <span data-ttu-id="77cdd-169">Ha lehetséges tervezze meg megoldásokat igénylő tranzakciók compensating összetettsége elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="77cdd-169">If possible, design solutions to avoid the complexity of requiring compensating transactions.</span></span>

## <a name="example"></a><span data-ttu-id="77cdd-170">Példa</span><span class="sxs-lookup"><span data-stu-id="77cdd-170">Example</span></span>

<span data-ttu-id="77cdd-171">Utazás webhely lehetővé teszi, hogy az ügyfelek könyv útvonalak.</span><span class="sxs-lookup"><span data-stu-id="77cdd-171">A travel website lets customers book itineraries.</span></span> <span data-ttu-id="77cdd-172">Egyetlen útvonal járatok és szállodák előfordulhat, hogy alkotják.</span><span class="sxs-lookup"><span data-stu-id="77cdd-172">A single itinerary might comprise a series of flights and hotels.</span></span> <span data-ttu-id="77cdd-173">Az ügyfél határozzon London utazik és Párizsi be tudta végezze el az alábbi lépéseket egy útvonal létrehozásakor:</span><span class="sxs-lookup"><span data-stu-id="77cdd-173">A customer traveling from Seattle to London and then on to Paris could perform the following steps when creating an itinerary:</span></span>

1. <span data-ttu-id="77cdd-174">Megjelenik egy ülések repülési F1 határozzon London.</span><span class="sxs-lookup"><span data-stu-id="77cdd-174">Book a seat on flight F1 from Seattle to London.</span></span>
2. <span data-ttu-id="77cdd-175">A felhőszolgáltató közötti átviteléhez F2 London Párizsba helyet könyv.</span><span class="sxs-lookup"><span data-stu-id="77cdd-175">Book a seat on flight F2 from London to Paris.</span></span>
3. <span data-ttu-id="77cdd-176">A felhőszolgáltató közötti átviteléhez F3 Párizsi Budapest helyet könyv.</span><span class="sxs-lookup"><span data-stu-id="77cdd-176">Book a seat on flight F3 from Paris to Seattle.</span></span>
4. <span data-ttu-id="77cdd-177">Foglaljon le egy helyet, a szállodák H1 Londonban.</span><span class="sxs-lookup"><span data-stu-id="77cdd-177">Reserve a room at hotel H1 in London.</span></span>
5. <span data-ttu-id="77cdd-178">Egy hely a szállodák H2 megadva lefoglalni.</span><span class="sxs-lookup"><span data-stu-id="77cdd-178">Reserve a room at hotel H2 in Paris.</span></span>

<span data-ttu-id="77cdd-179">Ezeket a lépéseket egy idővel konzisztenssé műveletet jelent, bár minden egyes lépést külön műveletként.</span><span class="sxs-lookup"><span data-stu-id="77cdd-179">These steps constitute an eventually consistent operation, although each step is a separate action.</span></span> <span data-ttu-id="77cdd-180">Ezért is teljesítő ezeket a lépéseket, a rendszer kell is rögzítse szükségessé minden lépés abban az esetben, ha az ügyfél úgy dönt, hogy az útvonal szakítsa meg a számláló műveletek.</span><span class="sxs-lookup"><span data-stu-id="77cdd-180">Therefore, as well as performing these steps, the system must also record the counter operations necessary to undo each step in case the customer decides to cancel the itinerary.</span></span> <span data-ttu-id="77cdd-181">A számláló műveletek elvégzéséhez szükséges lépések követően futtathatja kompenzációs tranzakcióként.</span><span class="sxs-lookup"><span data-stu-id="77cdd-181">The steps necessary to perform the counter operations can then run as a compensating transaction.</span></span>

<span data-ttu-id="77cdd-182">Figyelje meg, hogy a kompenzációs tranzakció lépéseit nem lehet az eredeti lépéseket pontos ellentéte, és minden lépés kompenzációs tranzakcióban lévő logika figyelembe kell vennie üzleti vonatkozó szabályokat.</span><span class="sxs-lookup"><span data-stu-id="77cdd-182">Notice that the steps in the compensating transaction might not be the exact opposite of the original steps, and the logic in each step in the compensating transaction must take into account any business-specific rules.</span></span> <span data-ttu-id="77cdd-183">Például egy repülési hellyel unbooking előfordulhat, hogy nem jogosíthatók az ügyfél a fizetős pénzt teljes visszatérítése.</span><span class="sxs-lookup"><span data-stu-id="77cdd-183">For example, unbooking a seat on a flight might not entitle the customer to a complete refund of any money paid.</span></span> <span data-ttu-id="77cdd-184">Az ábra azt mutatja be, le egy utazás útvonal hosszú ideig futó tranzakció visszavonása kompenzációs tranzakció létrehozásakor.</span><span class="sxs-lookup"><span data-stu-id="77cdd-184">The figure illustrates generating a compensating transaction to undo a long-running transaction to book a travel itinerary.</span></span>

![Egy hosszú ideig futó tranzakció le egy utazás útvonal visszavonása kompenzációs tranzakció létrehozása](./_images/compensating-transaction-diagram.png)


> <span data-ttu-id="77cdd-186">Esetleg a kompenzációs tranzakcióban párhuzamosan, attól függően, hogy az egyes lépéseihez szükséges kompenzációs logikai tervezésétől már végrehajtandó lépéseit.</span><span class="sxs-lookup"><span data-stu-id="77cdd-186">It might be possible for the steps in the compensating transaction to be performed in parallel, depending on how you've designed the compensating logic for each step.</span></span>

<span data-ttu-id="77cdd-187">A számos üzleti megoldások sikertelen volt-e egyetlen lépésben nem mindig szükségessé teszik a működés közbeni a rendszer egy kompenzációs tranzakció használatával ismét.</span><span class="sxs-lookup"><span data-stu-id="77cdd-187">In many business solutions, failure of a single step doesn't always necessitate rolling the system back by using a compensating transaction.</span></span> <span data-ttu-id="77cdd-188">Például ha&mdash;után rendelkező lefoglalt járatok F1 F2 és F3 utazás webhely forgatókönyvben&mdash;az ügyfél nem tudja lefoglalni a helyiségben: Szálloda H1, érdemes biztosítani az ügyfél egy másik Szálloda ugyanabban a városban, egy hely helyett a járatokat megszakítása.</span><span class="sxs-lookup"><span data-stu-id="77cdd-188">For example, if&mdash;after having booked flights F1, F2, and F3 in the travel website scenario&mdash;the customer is unable to reserve a room at hotel H1, it's preferable to offer the customer a room at a different hotel in the same city rather than canceling the flights.</span></span> <span data-ttu-id="77cdd-189">Az ügyfél továbbra is dönt, hogy megszakítja a (ebben az esetben az kompenzációs tranzakció fut, és visszavonja a járatok F1 F2 és F3 történt helyfoglalás), de ez a döntés kell tenni, az ügyfél által, nem pedig a rendszer.</span><span class="sxs-lookup"><span data-stu-id="77cdd-189">The customer can still decide to cancel (in which case the compensating transaction runs and undoes the bookings made on flights F1, F2, and F3), but this decision should be made by the customer rather than by the system.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="77cdd-190">Útmutató és a kapcsolódó minták</span><span class="sxs-lookup"><span data-stu-id="77cdd-190">Related patterns and guidance</span></span>

<span data-ttu-id="77cdd-191">A következő mintákat és útmutatókat is lehet releváns ebben a mintában végrehajtása során:</span><span class="sxs-lookup"><span data-stu-id="77cdd-191">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="77cdd-192">[Adatok konzisztencia ismertetése](https://msdn.microsoft.com/library/dn589800.aspx).</span><span class="sxs-lookup"><span data-stu-id="77cdd-192">[Data Consistency Primer](https://msdn.microsoft.com/library/dn589800.aspx).</span></span> <span data-ttu-id="77cdd-193">A tranzakció Compensating mintát gyakran használják műveletek visszavonásához, a végleges konzisztencia modell megvalósításához.</span><span class="sxs-lookup"><span data-stu-id="77cdd-193">The Compensating Transaction pattern is often used to undo operations that implement the eventual consistency model.</span></span> <span data-ttu-id="77cdd-194">A kezdés tájékoztatást nyújt az előnyöket és a végleges konzisztencia kompromisszumot.</span><span class="sxs-lookup"><span data-stu-id="77cdd-194">This primer provides information on the benefits and tradeoffs of eventual consistency.</span></span>

- <span data-ttu-id="77cdd-195">[A Feladatütemező-ügynök – felügyelő mintát](scheduler-agent-supervisor.md).</span><span class="sxs-lookup"><span data-stu-id="77cdd-195">[Scheduler-Agent-Supervisor Pattern](scheduler-agent-supervisor.md).</span></span> <span data-ttu-id="77cdd-196">Ismerteti, hogyan lehet rugalmas rendszerben elosztott szolgáltatásokat és erőforrásokat használó üzleti műveletek végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="77cdd-196">Describes how to implement resilient systems that perform business operations that use distributed services and resources.</span></span> <span data-ttu-id="77cdd-197">Egyes esetekben szükség lehet egy kompenzációs tranzakció használatával egy művelet által végzett munka visszavonása.</span><span class="sxs-lookup"><span data-stu-id="77cdd-197">Sometimes, it might be necessary to undo the work performed by an operation by using a compensating transaction.</span></span>

- <span data-ttu-id="77cdd-198">[Ismételje meg a minta](./retry.md).</span><span class="sxs-lookup"><span data-stu-id="77cdd-198">[Retry Pattern](./retry.md).</span></span> <span data-ttu-id="77cdd-199">Compensating tranzakciók elvégzéséhez költséges lehet, és lehetséges, egy hatékony házirend tett sikertelen műveletek újrapróbálkozási mintát követve implementálásával minimalizálása érdekében a használatukat.</span><span class="sxs-lookup"><span data-stu-id="77cdd-199">Compensating transactions can be expensive to perform, and it might be possible to minimize their use by implementing an effective policy of retrying failing operations by following the Retry pattern.</span></span>
