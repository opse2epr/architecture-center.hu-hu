---
title: A Feladatütemező ügynök felügyelő
description: Egy készletét műveletek között elosztott készlete szolgáltatások és az egyéb távoli erőforrásokhoz.
keywords: Kialakítási mintája
author: dragon119
ms.date: 06/23/2017
pnp.series.title: Cloud Design Patterns
pnp.pattern.categories:
- messaging
- resiliency
ms.openlocfilehash: 03bfe2fe96b3b81d547cfedb075bcf855846b668
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 11/14/2017
---
# <a name="scheduler-agent-supervisor-pattern"></a><span data-ttu-id="1237d-104">A Feladatütemező ügynök felügyelő minta</span><span class="sxs-lookup"><span data-stu-id="1237d-104">Scheduler Agent Supervisor pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="1237d-105">Egy készletét elosztott műveletek egyetlen műveletként.</span><span class="sxs-lookup"><span data-stu-id="1237d-105">Coordinate a set of distributed actions as a single operation.</span></span> <span data-ttu-id="1237d-106">Ha a műveletek sikertelenek, próbálja meg transzparens módon kezeli a hibák, vagy pedig a munkahelyi végeznie, így a teljes művelet sikeres vagy sikertelen egész visszavonása.</span><span class="sxs-lookup"><span data-stu-id="1237d-106">If any of the actions fail, try to handle the failures transparently, or else undo the work that was performed, so the entire operation succeeds or fails as a whole.</span></span> <span data-ttu-id="1237d-107">Rugalmasság ez hozzáadása egy elosztott rendszert, lehetővé téve számára a helyre, majd próbálja megismételni a végrehajtandó műveleteket átmeneti kivételek, hosszú ideig tart és folyamat hibái miatt sikertelen.</span><span class="sxs-lookup"><span data-stu-id="1237d-107">This can add resiliency to a distributed system, by enabling it to recover and retry actions that fail due to transient exceptions, long-lasting faults, and process failures.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="1237d-108">A környezetben, és probléma</span><span class="sxs-lookup"><span data-stu-id="1237d-108">Context and problem</span></span>

<span data-ttu-id="1237d-109">Egy alkalmazás feladatokat, amelyek közé tartozik a száma, amelyeket lehet, hogy távoli szolgáltatások invoke vagy távoli erőforrások eléréséhez lépéseiért hajt végre.</span><span class="sxs-lookup"><span data-stu-id="1237d-109">An application performs tasks that include a number of steps, some of which might invoke remote services or access remote resources.</span></span> <span data-ttu-id="1237d-110">Előfordulhat, hogy az egyes lépéseket egymástól független, de azok vannak összehangolva. az alkalmazás logika, amely megvalósítja a feladatot.</span><span class="sxs-lookup"><span data-stu-id="1237d-110">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span>

<span data-ttu-id="1237d-111">Amikor csak lehetséges, az alkalmazás győződjön meg arról, hogy a feladat befejezését fut, és hárítsa el a távoli szolgáltatások vagy az erőforrásokhoz való hozzáférés során felmerülő esetleges hibákat.</span><span class="sxs-lookup"><span data-stu-id="1237d-111">Whenever possible, the application should ensure that the task runs to completion and resolve any failures that might occur when accessing remote services or resources.</span></span> <span data-ttu-id="1237d-112">Hiba történik a számos oka lehet.</span><span class="sxs-lookup"><span data-stu-id="1237d-112">Failures can occur for many reasons.</span></span> <span data-ttu-id="1237d-113">Például a hálózat esetleg nem működik, kommunikációs sikerült lehet megszakítani, elképzelhető, hogy a távoli szolgáltatás nem válaszol vagy instabil állapotban vagy távoli az erőforrás átmenetileg nem érhetők el, lehet, hogy az erőforrás-korlátozások miatt előfordulhat, hogy lehet.</span><span class="sxs-lookup"><span data-stu-id="1237d-113">For example, the network might be down, communications could be interrupted, a remote service might be unresponsive or in an unstable state, or a remote resource might be temporarily inaccessible, perhaps due to resource constraints.</span></span> <span data-ttu-id="1237d-114">Sok esetben a hibák átmenetiek lehetnek, és segítségével kezelhetik a [újrapróbálkozási mintát][retry-pattern].</span><span class="sxs-lookup"><span data-stu-id="1237d-114">In many cases the failures will be transient and can be handled by using the [Retry pattern][retry-pattern].</span></span>

<span data-ttu-id="1237d-115">Ha az alkalmazás állandó hibát észlel, nem könnyen helyreállíthatók, állítsa helyre a rendszer konzisztens állapotba, és a teljes műveletet integritását képesnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="1237d-115">If the application detects a more permanent fault it can't easily recover from, it must be able to restore the system to a consistent state and ensure integrity of the entire operation.</span></span>

## <a name="solution"></a><span data-ttu-id="1237d-116">Megoldás</span><span class="sxs-lookup"><span data-stu-id="1237d-116">Solution</span></span>

<span data-ttu-id="1237d-117">A Feladatütemező ügynök felügyelő mintát a következő szereplője határozza meg.</span><span class="sxs-lookup"><span data-stu-id="1237d-117">The Scheduler Agent Supervisor pattern defines the following actors.</span></span> <span data-ttu-id="1237d-118">Ezek szereplője levezényelni a teljes feladat részeként elvégzendő lépések.</span><span class="sxs-lookup"><span data-stu-id="1237d-118">These actors orchestrate the steps to be performed as part of the overall task.</span></span>

- <span data-ttu-id="1237d-119">A **Feladatütemező** rendezi a lépéseket, amelyek a feladat futtatását és koordinálja a műveletet.</span><span class="sxs-lookup"><span data-stu-id="1237d-119">The **Scheduler** arranges for the steps that make up the task to be executed and orchestrates their operation.</span></span> <span data-ttu-id="1237d-120">Ezeket a lépéseket egy folyamat vagy munkafolyamat lehet egyesíteni.</span><span class="sxs-lookup"><span data-stu-id="1237d-120">These steps can be combined into a pipeline or workflow.</span></span> <span data-ttu-id="1237d-121">Az ütemező felelős győződjön meg arról, hogy a munkafolyamat utasításait a megfelelő sorrendben történik.</span><span class="sxs-lookup"><span data-stu-id="1237d-121">The Scheduler is responsible for ensuring that the steps in this workflow are performed in the right order.</span></span> <span data-ttu-id="1237d-122">Mivel minden egyes lépést, a Feladatütemező rögzíti a munkafolyamat, például a "lépés a még nem indult el," "lépés fut" állapotba, vagy a "lépése befejeződött."</span><span class="sxs-lookup"><span data-stu-id="1237d-122">As each step is performed, the Scheduler records the state of the workflow, such as "step not yet started," "step running," or "step completed."</span></span> <span data-ttu-id="1237d-123">Az állapot is tartalmaznia kell a lépés befejezéséhez engedélyezett idő egy felső korlátot, a befejezéséhez által idő hívása.</span><span class="sxs-lookup"><span data-stu-id="1237d-123">The state information should also include an upper limit of the time allowed for the step to finish, called the complete-by time.</span></span> <span data-ttu-id="1237d-124">Ha egy lépés szükség van a távoli szolgáltatás vagy az erőforrás elérésére, a Feladatütemező hív meg, a megfelelő ügynököt, és átadja azt a végzett munka részleteit.</span><span class="sxs-lookup"><span data-stu-id="1237d-124">If a step requires access to a remote service or resource, the Scheduler invokes the appropriate Agent, passing it the details of the work to be performed.</span></span> <span data-ttu-id="1237d-125">Az ütemező általában egy ügynök aszinkron kérelem/válasz messaging szolgáltatással kommunikál.</span><span class="sxs-lookup"><span data-stu-id="1237d-125">The Scheduler typically communicates with an Agent using asynchronous request/response messaging.</span></span> <span data-ttu-id="1237d-126">Ennek segítségével valósítható várólisták, de más elosztott üzenetküldő technológiák volt használható, helyette.</span><span class="sxs-lookup"><span data-stu-id="1237d-126">This can be implemented using queues, although other distributed messaging technologies could be used instead.</span></span>

    > <span data-ttu-id="1237d-127">Az ütemező egy hasonló funkciót a folyamat Manager a hajt végre a [folyamat Manager mintát](http://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span><span class="sxs-lookup"><span data-stu-id="1237d-127">The Scheduler performs a similar function to the Process Manager in the [Process Manager pattern](http://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span></span> <span data-ttu-id="1237d-128">A tényleges munkafolyamat általában definiálva, és egy munkafolyamat-motor, amely vezérli az ütemező által megvalósított.</span><span class="sxs-lookup"><span data-stu-id="1237d-128">The actual workflow is typically defined and implemented by a workflow engine that's controlled by the Scheduler.</span></span> <span data-ttu-id="1237d-129">Ez a megközelítés a munkafolyamatot az ütemező üzleti logikája leválasztja.</span><span class="sxs-lookup"><span data-stu-id="1237d-129">This approach decouples the business logic in the workflow from the Scheduler.</span></span>

- <span data-ttu-id="1237d-130">A **ügynök** logika, amely magában foglalja a távoli szolgáltatás hívása, vagy egy távoli lépése, a feladatütemezés által hivatkozott erőforráshoz való hozzáférés tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="1237d-130">The **Agent** contains logic that encapsulates a call to a remote service, or access to a remote resource referenced by a step in a task.</span></span> <span data-ttu-id="1237d-131">Minden ügynök általában becsomagolja a egy egyetlen szolgáltatás vagy az erőforrás, hívások végrehajtási a megfelelő hiba kezelését, és próbálkozzon újra a programot a (függvényében időtúllépés megkötés, a későbbiekben olvashat).</span><span class="sxs-lookup"><span data-stu-id="1237d-131">Each Agent typically wraps calls to a single service or resource, implementing the appropriate error handling and retry logic (subject to a timeout constraint, described later).</span></span> <span data-ttu-id="1237d-132">A lépéseket a munkafolyamatban az ütemező által futtatott használja más lépéseket több szolgáltatásokhoz és erőforrásokhoz, ha minden lépés (Ez a minta egy megvalósítási részletei) egy másik ügynök esetleg hivatkoznak.</span><span class="sxs-lookup"><span data-stu-id="1237d-132">If the steps in the workflow being run by the Scheduler use several services and resources across different steps, each step might reference a different Agent (this is an implementation detail of the pattern).</span></span>

- <span data-ttu-id="1237d-133">A **felügyelő** a lépéseket a az ütemező által végzett feladat állapotát figyeli.</span><span class="sxs-lookup"><span data-stu-id="1237d-133">The **Supervisor** monitors the status of the steps in the task being performed by the Scheduler.</span></span> <span data-ttu-id="1237d-134">Rendszeres időközönként fut (a lesz adott rendszer), és megvizsgálja az ütemező által fenntartott lépéseket állapotát.</span><span class="sxs-lookup"><span data-stu-id="1237d-134">It runs periodically (the frequency will be system specific), and examines the status of steps maintained by the Scheduler.</span></span> <span data-ttu-id="1237d-135">Ha azt észleli, hogy azokat, lejárt, vagy sikertelen volt, rendszerezi helyreállítani a lépés, vagy hajtsa végre a megfelelő javító intézkedés (Ez lehet, hogy tartalmaz, amely egy lépés állapotának módosítása) a megfelelő ügynök.</span><span class="sxs-lookup"><span data-stu-id="1237d-135">If it detects any that have timed out or failed, it arranges for the appropriate Agent to recover the step or execute the appropriate remedial action (this might involve modifying the status of a step).</span></span> <span data-ttu-id="1237d-136">Vegye figyelembe, hogy a helyreállítási vagy a javító műveleteket az ütemező és az ügynökök alapján történik.</span><span class="sxs-lookup"><span data-stu-id="1237d-136">Note that the recovery or remedial actions are implemented by the Scheduler and Agents.</span></span> <span data-ttu-id="1237d-137">A felügyelő egyszerűen igényeljen, hogy ezeket a műveleteket kell elvégezni.</span><span class="sxs-lookup"><span data-stu-id="1237d-137">The Supervisor should simply request that these actions be performed.</span></span>

<span data-ttu-id="1237d-138">A Feladatütemező, az ügynök és a felügyelő összetevői logikai és fizikai végrehajtásuk használt technológiától függ.</span><span class="sxs-lookup"><span data-stu-id="1237d-138">The Scheduler, Agent, and Supervisor are logical components and their physical implementation depends on the technology being used.</span></span> <span data-ttu-id="1237d-139">Több logikai ügynökök például egyetlen webszolgáltatás részeként kell végrehajtani.</span><span class="sxs-lookup"><span data-stu-id="1237d-139">For example, several logical agents might be implemented as part of a single web service.</span></span>

<span data-ttu-id="1237d-140">A Feladatütemező a feladat és a tartós tárolóban, az állapot tárolásának nevű egyes lépéseinek állapotát vonatkozó adatokat tárolja.</span><span class="sxs-lookup"><span data-stu-id="1237d-140">The Scheduler maintains information about the progress of the task and the state of each step in a durable data store, called the state store.</span></span> <span data-ttu-id="1237d-141">A felügyelő használhatja ezeket az információkat annak meghatározásához, hogy a lépés nem sikerült.</span><span class="sxs-lookup"><span data-stu-id="1237d-141">The Supervisor can use this information to help determine whether a step has failed.</span></span> <span data-ttu-id="1237d-142">Az ábra azt mutatja be, a Feladatütemező, az ügynökök, a felügyelő és az állapot tárolásának közötti kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="1237d-142">The figure illustrates the relationship between the Scheduler, the Agents, the Supervisor, and the state store.</span></span>

![1. ábra – a Feladatütemező ügynök felügyelő mintában actors](./_images/scheduler-agent-supervisor-pattern.png)


> <span data-ttu-id="1237d-144">A minta egy egyszerűsített verziója látható.</span><span class="sxs-lookup"><span data-stu-id="1237d-144">This diagram shows a simplified version of the pattern.</span></span> <span data-ttu-id="1237d-145">Valós megvalósításában valószínűleg egymással párhuzamosan fut, minden egyes feladatok egy részét az ütemező több példányát.</span><span class="sxs-lookup"><span data-stu-id="1237d-145">In a real implementation, there might be many instances of the Scheduler running concurrently, each a subset of tasks.</span></span> <span data-ttu-id="1237d-146">Hasonlóképpen a rendszer futtathat minden ügynök, vagy még több felügyelők több példányát.</span><span class="sxs-lookup"><span data-stu-id="1237d-146">Similarly, the system could run multiple instances of each Agent, or even multiple Supervisors.</span></span> <span data-ttu-id="1237d-147">Ebben az esetben felügyelők kell koordinálja egymással gondosan győződjön meg arról, hogy nem "versenyeznek" a sikertelen lépéseket és feladatokat helyreállítása a munkájukat.</span><span class="sxs-lookup"><span data-stu-id="1237d-147">In this case, Supervisors must coordinate their work with each other carefully to ensure that they don’t compete to recover the same failed steps and tasks.</span></span> <span data-ttu-id="1237d-148">A [vezető választás mintát](leader-election.md) biztosít egy lehetséges megoldás erre a problémára.</span><span class="sxs-lookup"><span data-stu-id="1237d-148">The [Leader Election pattern](leader-election.md) provides one possible solution to this problem.</span></span>

<span data-ttu-id="1237d-149">Ha az alkalmazás készen áll a futtatásra egy feladatot, akkor kérést küld az ütemező.</span><span class="sxs-lookup"><span data-stu-id="1237d-149">When the application is ready to run a task, it submits a request to the Scheduler.</span></span> <span data-ttu-id="1237d-150">A Feladatütemező rekordok kezdeti állapotinformációkat a feladatot, és lépést (például lépés még nem indult el) a állapot tárolásának, majd elindítja a munkafolyamat által definiált műveletek végrehajtása.</span><span class="sxs-lookup"><span data-stu-id="1237d-150">The Scheduler records initial state information about the task and its steps (for example, step not yet started) in the state store and then starts performing the operations defined by the workflow.</span></span> <span data-ttu-id="1237d-151">Az ütemező indulásakor az egyes lépéseket, akkor frissíti az állapottároló (például lépés fut) az adott lépés állapotára vonatkozó adatokat.</span><span class="sxs-lookup"><span data-stu-id="1237d-151">As the Scheduler starts each step, it updates the information about the state of that step in the state store (for example, step running).</span></span>

<span data-ttu-id="1237d-152">Ha egy lépés hivatkozik a távoli szolgáltatás vagy az erőforrás, a Feladatütemező üzenetet küld a megfelelő ügynök.</span><span class="sxs-lookup"><span data-stu-id="1237d-152">If a step references a remote service or resource, the Scheduler sends a message to the appropriate Agent.</span></span> <span data-ttu-id="1237d-153">Az üzenet a szolgáltatáshoz adnak át vagy nem érhető el az erőforrás a művelet befejezéséhez által ideje mellett kell az ügynököt adatokat tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="1237d-153">The message contains the information that the Agent needs to pass to the service or access the resource, in addition to the complete-by time for the operation.</span></span> <span data-ttu-id="1237d-154">Ha az ügynököt a művelet sikeresen befejeződött, a Feladatütemező választ ad vissza.</span><span class="sxs-lookup"><span data-stu-id="1237d-154">If the Agent completes its operation successfully, it returns a response to the Scheduler.</span></span> <span data-ttu-id="1237d-155">Az ütemező az állapottároló (például lépés befejeződött) állapot frissítése, majd hajtsa végre a következő lépéssel.</span><span class="sxs-lookup"><span data-stu-id="1237d-155">The Scheduler can then update the state information in the state store (for example, step completed) and perform the next step.</span></span> <span data-ttu-id="1237d-156">A folyamat folytatódik, amíg a teljes feladat be nem fejeződik.</span><span class="sxs-lookup"><span data-stu-id="1237d-156">This process continues until the entire task is complete.</span></span>

<span data-ttu-id="1237d-157">Az ügynök valósíthatja meg semmilyen újrapróbálkozási logika, amely a munkájuk elvégzéséhez szükséges.</span><span class="sxs-lookup"><span data-stu-id="1237d-157">An Agent can implement any retry logic that's necessary to perform its work.</span></span> <span data-ttu-id="1237d-158">Azonban ha az ügynök nem végrehajtják a tevékenységeket, végezze el által lejárta előtt, a Feladatütemező azt fogja feltételezni, hogy a művelet sikertelen volt.</span><span class="sxs-lookup"><span data-stu-id="1237d-158">However, if the Agent doesn't complete its work before the complete-by period expires, the Scheduler will assume that the operation has failed.</span></span> <span data-ttu-id="1237d-159">Ebben az esetben az ügynök állítsa le a tevékenységeket és nem próbálja meg bármit térjen vissza az ütemező (még egy hibaüzenet), vagy próbálja bármely formájára vonatkozó helyreállítási.</span><span class="sxs-lookup"><span data-stu-id="1237d-159">In this case, the Agent should stop its work and not try to return anything to the Scheduler (not even an error message), or try any form of recovery.</span></span> <span data-ttu-id="1237d-160">Ez a korlátozás oka, hogy egy lépés túllépte az időkorlátot vagy sikertelen volt, követően az ügynök egy másik példánya ütemezhető a hibás lépés (a műveletet később) futtatásához.</span><span class="sxs-lookup"><span data-stu-id="1237d-160">The reason for this restriction is that, after a step has timed out or failed, another instance of the Agent might be scheduled to run the failing step (this process is described later).</span></span>

<span data-ttu-id="1237d-161">Ha az ügynök nem sikerül, a Feladatütemező nem kapott választ.</span><span class="sxs-lookup"><span data-stu-id="1237d-161">If the Agent fails, the Scheduler won't receive a response.</span></span> <span data-ttu-id="1237d-162">A minta nem különböztetni a lépést, amely túllépte az időkorlátot, a másik valóban sikertelen volt.</span><span class="sxs-lookup"><span data-stu-id="1237d-162">The pattern doesn't make a distinction between a step that has timed out and one that has genuinely failed.</span></span>

<span data-ttu-id="1237d-163">Egy lépés átlépi az időkorlátot vagy meghiúsul, ha az állapottároló egy rekordot, amely azt jelzi, hogy a lépés futtatja, de a befejezéséhez által idő fog átadott fogja tartalmazni.</span><span class="sxs-lookup"><span data-stu-id="1237d-163">If a step times out or fails, the state store will contain a record that indicates that the step is running, but the complete-by time will have passed.</span></span> <span data-ttu-id="1237d-164">A felügyelő ehhez hasonló lépéseket keresi, és megpróbálja helyreállítani őket.</span><span class="sxs-lookup"><span data-stu-id="1237d-164">The Supervisor looks for steps like this and tries to recover them.</span></span> <span data-ttu-id="1237d-165">Egy lehetséges stratégia a befejezéséhez által értékét a lépés elvégzése után, és az ütemező azonosítása a lépés túllépte az időkorlátot, majd üzenetküldéshez rendelkezésre álló időt kiterjeszteni a felügyelő szolgál. Az ütemező majd megpróbálja ismételje meg ezt a lépést.</span><span class="sxs-lookup"><span data-stu-id="1237d-165">One possible strategy is for the Supervisor to update the complete-by value to extend the time available to complete the step, and then send a message to the Scheduler identifying the step that has timed out. The Scheduler can then try to repeat this step.</span></span> <span data-ttu-id="1237d-166">Azonban ez a kialakítás megköveteli a feladatokat az idempotent.</span><span class="sxs-lookup"><span data-stu-id="1237d-166">However, this design requires the tasks to be idempotent.</span></span>

<span data-ttu-id="1237d-167">A felügyelő megakadályozhatja, hogy megegyezik a hajtva, ha folyamatosan meghibásodik, vagy időtúllépés módosítania kell. Ehhez az szükséges, a felügyelő sikerült karbantartása minden egyes lépést, és az állapotadatokat, az a tárolóban újrapróbálkozások számát.</span><span class="sxs-lookup"><span data-stu-id="1237d-167">The Supervisor might need to prevent the same step from being retried if it continually fails or times out. To do this, the Supervisor could maintain a retry count for each step, along with the state information, in the state store.</span></span> <span data-ttu-id="1237d-168">Ha ez a szám eléri az előre definiált a felügyelő is elfogadása előtt, akkor újra kell a lépésben az általános gyakorlat, hogy a tartalék fel fogja oldani az ebben az időszakban az ütemező értesítésére hosszabb ideig vár a.</span><span class="sxs-lookup"><span data-stu-id="1237d-168">If this count exceeds a predefined threshold the Supervisor can adopt a strategy of waiting for an extended period before notifying the Scheduler that it should retry the step, in the expectation that the fault will be resolved during this period.</span></span> <span data-ttu-id="1237d-169">Azt is megteheti, a felügyelő tud üzenetet küldeni az ütemező kéréséhez vonhatók vissza, a teljes tevékenység végrehajtása egy [Compensating tranzakció mintát](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="1237d-169">Alternatively, the Supervisor can send a message to the Scheduler to request the entire task be undone by implementing a [Compensating Transaction pattern](compensating-transaction.md).</span></span> <span data-ttu-id="1237d-170">Ez a megközelítés a Feladatütemező és minden egyes lépést, amely a sikeresen befejeződött a kompenzációs műveletek végrehajtásához szükséges adatokat szolgáltató ügynökök függ.</span><span class="sxs-lookup"><span data-stu-id="1237d-170">This approach will depend on the Scheduler and Agents providing the information necessary to implement the compensating operations for each step that completed successfully.</span></span>

> <span data-ttu-id="1237d-171">A Feladatütemező és az ügynökök figyelésére, és indítsa újra őket, ha azt elmulasztják a felügyelő célja nem.</span><span class="sxs-lookup"><span data-stu-id="1237d-171">It isn't the purpose of the Supervisor to monitor the Scheduler and Agents, and restart them if they fail.</span></span> <span data-ttu-id="1237d-172">A rendszer ezen része az infrastruktúra ezeket az összetevőket futnak kezelje.</span><span class="sxs-lookup"><span data-stu-id="1237d-172">This aspect of the system should be handled by the infrastructure these components are running in.</span></span> <span data-ttu-id="1237d-173">Hasonlóképpen, a felügyelő lehetnének fut a feladat az ütemező által végzett műveletek a tényleges üzleti ismerete (egyebek között a helyesbítéshez amennyiben ezek a feladatok nem).</span><span class="sxs-lookup"><span data-stu-id="1237d-173">Similarly, the Supervisor shouldn't have knowledge of the actual business operations that the tasks being performed by the Scheduler are running (including how to compensate should these tasks fail).</span></span> <span data-ttu-id="1237d-174">Ez az a célja az ütemező által megvalósított a munkafolyamat-logikát.</span><span class="sxs-lookup"><span data-stu-id="1237d-174">This is the purpose of the workflow logic implemented by the Scheduler.</span></span> <span data-ttu-id="1237d-175">A felügyelő kizárólagos felelőssége, hogy határozza meg, hogy a lépés nem sikerült, és meg kell ismételni, vagy a teljes feladat lehet visszavonni a hibás lépést tartalmazó elrendezése.</span><span class="sxs-lookup"><span data-stu-id="1237d-175">The sole responsibility of the Supervisor is to determine whether a step has failed and arrange either for it to be repeated or for the entire task containing the failed step to be undone.</span></span>

<span data-ttu-id="1237d-176">Az ütemező meghibásodás után újraindul, vagy az ütemező által végzett a munkafolyamat váratlanul leáll, ha az ütemező legyen meg tudja határozni, ha az nem volt kezelése szolgáló aktív feladat állapotát, és készüljön, ez a feladat folytatása ettől a ponttól.</span><span class="sxs-lookup"><span data-stu-id="1237d-176">If the Scheduler is restarted after a failure, or the workflow being performed by the Scheduler terminates unexpectedly, the Scheduler should be able to determine the status of any inflight task that it was handling when it failed, and be prepared to resume this task from that point.</span></span> <span data-ttu-id="1237d-177">A részleteket a folyamat során valószínűleg adott rendszer.</span><span class="sxs-lookup"><span data-stu-id="1237d-177">The implementation details of this process are likely to be system specific.</span></span> <span data-ttu-id="1237d-178">A feladat nem állítható helyre, ha a feladat már végzett munka visszavonása szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="1237d-178">If the task can't be recovered, it might be necessary to undo the work already performed by the task.</span></span> <span data-ttu-id="1237d-179">Emellett előfordulhat, hogy végrehajtási egy [tranzakció compensating](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="1237d-179">This might also require implementing a [compensating transaction](compensating-transaction.md).</span></span>

<span data-ttu-id="1237d-180">A fő ebben a mintában előnye, hogy a rendszer váratlan ideiglenes vagy helyreállíthatatlan hiba esetén refs nem.</span><span class="sxs-lookup"><span data-stu-id="1237d-180">The key advantage of this pattern is that the system is resilient in the event of unexpected temporary or unrecoverable failures.</span></span> <span data-ttu-id="1237d-181">A rendszer kell öngyógyító lehet létrehozni.</span><span class="sxs-lookup"><span data-stu-id="1237d-181">The system can be constructed to be self healing.</span></span> <span data-ttu-id="1237d-182">Például ha egy ügynök vagy a Feladatütemező nem sikerül, egy új elindítható, és a felügyelő rendezheti folytatható egy tevékenység.</span><span class="sxs-lookup"><span data-stu-id="1237d-182">For example, if an Agent or the Scheduler fails, a new one can be started and the Supervisor can arrange for a task to be resumed.</span></span> <span data-ttu-id="1237d-183">Ha nem sikerül a felügyelő, egy másik példánya elindítható, és képes átveszik a hiba helyéről.</span><span class="sxs-lookup"><span data-stu-id="1237d-183">If the Supervisor fails, another instance can be started and can take over from where the failure occurred.</span></span> <span data-ttu-id="1237d-184">A felügyelő ütemezett rendszeres időközönként, ha egy előre meghatározott időszak után automatikusan indítható új példányt.</span><span class="sxs-lookup"><span data-stu-id="1237d-184">If the Supervisor is scheduled to run periodically, a new instance can be automatically started after a predefined interval.</span></span> <span data-ttu-id="1237d-185">Az állapot tárolásának replikálható egy még nagyobb fokú rugalmasságot eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="1237d-185">The state store can be replicated to reach an even greater degree of resiliency.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="1237d-186">Problémákat és szempontok</span><span class="sxs-lookup"><span data-stu-id="1237d-186">Issues and considerations</span></span>

<span data-ttu-id="1237d-187">Ez a kialakítás megvalósítása meghatározásakor a következő szempontokat kell figyelembe vennie:</span><span class="sxs-lookup"><span data-stu-id="1237d-187">You should consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="1237d-188">Ebben a mintában nehéz lehet megvalósítani, és a rendszer minden lehetséges hibaállapotba alaposan tesztelni.</span><span class="sxs-lookup"><span data-stu-id="1237d-188">This pattern can be difficult to implement and requires thorough testing of each possible failure mode of the system.</span></span>

- <span data-ttu-id="1237d-189">Az ütemező által megvalósított helyreállítási/újrapróbálkozási logika összetett és függő állapotadatokat az állapottároló használatban.</span><span class="sxs-lookup"><span data-stu-id="1237d-189">The recovery/retry logic implemented by the Scheduler is complex and dependent on state information held in the state store.</span></span> <span data-ttu-id="1237d-190">Is szükség lehet a tartós tárolóban kompenzációs tranzakció végrehajtásához szükséges adatok rögzítéséhez.</span><span class="sxs-lookup"><span data-stu-id="1237d-190">It might also be necessary to record the information required to implement a compensating transaction in a durable data store.</span></span>

- <span data-ttu-id="1237d-191">Milyen gyakran a felügyelő fut-e szüksége lesz.</span><span class="sxs-lookup"><span data-stu-id="1237d-191">How often the Supervisor runs will be important.</span></span> <span data-ttu-id="1237d-192">Megakadályozhatja, hogy a hibás lépéshez sem blokkolja-e egy alkalmazás hosszú időn keresztül a elég gyakran fusson, de azt nem futtatható úgy, hogy egy terhelés válik.</span><span class="sxs-lookup"><span data-stu-id="1237d-192">It should run often enough to prevent any failed steps from blocking an application for an extended period, but it shouldn't run so often that it becomes an overhead.</span></span>

- <span data-ttu-id="1237d-193">A lépéseket egy ügynök által végzett egynél többször is futhat.</span><span class="sxs-lookup"><span data-stu-id="1237d-193">The steps performed by an Agent could be run more than once.</span></span> <span data-ttu-id="1237d-194">A programot, amely megvalósítja az alábbi lépéseket az idempotent kell lennie.</span><span class="sxs-lookup"><span data-stu-id="1237d-194">The logic that implements these steps should be idempotent.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="1237d-195">Mikor érdemes használni ezt a mintát</span><span class="sxs-lookup"><span data-stu-id="1237d-195">When to use this pattern</span></span>

<span data-ttu-id="1237d-196">Használja ezt a mintát, ha egy folyamat, amely elosztott környezetben, például a felhőben fut, a refs kommunikációs hiba és/vagy a működési probléma kell lennie.</span><span class="sxs-lookup"><span data-stu-id="1237d-196">Use this pattern when a process that runs in a distributed environment, such as the cloud, must be resilient to communications failure and/or operational failure.</span></span>

<span data-ttu-id="1237d-197">Ez a minta nem feltétlenül alkalmas feladatokat, amelyek nem távoli szolgáltatások meghívása vagy a távoli erőforrásokhoz férnek hozzá.</span><span class="sxs-lookup"><span data-stu-id="1237d-197">This pattern might not be suitable for tasks that don't invoke remote services or access remote resources.</span></span>

## <a name="example"></a><span data-ttu-id="1237d-198">Példa</span><span class="sxs-lookup"><span data-stu-id="1237d-198">Example</span></span>

<span data-ttu-id="1237d-199">A webes alkalmazás, amely egy kereskedelmi rendszer lett telepítve a Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="1237d-199">A web application that implements an ecommerce system has been deployed on Microsoft Azure.</span></span> <span data-ttu-id="1237d-200">Ez az alkalmazás keresse meg a választható termékek és a rendeléseket helyezze futtathatók.</span><span class="sxs-lookup"><span data-stu-id="1237d-200">Users can run this application to browse the available products and to place orders.</span></span> <span data-ttu-id="1237d-201">A felhasználói felület webes szerepkörben fut, és az alkalmazás rendelés feldolgozása elemei feldolgozói szerepkörök készletként valósíthatók meg.</span><span class="sxs-lookup"><span data-stu-id="1237d-201">The user interface runs as a web role, and the order processing elements of the application are implemented as a set of worker roles.</span></span> <span data-ttu-id="1237d-202">A logika feldolgozási sorrendben részét magában foglalja a távoli szolgáltatás elérésével, és lehet, hogy a rendszer ezen része átmeneti jellegű, vagy további hosszú ideig tart hibák hibalehetőségeket rejt magában.</span><span class="sxs-lookup"><span data-stu-id="1237d-202">Part of the order processing logic involves accessing a remote service, and this aspect of the system could be prone to transient or more long-lasting faults.</span></span> <span data-ttu-id="1237d-203">Emiatt a tervezők a Feladatütemező ügynök felügyelő mintát használt feldolgozásakor a rendszer az elemek sorrendje végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="1237d-203">For this reason, the designers used the Scheduler Agent Supervisor pattern to implement the order processing elements of the system.</span></span>

<span data-ttu-id="1237d-204">Amikor a vevő egy sorrendet, az alkalmazás egy üzenet, amely leírja a sorrendben, és ez az üzenet egy üzenetsorba küldi hoz létre.</span><span class="sxs-lookup"><span data-stu-id="1237d-204">When a customer places an order, the application constructs a message that describes the order and posts this message to a queue.</span></span> <span data-ttu-id="1237d-205">Külön küldésének folyamatainak, a feldolgozói szerepkör található üzenet beolvasása, a rendelés részleteit szúr be a rendelések adatbázist, és létrehoz egy rekordot a rendelés folyamat az állapottároló.</span><span class="sxs-lookup"><span data-stu-id="1237d-205">A separate submission process, running in a worker role, retrieves the message, inserts the order details into the orders database, and creates a record for the order process in the state store.</span></span> <span data-ttu-id="1237d-206">Vegye figyelembe, hogy a rendelések adatbázist és az állapot tárolásának Beszúrások azonos művelet részeként történik.</span><span class="sxs-lookup"><span data-stu-id="1237d-206">Note that the inserts into the orders database and the state store are performed as part of the same operation.</span></span> <span data-ttu-id="1237d-207">A folyamat célja, hogy győződjön meg arról, hogy mindkét beszúrása teljes együtt.</span><span class="sxs-lookup"><span data-stu-id="1237d-207">The submission process is designed to ensure that both inserts complete together.</span></span>

<span data-ttu-id="1237d-208">A folyamat létrehozza a rendelés állapotinformáció tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="1237d-208">The state information that the submission process creates for the order includes:</span></span>

- <span data-ttu-id="1237d-209">**OrderID**.</span><span class="sxs-lookup"><span data-stu-id="1237d-209">**OrderID**.</span></span> <span data-ttu-id="1237d-210">A rendelések adatbázis sorrendje azonosítója.</span><span class="sxs-lookup"><span data-stu-id="1237d-210">The ID of the order in the orders database.</span></span>

- <span data-ttu-id="1237d-211">**LockedBy**.</span><span class="sxs-lookup"><span data-stu-id="1237d-211">**LockedBy**.</span></span> <span data-ttu-id="1237d-212">A feldolgozói szerepkör kezelése a sorrend Példányazonosítója.</span><span class="sxs-lookup"><span data-stu-id="1237d-212">The instance ID of the worker role handling the order.</span></span> <span data-ttu-id="1237d-213">Előfordulhat, hogy a feldolgozói szerepkör fut a Feladatütemező aktuális példányai, de minden rendelés csak egy példányban kell kezelnie.</span><span class="sxs-lookup"><span data-stu-id="1237d-213">There might be multiple current instances of the worker role running the Scheduler, but each order should only be handled by a single instance.</span></span>

- <span data-ttu-id="1237d-214">**CompleteBy**.</span><span class="sxs-lookup"><span data-stu-id="1237d-214">**CompleteBy**.</span></span> <span data-ttu-id="1237d-215">Az idő a sorrendben kell feldolgozni.</span><span class="sxs-lookup"><span data-stu-id="1237d-215">The time the order should be processed by.</span></span>

- <span data-ttu-id="1237d-216">**ProcessState**.</span><span class="sxs-lookup"><span data-stu-id="1237d-216">**ProcessState**.</span></span> <span data-ttu-id="1237d-217">A sorrend kezelése a feladat aktuális állapotát.</span><span class="sxs-lookup"><span data-stu-id="1237d-217">The current state of the task handling the order.</span></span> <span data-ttu-id="1237d-218">A lehetséges állapotok a következők:</span><span class="sxs-lookup"><span data-stu-id="1237d-218">The possible states are:</span></span>

    - <span data-ttu-id="1237d-219">**Függőben lévő**.</span><span class="sxs-lookup"><span data-stu-id="1237d-219">**Pending**.</span></span> <span data-ttu-id="1237d-220">A sorrend létrejött, de feldolgozása még nem kezdődött.</span><span class="sxs-lookup"><span data-stu-id="1237d-220">The order has been created but processing hasn't yet been started.</span></span>
    - <span data-ttu-id="1237d-221">**Feldolgozási**.</span><span class="sxs-lookup"><span data-stu-id="1237d-221">**Processing**.</span></span> <span data-ttu-id="1237d-222">A megrendelés feldolgozása folyamatban van.</span><span class="sxs-lookup"><span data-stu-id="1237d-222">The order is currently being processed.</span></span>
    - <span data-ttu-id="1237d-223">**Feldolgozott**.</span><span class="sxs-lookup"><span data-stu-id="1237d-223">**Processed**.</span></span> <span data-ttu-id="1237d-224">A rendelés feldolgozása sikeresen megtörtént.</span><span class="sxs-lookup"><span data-stu-id="1237d-224">The order has been processed successfully.</span></span>
    - <span data-ttu-id="1237d-225">**Hiba**.</span><span class="sxs-lookup"><span data-stu-id="1237d-225">**Error**.</span></span> <span data-ttu-id="1237d-226">Rendelés feldolgozása sikertelen volt.</span><span class="sxs-lookup"><span data-stu-id="1237d-226">The order processing has failed.</span></span>

- <span data-ttu-id="1237d-227">**FailureCount**.</span><span class="sxs-lookup"><span data-stu-id="1237d-227">**FailureCount**.</span></span> <span data-ttu-id="1237d-228">Hány alkalommal a feldolgozása meghiúsult a sorrend.</span><span class="sxs-lookup"><span data-stu-id="1237d-228">The number of times that processing has been tried for the order.</span></span>

<span data-ttu-id="1237d-229">Az állapot az információ a `OrderID` mezőt átmásolja az új sorrendbe rendelés azonosítója.</span><span class="sxs-lookup"><span data-stu-id="1237d-229">In this state information, the `OrderID` field is copied from the order ID of the new order.</span></span> <span data-ttu-id="1237d-230">A `LockedBy` és `CompleteBy` mezők értéke `null`, a `ProcessState` mező értéke `Pending`, és a `FailureCount` mező értéke 0.</span><span class="sxs-lookup"><span data-stu-id="1237d-230">The `LockedBy` and `CompleteBy` fields are set to `null`, the `ProcessState` field is set to `Pending`, and the `FailureCount` field is set to 0.</span></span>

> <span data-ttu-id="1237d-231">Ebben a példában a sorrend logika kezelése viszonylag egyszerű, és csak egyetlen lépésben, amely hívja meg a távoli szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="1237d-231">In this example, the order handling logic is relatively simple and only has a single step that invokes a remote service.</span></span> <span data-ttu-id="1237d-232">Egy összetettebb többlépéses forgatókönyv esetén a folyamat olyan valószínűleg tartalmaz, amely számos lépést, és így több rekordot kellene hozhatók létre az állapottároló – mindegyiket egy egyéni lépést állapotát leíró.</span><span class="sxs-lookup"><span data-stu-id="1237d-232">In a more complex multistep scenario, the submission process would likely involve several steps, and so several records would be created in the state store—each one describing the state of an individual step.</span></span>

<span data-ttu-id="1237d-233">A Feladatütemező is a feldolgozói szerepkör részeként fut, és megvalósítja az üzleti logika, amely kezeli a sorrendben.</span><span class="sxs-lookup"><span data-stu-id="1237d-233">The Scheduler also runs as part of a worker role and implements the business logic that handles the order.</span></span> <span data-ttu-id="1237d-234">Az ütemező új rendelések lekérdezési példányának megvizsgálja az állapottároló rekordok ahol a `LockedBy` mező értéke null, és a `ProcessState` mező függőben.</span><span class="sxs-lookup"><span data-stu-id="1237d-234">An instance of the Scheduler polling for new orders examines the state store for records where the `LockedBy` field is null and the `ProcessState` field is pending.</span></span> <span data-ttu-id="1237d-235">Amikor az ütemező megtalál egy új sorrendben, akkor azonnal feltölti a `LockedBy` mezőt a saját Példányazonosító beállítása a `CompleteBy` mező egy megfelelő időpontot, és beállítja a `ProcessState` mezőjét a feldolgozásra.</span><span class="sxs-lookup"><span data-stu-id="1237d-235">When the Scheduler finds a new order, it immediately populates the `LockedBy` field with its own instance ID, sets the `CompleteBy` field to an appropriate time, and sets the `ProcessState` field to processing.</span></span> <span data-ttu-id="1237d-236">A kód tervezték kizárólagos és atomi, ha biztosítani szeretné, hogy a Feladatütemező két egyidejű példánya nem egyidejűleg kezelni ugyanabban a sorrendben.</span><span class="sxs-lookup"><span data-stu-id="1237d-236">The code is designed to be exclusive and atomic to ensure that two concurrent instances of the Scheduler can't try to handle the same order simultaneously.</span></span>

<span data-ttu-id="1237d-237">Az ütemező futtat a rendelés feldolgozása aszinkron módon történik, az üzleti munkafolyamat átadja azt az értéket a `OrderID` mezőjét az állapottárolóhoz.</span><span class="sxs-lookup"><span data-stu-id="1237d-237">The Scheduler then runs the business workflow to process the order asynchronously, passing it the value in the `OrderID` field from the state store.</span></span> <span data-ttu-id="1237d-238">A munkafolyamat sorrendjének kezelése a rendelés részleteit lekéri a rendelések adatbázist, és a tevékenységeket hajt végre.</span><span class="sxs-lookup"><span data-stu-id="1237d-238">The workflow handling the order retrieves the details of the order from the orders database and performs its work.</span></span> <span data-ttu-id="1237d-239">Amikor egy lépéseként rendelés feldolgozása kell meghívni a távoli szolgáltatás, az ügynök.</span><span class="sxs-lookup"><span data-stu-id="1237d-239">When a step in the order processing workflow needs to invoke the remote service, it uses an Agent.</span></span> <span data-ttu-id="1237d-240">A munkafolyamat-lépés a ügynök két kérelem/válasz csatorna működő Azure Service Bus-üzenetsorok használatával kommunikál.</span><span class="sxs-lookup"><span data-stu-id="1237d-240">The workflow step communicates with the Agent using a pair of Azure Service Bus message queues acting as a request/response channel.</span></span> <span data-ttu-id="1237d-241">Az ábra mutatja a megoldás magas szintű nézetét.</span><span class="sxs-lookup"><span data-stu-id="1237d-241">The figure shows a high level view of the solution.</span></span>

![2. ábra – a Feladatütemező ügynök felügyelő mintát használ az Azure-megoldásban rendelések kezeléséhez](./_images/scheduler-agent-supervisor-solution.png)

<span data-ttu-id="1237d-243">A munkafolyamat-lépés a az ügynök küldött üzenet ismertetése, és végezze el által időpontot.</span><span class="sxs-lookup"><span data-stu-id="1237d-243">The message sent to the Agent from a workflow step describes the order and includes the complete-by time.</span></span> <span data-ttu-id="1237d-244">Ha az ügynök választ kap a távoli szolgáltatás, a befejezéséhez által idő lejárta előtt, a Service Bus-üzenetsorba, amelyen a munkafolyamat figyeli a visszaküldés válaszüzenetet küld.</span><span class="sxs-lookup"><span data-stu-id="1237d-244">If the Agent receives a response from the remote service before the complete-by time expires, it posts a reply message on the Service Bus queue on which the workflow is listening.</span></span> <span data-ttu-id="1237d-245">A munkafolyamat-lépés a érvényes válasz üzenetet kap, amikor befejeződik a feldolgozás és a Feladatütemező beállítása a "ProcessState mező a sorrend szerinti feldolgozásra.</span><span class="sxs-lookup"><span data-stu-id="1237d-245">When the workflow step receives the valid reply message, it completes its processing and the Scheduler sets the \`ProcessState field of the order state to processed.</span></span> <span data-ttu-id="1237d-246">Ezen a ponton a rendelés feldolgozása sikeresen befejeződött.</span><span class="sxs-lookup"><span data-stu-id="1237d-246">At this point, the order processing has completed successfully.</span></span>

<span data-ttu-id="1237d-247">A befejezéséhez által idő lejárta előtt az ügynök választ kap a távoli szolgáltatás az ügynök egyszerűen leáll a feldolgozás, és leállítja a kezelési sorrendje.</span><span class="sxs-lookup"><span data-stu-id="1237d-247">If the complete-by time expires before the Agent receives a response from the remote service, the Agent simply halts its processing and terminates handling the order.</span></span> <span data-ttu-id="1237d-248">Hasonlóképpen ha kezelése sorrendje a munkafolyamat befejezéséhez által idő meghaladja, azt is megszakítja.</span><span class="sxs-lookup"><span data-stu-id="1237d-248">Similarly, if the workflow handling the order exceeds the complete-by time, it also terminates.</span></span> <span data-ttu-id="1237d-249">Mindkét esetben feldolgozását, de a befejezéséhez által idő marad készletében állapot tárolási sorrendjének állapotának azt jelzi, hogy a rendelés feldolgozásra idő telt tekinteni, a folyamat sikertelen volt.</span><span class="sxs-lookup"><span data-stu-id="1237d-249">In both cases, the state of the order in the state store remains set to processing, but the complete-by time indicates that the time for processing the order has passed and the process is deemed to have failed.</span></span> <span data-ttu-id="1237d-250">Vegye figyelembe, hogy az ügynököt, hozzáférhet a távoli szolgáltatás, vagy a munkafolyamat, milyen sorrendben (vagy mindkettőt) kezelő váratlanul leáll, ha az állapottároló található információk újra marad állítsa be a feldolgozásra, és végül egy lejárt befejezéséhez-által értéke lesz.</span><span class="sxs-lookup"><span data-stu-id="1237d-250">Note that if the Agent that's accessing the remote service, or the workflow that's handling the order (or both) terminate unexpectedly, the information in the state store will again remain set to processing and eventually will have an expired complete-by value.</span></span>

<span data-ttu-id="1237d-251">Ha az ügynök egy helyreállíthatatlan, nontransient hibát észlel, azt a távoli szolgáltatással való kapcsolatfelvételre tett kísérlet közben, egy hiba választ a munkafolyamat is küldheti.</span><span class="sxs-lookup"><span data-stu-id="1237d-251">If the Agent detects an unrecoverable, nontransient fault while it's trying to contact the remote service, it can send an error response back to the workflow.</span></span> <span data-ttu-id="1237d-252">Az ütemező sorrendje állapotának beállítása hibás, és indítson eseményt, amely riasztást küld a kezelőnek.</span><span class="sxs-lookup"><span data-stu-id="1237d-252">The Scheduler can set the status of the order to error and raise an event that alerts an operator.</span></span> <span data-ttu-id="1237d-253">Az operátor is próbálja manuálisan megoldani a hiba okát, és küldje el újra a sikertelen feldolgozási lépést.</span><span class="sxs-lookup"><span data-stu-id="1237d-253">The operator can then try to resolve the reason for the failure manually and resubmit the failed processing step.</span></span>

<span data-ttu-id="1237d-254">A felügyelő rendszeres időközönként megvizsgálja a állapot rendelések lejárt befejezéséhez-által értéket keresi.</span><span class="sxs-lookup"><span data-stu-id="1237d-254">The Supervisor periodically examines the state store looking for orders with an expired complete-by value.</span></span> <span data-ttu-id="1237d-255">Ha a felügyelő talál egy olyan rekordot, növeli a `FailureCount` mező.</span><span class="sxs-lookup"><span data-stu-id="1237d-255">If the Supervisor finds a record, it increments the `FailureCount` field.</span></span> <span data-ttu-id="1237d-256">Ha a hiba száma érték a megadott küszöbérték alatti, a felügyelő alaphelyzetbe állítja a `LockedBy` mező null, frissítések a `CompleteBy` mezőt egy új lejárati időt, és beállítja a a `ProcessState` mezőről függőben lévő.</span><span class="sxs-lookup"><span data-stu-id="1237d-256">If the failure count value is below a specified threshold value, the Supervisor resets the `LockedBy` field to null, updates the `CompleteBy` field with a new expiration time, and sets the `ProcessState` field to pending.</span></span> <span data-ttu-id="1237d-257">Az ütemező példányának itt megadott sorrendben átvételéhez, és hajtsa végre, a feldolgozás előtt.</span><span class="sxs-lookup"><span data-stu-id="1237d-257">An instance of the Scheduler can pick up this order and perform its processing as before.</span></span> <span data-ttu-id="1237d-258">Ha a hiba száma értéke meghaladja a megadott küszöbértéket, a hiba okát nontransient adottnak.</span><span class="sxs-lookup"><span data-stu-id="1237d-258">If the failure count value exceeds a specified threshold, the reason for the failure is assumed to be nontransient.</span></span> <span data-ttu-id="1237d-259">A felügyelő hiba a rendelés állapotát állítja be, és kivált egy eseményt, amely riasztást küld a kezelőnek.</span><span class="sxs-lookup"><span data-stu-id="1237d-259">The Supervisor sets the status of the order to error and raises an event that alerts an operator.</span></span>

> <span data-ttu-id="1237d-260">Ebben a példában a felügyelő vezettek be egy külön feldolgozói szerepkör.</span><span class="sxs-lookup"><span data-stu-id="1237d-260">In this example, the Supervisor is implemented in a separate worker role.</span></span> <span data-ttu-id="1237d-261">Stratégiák számos segítségével gondoskodik a felügyelő feladat futtatásának, beleértve a Azure Scheduler szolgáltatás használatakor (amelyek nem tévesztendők az ebben a mintában az ütemező összetevő).</span><span class="sxs-lookup"><span data-stu-id="1237d-261">You can use a variety of strategies to arrange for the Supervisor task to be run, including using the Azure Scheduler service (not to be confused with the Scheduler component in this pattern).</span></span> <span data-ttu-id="1237d-262">Az Azure Scheduler szolgáltatás kapcsolatos további információkért látogasson el a [Feladatütemező](https://azure.microsoft.com/services/scheduler/) lap.</span><span class="sxs-lookup"><span data-stu-id="1237d-262">For more information about the Azure Scheduler service, visit the [Scheduler](https://azure.microsoft.com/services/scheduler/) page.</span></span>

<span data-ttu-id="1237d-263">Jóllehet nem ebben a példában látható, a Feladatütemező módosítania kell a folyamatát és a sorrend szerez tudomást sorrendje beküldött tartani.</span><span class="sxs-lookup"><span data-stu-id="1237d-263">Although it isn't shown in this example, the Scheduler might need to keep the application that submitted the order informed about the progress and status of the order.</span></span> <span data-ttu-id="1237d-264">Az alkalmazás és az ütemező el különítve egymástól összes függőséget közöttük elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="1237d-264">The application and the Scheduler are isolated from each other to eliminate any dependencies between them.</span></span> <span data-ttu-id="1237d-265">Az alkalmazás rendelkezik, amelynek nincsenek saját ismeretei az ütemező példányának kezeli a sorrendben, és az ütemező nem észleli a mely adott alkalmazáspéldány közzétett sorrendje.</span><span class="sxs-lookup"><span data-stu-id="1237d-265">The application has no knowledge of which instance of the Scheduler is handling the order, and the Scheduler is unaware of which specific application instance posted the order.</span></span>

<span data-ttu-id="1237d-266">Ahhoz, hogy a rendelés állapota jelentendő, az alkalmazás használhatja a saját személyes válaszvárólistáját.</span><span class="sxs-lookup"><span data-stu-id="1237d-266">To allow the order status to be reported, the application could use its own private response queue.</span></span> <span data-ttu-id="1237d-267">A válasz várólista részleteit tartalmazzák a folyamat, amely lenne a következő információk belefoglalása az állapottárolóhoz küldött kérelem a lenne.</span><span class="sxs-lookup"><span data-stu-id="1237d-267">The details of this response queue would be included as part of the request sent to the submission process, which would include this information in the state store.</span></span> <span data-ttu-id="1237d-268">Az ütemező volna majd Yammerhez a várólistának a rendelés (kérelem érkezett, sorrendben befejeződött, sorrendje nem sikerült és így tovább) állapotát jelzi.</span><span class="sxs-lookup"><span data-stu-id="1237d-268">The Scheduler would then post messages to this queue indicating the status of the order (request received, order completed, order failed, and so on).</span></span> <span data-ttu-id="1237d-269">Az bele kell foglalni a rendelés azonosítója ezek az üzenetek, azokat is egyeztetés szükséges az eredeti kérést az alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="1237d-269">It should include the order ID in these messages so they can be correlated with the original request by the application.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="1237d-270">Útmutató és a kapcsolódó minták</span><span class="sxs-lookup"><span data-stu-id="1237d-270">Related patterns and guidance</span></span>

<span data-ttu-id="1237d-271">A következő mintákat és útmutatókat is lehet releváns ebben a mintában végrehajtása során:</span><span class="sxs-lookup"><span data-stu-id="1237d-271">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>
- <span data-ttu-id="1237d-272">[Ismételje meg a minta][retry-pattern].</span><span class="sxs-lookup"><span data-stu-id="1237d-272">[Retry pattern][retry-pattern].</span></span> <span data-ttu-id="1237d-273">Az ügynök ebben a mintában segítségével átlátható módon próbálja megismételni a műveletet fér hozzá a távoli szolgáltatás vagy az erőforrás, amely korábban nem sikerült.</span><span class="sxs-lookup"><span data-stu-id="1237d-273">An Agent can use this pattern to transparently retry an operation that accesses a remote service or resource that has previously failed.</span></span> <span data-ttu-id="1237d-274">Akkor használja, ha az elvárás, hogy a hiba oka átmeneti és javíthatóak.</span><span class="sxs-lookup"><span data-stu-id="1237d-274">Use when the expectation is that the cause of the failure is transient and can be corrected.</span></span>
- <span data-ttu-id="1237d-275">[Áramköri megszakító mintát](circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="1237d-275">[Circuit Breaker pattern](circuit-breaker.md).</span></span> <span data-ttu-id="1237d-276">Az ügynök ebben a mintában segítségével hibák elhárításához, amikor csatlakozik a távoli szolgáltatás vagy az erőforrás a változó időn tévő kezelni.</span><span class="sxs-lookup"><span data-stu-id="1237d-276">An Agent can use this pattern to handle faults that take a variable amount of time to correct when connecting to a remote service or resource.</span></span>
- <span data-ttu-id="1237d-277">[Kompenzációs tranzakció mintát](compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="1237d-277">[Compensating Transaction pattern](compensating-transaction.md).</span></span> <span data-ttu-id="1237d-278">Ha a munkafolyamat egy ütemező által végzett nem fejeződik be sikeresen, korábban végrehajtott munka visszavonása szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="1237d-278">If the workflow being performed by a Scheduler can't be completed successfully, it might be necessary to undo any work it's previously performed.</span></span> <span data-ttu-id="1237d-279">A tranzakció Compensating mintát ismerteti, hogyan ez érhető el a végleges konzisztencia modell az alábbi műveletek.</span><span class="sxs-lookup"><span data-stu-id="1237d-279">The Compensating Transaction pattern describes how this can be achieved for operations that follow the eventual consistency model.</span></span> <span data-ttu-id="1237d-280">Az ilyen típusú műveletek általában a egy összetett üzleti folyamatokat és munkafolyamatok végző Feladatütemező valósítják meg.</span><span class="sxs-lookup"><span data-stu-id="1237d-280">These types of operations are commonly implemented by a Scheduler that performs complex business processes and workflows.</span></span>
- <span data-ttu-id="1237d-281">[Aszinkron üzenetkezelési ismertetése](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="1237d-281">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="1237d-282">A Feladatütemező ügynök felügyelő mintában az összetevők általában egymástól leválasztott futtatni, és aszinkron kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="1237d-282">The components in the Scheduler Agent Supervisor pattern typically run decoupled from each other and communicate asynchronously.</span></span> <span data-ttu-id="1237d-283">Néhány a módszerekkel, amelyek segítségével valósítja meg az üzenet-várólistákból alapján aszinkron kommunikációt foglalja össze.</span><span class="sxs-lookup"><span data-stu-id="1237d-283">Describes some of the approaches that can be used to implement asynchronous communication based on message queues.</span></span>
- <span data-ttu-id="1237d-284">[Vezető választás mintát](leader-election.md).</span><span class="sxs-lookup"><span data-stu-id="1237d-284">[Leader Election pattern](leader-election.md).</span></span> <span data-ttu-id="1237d-285">A műveleteket, megakadályozhatja, hogy a megkísérli a folytatást sikertelen ugyanezt a felügyelő több példány koordinálására szükség lehet.</span><span class="sxs-lookup"><span data-stu-id="1237d-285">It might be necessary to coordinate the actions of multiple instances of a Supervisor to prevent them from attempting to recover the same failed process.</span></span> <span data-ttu-id="1237d-286">A vezető választás mintát ehhez ismerteti.</span><span class="sxs-lookup"><span data-stu-id="1237d-286">The Leader Election pattern describes how to do this.</span></span>
- <span data-ttu-id="1237d-287">[Architektúra: A Feladatütemező-ügynök – felügyelő mintát](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) Clemens Vasters blog</span><span class="sxs-lookup"><span data-stu-id="1237d-287">[Cloud Architecture: The Scheduler-Agent-Supervisor Pattern](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) on Clemens Vasters' blog</span></span>
- [<span data-ttu-id="1237d-288">Folyamat Manager minta</span><span class="sxs-lookup"><span data-stu-id="1237d-288">Process Manager pattern</span></span>](http://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html)
- <span data-ttu-id="1237d-289">[6 – referencia: Egy Saga a Sagas](https://msdn.microsoft.com/library/jj591569.aspx).</span><span class="sxs-lookup"><span data-stu-id="1237d-289">[Reference 6: A Saga on Sagas](https://msdn.microsoft.com/library/jj591569.aspx).</span></span> <span data-ttu-id="1237d-290">Egy példa látható, hogyan CQRS mintát használja-e a folyamat manager (a CQRS út útmutatást része).</span><span class="sxs-lookup"><span data-stu-id="1237d-290">An example showing how the CQRS pattern uses a process manager (part of the CQRS Journey guidance).</span></span>
- [<span data-ttu-id="1237d-291">A Microsoft Azure Scheduler</span><span class="sxs-lookup"><span data-stu-id="1237d-291">Microsoft Azure Scheduler</span></span>](https://azure.microsoft.com/services/scheduler/)

[retry-pattern]: ./retry.md
