---
title: Feladatütemező ügynök felügyeleti mintája
titleSuffix: Cloud Design Patterns
description: Koordinálhat egy műveletkészletet egy elosztott szolgáltatáskészleten és más távoli erőforrásokon.
keywords: tervezési minta
author: dragon119
ms.date: 06/23/2017
ms.topic: design-pattern
ms.service: architecture-center
ms.subservice: cloud-fundamentals
ms.custom: seodec18
ms.openlocfilehash: bf432444587216d7f635b0a5f26fed9223e85c44
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54482051"
---
# <a name="scheduler-agent-supervisor-pattern"></a><span data-ttu-id="58031-104">Feladatütemező ügynök felügyeleti mintája</span><span class="sxs-lookup"><span data-stu-id="58031-104">Scheduler Agent Supervisor pattern</span></span>

[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="58031-105">Elosztott műveleteket egyetlen műveletként koordinálhat.</span><span class="sxs-lookup"><span data-stu-id="58031-105">Coordinate a set of distributed actions as a single operation.</span></span> <span data-ttu-id="58031-106">Ha a műveletek bármelyike sikertelen, próbálja átlátható módon kezelni a hibákat, különben elképzelhető, hogy az elvégzett munkát vissza kell vonni, így a teljes művelet egészében lesz sikeres vagy sikertelen.</span><span class="sxs-lookup"><span data-stu-id="58031-106">If any of the actions fail, try to handle the failures transparently, or else undo the work that was performed, so the entire operation succeeds or fails as a whole.</span></span> <span data-ttu-id="58031-107">Ez rugalmasságot nyújthat az elosztott rendszereknek azáltal, hogy lehetővé teszi a helyreállítást és az újrapróbálkozást az átmeneti kivételek, a hosszan tartó hibák és a folyamathibák következtében sikertelen műveletek esetében.</span><span class="sxs-lookup"><span data-stu-id="58031-107">This can add resiliency to a distributed system, by enabling it to recover and retry actions that fail due to transient exceptions, long-lasting faults, and process failures.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="58031-108">Kontextus és probléma</span><span class="sxs-lookup"><span data-stu-id="58031-108">Context and problem</span></span>

<span data-ttu-id="58031-109">Egy alkalmazás több lépésből álló feladatokat hajt végre – a lépések némelyike esetleg távoli szolgáltatásokat hív meg vagy távoli erőforrásokhoz fér hozzá.</span><span class="sxs-lookup"><span data-stu-id="58031-109">An application performs tasks that include a number of steps, some of which might invoke remote services or access remote resources.</span></span> <span data-ttu-id="58031-110">Az egyes lépések egymástól függetlenek is lehetnek, de azokat a feladatot megvalósító alkalmazáslogika vezényli.</span><span class="sxs-lookup"><span data-stu-id="58031-110">The individual steps might be independent of each other, but they are orchestrated by the application logic that implements the task.</span></span>

<span data-ttu-id="58031-111">Amikor csak lehetséges, az alkalmazásnak biztosítania kell, hogy a feladat befejeződjön, valamint a távoli szolgáltatásokhoz vagy erőforrásokhoz való hozzáférés során esetlegesen fellépő hibákat el kell hárítania.</span><span class="sxs-lookup"><span data-stu-id="58031-111">Whenever possible, the application should ensure that the task runs to completion and resolve any failures that might occur when accessing remote services or resources.</span></span> <span data-ttu-id="58031-112">A hibáknak számos oka lehet.</span><span class="sxs-lookup"><span data-stu-id="58031-112">Failures can occur for many reasons.</span></span> <span data-ttu-id="58031-113">Előfordulhat, hogy a hálózat nem működik, a kommunikáció megszakadt, egy távoli szolgáltatás nem válaszol vagy instabil, vagy egy távoli erőforrás átmenetileg nem érhető el, például erőforrás-korlátozás miatt.</span><span class="sxs-lookup"><span data-stu-id="58031-113">For example, the network might be down, communications could be interrupted, a remote service might be unresponsive or in an unstable state, or a remote resource might be temporarily inaccessible, perhaps due to resource constraints.</span></span> <span data-ttu-id="58031-114">A legtöbb esetben a hibák átmenetiek, és használatával kezelhetők a [újrapróbálkozási minta](./retry.md).</span><span class="sxs-lookup"><span data-stu-id="58031-114">In many cases the failures will be transient and can be handled by using the [Retry pattern](./retry.md).</span></span>

<span data-ttu-id="58031-115">Ha az alkalmazás nem könnyen helyreállítható állandó hibát észlel, a teljes művelet integritásának biztosítása érdekében képesnek kell lennie visszaállítani a rendszert egy konzisztens állapotba.</span><span class="sxs-lookup"><span data-stu-id="58031-115">If the application detects a more permanent fault it can't easily recover from, it must be able to restore the system to a consistent state and ensure integrity of the entire operation.</span></span>

## <a name="solution"></a><span data-ttu-id="58031-116">Megoldás</span><span class="sxs-lookup"><span data-stu-id="58031-116">Solution</span></span>

<span data-ttu-id="58031-117">A feladatütemező ügynök felügyeleti mintája az alábbi aktorokat határozza meg.</span><span class="sxs-lookup"><span data-stu-id="58031-117">The Scheduler Agent Supervisor pattern defines the following actors.</span></span> <span data-ttu-id="58031-118">Ezek az aktorok szervezik meg a teljes feladat részeként végrehajtandó lépéseket.</span><span class="sxs-lookup"><span data-stu-id="58031-118">These actors orchestrate the steps to be performed as part of the overall task.</span></span>

- <span data-ttu-id="58031-119">Az **ütemező** gondoskodik a feladat lépéseinek végrehajtásáról, és összehangolja a működésüket.</span><span class="sxs-lookup"><span data-stu-id="58031-119">The **Scheduler** arranges for the steps that make up the task to be executed and orchestrates their operation.</span></span> <span data-ttu-id="58031-120">Ezek a lépések folyamattá vagy munkafolyamattá egyesíthetők.</span><span class="sxs-lookup"><span data-stu-id="58031-120">These steps can be combined into a pipeline or workflow.</span></span> <span data-ttu-id="58031-121">Az ütemező felelős azért, hogy a munkafolyamat lépései a helyes sorrendben kövessék egymást.</span><span class="sxs-lookup"><span data-stu-id="58031-121">The Scheduler is responsible for ensuring that the steps in this workflow are performed in the right order.</span></span> <span data-ttu-id="58031-122">Ahogy az egyes lépések végbemennek, az ütemező rögzíti a munkafolyamat állapotát, például: „a lépés még nem kezdődött el”, „a lépés fut”, vagy a „lépés befejeződött”.</span><span class="sxs-lookup"><span data-stu-id="58031-122">As each step is performed, the Scheduler records the state of the workflow, such as "step not yet started," "step running," or "step completed."</span></span> <span data-ttu-id="58031-123">Az állapotot leíró információnak tartalmaznia kell a lépés befejezéséhez engedélyezett idő felső határát („befejezési idő”).</span><span class="sxs-lookup"><span data-stu-id="58031-123">The state information should also include an upper limit of the time allowed for the step to finish, called the complete-by time.</span></span> <span data-ttu-id="58031-124">Ha egy lépéshez szükség van távoli szolgáltatáshoz vagy erőforráshoz való hozzáférésre, az ütemező meghívja a megfelelő ügynököt, és átadja neki az elvégzendő munka részleteit.</span><span class="sxs-lookup"><span data-stu-id="58031-124">If a step requires access to a remote service or resource, the Scheduler invokes the appropriate Agent, passing it the details of the work to be performed.</span></span> <span data-ttu-id="58031-125">Az ütemező általában aszinkron kérés/válasz típusú üzenetküldés formájában kommunikál az ügynökökkel.</span><span class="sxs-lookup"><span data-stu-id="58031-125">The Scheduler typically communicates with an Agent using asynchronous request/response messaging.</span></span> <span data-ttu-id="58031-126">Ez üzenetsorok segítségével valósítható meg, bár egyéb elosztott üzenetkezelési technológiák is használhatók.</span><span class="sxs-lookup"><span data-stu-id="58031-126">This can be implemented using queues, although other distributed messaging technologies could be used instead.</span></span>

    > <span data-ttu-id="58031-127">Az ütemező a [folyamatkezelő mintájában](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html) található folyamatkezelőhöz hasonló funkciót tölt be.</span><span class="sxs-lookup"><span data-stu-id="58031-127">The Scheduler performs a similar function to the Process Manager in the [Process Manager pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html).</span></span> <span data-ttu-id="58031-128">A tényleges munkafolyamatot általában egy munkafolyamat-motor definiálja és implementálja, amelyet az ütemező irányít.</span><span class="sxs-lookup"><span data-stu-id="58031-128">The actual workflow is typically defined and implemented by a workflow engine that's controlled by the Scheduler.</span></span> <span data-ttu-id="58031-129">Ez a megközelítés leválasztja a munkafolyamat üzleti logikáját az ütemezőről.</span><span class="sxs-lookup"><span data-stu-id="58031-129">This approach decouples the business logic in the workflow from the Scheduler.</span></span>

- <span data-ttu-id="58031-130">Az **ügynök** olyan logikát tartalmaz, amely magában foglalja a feladat lépéseiben hivatkozott távoli szolgáltatások hívását vagy távoli erőforrásokhoz való hozzáférést.</span><span class="sxs-lookup"><span data-stu-id="58031-130">The **Agent** contains logic that encapsulates a call to a remote service, or access to a remote resource referenced by a step in a task.</span></span> <span data-ttu-id="58031-131">Általában minden ügynök egyetlen szolgáltatáshoz vagy erőforráshoz csomagolja a hívásokat, és alkalmazza a megfelelő hibakezelést és újrapróbálkozási logikát (időtúllépési megkötés függvényében, amelyről a későbbiekben olvashat).</span><span class="sxs-lookup"><span data-stu-id="58031-131">Each Agent typically wraps calls to a single service or resource, implementing the appropriate error handling and retry logic (subject to a timeout constraint, described later).</span></span> <span data-ttu-id="58031-132">Ha az ütemező által futtatott munkafolyamat lépései több szolgáltatást és erőforrást használnak különböző lépéseken keresztül, minden lépés hivatkozhat más ügynökre (ez a minta egy implementálási részlete).</span><span class="sxs-lookup"><span data-stu-id="58031-132">If the steps in the workflow being run by the Scheduler use several services and resources across different steps, each step might reference a different Agent (this is an implementation detail of the pattern).</span></span>

- <span data-ttu-id="58031-133">A **felügyelő** figyeli az ütemező által végrehajtott feladat lépéseinek állapotát.</span><span class="sxs-lookup"><span data-stu-id="58031-133">The **Supervisor** monitors the status of the steps in the task being performed by the Scheduler.</span></span> <span data-ttu-id="58031-134">Rendszeres időközönként fut (a gyakorisága rendszerspecifikus), és megvizsgálja az ütemező által fenntartott lépések állapotát.</span><span class="sxs-lookup"><span data-stu-id="58031-134">It runs periodically (the frequency will be system specific), and examines the status of steps maintained by the Scheduler.</span></span> <span data-ttu-id="58031-135">Ha időtúllépést vagy sikertelen lépést észlel, a megfelelő ügynökkel helyreállíttatja a lépést, vagy elvégezteti a megfelelő helyreigazító műveletet (ez egyes lépések állapotának módosításával járhat).</span><span class="sxs-lookup"><span data-stu-id="58031-135">If it detects any that have timed out or failed, it arranges for the appropriate Agent to recover the step or execute the appropriate remedial action (this might involve modifying the status of a step).</span></span> <span data-ttu-id="58031-136">Vegye figyelembe, hogy a helyreállítási vagy helyreigazító műveleteket az ütemező és az ügynökök végzik.</span><span class="sxs-lookup"><span data-stu-id="58031-136">Note that the recovery or remedial actions are implemented by the Scheduler and Agents.</span></span> <span data-ttu-id="58031-137">A felügyelő csupán kérést küld a műveletek elvégzésére.</span><span class="sxs-lookup"><span data-stu-id="58031-137">The Supervisor should simply request that these actions be performed.</span></span>

<span data-ttu-id="58031-138">Az ütemező, az ügynök és a felügyelő logikai összetevők, amelyek fizikai implementálása a használt technológiától függ.</span><span class="sxs-lookup"><span data-stu-id="58031-138">The Scheduler, Agent, and Supervisor are logical components and their physical implementation depends on the technology being used.</span></span> <span data-ttu-id="58031-139">Például számos logikai ügynök implementálható egyetlen webszolgáltatás részeként.</span><span class="sxs-lookup"><span data-stu-id="58031-139">For example, several logical agents might be implemented as part of a single web service.</span></span>

<span data-ttu-id="58031-140">Az ütemező az állapottároló elnevezésű tartós adattárban információkat tárol a feladat és az egyes lépések állapotáról.</span><span class="sxs-lookup"><span data-stu-id="58031-140">The Scheduler maintains information about the progress of the task and the state of each step in a durable data store, called the state store.</span></span> <span data-ttu-id="58031-141">A felügyelő az információk alapján segítséget nyújt annak meghatározásában, meghiúsult-e egy lépés, vagy sem.</span><span class="sxs-lookup"><span data-stu-id="58031-141">The Supervisor can use this information to help determine whether a step has failed.</span></span> <span data-ttu-id="58031-142">Az ábra bemutatja az ütemező, az ügynökök, a felügyelő és az állapottároló közötti kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="58031-142">The figure illustrates the relationship between the Scheduler, the Agents, the Supervisor, and the state store.</span></span>

![1. ábra – Az aktorok a Feladatütemező ügynök felügyeleti mintájában](./_images/scheduler-agent-supervisor-pattern.png)

> [!NOTE]
> <span data-ttu-id="58031-144">Ezen az ábrán a minta egyszerűsített változata látható.</span><span class="sxs-lookup"><span data-stu-id="58031-144">This diagram shows a simplified version of the pattern.</span></span> <span data-ttu-id="58031-145">Valós alkalmazáskor az ütemező több példánya is futhat párhuzamosan, mindegyik feladatok alegységeként.</span><span class="sxs-lookup"><span data-stu-id="58031-145">In a real implementation, there might be many instances of the Scheduler running concurrently, each a subset of tasks.</span></span> <span data-ttu-id="58031-146">A rendszer futtathat több példányt minden ügynökből, vagy akár több felügyelőt is.</span><span class="sxs-lookup"><span data-stu-id="58031-146">Similarly, the system could run multiple instances of each Agent, or even multiple Supervisors.</span></span> <span data-ttu-id="58031-147">Ebben az esetben a felügyelőknek koordinálniuk kell egymással a munkájukat, hogy ne ugyanazokat a sikertelen lépéseket és feladatokat próbálják helyreállítani.</span><span class="sxs-lookup"><span data-stu-id="58031-147">In this case, Supervisors must coordinate their work with each other carefully to ensure that they don’t compete to recover the same failed steps and tasks.</span></span> <span data-ttu-id="58031-148">A [vezetőválasztási minta](./leader-election.md) egy lehetséges megoldást jelent erre a problémára.</span><span class="sxs-lookup"><span data-stu-id="58031-148">The [Leader Election pattern](./leader-election.md) provides one possible solution to this problem.</span></span>

<span data-ttu-id="58031-149">Amikor az alkalmazás készen áll egy feladat futtatására, kérést küld az ütemezőnek.</span><span class="sxs-lookup"><span data-stu-id="58031-149">When the application is ready to run a task, it submits a request to the Scheduler.</span></span> <span data-ttu-id="58031-150">Az ütemező információkat rögzít az állapottárolóba a feladat és a lépések kezdeti állapotáról (például: meg nem kezdett lépés), majd elkezdi végrehajtani a munkafolyamat által meghatározott műveleteket.</span><span class="sxs-lookup"><span data-stu-id="58031-150">The Scheduler records initial state information about the task and its steps (for example, step not yet started) in the state store and then starts performing the operations defined by the workflow.</span></span> <span data-ttu-id="58031-151">Egy-egy lépés megkezdésekor az ütemező frissíti az adattárolóban az adott lépés állapotával kapcsolatos információt (például: a lépés fut).</span><span class="sxs-lookup"><span data-stu-id="58031-151">As the Scheduler starts each step, it updates the information about the state of that step in the state store (for example, step running).</span></span>

<span data-ttu-id="58031-152">Ha egy lépés egy távoli szolgáltatásra vagy erőforrásra hivatkozik, az ütemező üzenetet küld a megfelelő ügynöknek.</span><span class="sxs-lookup"><span data-stu-id="58031-152">If a step references a remote service or resource, the Scheduler sends a message to the appropriate Agent.</span></span> <span data-ttu-id="58031-153">Az üzenet tartalmazza azt az információt, amelyet az ügynöknek továbbítania kell a szolgáltatásnak, vagy amellyel hozzáférhet az erőforráshoz, valamint tartalmazza a művelet befejezési idejét is.</span><span class="sxs-lookup"><span data-stu-id="58031-153">The message contains the information that the Agent needs to pass to the service or access the resource, in addition to the complete-by time for the operation.</span></span> <span data-ttu-id="58031-154">Ha az ügynök sikeresen teljesíti a műveletet, választ küld az ütemezőnek.</span><span class="sxs-lookup"><span data-stu-id="58031-154">If the Agent completes its operation successfully, it returns a response to the Scheduler.</span></span> <span data-ttu-id="58031-155">Az ütemező így frissítheti az állapotinformációt az állapottárolóban (például: lépés befejezve), és végrehajthatja a következő lépést.</span><span class="sxs-lookup"><span data-stu-id="58031-155">The Scheduler can then update the state information in the state store (for example, step completed) and perform the next step.</span></span> <span data-ttu-id="58031-156">Ez a folyamat folytatódik a teljes feladat befejezéséig.</span><span class="sxs-lookup"><span data-stu-id="58031-156">This process continues until the entire task is complete.</span></span>

<span data-ttu-id="58031-157">Egy ügynök bármilyen újrapróbálkozási logikát alkalmazhat, amely a feladatának teljesítéséhez szükséges.</span><span class="sxs-lookup"><span data-stu-id="58031-157">An Agent can implement any retry logic that's necessary to perform its work.</span></span> <span data-ttu-id="58031-158">Ha azonban az ügynök nem teljesíti a feladatot a befejezési idő lejárta előtt, az ütemező a műveletet sikertelenként fogja kezelni.</span><span class="sxs-lookup"><span data-stu-id="58031-158">However, if the Agent doesn't complete its work before the complete-by period expires, the Scheduler will assume that the operation has failed.</span></span> <span data-ttu-id="58031-159">Ebben az esetben az ügynöknek be kell fejeznie a tevékenységét, és nem szabad visszaküldenie semmit az ütemezőnek (még hibaüzenetet sem), valamint nem szabad helyreállítással próbálkoznia.</span><span class="sxs-lookup"><span data-stu-id="58031-159">In this case, the Agent should stop its work and not try to return anything to the Scheduler (not even an error message), or try any form of recovery.</span></span> <span data-ttu-id="58031-160">A korlátozás oka, hogy miután egy lépés túllépte az időkorlátot vagy meghiúsult, az ügynök egy másik példánya ütemezve lehet a sikertelen lépés futtatására (erről a folyamatról a későbbiekben olvashat).</span><span class="sxs-lookup"><span data-stu-id="58031-160">The reason for this restriction is that, after a step has timed out or failed, another instance of the Agent might be scheduled to run the failing step (this process is described later).</span></span>

<span data-ttu-id="58031-161">Ha az ügynök nem tudja végrehajtani a feladatát, az ütemező nem kap választ.</span><span class="sxs-lookup"><span data-stu-id="58031-161">If the Agent fails, the Scheduler won't receive a response.</span></span> <span data-ttu-id="58031-162">A minta nem tesz különbséget az időkorlátot túllépő és a valóban sikertelen lépések között.</span><span class="sxs-lookup"><span data-stu-id="58031-162">The pattern doesn't make a distinction between a step that has timed out and one that has genuinely failed.</span></span>

<span data-ttu-id="58031-163">Ha egy lépés túllépi az időkorlátot vagy meghiúsul, az állapottárolóba bekerül egy rekord arról, hogy a lépés fut, de a befejezési idő lejárt.</span><span class="sxs-lookup"><span data-stu-id="58031-163">If a step times out or fails, the state store will contain a record that indicates that the step is running, but the complete-by time will have passed.</span></span> <span data-ttu-id="58031-164">A felügyelő ehhez hasonló lépéseket keres, és megpróbálja helyreállítani őket.</span><span class="sxs-lookup"><span data-stu-id="58031-164">The Supervisor looks for steps like this and tries to recover them.</span></span> <span data-ttu-id="58031-165">Egy lehetséges stratégia a felügyelő számára a befejezési időérték frissítése a lépés elvégzéséhez szükséges idő meghosszabbításának céljából, majd a lejárt lépést azonosító üzenet küldése az ütemezőnek. Ezután az ütemező megpróbálhatja megismételni a lépést.</span><span class="sxs-lookup"><span data-stu-id="58031-165">One possible strategy is for the Supervisor to update the complete-by value to extend the time available to complete the step, and then send a message to the Scheduler identifying the step that has timed out. The Scheduler can then try to repeat this step.</span></span> <span data-ttu-id="58031-166">Ehhez a kialakításhoz azonban szükséges, hogy a feladatok idempotensek legyenek.</span><span class="sxs-lookup"><span data-stu-id="58031-166">However, this design requires the tasks to be idempotent.</span></span>

<span data-ttu-id="58031-167">Előfordulhat, hogy a felügyelőnek meg kell akadályoznia ugyanazon lépés végrehajtásának újrapróbálását, ha a lépés folyamatosan meghiúsul vagy lejár. Ennek kivitelezéséhez a felügyelő egy ismétlésszámot tarthat fenn az állapottárolóban minden egyes lépéshez, az állapotinformációval együtt.</span><span class="sxs-lookup"><span data-stu-id="58031-167">The Supervisor might need to prevent the same step from being retried if it continually fails or times out. To do this, the Supervisor could maintain a retry count for each step, along with the state information, in the state store.</span></span> <span data-ttu-id="58031-168">Ha ez a szám túllép egy előre meghatározott küszöbértéket, a felügyelő másik stratégiaként hosszabb ideig várhat, mielőtt értesítené az ütemezőt, hogy az próbálja újra a lépést, annak reményében, hogy a várakozás alatt a probléma megoldódik.</span><span class="sxs-lookup"><span data-stu-id="58031-168">If this count exceeds a predefined threshold the Supervisor can adopt a strategy of waiting for an extended period before notifying the Scheduler that it should retry the step, in the expectation that the fault will be resolved during this period.</span></span> <span data-ttu-id="58031-169">A felügyelő másik megoldásként kérést küldhet az ütemezőnek a teljes feladat visszavonására egy [kompenzáló tranzakciós minta](./compensating-transaction.md) alkalmazásával.</span><span class="sxs-lookup"><span data-stu-id="58031-169">Alternatively, the Supervisor can send a message to the Scheduler to request the entire task be undone by implementing a [Compensating Transaction pattern](./compensating-transaction.md).</span></span> <span data-ttu-id="58031-170">Ennek a megközelítésnek a sikeressége azon múlik, biztosítják-e az ügynökök és az ütemező a sikeresen befejeződött lépések kompenzáló műveleteinek implementálásához szükséges információkat.</span><span class="sxs-lookup"><span data-stu-id="58031-170">This approach will depend on the Scheduler and Agents providing the information necessary to implement the compensating operations for each step that completed successfully.</span></span>

> <span data-ttu-id="58031-171">A felügyelőnek nem célja sem az ütemező és az ügynökök monitorozása, sem hiba esetén az újraindításuk.</span><span class="sxs-lookup"><span data-stu-id="58031-171">It isn't the purpose of the Supervisor to monitor the Scheduler and Agents, and restart them if they fail.</span></span> <span data-ttu-id="58031-172">A rendszer e részét az ezeket az összetevőket futtató infrastruktúrának kell kezelnie.</span><span class="sxs-lookup"><span data-stu-id="58031-172">This aspect of the system should be handled by the infrastructure these components are running in.</span></span> <span data-ttu-id="58031-173">A felügyelőnek szintén nem feladata ismerni a tényleges üzleti műveleteket, amelyeket az ütemező által végzett feladatok futtatnak (beleértve a sikertelen feladatok esetében történő kompenzálás módját).</span><span class="sxs-lookup"><span data-stu-id="58031-173">Similarly, the Supervisor shouldn't have knowledge of the actual business operations that the tasks being performed by the Scheduler are running (including how to compensate should these tasks fail).</span></span> <span data-ttu-id="58031-174">Ez az ütemező által alkalmazott munkafolyamat-logika feladata.</span><span class="sxs-lookup"><span data-stu-id="58031-174">This is the purpose of the workflow logic implemented by the Scheduler.</span></span> <span data-ttu-id="58031-175">A felügyelő egyetlen felelőssége, hogy meghatározza, meghiúsult-e egy lépés, és megszervezze a megismétlését vagy a sikertelen lépést tartalmazó teljes feladat visszavonását.</span><span class="sxs-lookup"><span data-stu-id="58031-175">The sole responsibility of the Supervisor is to determine whether a step has failed and arrange either for it to be repeated or for the entire task containing the failed step to be undone.</span></span>

<span data-ttu-id="58031-176">Ha az ütemező hiba után indult újra, vagy az ütemező által végzett munkafolyamat váratlanul leállt, az ütemező képes meghatározni a hiba beálltakor végzett feladatok állapotát, és kész folytatni őket attól a ponttól.</span><span class="sxs-lookup"><span data-stu-id="58031-176">If the Scheduler is restarted after a failure, or the workflow being performed by the Scheduler terminates unexpectedly, the Scheduler should be able to determine the status of any inflight task that it was handling when it failed, and be prepared to resume this task from that point.</span></span> <span data-ttu-id="58031-177">A folyamat implementálásának részletei nagy valószínűséggel rendszerspecifikusak.</span><span class="sxs-lookup"><span data-stu-id="58031-177">The implementation details of this process are likely to be system specific.</span></span> <span data-ttu-id="58031-178">Ha a feladat nem helyreállítható, szükség lehet a feladat által már elvégzett munka visszavonására.</span><span class="sxs-lookup"><span data-stu-id="58031-178">If the task can't be recovered, it might be necessary to undo the work already performed by the task.</span></span> <span data-ttu-id="58031-179">Ehhez szükséges lehet egy [kompenzáló tranzakció](./compensating-transaction.md) implementálása.</span><span class="sxs-lookup"><span data-stu-id="58031-179">This might also require implementing a [compensating transaction](./compensating-transaction.md).</span></span>

<span data-ttu-id="58031-180">Ennek a mintának az egyik legfontosabb előnye a váratlan ideiglenes vagy nem helyreállítható hibák esetén biztosított rugalmasság.</span><span class="sxs-lookup"><span data-stu-id="58031-180">The key advantage of this pattern is that the system is resilient in the event of unexpected temporary or unrecoverable failures.</span></span> <span data-ttu-id="58031-181">A rendszer tervezhető úgy, hogy kijavítsa önmagát.</span><span class="sxs-lookup"><span data-stu-id="58031-181">The system can be constructed to be self healing.</span></span> <span data-ttu-id="58031-182">Például ha hiba lép fel egy ügynök vagy az ütemező működésében, elindíthat egy új példányt, és a felügyelő segítségével folytathatja a feladatokat.</span><span class="sxs-lookup"><span data-stu-id="58031-182">For example, if an Agent or the Scheduler fails, a new one can be started and the Supervisor can arrange for a task to be resumed.</span></span> <span data-ttu-id="58031-183">Ha a felügyelő működésében lép fel hiba, elindíthat egy másik példányt, amellyel onnan folytathatja a munkát, ahol a hiba történt.</span><span class="sxs-lookup"><span data-stu-id="58031-183">If the Supervisor fails, another instance can be started and can take over from where the failure occurred.</span></span> <span data-ttu-id="58031-184">Ha a felügyelő rendszeres időközönként ütemezve fut, automatikusan indítható új példány egy előre meghatározott időszak után.</span><span class="sxs-lookup"><span data-stu-id="58031-184">If the Supervisor is scheduled to run periodically, a new instance can be automatically started after a predefined interval.</span></span> <span data-ttu-id="58031-185">Az állapottároló replikálható a még nagyobb fokú rugalmasság elérése érdekében.</span><span class="sxs-lookup"><span data-stu-id="58031-185">The state store can be replicated to reach an even greater degree of resiliency.</span></span>

## <a name="issues-and-considerations"></a><span data-ttu-id="58031-186">Problémák és megfontolandó szempontok</span><span class="sxs-lookup"><span data-stu-id="58031-186">Issues and considerations</span></span>

<span data-ttu-id="58031-187">A minta megvalósítása során az alábbi pontokat vegye figyelembe:</span><span class="sxs-lookup"><span data-stu-id="58031-187">You should consider the following points when deciding how to implement this pattern:</span></span>

- <span data-ttu-id="58031-188">Ez a minta nehezebben implementálható, és szükséges hozzá a rendszer minden lehetséges hibaállapotának alapos tesztelése.</span><span class="sxs-lookup"><span data-stu-id="58031-188">This pattern can be difficult to implement and requires thorough testing of each possible failure mode of the system.</span></span>

- <span data-ttu-id="58031-189">Az ütemező által implementált helyreállítási/újrapróbálkozási logika összetett, és függ az állapottárolóban tárolt állapotinformációtól.</span><span class="sxs-lookup"><span data-stu-id="58031-189">The recovery/retry logic implemented by the Scheduler is complex and dependent on state information held in the state store.</span></span> <span data-ttu-id="58031-190">Előfordulhat, hogy rögzíteni kell a kompenzáló tranzakció implementálásához szükséges információt egy tartós adattárban.</span><span class="sxs-lookup"><span data-stu-id="58031-190">It might also be necessary to record the information required to implement a compensating transaction in a durable data store.</span></span>

- <span data-ttu-id="58031-191">Fontos, milyen gyakran fut a felügyelő.</span><span class="sxs-lookup"><span data-stu-id="58031-191">How often the Supervisor runs will be important.</span></span> <span data-ttu-id="58031-192">Elég gyakran kell futnia annak megakadályozásához, hogy a hibás lépések hosszú ideig blokkoljanak egy alkalmazást, de nem olyan gyakran, hogy többletterheléssé váljon.</span><span class="sxs-lookup"><span data-stu-id="58031-192">It should run often enough to prevent any failed steps from blocking an application for an extended period, but it shouldn't run so often that it becomes an overhead.</span></span>

- <span data-ttu-id="58031-193">Az ügynökök által végzett lépések többször is futtathatók.</span><span class="sxs-lookup"><span data-stu-id="58031-193">The steps performed by an Agent could be run more than once.</span></span> <span data-ttu-id="58031-194">Az ezeket a lépéseket implementáló logikának idempotensnek kell lennie.</span><span class="sxs-lookup"><span data-stu-id="58031-194">The logic that implements these steps should be idempotent.</span></span>

## <a name="when-to-use-this-pattern"></a><span data-ttu-id="58031-195">Mikor érdemes ezt a mintát használni?</span><span class="sxs-lookup"><span data-stu-id="58031-195">When to use this pattern</span></span>

<span data-ttu-id="58031-196">Használja ezt a mintát, ha egy elosztott környezetben, például felhőben futó folyamatnak rugalmasnak kell lennie a kommunikációs és/vagy működési hibákkal szemben.</span><span class="sxs-lookup"><span data-stu-id="58031-196">Use this pattern when a process that runs in a distributed environment, such as the cloud, must be resilient to communications failure and/or operational failure.</span></span>

<span data-ttu-id="58031-197">Nem érdemes ezt a mintát használni olyan feladatok esetében, amelyek nem hívnak meg távoli szolgáltatásokat vagy nem férnek hozzá távoli erőforrásokhoz.</span><span class="sxs-lookup"><span data-stu-id="58031-197">This pattern might not be suitable for tasks that don't invoke remote services or access remote resources.</span></span>

## <a name="example"></a><span data-ttu-id="58031-198">Példa</span><span class="sxs-lookup"><span data-stu-id="58031-198">Example</span></span>

<span data-ttu-id="58031-199">Egy elektronikus kereskedelmi rendszert implementáló webalkalmazás lett üzembe helyezve a Microsoft Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="58031-199">A web application that implements an ecommerce system has been deployed on Microsoft Azure.</span></span> <span data-ttu-id="58031-200">Az alkalmazás segítségével a felhasználók böngészhetnek az elérhető termékek között, és rendeléseket adhatnak le.</span><span class="sxs-lookup"><span data-stu-id="58031-200">Users can run this application to browse the available products and to place orders.</span></span> <span data-ttu-id="58031-201">A felhasználói felület webes szerepkörként fut, az alkalmazás rendelésfeldolgozó elemei pedig feldolgozói szerepkörökként vannak implementálva.</span><span class="sxs-lookup"><span data-stu-id="58031-201">The user interface runs as a web role, and the order processing elements of the application are implemented as a set of worker roles.</span></span> <span data-ttu-id="58031-202">A rendelésfeldolgozó logika egy része magában foglalja a távoli szolgáltatásokhoz való hozzáférést. A rendszer ezen aspektusában gyakrabban előfordulhatnak átmeneti vagy hosszan tartó hibák.</span><span class="sxs-lookup"><span data-stu-id="58031-202">Part of the order processing logic involves accessing a remote service, and this aspect of the system could be prone to transient or more long-lasting faults.</span></span> <span data-ttu-id="58031-203">Ezért a tervezők a Feladatütemező ügynök felügyeleti mintáját használták a rendszer rendelésfeldolgozó elemeinek implementálásához.</span><span class="sxs-lookup"><span data-stu-id="58031-203">For this reason, the designers used the Scheduler Agent Supervisor pattern to implement the order processing elements of the system.</span></span>

<span data-ttu-id="58031-204">Amikor az ügyfél lead egy rendelést, az alkalmazás összeállít egy üzenetet, amelyben leírja a rendelést, majd egy üzenetsorba küldi.</span><span class="sxs-lookup"><span data-stu-id="58031-204">When a customer places an order, the application constructs a message that describes the order and posts this message to a queue.</span></span> <span data-ttu-id="58031-205">Az üzenetet egy feldolgozói szerepkörben futó külön beküldési folyamat olvassa be, beszúrja a rendelés részleteit a rendelési adatbázisba, és rögzíti a rendelési folyamatot az állapottárolóban.</span><span class="sxs-lookup"><span data-stu-id="58031-205">A separate submission process, running in a worker role, retrieves the message, inserts the order details into the orders database, and creates a record for the order process in the state store.</span></span> <span data-ttu-id="58031-206">Vegye figyelembe, hogy a rendelési adatbázisba és az állapottárolóba történő beszúrások ugyanazon művelet részeként történnek.</span><span class="sxs-lookup"><span data-stu-id="58031-206">Note that the inserts into the orders database and the state store are performed as part of the same operation.</span></span> <span data-ttu-id="58031-207">A beküldési folyamat célja a két beszúrás együttes befejezésének biztosítása.</span><span class="sxs-lookup"><span data-stu-id="58031-207">The submission process is designed to ensure that both inserts complete together.</span></span>

<span data-ttu-id="58031-208">A beküldési folyamat által a rendeléshez létrehozott állapotinformáció az alábbiakat tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="58031-208">The state information that the submission process creates for the order includes:</span></span>

- <span data-ttu-id="58031-209">**OrderID**.</span><span class="sxs-lookup"><span data-stu-id="58031-209">**OrderID**.</span></span> <span data-ttu-id="58031-210">A rendelési adatbázisban található rendelés azonosítója.</span><span class="sxs-lookup"><span data-stu-id="58031-210">The ID of the order in the orders database.</span></span>

- <span data-ttu-id="58031-211">**LockedBy**.</span><span class="sxs-lookup"><span data-stu-id="58031-211">**LockedBy**.</span></span> <span data-ttu-id="58031-212">A rendelést kezelő feldolgozói szerepkör példányazonosítója.</span><span class="sxs-lookup"><span data-stu-id="58031-212">The instance ID of the worker role handling the order.</span></span> <span data-ttu-id="58031-213">Előfordulhat, hogy a feldolgozói szerepkör több aktuális példánya futtatja az ütemezőt, de az egyes rendeléseket csak egy példánynak kell kezelnie.</span><span class="sxs-lookup"><span data-stu-id="58031-213">There might be multiple current instances of the worker role running the Scheduler, but each order should only be handled by a single instance.</span></span>

- <span data-ttu-id="58031-214">**CompleteBy**.</span><span class="sxs-lookup"><span data-stu-id="58031-214">**CompleteBy**.</span></span> <span data-ttu-id="58031-215">Az az időpont, ameddig a rendelés feldolgozásának meg kell történnie.</span><span class="sxs-lookup"><span data-stu-id="58031-215">The time the order should be processed by.</span></span>

- <span data-ttu-id="58031-216">**ProcessState**.</span><span class="sxs-lookup"><span data-stu-id="58031-216">**ProcessState**.</span></span> <span data-ttu-id="58031-217">A rendelést kezelő feladat jelenlegi állapota.</span><span class="sxs-lookup"><span data-stu-id="58031-217">The current state of the task handling the order.</span></span> <span data-ttu-id="58031-218">A lehetséges állapotok a következők:</span><span class="sxs-lookup"><span data-stu-id="58031-218">The possible states are:</span></span>

  - <span data-ttu-id="58031-219">**Pending**.</span><span class="sxs-lookup"><span data-stu-id="58031-219">**Pending**.</span></span> <span data-ttu-id="58031-220">A rendelés létrejött, de a feldolgozása még nem kezdődött el.</span><span class="sxs-lookup"><span data-stu-id="58031-220">The order has been created but processing hasn't yet been started.</span></span>
  - <span data-ttu-id="58031-221">**Processing**.</span><span class="sxs-lookup"><span data-stu-id="58031-221">**Processing**.</span></span> <span data-ttu-id="58031-222">A rendelés feldolgozása folyamatban van.</span><span class="sxs-lookup"><span data-stu-id="58031-222">The order is currently being processed.</span></span>
  - <span data-ttu-id="58031-223">**Processed**.</span><span class="sxs-lookup"><span data-stu-id="58031-223">**Processed**.</span></span> <span data-ttu-id="58031-224">A rendelés feldolgozása sikeresen megtörtént.</span><span class="sxs-lookup"><span data-stu-id="58031-224">The order has been processed successfully.</span></span>
  - <span data-ttu-id="58031-225">**Error**.</span><span class="sxs-lookup"><span data-stu-id="58031-225">**Error**.</span></span> <span data-ttu-id="58031-226">A rendelés feldolgozása nem sikerült.</span><span class="sxs-lookup"><span data-stu-id="58031-226">The order processing has failed.</span></span>

- <span data-ttu-id="58031-227">**FailureCount**.</span><span class="sxs-lookup"><span data-stu-id="58031-227">**FailureCount**.</span></span> <span data-ttu-id="58031-228">A rendelés feldolgozására tett kísérletek száma.</span><span class="sxs-lookup"><span data-stu-id="58031-228">The number of times that processing has been tried for the order.</span></span>

<span data-ttu-id="58031-229">Ebben az állapotinformációban az `OrderID` mező az új rendelés rendelésazonosítójából lett kimásolva.</span><span class="sxs-lookup"><span data-stu-id="58031-229">In this state information, the `OrderID` field is copied from the order ID of the new order.</span></span> <span data-ttu-id="58031-230">A `LockedBy` és `CompleteBy` mező értéke `null`, a `ProcessState` mező értéke `Pending`, a `FailureCount` mező értéke pedig 0.</span><span class="sxs-lookup"><span data-stu-id="58031-230">The `LockedBy` and `CompleteBy` fields are set to `null`, the `ProcessState` field is set to `Pending`, and the `FailureCount` field is set to 0.</span></span>

> [!NOTE]
> <span data-ttu-id="58031-231">Ebben a példában a rendeléskezelő logika viszonylag egyszerű, és csak egyetlen lépése van, amely távoli szolgáltatást hív meg.</span><span class="sxs-lookup"><span data-stu-id="58031-231">In this example, the order handling logic is relatively simple and only has a single step that invokes a remote service.</span></span> <span data-ttu-id="58031-232">Egy összetettebb, többlépéses forgatókönyv esetében a folyamat vélhetően több lépést tartalmaz, így az állapottárolóban is több, egy adott lépés állapotát leíró rekord készül.</span><span class="sxs-lookup"><span data-stu-id="58031-232">In a more complex multistep scenario, the submission process would likely involve several steps, and so several records would be created in the state store—each one describing the state of an individual step.</span></span>

<span data-ttu-id="58031-233">Az ütemező szintén a feldolgozói szerepkör részeként fut, és implementálja a rendelést kezelő üzleti logikát.</span><span class="sxs-lookup"><span data-stu-id="58031-233">The Scheduler also runs as part of a worker role and implements the business logic that handles the order.</span></span> <span data-ttu-id="58031-234">Az ütemező egy új rendeléseket kereső példánya olyan rekordokat vizsgál az állapottárolóban, amelyekben a `LockedBy` mező értéke null, a `ProcessState` mezőé pedig „Pending”.</span><span class="sxs-lookup"><span data-stu-id="58031-234">An instance of the Scheduler polling for new orders examines the state store for records where the `LockedBy` field is null and the `ProcessState` field is pending.</span></span> <span data-ttu-id="58031-235">Amikor az ütemező új rendelést talál, azonnal kitölti a `LockedBy` mezőt a saját példányazonosítójával, a `CompleteBy` mezőt egy megfelelő időpontra állítja be, a `ProcessState` mezőt pedig „Processing” értékre állítja.</span><span class="sxs-lookup"><span data-stu-id="58031-235">When the Scheduler finds a new order, it immediately populates the `LockedBy` field with its own instance ID, sets the `CompleteBy` field to an appropriate time, and sets the `ProcessState` field to processing.</span></span> <span data-ttu-id="58031-236">A kód kizárólagos és atomi tervezése biztosítja, hogy az ütemező két párhuzamosan futó példánya ne kezelhesse egyszerre ugyanazt a rendelést.</span><span class="sxs-lookup"><span data-stu-id="58031-236">The code is designed to be exclusive and atomic to ensure that two concurrent instances of the Scheduler can't try to handle the same order simultaneously.</span></span>

<span data-ttu-id="58031-237">Az ütemező ezután futtatja az üzleti munkafolyamatot a rendelés aszinkron módon történő feldolgozásához, és átadja a rendelésnek az állapottárolóban található `OrderID` mezőben lévő értéket.</span><span class="sxs-lookup"><span data-stu-id="58031-237">The Scheduler then runs the business workflow to process the order asynchronously, passing it the value in the `OrderID` field from the state store.</span></span> <span data-ttu-id="58031-238">A rendelést kezelő munkafolyamat lekéri a rendelés részleteit a rendelési adatbázisból, és elvégzi a feladatát.</span><span class="sxs-lookup"><span data-stu-id="58031-238">The workflow handling the order retrieves the details of the order from the orders database and performs its work.</span></span> <span data-ttu-id="58031-239">Ha a rendelésfeldolgozási munkafolyamatban egy lépésnek távoli szolgáltatást kell meghívnia, erre ügynököt használ.</span><span class="sxs-lookup"><span data-stu-id="58031-239">When a step in the order processing workflow needs to invoke the remote service, it uses an Agent.</span></span> <span data-ttu-id="58031-240">A munkafolyamat-lépés egy kérés/válasz típusú csatornaként működő Azure Service Bus-üzenetsorpárt használ az ügynökkel folytatott kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="58031-240">The workflow step communicates with the Agent using a pair of Azure Service Bus message queues acting as a request/response channel.</span></span> <span data-ttu-id="58031-241">Az ábra a megoldás magas szintű nézetét mutatja be.</span><span class="sxs-lookup"><span data-stu-id="58031-241">The figure shows a high level view of the solution.</span></span>

![2. ábra – A Feladatütemező ügynök felügyeleti mintájának használata rendelések kezeléséhez egy Azure-megoldásban](./_images/scheduler-agent-supervisor-solution.png)

<span data-ttu-id="58031-243">Az ügynöknek egy munkafolyamat-lépés által küldött üzenet leírja a rendelést, és tartalmazza a befejezési időt.</span><span class="sxs-lookup"><span data-stu-id="58031-243">The message sent to the Agent from a workflow step describes the order and includes the complete-by time.</span></span> <span data-ttu-id="58031-244">Ha az ügynök választ kap a távoli szolgáltatástól a befejezési idő lejárta előtt, válaszüzenetet küld abba a Service Bus-üzenetsorba, amelyet a munkafolyamat figyel.</span><span class="sxs-lookup"><span data-stu-id="58031-244">If the Agent receives a response from the remote service before the complete-by time expires, it posts a reply message on the Service Bus queue on which the workflow is listening.</span></span> <span data-ttu-id="58031-245">Amikor a munkafolyamat-lépés megkapja az érvényes válaszüzenetet, befejezi a feldolgozást, majd az ütemező „Processed” állapotra állítja be a rendelési állapot „ProcessState” mezőjének értékét.</span><span class="sxs-lookup"><span data-stu-id="58031-245">When the workflow step receives the valid reply message, it completes its processing and the Scheduler sets the \`ProcessState field of the order state to processed.</span></span> <span data-ttu-id="58031-246">Ezen a ponton a rendelés feldolgozása sikeresen befejeződött.</span><span class="sxs-lookup"><span data-stu-id="58031-246">At this point, the order processing has completed successfully.</span></span>

<span data-ttu-id="58031-247">Ha a befejezési idő lejár, mielőtt az ügynök választ kap a távoli szolgáltatástól, az ügynök egyszerűen abbahagyja a feldolgozást, és leállítja a rendelés kezelését.</span><span class="sxs-lookup"><span data-stu-id="58031-247">If the complete-by time expires before the Agent receives a response from the remote service, the Agent simply halts its processing and terminates handling the order.</span></span> <span data-ttu-id="58031-248">Ha a rendelést kezelő munkafolyamat túllépi a befejezési időt, hasonlóképpen leáll.</span><span class="sxs-lookup"><span data-stu-id="58031-248">Similarly, if the workflow handling the order exceeds the complete-by time, it also terminates.</span></span> <span data-ttu-id="58031-249">A rendelés állapota az állapottárolóban mindkét esetben „Processing” marad, de a befejezési idő alapján látható, hogy a rendelés feldolgozására szánt idő letelt, és a folyamat sikertelennek lett nyilvánítva.</span><span class="sxs-lookup"><span data-stu-id="58031-249">In both cases, the state of the order in the state store remains set to processing, but the complete-by time indicates that the time for processing the order has passed and the process is deemed to have failed.</span></span> <span data-ttu-id="58031-250">Vegye figyelembe, hogy ha a távoli szolgáltatáshoz hozzáférő ügynök vagy a rendelést kezelő munkafolyamat (vagy mindkettő) váratlanul leáll, az állapottárolóban található információ szintén „Processing” értékre állítva marad, majd idővel lejárt befejezési idővel rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="58031-250">Note that if the Agent that's accessing the remote service, or the workflow that's handling the order (or both) terminate unexpectedly, the information in the state store will again remain set to processing and eventually will have an expired complete-by value.</span></span>

<span data-ttu-id="58031-251">Ha az ügynök helyreállíthatatlan, nem átmeneti hibát észlel a távoli szolgáltatással való kapcsolatfelvételre tett kísérlet közben, hibaüzenetet küldhet vissza a munkafolyamatnak.</span><span class="sxs-lookup"><span data-stu-id="58031-251">If the Agent detects an unrecoverable, nontransient fault while it's trying to contact the remote service, it can send an error response back to the workflow.</span></span> <span data-ttu-id="58031-252">Az ütemező a rendelési állapotot „Error” értékre állíthatja, és elindíthat egy eseményt, amely riaszt egy operátort.</span><span class="sxs-lookup"><span data-stu-id="58031-252">The Scheduler can set the status of the order to error and raise an event that alerts an operator.</span></span> <span data-ttu-id="58031-253">Az operátor ekkor megpróbálja manuálisan elhárítani a hibát, és újraküldeni a sikertelen feldolgozási lépést.</span><span class="sxs-lookup"><span data-stu-id="58031-253">The operator can then try to resolve the reason for the failure manually and resubmit the failed processing step.</span></span>

<span data-ttu-id="58031-254">A felügyelő rendszeres időközönként átvizsgálja az állapottárolót lejárt befejezési időértékű rendeléseket keresve.</span><span class="sxs-lookup"><span data-stu-id="58031-254">The Supervisor periodically examines the state store looking for orders with an expired complete-by value.</span></span> <span data-ttu-id="58031-255">Ha talál ilyen rekordot, növeli a `FailureCount` mező értékét.</span><span class="sxs-lookup"><span data-stu-id="58031-255">If the Supervisor finds a record, it increments the `FailureCount` field.</span></span> <span data-ttu-id="58031-256">Ha a hibaszám értéke egy meghatározott küszöbérték alatt van, a felügyelő visszaállítja a `LockedBy` mezőt nullértékre, új lejárati időre frissíti a `CompleteBy` mezőt, és beállítja a `ProcessState` mező állapotát „Pending” értékre.</span><span class="sxs-lookup"><span data-stu-id="58031-256">If the failure count value is below a specified threshold value, the Supervisor resets the `LockedBy` field to null, updates the `CompleteBy` field with a new expiration time, and sets the `ProcessState` field to pending.</span></span> <span data-ttu-id="58031-257">Az ütemező egy példánya átveheti ezt a rendelést, és az eddigiekhez hasonlóan elvégezheti a feldolgozását.</span><span class="sxs-lookup"><span data-stu-id="58031-257">An instance of the Scheduler can pick up this order and perform its processing as before.</span></span> <span data-ttu-id="58031-258">Ha a hibaszám értéke meghaladja a meghatározott küszöbértéket, a rendszer a hiba okát nem átmenetinek tekinti.</span><span class="sxs-lookup"><span data-stu-id="58031-258">If the failure count value exceeds a specified threshold, the reason for the failure is assumed to be nontransient.</span></span> <span data-ttu-id="58031-259">A felügyelő a rendelési állapotot „Error” értékre állítja, és elindít egy eseményt, amely riaszt egy operátort.</span><span class="sxs-lookup"><span data-stu-id="58031-259">The Supervisor sets the status of the order to error and raises an event that alerts an operator.</span></span>

> <span data-ttu-id="58031-260">Ebben a példában a felügyelő egy külön feldolgozói szerepkörben van implementálva.</span><span class="sxs-lookup"><span data-stu-id="58031-260">In this example, the Supervisor is implemented in a separate worker role.</span></span> <span data-ttu-id="58031-261">Számos stratégiát használhat a felügyelői feladat futtatására, beleértve az Azure Scheduler-szolgáltatás használatát (nem összetévesztendő az ebben a mintában használt ütemező összetevővel).</span><span class="sxs-lookup"><span data-stu-id="58031-261">You can use a variety of strategies to arrange for the Supervisor task to be run, including using the Azure Scheduler service (not to be confused with the Scheduler component in this pattern).</span></span> <span data-ttu-id="58031-262">Az Azure Scheduler-szolgáltatással kapcsolatos további információért látogasson el [a Scheduler](https://azure.microsoft.com/services/scheduler/) oldalára.</span><span class="sxs-lookup"><span data-stu-id="58031-262">For more information about the Azure Scheduler service, visit the [Scheduler](https://azure.microsoft.com/services/scheduler/) page.</span></span>

<span data-ttu-id="58031-263">Bár ebben a példában nem mutattuk be, előfordulhat, hogy az ütemezőnek folyamatosan tájékoztatnia kell a rendelést beküldő alkalmazást a rendelés folyamatáról és állapotáról.</span><span class="sxs-lookup"><span data-stu-id="58031-263">Although it isn't shown in this example, the Scheduler might need to keep the application that submitted the order informed about the progress and status of the order.</span></span> <span data-ttu-id="58031-264">Az alkalmazás és az ütemező az egymás közötti függőségek elkerülése érdekében el van különítve egymástól.</span><span class="sxs-lookup"><span data-stu-id="58031-264">The application and the Scheduler are isolated from each other to eliminate any dependencies between them.</span></span> <span data-ttu-id="58031-265">Az alkalmazás nem rendelkezik információval arról, hogy az ütemező melyik példánya kezeli a rendelést, ahogyan az ütemező sem tud arról, pontosan melyik alkalmazáspéldány adta le a rendelést.</span><span class="sxs-lookup"><span data-stu-id="58031-265">The application has no knowledge of which instance of the Scheduler is handling the order, and the Scheduler is unaware of which specific application instance posted the order.</span></span>

<span data-ttu-id="58031-266">Ahhoz, hogy a rendelés állapota jelenthető legyen, az alkalmazás használhatja a saját személyes válaszvárólistáját.</span><span class="sxs-lookup"><span data-stu-id="58031-266">To allow the order status to be reported, the application could use its own private response queue.</span></span> <span data-ttu-id="58031-267">A válaszvárólista részleteit tartalmazza a kérés, amelyet a beküldési folyamat kap meg, amely hozzáadja ezt az információt az állapottárhoz.</span><span class="sxs-lookup"><span data-stu-id="58031-267">The details of this response queue would be included as part of the request sent to the submission process, which would include this information in the state store.</span></span> <span data-ttu-id="58031-268">Ezután az ütemező üzeneteket küld ebbe az üzenetsorba a rendelés állapotáról (kérés megérkezett, rendelés befejezve, rendelés sikertelen stb.).</span><span class="sxs-lookup"><span data-stu-id="58031-268">The Scheduler would then post messages to this queue indicating the status of the order (request received, order completed, order failed, and so on).</span></span> <span data-ttu-id="58031-269">Az üzeneteknek tartalmazniuk kell a rendelési azonosítót, hogy összekapcsolhatók legyenek az alkalmazás által küldött eredeti kéréssel.</span><span class="sxs-lookup"><span data-stu-id="58031-269">It should include the order ID in these messages so they can be correlated with the original request by the application.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="58031-270">Kapcsolódó minták és útmutatók</span><span class="sxs-lookup"><span data-stu-id="58031-270">Related patterns and guidance</span></span>

<span data-ttu-id="58031-271">Az alábbi minták és útmutatók szintén hasznosak lehetnek a minta megvalósításakor:</span><span class="sxs-lookup"><span data-stu-id="58031-271">The following patterns and guidance might also be relevant when implementing this pattern:</span></span>

- <span data-ttu-id="58031-272">[Újrapróbálkozási minta](./retry.md).</span><span class="sxs-lookup"><span data-stu-id="58031-272">[Retry pattern](./retry.md).</span></span> <span data-ttu-id="58031-273">Ügynökök használhatják ezt a mintát egy olyan művelet átlátható módon történő megismétléséhez, amely korábban hibás állapotú távoli szolgáltatáshoz vagy erőforráshoz fér hozzá.</span><span class="sxs-lookup"><span data-stu-id="58031-273">An Agent can use this pattern to transparently retry an operation that accesses a remote service or resource that has previously failed.</span></span> <span data-ttu-id="58031-274">Akkor használja, ha a hiba oka valószínűsíthetően átmeneti és elhárítható.</span><span class="sxs-lookup"><span data-stu-id="58031-274">Use when the expectation is that the cause of the failure is transient and can be corrected.</span></span>
- <span data-ttu-id="58031-275">[Áramkör-megszakítási minta](./circuit-breaker.md).</span><span class="sxs-lookup"><span data-stu-id="58031-275">[Circuit Breaker pattern](./circuit-breaker.md).</span></span> <span data-ttu-id="58031-276">Ügynökök használhatják ezt a mintát olyan hibák kezelésére, amelyek elhárítása távoli szolgáltatáshoz vagy erőforráshoz való csatlakozáskor változó mennyiségű időt vesz igénybe.</span><span class="sxs-lookup"><span data-stu-id="58031-276">An Agent can use this pattern to handle faults that take a variable amount of time to correct when connecting to a remote service or resource.</span></span>
- <span data-ttu-id="58031-277">[Kompenzáló tranzakció mintája](./compensating-transaction.md).</span><span class="sxs-lookup"><span data-stu-id="58031-277">[Compensating Transaction pattern](./compensating-transaction.md).</span></span> <span data-ttu-id="58031-278">Ha az ütemező által végzett munkafolyamatot nem lehet sikeresen befejezni, szükséges lehet az addig elvégzett munka visszavonása.</span><span class="sxs-lookup"><span data-stu-id="58031-278">If the workflow being performed by a Scheduler can't be completed successfully, it might be necessary to undo any work it's previously performed.</span></span> <span data-ttu-id="58031-279">A Kompenzáló tranzakció mintája leírja, hogyan valósítható ez meg olyan műveletek esetében, amelyek a végleges konzisztenciájú modellt követik.</span><span class="sxs-lookup"><span data-stu-id="58031-279">The Compensating Transaction pattern describes how this can be achieved for operations that follow the eventual consistency model.</span></span> <span data-ttu-id="58031-280">Az ilyen típusú műveleteket általában egy összetett üzleti folyamatokat és munkafolyamatokat végző ütemező implementálja.</span><span class="sxs-lookup"><span data-stu-id="58031-280">These types of operations are commonly implemented by a Scheduler that performs complex business processes and workflows.</span></span>
- <span data-ttu-id="58031-281">[Az aszinkron üzenetkezelés ismertetése](https://msdn.microsoft.com/library/dn589781.aspx).</span><span class="sxs-lookup"><span data-stu-id="58031-281">[Asynchronous Messaging Primer](https://msdn.microsoft.com/library/dn589781.aspx).</span></span> <span data-ttu-id="58031-282">A Feladatütemező ügynök felügyeleti mintájának összetevői általában egymástól elválasztva futnak, és aszinkron módon kommunikálnak.</span><span class="sxs-lookup"><span data-stu-id="58031-282">The components in the Scheduler Agent Supervisor pattern typically run decoupled from each other and communicate asynchronously.</span></span> <span data-ttu-id="58031-283">Itt néhány, aszinkron módon történő kommunikáció implementálására használt, üzenetsorokon alapuló megközelítés leírását olvashatja.</span><span class="sxs-lookup"><span data-stu-id="58031-283">Describes some of the approaches that can be used to implement asynchronous communication based on message queues.</span></span>
- <span data-ttu-id="58031-284">[Vezetőválasztási minta](./leader-election.md).</span><span class="sxs-lookup"><span data-stu-id="58031-284">[Leader Election pattern](./leader-election.md).</span></span> <span data-ttu-id="58031-285">Szükséges lehet koordinálni egy felügyelő több példányának műveleteit annak megakadályozása érdekében, hogy a példányok ugyanazt a sikertelen folyamatot próbálják meg helyreállítani.</span><span class="sxs-lookup"><span data-stu-id="58031-285">It might be necessary to coordinate the actions of multiple instances of a Supervisor to prevent them from attempting to recover the same failed process.</span></span> <span data-ttu-id="58031-286">A Vezetőválasztási minta ismerteti, hogyan teheti meg ezt.</span><span class="sxs-lookup"><span data-stu-id="58031-286">The Leader Election pattern describes how to do this.</span></span>
- <span data-ttu-id="58031-287">[Felhőarchitektúra: A Feladatütemező ügynök felügyeleti mintája](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) Clemens Vasters blogján</span><span class="sxs-lookup"><span data-stu-id="58031-287">[Cloud Architecture: The Scheduler-Agent-Supervisor Pattern](https://blogs.msdn.microsoft.com/clemensv/2010/09/27/cloud-architecture-the-scheduler-agent-supervisor-pattern/) on Clemens Vasters' blog</span></span>
- [<span data-ttu-id="58031-288">Folyamatkezelő minta</span><span class="sxs-lookup"><span data-stu-id="58031-288">Process Manager pattern</span></span>](https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html)
- <span data-ttu-id="58031-289">[6. hivatkozás: Egy Saga a Sagákról](https://msdn.microsoft.com/library/jj591569.aspx).</span><span class="sxs-lookup"><span data-stu-id="58031-289">[Reference 6: A Saga on Sagas](https://msdn.microsoft.com/library/jj591569.aspx).</span></span> <span data-ttu-id="58031-290">Egy példa arra, hogyan használja a CQRS mintája a folyamatkezelőt (a CQRS-út útmutatásának része).</span><span class="sxs-lookup"><span data-stu-id="58031-290">An example showing how the CQRS pattern uses a process manager (part of the CQRS Journey guidance).</span></span>
- [<span data-ttu-id="58031-291">Microsoft Azure Scheduler</span><span class="sxs-lookup"><span data-stu-id="58031-291">Microsoft Azure Scheduler</span></span>](https://azure.microsoft.com/services/scheduler/)
