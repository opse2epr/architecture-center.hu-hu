---
title: A Mikroszolgáltatási architektúra az Azure Kubernetes Service (AKS)
description: A mikroszolgáltatási architektúra az Azure Kubernetes Service (AKS) üzembe helyezése
author: MikeWasson
ms.date: 12/10/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: ac7ab8b8dd154999a05dc531e41b0994f66ddf10
ms.sourcegitcommit: 700a4f6ce61b1ebe68e227fc57443e49282e35aa
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 02/07/2019
ms.locfileid: "55887403"
---
# <a name="microservices-architecture-on-azure-kubernetes-service-aks"></a><span data-ttu-id="1055e-103">A Mikroszolgáltatási architektúra az Azure Kubernetes Service (AKS)</span><span class="sxs-lookup"><span data-stu-id="1055e-103">Microservices architecture on Azure Kubernetes Service (AKS)</span></span>

<span data-ttu-id="1055e-104">A referenciaarchitektúrák a mikroszolgáltatás-alkalmazások üzembe helyezett Azure Kubernetes Service (AKS) jeleníti meg.</span><span class="sxs-lookup"><span data-stu-id="1055e-104">This reference architectures shows a microservices application deployed to Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="1055e-105">A legtöbb telepítés esetén a kiindulási pont lehet AKS alapkonfiguráció mutatja.</span><span class="sxs-lookup"><span data-stu-id="1055e-105">It shows a basic AKS configuration that can be the starting point for most deployments.</span></span> <span data-ttu-id="1055e-106">Fejlettebb lehetőségeket, ideértve a speciális hálózati beállításokat, egy különálló referenciaarchitektúrában található tárgyalja.</span><span class="sxs-lookup"><span data-stu-id="1055e-106">More advanced options, including advanced networking options, will be covered in a separate reference architecture.</span></span>

<span data-ttu-id="1055e-107">Ez a cikk a Kubernetes alapszintű ismeretét feltételezi.</span><span class="sxs-lookup"><span data-stu-id="1055e-107">This article assumes basic knowledge of Kubernetes.</span></span> <span data-ttu-id="1055e-108">A cikk elsősorban az infrastruktúra és a fejlesztési és üzemeltetési megfontolások az aks-en futó a mikroszolgáltatási architektúra szolgál.</span><span class="sxs-lookup"><span data-stu-id="1055e-108">The article focuses mainly on the infrastructure and DevOps considerations of running a microservices architecture on AKS.</span></span> <span data-ttu-id="1055e-109">Domain Driven tervezési (DDD) szempontból mikroszolgáltatások tervezési útmutatóért lásd: [tervezése, létrehozása és működtetése az Azure mikroszolgáltatások](/azure/architecture/microservices).</span><span class="sxs-lookup"><span data-stu-id="1055e-109">For guidance on how to design microservices from a Domain Driven Design (DDD) perspective, see [Designing, building, and operating microservices on Azure](/azure/architecture/microservices).</span></span>

> [!NOTE]
> <span data-ttu-id="1055e-110">Dolgozunk a referenciaimplementációt (RI) kísérő ebben a cikkben, amely várhatóan közzététele az előzetes verzióját 2019.</span><span class="sxs-lookup"><span data-stu-id="1055e-110">We are working on a reference implementation (RI) to accompany this article, which we expect to publish in early 2019.</span></span> <span data-ttu-id="1055e-111">Ez a cikk építhetnek be további ajánlott eljárásait a fenntartott példány frissül.</span><span class="sxs-lookup"><span data-stu-id="1055e-111">This article will be updated to incorporate additional best practices from that RI.</span></span>

![Az AKS a referencia-architektúra](./_images/aks.png)

## <a name="architecture"></a><span data-ttu-id="1055e-113">Architektúra</span><span class="sxs-lookup"><span data-stu-id="1055e-113">Architecture</span></span>

<span data-ttu-id="1055e-114">Az architektúra a következőkben leírt összetevőkből áll.</span><span class="sxs-lookup"><span data-stu-id="1055e-114">The architecture consists of the following components.</span></span>

<span data-ttu-id="1055e-115">**Azure Kubernetes Service** (AKS).</span><span class="sxs-lookup"><span data-stu-id="1055e-115">**Azure Kubernetes Service** (AKS).</span></span> <span data-ttu-id="1055e-116">AKS-felügyelt Kubernetes-fürt üzembe helyezése Azure-szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="1055e-116">AKS is an Azure service that deploys a managed Kubernetes cluster.</span></span> 

<span data-ttu-id="1055e-117">**Kubernetes-fürt**.</span><span class="sxs-lookup"><span data-stu-id="1055e-117">**Kubernetes cluster**.</span></span> <span data-ttu-id="1055e-118">Az AKS feladata a Kubernetes-fürt üzembe helyezéséhez és kezeléséhez a Kubernetes-főkiszolgálóhoz.</span><span class="sxs-lookup"><span data-stu-id="1055e-118">AKS is responsible for deploying the Kubernetes cluster and for managing the Kubernetes masters.</span></span> <span data-ttu-id="1055e-119">Csak az ügynökcsomópontok kezelhető.</span><span class="sxs-lookup"><span data-stu-id="1055e-119">You only manage the agent nodes.</span></span>

<span data-ttu-id="1055e-120">**Virtuális hálózat**.</span><span class="sxs-lookup"><span data-stu-id="1055e-120">**Virtual network**.</span></span> <span data-ttu-id="1055e-121">Alapértelmezés szerint az AKS üzembe helyezéséhez az ügynökcsomópontok be egy virtuális hálózatot hoz létre.</span><span class="sxs-lookup"><span data-stu-id="1055e-121">By default, AKS creates a virtual network to deploy the agent nodes into.</span></span> <span data-ttu-id="1055e-122">Speciális forgatókönyvek esetén létrehozhat a virtuális hálózat először, többek között miként vannak konfigurálva az alhálózatokat használó helyszíni kapcsolatok és IP-címkezelést, amellyel szabályozhatja.</span><span class="sxs-lookup"><span data-stu-id="1055e-122">For more advanced scenarios, you can create the virtual network first, which lets you control things like how the subnets are configured, on-premises connectivity, and IP addressing.</span></span> <span data-ttu-id="1055e-123">További információkért lásd: [speciális konfigurálása az Azure Kubernetes Service (AKS) hálózat](/azure/aks/configure-advanced-networking).</span><span class="sxs-lookup"><span data-stu-id="1055e-123">For more information, see [Configure advanced networking in Azure Kubernetes Service (AKS)](/azure/aks/configure-advanced-networking).</span></span>

<span data-ttu-id="1055e-124">**Bejövő forgalom**.</span><span class="sxs-lookup"><span data-stu-id="1055e-124">**Ingress**.</span></span> <span data-ttu-id="1055e-125">Egy bejövő HTTP (S) útvonalakat a fürtön belüli szolgáltatások tesz elérhetővé.</span><span class="sxs-lookup"><span data-stu-id="1055e-125">An ingress exposes HTTP(S) routes to services inside the cluster.</span></span> <span data-ttu-id="1055e-126">További információkért lásd: a szakasz [API-átjáró](#api-gateway) alatt.</span><span class="sxs-lookup"><span data-stu-id="1055e-126">For more information, see the section [API Gateway](#api-gateway) below.</span></span>

<span data-ttu-id="1055e-127">**Külső adattárakban**.</span><span class="sxs-lookup"><span data-stu-id="1055e-127">**External data stores**.</span></span> <span data-ttu-id="1055e-128">A Mikroszolgáltatások általában állapot nélküli és állapotadatokat írni a külső adattárakban, mint például az Azure SQL Database vagy a Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="1055e-128">Microservices are typically stateless and write state to external data stores, such as Azure SQL Database or Cosmos DB.</span></span>

<span data-ttu-id="1055e-129">**Az Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="1055e-129">**Azure Active Directory**.</span></span> <span data-ttu-id="1055e-130">Az AKS használja az Azure Active Directory (Azure AD) identitás más Azure-erőforrások Azure-terheléselosztók például elindíthatók.</span><span class="sxs-lookup"><span data-stu-id="1055e-130">AKS uses an Azure Active Directory (Azure AD) identity to create and manage other Azure resources such as Azure load balancers.</span></span> <span data-ttu-id="1055e-131">Az Azure AD használata felhasználói hitelesítéshez ügyfélalkalmazások is ajánlott.</span><span class="sxs-lookup"><span data-stu-id="1055e-131">Azure AD is also recommended for user authentication in client applications.</span></span>

<span data-ttu-id="1055e-132">**Az Azure Container Registry**.</span><span class="sxs-lookup"><span data-stu-id="1055e-132">**Azure Container Registry**.</span></span> <span data-ttu-id="1055e-133">Container Registry privát Docker-lemezképek vannak telepítve a fürthöz használni.</span><span class="sxs-lookup"><span data-stu-id="1055e-133">Use Container Registry to store private Docker images, which are deployed to the cluster.</span></span> <span data-ttu-id="1055e-134">Az AKS használata az Azure AD identity tároló-beállításjegyzék hitelesítheti.</span><span class="sxs-lookup"><span data-stu-id="1055e-134">AKS can authenticate with Container Registry using its Azure AD identity.</span></span> <span data-ttu-id="1055e-135">Vegye figyelembe, hogy az AKS nem igényel Azure Container Registrybe.</span><span class="sxs-lookup"><span data-stu-id="1055e-135">Note that AKS does not require Azure Container Registry.</span></span> <span data-ttu-id="1055e-136">Egyéb tároló-beállításjegyzékek, például a Docker Hub is használhatja.</span><span class="sxs-lookup"><span data-stu-id="1055e-136">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="1055e-137">**Az Azure folyamatok**.</span><span class="sxs-lookup"><span data-stu-id="1055e-137">**Azure Pipelines**.</span></span> <span data-ttu-id="1055e-138">Folyamatok része az Azure DevOps-szolgáltatásokkal, és a futtatások automatizált buildek, tesztek és központi telepítések.</span><span class="sxs-lookup"><span data-stu-id="1055e-138">Pipelines is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="1055e-139">Külső CI/CD megoldásokra, például a Jenkins is használhatja.</span><span class="sxs-lookup"><span data-stu-id="1055e-139">You can also use third-party CI/CD solutions such as Jenkins.</span></span> 

<span data-ttu-id="1055e-140">**Helm**.</span><span class="sxs-lookup"><span data-stu-id="1055e-140">**Helm**.</span></span> <span data-ttu-id="1055e-141">Méretezhető, Helm a Kuberneteshez készült Csomagkezelő &mdash; úgy szeretné a Kubernetes-objektumokat egyetlen egységbe, amely közzétehet, üzembe helyezését, és frissítheti.</span><span class="sxs-lookup"><span data-stu-id="1055e-141">Helm is as a package manager for Kubernetes &mdash; a way to bundle Kubernetes objects into a single unit that you can publish, deploy, version, and update.</span></span>

<span data-ttu-id="1055e-142">**Az Azure Monitor**.</span><span class="sxs-lookup"><span data-stu-id="1055e-142">**Azure Monitor**.</span></span> <span data-ttu-id="1055e-143">Az Azure Monitor gyűjt, és a metrikák és naplók, beleértve a platform az Azure-szolgáltatások mérőszámait a megoldás és alkalmazások telemetrikus adatait tárolja.</span><span class="sxs-lookup"><span data-stu-id="1055e-143">Azure Monitor collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="1055e-144">Ezen adatok segítségével figyelheti az alkalmazást, állítsa be a riasztások és az irányítópultok és hajtsa végre a kiváltó okok elemzése a hibák.</span><span class="sxs-lookup"><span data-stu-id="1055e-144">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="1055e-145">Az Azure Monitor integrálható az aks-sel való a tartományvezérlők, csomópontok, és a tárolók, valamint a tároló naplóinak és fő csomópont naplóinak begyűjtése.</span><span class="sxs-lookup"><span data-stu-id="1055e-145">Azure Monitor integrates with AKS to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="1055e-146">Kialakítási szempontok</span><span class="sxs-lookup"><span data-stu-id="1055e-146">Design considerations</span></span>

<span data-ttu-id="1055e-147">Ez a referenciaarchitektúra irányul, mikroszolgáltatás-architektúrákat, bár az ajánlott eljárásokat számos érvénybe lépnek az aks-en futó számítási feladatoktól.</span><span class="sxs-lookup"><span data-stu-id="1055e-147">This reference architecture is focused on microservices architectures, although many of the recommended practices will apply to other workloads running on AKS.</span></span>

### <a name="microservices"></a><span data-ttu-id="1055e-148">Mikroszolgáltatások</span><span class="sxs-lookup"><span data-stu-id="1055e-148">Microservices</span></span>

<span data-ttu-id="1055e-149">A Kubernetes-szolgáltatást objektum modell mikroszolgáltatások a Kubernetesben természetes módon.</span><span class="sxs-lookup"><span data-stu-id="1055e-149">The Kubernetes Service object is a natural way to model microservices in Kubernetes.</span></span> <span data-ttu-id="1055e-150">A mikroszolgáltatások általában a kód lazán kapcsolt, függetlenül üzembe helyezhető egysége.</span><span class="sxs-lookup"><span data-stu-id="1055e-150">A microservice is a loosely coupled, independently deployable unit of code.</span></span> <span data-ttu-id="1055e-151">Mikroszolgáltatások általában jól meghatározott API-kon keresztül kommunikálnak, és a szolgáltatásészlelés valamilyen keresztül észlelhetőek legyenek.</span><span class="sxs-lookup"><span data-stu-id="1055e-151">Microservices typically communicate through well-defined APIs, and are discoverable through some form of service discovery.</span></span> <span data-ttu-id="1055e-152">A Kubernetes-szolgáltatást objektum ezeknek a követelményeknek megfelelő képességeket tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="1055e-152">The Kubernetes Service object provides a set of capabilities that match these requirements:</span></span>

- <span data-ttu-id="1055e-153">IP-cím.</span><span class="sxs-lookup"><span data-stu-id="1055e-153">IP address.</span></span> <span data-ttu-id="1055e-154">A Service objektum tartalmazza a statikus belső IP-címet a podok (ReplicaSet) egy csoportjánál.</span><span class="sxs-lookup"><span data-stu-id="1055e-154">The Service object provides a static internal IP address for a group of pods (ReplicaSet).</span></span> <span data-ttu-id="1055e-155">Podok is létrehozott, illetve különböző pontjain áthelyezték, a szolgáltatás mindig az e belső IP-címen érhető el.</span><span class="sxs-lookup"><span data-stu-id="1055e-155">As pods are created or moved around, the service is always reachable at this internal IP address.</span></span>

- <span data-ttu-id="1055e-156">Terheléselosztás.</span><span class="sxs-lookup"><span data-stu-id="1055e-156">Load balancing.</span></span> <span data-ttu-id="1055e-157">A szolgáltatás IP-címre küldött adatforgalom a podok terheléselosztó pedig.</span><span class="sxs-lookup"><span data-stu-id="1055e-157">Traffic sent to the service's IP address is load balanced to the pods.</span></span> 

- <span data-ttu-id="1055e-158">Szolgáltatás felderítése.</span><span class="sxs-lookup"><span data-stu-id="1055e-158">Service discovery.</span></span> <span data-ttu-id="1055e-159">Szolgáltatások rendeli hozzá a Kubernetes DNS-szolgáltatás belső DNS-bejegyzéseket.</span><span class="sxs-lookup"><span data-stu-id="1055e-159">Services are assigned internal DNS entries by the Kubernetes DNS service.</span></span> <span data-ttu-id="1055e-160">Ez azt jelenti, hogy az API-átjáró segítségével meghívhatja a háttérszolgáltatást, a DNS-név használatával.</span><span class="sxs-lookup"><span data-stu-id="1055e-160">That means the API gateway can call a backend service using the DNS name.</span></span> <span data-ttu-id="1055e-161">Ugyanazt a mechanizmust a szolgáltatások közötti kommunikációhoz használható.</span><span class="sxs-lookup"><span data-stu-id="1055e-161">The same mechanism can be used for service-to-service communication.</span></span> <span data-ttu-id="1055e-162">A DNS-bejegyzések szerint vannak rendszerezve névtér, így a névterek felelnek meg, amelyet környezeteket, akkor a szolgáltatás DNS-neve lesz leképezve természetesen a doména aplikace.</span><span class="sxs-lookup"><span data-stu-id="1055e-162">The DNS entries are organized by namespace, so if your namespaces correspond to bounded contexts, then the DNS name for a service will map naturally to the application domain.</span></span>

<span data-ttu-id="1055e-163">Az alábbi ábrán a fogalmi kapcsolat és a podok között megjelenítése.</span><span class="sxs-lookup"><span data-stu-id="1055e-163">The following diagram show the conceptual relation between services and pods.</span></span> <span data-ttu-id="1055e-164">A tényleges hozzárendelést végpont IP-címek és portok kube-proxyként, a Kubernetes hálózati proxy végzi el.</span><span class="sxs-lookup"><span data-stu-id="1055e-164">The actual mapping to endpoint IP addresses and ports is done by kube-proxy, the Kubernetes network proxy.</span></span>

![Szolgáltatások és a podok](./_images/aks-services.png)

### <a name="api-gateway"></a><span data-ttu-id="1055e-166">API-átjáró</span><span class="sxs-lookup"><span data-stu-id="1055e-166">API Gateway</span></span>

<span data-ttu-id="1055e-167">Egy *API-átjáró* egy átjáró, amely a külső ügyfelek és a mikroszolgáltatások között helyezkedik el.</span><span class="sxs-lookup"><span data-stu-id="1055e-167">An *API gateway* is a gateway that sits between external clients and the microservices.</span></span> <span data-ttu-id="1055e-168">Fordított proxy, mikroszolgáltatás-alapú ügyfelek útválasztási kérelmeit funkcionál.</span><span class="sxs-lookup"><span data-stu-id="1055e-168">It acts as a reverse proxy, routing requests from clients to microservices.</span></span> <span data-ttu-id="1055e-169">Emellett végrehajthatnak, például a hitelesítést, az SSL-lezárást és a sebességkorlátozás különböző általános feladatok.</span><span class="sxs-lookup"><span data-stu-id="1055e-169">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> 

<span data-ttu-id="1055e-170">Az átjáró által biztosított funkciókat módon csoportosíthatók:</span><span class="sxs-lookup"><span data-stu-id="1055e-170">Functionality provided by a gateway can be grouped as follows:</span></span>

- <span data-ttu-id="1055e-171">[Átjáró útválasztási](../../patterns/gateway-routing.md): A jobb oldali háttérszolgáltatások útválasztási ügyfélkéréseket.</span><span class="sxs-lookup"><span data-stu-id="1055e-171">[Gateway Routing](../../patterns/gateway-routing.md): Routing client requests to the right backend services.</span></span> <span data-ttu-id="1055e-172">Egyetlen végpontot biztosít az ügyfelek számára, és segít a különítse el a ügyfeleket a szolgáltatásoktól.</span><span class="sxs-lookup"><span data-stu-id="1055e-172">This provides a single endpoint for clients, and helps to decouple clients from services.</span></span>

- <span data-ttu-id="1055e-173">[Átjáró-összesítési](../../patterns/gateway-aggregation.md): Több kérés összesítési egyetlen kérelemmé, az ügyfél és a háttérkiszolgáló közötti forgalmat csökkentése érdekében.</span><span class="sxs-lookup"><span data-stu-id="1055e-173">[Gateway Aggregation](../../patterns/gateway-aggregation.md): Aggregation of multiple requests into a single request, to reduce chattiness between the client and the backend.</span></span>

- <span data-ttu-id="1055e-174">[Átjáró-kiürítés](../../patterns/gateway-offloading.md).</span><span class="sxs-lookup"><span data-stu-id="1055e-174">[Gateway Offloading](../../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="1055e-175">Az átjáró kiszervezheti a háttérszolgáltatásokat, például az SSL-lezárást, hitelesítés, IP-engedélyezési vagy ügyfél sebessége korlátozza (szabályozás) funkcióit.</span><span class="sxs-lookup"><span data-stu-id="1055e-175">A gateway can offload functionality from the backend services, such as SSL termination, authentication, IP whitelisting, or client rate limiting (throttling).</span></span>

<span data-ttu-id="1055e-176">API-átjárók olyan általános [a mikroszolgáltatások tervezési minta](https://microservices.io/patterns/apigateway.html).</span><span class="sxs-lookup"><span data-stu-id="1055e-176">API gateways are a general [microservices design pattern](https://microservices.io/patterns/apigateway.html).</span></span> <span data-ttu-id="1055e-177">Ezek segítségével valósítható meg a különböző technológiák száma.</span><span class="sxs-lookup"><span data-stu-id="1055e-177">They can be implemented using a number of different technologies.</span></span> <span data-ttu-id="1055e-178">A leggyakoribb megvalósítás valószínűleg egy peremhálózati útválasztó fordított proxy, például az nginx-et, a HAProxy vagy Traefik, a fürtben üzembe.</span><span class="sxs-lookup"><span data-stu-id="1055e-178">Probably the most common implementation is to deploy an edge router or reverse proxy, such as Nginx, HAProxy, or Traefik, inside the cluster.</span></span> 

<span data-ttu-id="1055e-179">Egyéb lehetőségek a következők:</span><span class="sxs-lookup"><span data-stu-id="1055e-179">Other options include:</span></span>

- <span data-ttu-id="1055e-180">Az Azure Application Gateway és/vagy az Azure API-felügyeleti, amelyek mindkét felügyelt szolgáltatás, amely a fürtön kívüli találhatók.</span><span class="sxs-lookup"><span data-stu-id="1055e-180">Azure Application Gateway and/or Azure API-Management, which are both managed services that reside outside of the cluster.</span></span> <span data-ttu-id="1055e-181">Egy Application Gateway Bejövőforgalom-vezérlőjéhez jelenleg bétaverzióban.</span><span class="sxs-lookup"><span data-stu-id="1055e-181">An Application Gateway Ingress Controller is currently in beta.</span></span>

- <span data-ttu-id="1055e-182">Az Azure Functions-proxyk.</span><span class="sxs-lookup"><span data-stu-id="1055e-182">Azure Functions Proxies.</span></span> <span data-ttu-id="1055e-183">Proxyk módosíthatja a kérelmek és válaszok és átirányíthatja a kéréseket URL-cím alapján.</span><span class="sxs-lookup"><span data-stu-id="1055e-183">Proxies can modify requests and responses and route requests based on URL.</span></span>

<span data-ttu-id="1055e-184">A Kubernetes **bejövő** erőforrástípus kivonatolja a proxykiszolgálót egy konfigurációs beállításait.</span><span class="sxs-lookup"><span data-stu-id="1055e-184">The Kubernetes **Ingress** resource type abstracts the configuration settings for a proxy server.</span></span> <span data-ttu-id="1055e-185">Egy bejövőforgalom-vezérlőt, amely az alapul szolgáló valósítja meg a bejövő forgalom együtt működik.</span><span class="sxs-lookup"><span data-stu-id="1055e-185">It works in conjunction with an ingress controller, which provides the underlying implementation of the Ingress.</span></span> <span data-ttu-id="1055e-186">Nincsenek bejövő vezérlők nginx-et, a HAProxy, a Traefik és az Application Gateway (előzetes verzió), többek között.</span><span class="sxs-lookup"><span data-stu-id="1055e-186">There are ingress controllers for Nginx, HAProxy, Traefik, and Application Gateway (preview), among others.</span></span>

<span data-ttu-id="1055e-187">A bejövőforgalom-vezérlőjéhez kezeli a proxykiszolgáló konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="1055e-187">The ingress controller handles configuring the proxy server.</span></span> <span data-ttu-id="1055e-188">Gyakran összetett konfigurációs fájlokat, amelyek nem könnyű, ha még nem szakértője, így a bejövőforgalom-vezérlőjéhez-ban a processzoron absztrakciós ezek igényelnek.</span><span class="sxs-lookup"><span data-stu-id="1055e-188">Often these require complex configuration files, which can be hard to tune if you aren't an expert, so the ingress controller is a nice abstraction.</span></span> <span data-ttu-id="1055e-189">Emellett a Bejövőforgalom-vezérlőjéhez hozzáfér a Kubernetes API-t, így intelligens döntéseket hoz útválasztást és terheléselosztási funkciók.</span><span class="sxs-lookup"><span data-stu-id="1055e-189">In addition, the Ingress Controller has access to the Kubernetes API, so it can make intelligent decisions about routing and load balancing.</span></span> <span data-ttu-id="1055e-190">Ha például az Nginx bejövőforgalom-vezérlőjéhez megkerüli a kube-proxy hálózati proxy.</span><span class="sxs-lookup"><span data-stu-id="1055e-190">For example, the Nginx ingress controller bypasses the kube-proxy network proxy.</span></span>

<span data-ttu-id="1055e-191">Másrészről Ha a beállítások szabályozni kell végrehajtani, érdemes megkerülése Ez az absztrakció, és a proxykiszolgáló manuális konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="1055e-191">On the other hand, if you need complete control over the settings, you may want to bypass this abstraction and configure the proxy server manually.</span></span> 

<span data-ttu-id="1055e-192">Fordított proxykiszolgáló a potenciális szűk keresztmetszetet vagy rendszerkritikus meghibásodási pontot, ezért mindig a magas rendelkezésre állás érdekében legalább két replika üzembe.</span><span class="sxs-lookup"><span data-stu-id="1055e-192">A reverse proxy server is a potential bottleneck or single point of failure, so always deploy at least two replicas for high availability.</span></span>

### <a name="data-storage"></a><span data-ttu-id="1055e-193">Adattárolás</span><span class="sxs-lookup"><span data-stu-id="1055e-193">Data storage</span></span>

<span data-ttu-id="1055e-194">A mikroszolgáltatási architektúrában a szolgáltatások kell ossza meg az adattárolás.</span><span class="sxs-lookup"><span data-stu-id="1055e-194">In a microservices architecture, services should not share data storage.</span></span> <span data-ttu-id="1055e-195">Egyes szolgáltatások saját kell a saját személyes adatokat a rejtett adatok szolgáltatások közötti függőségek elkerülése érdekében egy külön logikai tárolási.</span><span class="sxs-lookup"><span data-stu-id="1055e-195">Each service should own its own private data in a separate logical storage, to avoid hidden dependencies among services.</span></span> <span data-ttu-id="1055e-196">A hiba oka nem szándékos összekapcsolását szolgáltatásokat, amelyek akkor fordulhat elő, amikor a szolgáltatások megosztása az azonos mögöttes adatsémák elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="1055e-196">The reason is to avoid unintentional coupling between services, which can happen when services share the same underlying data schemas.</span></span> <span data-ttu-id="1055e-197">Is ha szolgáltatások kezeli a saját adattárak, használhatják a megfelelő adattároló a rájuk adott vonatkozó követelményeket.</span><span class="sxs-lookup"><span data-stu-id="1055e-197">Also, when services manage their own data stores, they can use the right data store for their particular requirements.</span></span> <span data-ttu-id="1055e-198">További információkért lásd: [mikroszolgáltatások tervezése: Az adatok kapcsolatos szempontok](/azure/architecture/microservices/data-considerations).</span><span class="sxs-lookup"><span data-stu-id="1055e-198">For more information, see [Designing microservices: Data considerations](/azure/architecture/microservices/data-considerations).</span></span>

<span data-ttu-id="1055e-199">Kerülje a perzisztens adatok tárolása a helyi fürt storage szolgáltatással, mert, amely összeköt, hogy az adatok a csomópontra.</span><span class="sxs-lookup"><span data-stu-id="1055e-199">Avoid storing persistent data in local cluster storage, because that ties the data to the node.</span></span> <span data-ttu-id="1055e-200">Ehelyett</span><span class="sxs-lookup"><span data-stu-id="1055e-200">Instead,</span></span> 

- <span data-ttu-id="1055e-201">Például az Azure SQL Database vagy a Cosmos dB-ben egy külső szolgáltatás használja *vagy*</span><span class="sxs-lookup"><span data-stu-id="1055e-201">Use an external service such as Azure SQL Database or Cosmos DB, *or*</span></span>

- <span data-ttu-id="1055e-202">Egy Azure-lemezek vagy az Azure Files használatával tartós kötet csatlakoztatási.</span><span class="sxs-lookup"><span data-stu-id="1055e-202">Mount a persistent volume using Azure Disks or Azure Files.</span></span> <span data-ttu-id="1055e-203">Ha ugyanazt a kötetet kell oszthatóak meg több podok által az Azure Files használatának.</span><span class="sxs-lookup"><span data-stu-id="1055e-203">Use Azure Files if the same volume needs to be shared by multiple pods.</span></span>

### <a name="namespaces"></a><span data-ttu-id="1055e-204">Névterek</span><span class="sxs-lookup"><span data-stu-id="1055e-204">Namespaces</span></span>

<span data-ttu-id="1055e-205">Névterek segítségével a fürtön belüli szolgáltatásokat.</span><span class="sxs-lookup"><span data-stu-id="1055e-205">Use namespaces to organize services within the cluster.</span></span> <span data-ttu-id="1055e-206">Minden objektum egy Kubernetes-fürt névtérhez tartozik.</span><span class="sxs-lookup"><span data-stu-id="1055e-206">Every object in a Kubernetes cluster belongs to a namespace.</span></span> <span data-ttu-id="1055e-207">Alapértelmezés szerint egy új objektum létrehozásakor kerül a `default` névtér.</span><span class="sxs-lookup"><span data-stu-id="1055e-207">By default, when you create a new object, it goes into the `default` namespace.</span></span> <span data-ttu-id="1055e-208">Azonban célszerű létrehozni, amelyek a fürtben az erőforrások rendszerezésének elősegítése érdekében leíró névterek.</span><span class="sxs-lookup"><span data-stu-id="1055e-208">But it's a good practice to create namespaces that are more descriptive to help organize the resources in the cluster.</span></span>

<span data-ttu-id="1055e-209">Első lépésként névterek megakadályozhatja az elnevezési ütközések.</span><span class="sxs-lookup"><span data-stu-id="1055e-209">First, namespaces help prevent naming collisions.</span></span> <span data-ttu-id="1055e-210">Ha több csapat ugyanabban a fürtben, akár több száz szilárd mikroszolgáltatás-alapú, üzembe helyezése a mikroszolgáltatások lekérdezi nehéz kezelni, ha az összes, ugyanazt a névteret.</span><span class="sxs-lookup"><span data-stu-id="1055e-210">When multiple teams deploy microservices into the same cluster, with possibly hundreds of microservices, it gets hard to manage if they all go into the same namespace.</span></span> <span data-ttu-id="1055e-211">Emellett névterek teszik lehetővé:</span><span class="sxs-lookup"><span data-stu-id="1055e-211">In addition, namespaces allow you to:</span></span>

- <span data-ttu-id="1055e-212">Erőforrás-korlátozások vonatkoznak egy adott névtéren, hogy az adott a névtérhez hozzárendelt podok teljes készletét nem haladhatja meg a névtér erőforrás kvótáját.</span><span class="sxs-lookup"><span data-stu-id="1055e-212">Apply resource constraints to a namespace, so that the total set of pods assigned to that namespace cannot exceed the resource quota of the namespace.</span></span>

- <span data-ttu-id="1055e-213">A szabályzatokat a névterek szintjén, beleértve az RBAC- és biztonsági házirendjeivel.</span><span class="sxs-lookup"><span data-stu-id="1055e-213">Apply policies at the namespace level, including RBAC and security policies.</span></span>

<span data-ttu-id="1055e-214">A mikroszolgáltatási architektúra, figyelembe véve a kapcsolódó kontextusokat, a mikroszolgáltatások rendszerezése és a névterek az egyes kapcsolódó kontextusai létrehozását.</span><span class="sxs-lookup"><span data-stu-id="1055e-214">For a microservices architecture, considering organizing the microservices into bounded contexts, and creating namespaces for each bounded context.</span></span> <span data-ttu-id="1055e-215">Például a "Megrendelések teljesítése" korlátozott környezet kapcsolódó összes mikroszolgáltatások tehet lépnek ugyanazt a névteret.</span><span class="sxs-lookup"><span data-stu-id="1055e-215">For example, all microservices related to the "Order Fulfillment" bounded context could go into the same namespace.</span></span> <span data-ttu-id="1055e-216">Másik lehetőségként hozzon létre egy névteret minden fejlesztői csapat.</span><span class="sxs-lookup"><span data-stu-id="1055e-216">Alternatively, create a namespace for each development team.</span></span>

<span data-ttu-id="1055e-217">Segédprogram-szolgáltatások helyezi a saját különálló névtérben.</span><span class="sxs-lookup"><span data-stu-id="1055e-217">Place utility services into their own separate namespace.</span></span> <span data-ttu-id="1055e-218">Például előfordulhat, hogy az Elasticsearch vagy telepít Prometheus fürtfigyelést és a Helm a tiller valóban.</span><span class="sxs-lookup"><span data-stu-id="1055e-218">For example, you might deploy Elasticsearch or Prometheus for cluster monitoring, or Tiller for Helm.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="1055e-219">Méretezési szempontok</span><span class="sxs-lookup"><span data-stu-id="1055e-219">Scalability considerations</span></span>

<span data-ttu-id="1055e-220">Kubernetes támogatja a horizontális felskálázás két szinten:</span><span class="sxs-lookup"><span data-stu-id="1055e-220">Kubernetes supports scale-out at two levels:</span></span>

- <span data-ttu-id="1055e-221">A központi telepítés számára lefoglalt podok számát skálázhatja.</span><span class="sxs-lookup"><span data-stu-id="1055e-221">Scale the number of pods allocated to a deployment.</span></span>
- <span data-ttu-id="1055e-222">A csomópontok méretezése a fürtben a fürt számára elérhető összes számítási erőforrások növelése érdekében.</span><span class="sxs-lookup"><span data-stu-id="1055e-222">Scale the nodes in the cluster, to increase the total compute resources available to the cluster.</span></span>

<span data-ttu-id="1055e-223">Bár a horizontálisan felskálázzuk és csomópontok manuálisan, minimálisra annak esélyét, hogy a szolgáltatások magas terhelés alatt fogy ki erőforrás lesz az automatikus skálázás, használatát javasoljuk.</span><span class="sxs-lookup"><span data-stu-id="1055e-223">Although you can scale out pods and nodes manually, we recommend using autoscaling, to minimize the chance that services will become resource starved under high load.</span></span> <span data-ttu-id="1055e-224">Az automatikus skálázási stratégia figyelembe kell vennie podok és a csomópontok.</span><span class="sxs-lookup"><span data-stu-id="1055e-224">An autoscaling strategy must take both pods and nodes into account.</span></span> <span data-ttu-id="1055e-225">Ha csak a podok horizontális felskálázása, végül meg fogják tudni elérni a erőforráskorlátok a csomópontok.</span><span class="sxs-lookup"><span data-stu-id="1055e-225">If you just scale out the pods, eventually you will reach the resource limits of the nodes.</span></span> 

### <a name="pod-autoscaling"></a><span data-ttu-id="1055e-226">Podok automatikus skálázás</span><span class="sxs-lookup"><span data-stu-id="1055e-226">Pod autoscaling</span></span>

<span data-ttu-id="1055e-227">A vízszintes Pod méretező (HPA) méretezi a podok megfigyelt CPU, memória, vagy egyéni metrikák alapján.</span><span class="sxs-lookup"><span data-stu-id="1055e-227">The Horizontal Pod Autoscaler (HPA) scales pods based on observed CPU, memory, or custom metrics.</span></span> <span data-ttu-id="1055e-228">Podok horizontális méretezés konfigurálásával, adja meg a cél a mérőszám (például: 70 % CPU) és a replikák minimális és maximális száma.</span><span class="sxs-lookup"><span data-stu-id="1055e-228">To configure horizontal pod scaling, you specify a target metric (for example, 70% of CPU), and the minimum and maximum number of replicas.</span></span> <span data-ttu-id="1055e-229">Be kell tölteni a szolgáltatásokhoz, hogy ezek a számok.</span><span class="sxs-lookup"><span data-stu-id="1055e-229">You should load test your services to derive these numbers.</span></span>

<span data-ttu-id="1055e-230">Az automatikus skálázás mellékhatása, hogy podok előfordulhat, hogy hozható létre vagy eltávolítani kívánt gyakrabban, juthatnak horizontális felskálázást és a horizontális leskálázási.</span><span class="sxs-lookup"><span data-stu-id="1055e-230">A side-effect of autoscaling is that pods may be created or evicted more frequently, as scale-out and scale-in events happen.</span></span> <span data-ttu-id="1055e-231">Ez hatásainak csökkentése érdekében:</span><span class="sxs-lookup"><span data-stu-id="1055e-231">To mitigate the effects of this:</span></span>

- <span data-ttu-id="1055e-232">Használat készültségi mintavételek, hogy a Kubernetes értesíti, amikor egy új pod készen áll a fogadja el a forgalmat.</span><span class="sxs-lookup"><span data-stu-id="1055e-232">Use readiness probes to let Kubernetes know when a new pod is ready to accept traffic.</span></span>
- <span data-ttu-id="1055e-233">Ezen pod megszakítás költségvetése egyszerre hány podok is kimaradásához egy szolgáltatásból.</span><span class="sxs-lookup"><span data-stu-id="1055e-233">Use pod disruption budgets to limit how many pods can be evicted from a service at a time.</span></span>

### <a name="cluster-autoscaling"></a><span data-ttu-id="1055e-234">Fürt automatikus skálázás</span><span class="sxs-lookup"><span data-stu-id="1055e-234">Cluster autoscaling</span></span>

<span data-ttu-id="1055e-235">Fürt automatikus méretező méretezi a csomópontok számát.</span><span class="sxs-lookup"><span data-stu-id="1055e-235">The cluster autoscaler scales the number of nodes.</span></span> <span data-ttu-id="1055e-236">Podok korlátozott erőforrások miatt nem lehet ütemezni, ha a fürt automatikus méretező is üzembe helyezi a további csomópontokat.</span><span class="sxs-lookup"><span data-stu-id="1055e-236">If pods can't be scheduled because of resource constraints, the cluster autoscaler will provision more nodes.</span></span>  <span data-ttu-id="1055e-237">(Megjegyzés: AKS és a fürt automatikus méretező integrációjával jelenleg előzetes verzióban érhető el.)</span><span class="sxs-lookup"><span data-stu-id="1055e-237">(Note: Integration between AKS and the cluster autoscaler is currently in preview.)</span></span>

<span data-ttu-id="1055e-238">Mivel a HPA megvizsgálja a tényleges felhasznált erőforrásokat, vagy más metrikákkal podok futását, a fürt méretező, amelyek még nincsenek ütemezve podok csomópontok üzembe helyezése.</span><span class="sxs-lookup"><span data-stu-id="1055e-238">Whereas HPA looks at actual resources consumed or other metrics from running pods, the cluster autoscaler is provisioning nodes for pods that aren't scheduled yet.</span></span> <span data-ttu-id="1055e-239">Ezért úgy tűnik, a kért erőforrások üzembe helyezéséhez a Kubernetes pod specifikációja megadott módon.</span><span class="sxs-lookup"><span data-stu-id="1055e-239">Therefore, it looks at the requested resources, as specified in the Kubernetes pod spec for a deployment.</span></span> <span data-ttu-id="1055e-240">Terheléses tesztelés használatával finomhangolása ezeket az értékeket.</span><span class="sxs-lookup"><span data-stu-id="1055e-240">Use load testing to fine-tune these values.</span></span>

<span data-ttu-id="1055e-241">A virtuális gép mérete nem módosítható, ezért néhány, a fürt létrehozásakor válassza ki a megfelelő Virtuálisgép-méretet az ügynök csomópontok kezdeti kapacitástervezési hajtsa végre a fürt létrehozása után.</span><span class="sxs-lookup"><span data-stu-id="1055e-241">You can't change the VM size after you create the cluster, so you should do some initial capacity planning to choose an appropriate VM size for the agent nodes when you create the cluster.</span></span> 

## <a name="availability-considerations"></a><span data-ttu-id="1055e-242">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="1055e-242">Availability considerations</span></span>

### <a name="health-probes"></a><span data-ttu-id="1055e-243">Állapotminták</span><span class="sxs-lookup"><span data-stu-id="1055e-243">Health probes</span></span>

<span data-ttu-id="1055e-244">Kubernetes podot tehetők közzé állapotadat-mintavétel két típusa határozza meg:</span><span class="sxs-lookup"><span data-stu-id="1055e-244">Kubernetes defines two types of health probe that a pod can expose:</span></span>

- <span data-ttu-id="1055e-245">Készenléti teszt: Arra utasítja a Kubernetest kérelmek fogadásához készen áll-e a pod.</span><span class="sxs-lookup"><span data-stu-id="1055e-245">Readiness probe: Tells Kubernetes whether the pod is ready to accept requests.</span></span>

- <span data-ttu-id="1055e-246">Végrehajtandó működőképességi: Arra utasítja a Kubernetest, hogy podot el kell távolítani, és egy új példány indítása.</span><span class="sxs-lookup"><span data-stu-id="1055e-246">Liveness probe: Tells Kubernetes whether a pod should be removed and a new instance started.</span></span>

<span data-ttu-id="1055e-247">Mintavételezők mértékegységeként, esetén érdemes egy szolgáltatást a Kubernetes működéséről.</span><span class="sxs-lookup"><span data-stu-id="1055e-247">When thinking about probes, it's useful to recall how a service works in Kubernetes.</span></span> <span data-ttu-id="1055e-248">A szolgáltatásnak van egy címke választó, amely megfelel a podok (nulla vagy több) készletét.</span><span class="sxs-lookup"><span data-stu-id="1055e-248">A service has a label selector that matches a set of (zero or more) pods.</span></span> <span data-ttu-id="1055e-249">Kubernetes elosztja a forgalmat, amelyek megfelelnek a választó a podokat.</span><span class="sxs-lookup"><span data-stu-id="1055e-249">Kubernetes load balances traffic to the pods that match the selector.</span></span> <span data-ttu-id="1055e-250">Csak a sikeresen elindult, és kifogástalan állapotú podok forgalom fogadására.</span><span class="sxs-lookup"><span data-stu-id="1055e-250">Only pods that started successfully and are healthy receive traffic.</span></span> <span data-ttu-id="1055e-251">Ha összeomlik, egy tároló, a Kubernetes megszakítja a pod, és ütemezi helyett.</span><span class="sxs-lookup"><span data-stu-id="1055e-251">If a container crashes, Kubernetes kills the pod and schedules a replacement.</span></span>

<span data-ttu-id="1055e-252">Egyes esetekben egy pod nem lehet készen áll a forgalom fogadásához, annak ellenére sikeresen elindult a pod.</span><span class="sxs-lookup"><span data-stu-id="1055e-252">Sometimes, a pod may not be ready to receive traffic, even though the pod started successfully.</span></span> <span data-ttu-id="1055e-253">Előfordulhat például, inicializálási feladatokat, ahol az alkalmazás a tárolóban futó dolgot betölti a memóriába, vagy a konfigurációs adatokat olvas.</span><span class="sxs-lookup"><span data-stu-id="1055e-253">For example, there may be initialization tasks, where the application running in the container loads things into memory or reads configuration data.</span></span> <span data-ttu-id="1055e-254">Jelzi, hogy egy pod kifogástalan állapotú, de nem áll készen a forgalom fogadásához, adjon meg egy készenlét.</span><span class="sxs-lookup"><span data-stu-id="1055e-254">To indicate that a pod is healthy but not ready to receive traffic, define a readiness probe.</span></span> 

<span data-ttu-id="1055e-255">Liveness mintavételek kezelni az esetet, ahol podot továbbra is fut, de nem kifogástalan, és újra kell indítani.</span><span class="sxs-lookup"><span data-stu-id="1055e-255">Liveness probes handle the case where a pod is still running, but is unhealthy and should be recycled.</span></span> <span data-ttu-id="1055e-256">Tegyük fel, hogy egy tároló valamilyen okból szolgálja ki a HTTP-kérések, de lefagy.</span><span class="sxs-lookup"><span data-stu-id="1055e-256">For example, suppose that a container is serving HTTP requests but hangs for some reason.</span></span> <span data-ttu-id="1055e-257">A tároló nem összeomlás, de bármilyen kérelmek leállt.</span><span class="sxs-lookup"><span data-stu-id="1055e-257">The container doesn't crash, but it has stopped serving any requests.</span></span> <span data-ttu-id="1055e-258">Egy HTTP végrehajtandó működőképességi határozza meg, ha a mintavétel nem válaszol, és, amely tájékoztatja a Kubernetest, hogy indítsa újra a pod.</span><span class="sxs-lookup"><span data-stu-id="1055e-258">If you define an HTTP liveness probe, the probe will stop responding and that informs Kubernetes to restart the pod.</span></span>

<span data-ttu-id="1055e-259">Mintavételezők tervezésekor az alábbiakban néhány szempontot:</span><span class="sxs-lookup"><span data-stu-id="1055e-259">Here are some considerations when designing probes:</span></span>

- <span data-ttu-id="1055e-260">Ha a kódot egy hosszú indítási ideje, nincs a veszélye annak, hogy a működőképesség folyamat hibát fog jelezni az indítás befejezése előtt.</span><span class="sxs-lookup"><span data-stu-id="1055e-260">If your code has a long startup time, there is a danger that a liveness probe will report failure before the startup completes.</span></span> <span data-ttu-id="1055e-261">Ennek megelőzése érdekében használja az initialDelaySeconds beállítást, ami késlelteti a mintavétel elindítását.</span><span class="sxs-lookup"><span data-stu-id="1055e-261">To prevent this, use the initialDelaySeconds setting, which delays the probe from starting.</span></span>

- <span data-ttu-id="1055e-262">A végrehajtandó működőképességi nem segít, kivéve, ha a pod újraindítása valószínű, hogy megfelelő állapotba állítsa vissza.</span><span class="sxs-lookup"><span data-stu-id="1055e-262">A liveness probe doesn't help unless restarting the pod is likely to restore it to a healthy state.</span></span> <span data-ttu-id="1055e-263">Használhatja a működőképesség memóriavesztés vagy váratlan holtpontok ellen, de nincs pont újrapróbálásakor, amelyet szeretne azonnal újra sikertelen podot.</span><span class="sxs-lookup"><span data-stu-id="1055e-263">You can use a liveness probe to mitigate against memory leaks or unexpected deadlocks, but there's no point in restarting a pod that's going to immediately fail again.</span></span>

- <span data-ttu-id="1055e-264">Néha készültségi mintavételek szolgálnak a függő szolgáltatások ellenőrzése.</span><span class="sxs-lookup"><span data-stu-id="1055e-264">Sometimes readiness probes are used to check dependent services.</span></span> <span data-ttu-id="1055e-265">Például ha podot függőség, adatbázis, a működőképesség előfordulhat, hogy ellenőrizze az adatbázis-kapcsolat.</span><span class="sxs-lookup"><span data-stu-id="1055e-265">For example, if a pod has a dependency on a database, the liveness probe might check the database connection.</span></span> <span data-ttu-id="1055e-266">Ez a megközelítés azonban váratlan problémák hozhat létre.</span><span class="sxs-lookup"><span data-stu-id="1055e-266">However, this approach can create unexpected problems.</span></span> <span data-ttu-id="1055e-267">Elképzelhető, hogy egy külső szolgáltatás valamilyen okból átmenetileg nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="1055e-267">An external service might be temporarily unavailable for some reason.</span></span> <span data-ttu-id="1055e-268">A szolgáltatás összes távolítható el a terheléselosztás, és így létrehozása előtt kaszkádolás révén terjedő hibákat okozó összes podok is sikertelen, a végrehajtandó készenléti teszt, amely miatt.</span><span class="sxs-lookup"><span data-stu-id="1055e-268">That will cause the readiness probe to fail for all the pods in your service, causing all of them to be removed from load balancing, and thus creating cascading failures upstream.</span></span> <span data-ttu-id="1055e-269">Jobb módszer, hogy megvalósítása az újrapróbálkozási kezelése a szolgáltatáson belül úgy, hogy a szolgáltatás megfelelően helyreállíthatja az átmeneti hibák.</span><span class="sxs-lookup"><span data-stu-id="1055e-269">A better approach is to implement retry handling within your service, so that your service can recover correctly from transient failures.</span></span>

### <a name="resource-constraints"></a><span data-ttu-id="1055e-270">Erőforrás-korlátozások</span><span class="sxs-lookup"><span data-stu-id="1055e-270">Resource constraints</span></span>

<span data-ttu-id="1055e-271">Az erőforrás-versengés hatással lehet egy szolgáltatás rendelkezésre állását.</span><span class="sxs-lookup"><span data-stu-id="1055e-271">Resource contention can affect the availability of a service.</span></span> <span data-ttu-id="1055e-272">Adja meg a for containers szolgáltatásban, korlátozott erőforrások, így egyetlen tároló nem ne terhelje tovább a fürterőforrások (memória és CPU).</span><span class="sxs-lookup"><span data-stu-id="1055e-272">Define resource constraints for containers, so that a single container cannot overwhelm the cluster resources (memory and CPU).</span></span> <span data-ttu-id="1055e-273">Nem tároló-erőforrások, például szálak vagy a hálózati kapcsolat, fontolja meg a [válaszfal minta](/azure/architecture/patterns/bulkhead) erőforrások elkülönítése.</span><span class="sxs-lookup"><span data-stu-id="1055e-273">For non-container resources, such as threads or network connections, consider using the [Bulkhead Pattern](/azure/architecture/patterns/bulkhead) to isolate resources.</span></span>

<span data-ttu-id="1055e-274">Erőforráskvóták használata korlátozni az erőforrások teljes névtér esetén engedélyezett.</span><span class="sxs-lookup"><span data-stu-id="1055e-274">Use resource quotas to limit the total resources allowed for a namespace.</span></span> <span data-ttu-id="1055e-275">Ezzel a módszerrel az előtér nem ez pedig erőforráshiányt a háttérszolgáltatások erőforrások vagy fordítva.</span><span class="sxs-lookup"><span data-stu-id="1055e-275">That way, the front end can't starve the backend services for resources or vice-versa.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="1055e-276">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="1055e-276">Security considerations</span></span>

### <a name="role-based-access-control-rbac"></a><span data-ttu-id="1055e-277">Szerepköralapú hozzáférés-vezérlés (RBAC)</span><span class="sxs-lookup"><span data-stu-id="1055e-277">Role based access control (RBAC)</span></span>

<span data-ttu-id="1055e-278">Kubernetes és az Azure egyaránt rendelkezik mechanizmusok szerepköralapú hozzáférés-vezérlés (RBAC):</span><span class="sxs-lookup"><span data-stu-id="1055e-278">Kubernetes and Azure both have mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="1055e-279">Az Azure RBAC az Azure-ban, beleértve az új Azure-erőforrások létrehozása erőforrások elérését szabályozza.</span><span class="sxs-lookup"><span data-stu-id="1055e-279">Azure RBAC controls access to resources in Azure, including the ability to create new Azure resources.</span></span> <span data-ttu-id="1055e-280">Engedélyeket rendelhet felhasználókhoz, csoportokhoz és egyszerű szolgáltatásokat.</span><span class="sxs-lookup"><span data-stu-id="1055e-280">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="1055e-281">(Egy egyszerű szolgáltatást az alkalmazások által használt biztonsági azonosítót.)</span><span class="sxs-lookup"><span data-stu-id="1055e-281">(A service principal is a security identity used by applications.)</span></span>

- <span data-ttu-id="1055e-282">Kubernetes RBAC szabályozza a Kubernetes API-engedélyek.</span><span class="sxs-lookup"><span data-stu-id="1055e-282">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="1055e-283">Például podok létrehozása és ajánlati podok olyan műveletek engedélyezett (vagy elutasítva) RBAC-n keresztül a felhasználó számára.</span><span class="sxs-lookup"><span data-stu-id="1055e-283">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="1055e-284">Kubernetes-engedélyek hozzárendelése a felhasználókhoz, hozzon létre *szerepkörök* és *szerepkör kötések*:</span><span class="sxs-lookup"><span data-stu-id="1055e-284">To assign Kubernetes permissions to users, you create *roles* and *role bindings*:</span></span>

  - <span data-ttu-id="1055e-285">A szerepkör az egy adott névtéren belül vonatkozó engedélyek egy készletét.</span><span class="sxs-lookup"><span data-stu-id="1055e-285">A Role is a set of permissions that apply within a namespace.</span></span> <span data-ttu-id="1055e-286">Engedélyek vannak megadva, az igék (beolvasása, frissítése, létrehozása és törlése) az erőforrások (podok, központi telepítések, stb.).</span><span class="sxs-lookup"><span data-stu-id="1055e-286">Permissions are defined as verbs (get, update, create, delete) on resources (pods, deployments, etc.).</span></span>

  - <span data-ttu-id="1055e-287">Egy RoleBinding felhasználókat és csoportokat hozzárendeli egy szerepkörhöz.</span><span class="sxs-lookup"><span data-stu-id="1055e-287">A RoleBinding assigns users or groups to a Role.</span></span>

  - <span data-ttu-id="1055e-288">Emellett van egy ClusterRole objektum, amely a szerepkör hasonlít, de minden névtérben létrehozott az egész fürt vonatkozik.</span><span class="sxs-lookup"><span data-stu-id="1055e-288">There is also a ClusterRole object, which is like a Role but applies to the entire cluster, across all namespaces.</span></span> <span data-ttu-id="1055e-289">Felhasználók vagy csoportok hozzárendelése egy ClusterRole, hozzon létre egy ClusterRoleBinding.</span><span class="sxs-lookup"><span data-stu-id="1055e-289">To assign users or groups to a ClusterRole, create a ClusterRoleBinding.</span></span>

<span data-ttu-id="1055e-290">AKS egyesíti e két RBAC mechanizmusok.</span><span class="sxs-lookup"><span data-stu-id="1055e-290">AKS integrates these two RBAC mechanisms.</span></span> <span data-ttu-id="1055e-291">Ha egy AKS-fürtöt hoz létre, konfigurálhatja úgy, hogy a felhasználók hitelesítéséhez az Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1055e-291">When you create an AKS cluster, you can configure it to use Azure AD for user authentication.</span></span> <span data-ttu-id="1055e-292">Ez beállítása a részletekért lásd: [integrálása az Azure Active Directory és az Azure Kubernetes Service](/azure/aks/aad-integration).</span><span class="sxs-lookup"><span data-stu-id="1055e-292">For details on how to set this up, see [Integrate Azure Active Directory with Azure Kubernetes Service](/azure/aks/aad-integration).</span></span>

<span data-ttu-id="1055e-293">Ha ez lett konfigurálva, a Kubernetes API-t (például a kubectl) hozzáférni kívánó felhasználó be kell jelentkeznie a az Azure AD hitelesítő adataik használatával.</span><span class="sxs-lookup"><span data-stu-id="1055e-293">Once this is configured, a user who wants to access the Kubernetes API (for example, through kubectl) must sign in using their Azure AD credentials.</span></span>

<span data-ttu-id="1055e-294">Alapértelmezés szerint az Azure AD-felhasználót nem érhető el a fürt rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="1055e-294">By default, an Azure AD user has no access to the cluster.</span></span> <span data-ttu-id="1055e-295">Hozzáférés biztosításához a fürt rendszergazdája, tekintse meg az Azure AD-felhasználók vagy csoportok RoleBindings hoz létre.</span><span class="sxs-lookup"><span data-stu-id="1055e-295">To grant access, the cluster administrator creates RoleBindings that refer to Azure AD users or groups.</span></span> <span data-ttu-id="1055e-296">Ha egy felhasználó nem rendelkezik engedélyekkel egy adott művelethez, nem fog működni.</span><span class="sxs-lookup"><span data-stu-id="1055e-296">If a user doesn't have permissions for a particular operation, it will fail.</span></span>

<span data-ttu-id="1055e-297">Ha a felhasználók nem férhetnek alapértelmezés szerint, hogyan a fürt rendszergazdai rendelkezik engedéllyel a szerepkör-kötések létrehozásához az első helyen?</span><span class="sxs-lookup"><span data-stu-id="1055e-297">If users have no access by default, how does the cluster admin have permission to create the role bindings in the first place?</span></span> <span data-ttu-id="1055e-298">AKS-fürt rendelkezik-e hitelesítő adatokat a Kubernetes API-t kiszolgáló meghívására szolgáló két típusú: fürt felhasználói és a fürt rendszergazdája. A fürt rendszergazdai hitelesítő adatait a fürt teljes hozzáférési jogot.</span><span class="sxs-lookup"><span data-stu-id="1055e-298">An AKS cluster actually has two types of credentials for calling the Kubernetes API server: cluster user and cluster admin. The cluster admin credentials grant full access to the cluster.</span></span> <span data-ttu-id="1055e-299">Az Azure CLI-paranccsal `az aks get-credentials --admin` letölti a fürt rendszergazdai hitelesítő adatait, és a kubeconfig fájlba menti őket.</span><span class="sxs-lookup"><span data-stu-id="1055e-299">The Azure CLI command `az aks get-credentials --admin` downloads the cluster admin credentials and saves them into your kubeconfig file.</span></span> <span data-ttu-id="1055e-300">A fürt rendszergazdája a kubeconfig segítségével szerepköröket és szerepkör-kötések létrehozása.</span><span class="sxs-lookup"><span data-stu-id="1055e-300">The cluster administrator can use this kubeconfig to create roles and role bindings.</span></span>

<span data-ttu-id="1055e-301">Olyan hatásosak a fürt rendszergazdai hitelesítő adatokat, mert az Azure RBAC használatával elérésének korlátozása:</span><span class="sxs-lookup"><span data-stu-id="1055e-301">Because the cluster admin credentials are so powerful, use Azure RBAC to restrict access to them:</span></span>

- <span data-ttu-id="1055e-302">Az "Azure Kubernetes Service fürt rendszergazdai szerepkör" jogosult töltse le a fürt rendszergazdai hitelesítő adatait.</span><span class="sxs-lookup"><span data-stu-id="1055e-302">The "Azure Kubernetes Service Cluster Admin Role" has permission to download the cluster admin credentials.</span></span> <span data-ttu-id="1055e-303">Csak a fürt rendszergazdák ezt a szerepkört kell rendelni.</span><span class="sxs-lookup"><span data-stu-id="1055e-303">Only cluster administrators should be assigned to this role.</span></span>

- <span data-ttu-id="1055e-304">Az "Azure Kubernetes Service fürt felhasználói szerepkörhöz" a fürt felhasználói hitelesítő adatok letöltése szükséges jogosultsággal rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="1055e-304">The "Azure Kubernetes Service Cluster User Role" has permission to download the cluster user credentials.</span></span> <span data-ttu-id="1055e-305">A nem rendszergazda felhasználók ehhez a szerepkörhöz is hozzárendelhető.</span><span class="sxs-lookup"><span data-stu-id="1055e-305">Non-admin users can be assigned to this role.</span></span> <span data-ttu-id="1055e-306">Ez a szerepkör nem ad adott engedélyek a fürtben Kubernetes-erőforrások &mdash; , csak lehetővé teszi a felhasználóknak az API-kiszolgálóhoz való csatlakozáshoz.</span><span class="sxs-lookup"><span data-stu-id="1055e-306">This role does not give any particular permissions on Kubernetes resources inside the cluster &mdash; it just allows a user to connect to the API server.</span></span> 

<span data-ttu-id="1055e-307">Az RBAC-szabályzatok (mind a Kubernetes, mind a Azure) határozza meg, ha úgy gondolja, hogy a szervezet a szerepkörökről:</span><span class="sxs-lookup"><span data-stu-id="1055e-307">When you define your RBAC policies (both Kubernetes and Azure), think about the roles in your organization:</span></span>

- <span data-ttu-id="1055e-308">Felhasználók létrehozása vagy egy AKS-fürt törlése és töltse le a rendszergazdai hitelesítő adatait?</span><span class="sxs-lookup"><span data-stu-id="1055e-308">Who can create or delete an AKS cluster and download the admin credentials?</span></span>
- <span data-ttu-id="1055e-309">A fürt felügyeletét?</span><span class="sxs-lookup"><span data-stu-id="1055e-309">Who can administer a cluster?</span></span>
- <span data-ttu-id="1055e-310">Ki is erőforrások létrehozása vagy módosítása egy adott névtéren belül?</span><span class="sxs-lookup"><span data-stu-id="1055e-310">Who can create or update resources within a namespace?</span></span>

<span data-ttu-id="1055e-311">Egy célszerű hatókörhöz Kubernetes RBAC-névteret, szerepkörök és RoleBindings, hanem ClusterRoles és ClusterRoleBindings engedélyeket.</span><span class="sxs-lookup"><span data-stu-id="1055e-311">It's a good practice to scope Kubernetes RBAC permissions by namespace, using Roles and RoleBindings, rather than ClusterRoles and ClusterRoleBindings.</span></span>

<span data-ttu-id="1055e-312">Végül pedig a kérdést, milyen engedélyekkel az AKS-fürt létrehozása és kezelése az Azure-erőforrások, például a terheléselosztók, hálózati vagy tárolási rendelkezik.</span><span class="sxs-lookup"><span data-stu-id="1055e-312">Finally, there is the question of what permissions the AKS cluster has to create and manage Azure resources, such as load balancers, networking, or storage.</span></span> <span data-ttu-id="1055e-313">Hitelesítse magát az Azure API-k, a fürt egy Azure AD-szolgáltatásnevet használja.</span><span class="sxs-lookup"><span data-stu-id="1055e-313">To authenticate itself with Azure APIs, the cluster uses an Azure AD service principal.</span></span> <span data-ttu-id="1055e-314">Ha nem ad meg egy szolgáltatásnevet, a fürt létrehozásakor, az egyik automatikusan létrejön.</span><span class="sxs-lookup"><span data-stu-id="1055e-314">If you don't specify a service principal when you create the cluster, one is created automatically.</span></span> <span data-ttu-id="1055e-315">Viszont azt, először hozza létre a szolgáltatásnevet, és rendelje hozzá a minimális RBAC-engedélyek ajánlott biztonsági eljárás.</span><span class="sxs-lookup"><span data-stu-id="1055e-315">However, it's a good security practice to create the service principal first and assign the minimal RBAC permissions to it.</span></span> <span data-ttu-id="1055e-316">További információkért lásd: [egyszerű szolgáltatások Azure Kubernetes Service-szel](/azure/aks/kubernetes-service-principal).</span><span class="sxs-lookup"><span data-stu-id="1055e-316">For more information, see [Service principals with Azure Kubernetes Service](/azure/aks/kubernetes-service-principal).</span></span>

### <a name="secrets-management-and-application-credentials"></a><span data-ttu-id="1055e-317">Titkos kódok felügyeleti és a hitelesítő adatok</span><span class="sxs-lookup"><span data-stu-id="1055e-317">Secrets management and application credentials</span></span>

<span data-ttu-id="1055e-318">Alkalmazások és szolgáltatások gyakran kell hitelesítő adatokat, amelyek lehetővé teszik külső szolgáltatásokkal, például az Azure Storage vagy az SQL-adatbázishoz való kapcsolódáshoz.</span><span class="sxs-lookup"><span data-stu-id="1055e-318">Applications and services often need credentials that allow them to connect to external services such as Azure Storage or SQL Database.</span></span> <span data-ttu-id="1055e-319">A kihívás, hogy biztonságban ezeket a hitelesítő adatokat, és nem szivárogtatnak ki őket.</span><span class="sxs-lookup"><span data-stu-id="1055e-319">The challenge is to keep these credentials safe and not leak them.</span></span> 

<span data-ttu-id="1055e-320">Azure-erőforrások az egyik lehetőség, hogy felügyelt identitásokat használ.</span><span class="sxs-lookup"><span data-stu-id="1055e-320">For Azure resources, one option is to use managed identities.</span></span> <span data-ttu-id="1055e-321">Egy felügyelt identitás lényege, hogy egy alkalmazás vagy szolgáltatás egy Azure AD-ben tárolt azonosítóval rendelkezik, és ezt az identitást használja az Azure-szolgáltatásokkal való hitelesítéshez.</span><span class="sxs-lookup"><span data-stu-id="1055e-321">The idea of a managed identity is that an application or service has an identity stored in Azure AD, and uses this identity to authenticate with an Azure service.</span></span> <span data-ttu-id="1055e-322">Az alkalmazás vagy szolgáltatás rendelkezik egy egyszerű szolgáltatást az Azure ad-ben készült, és az OAuth 2.0 jogkivonat hitelesíti.</span><span class="sxs-lookup"><span data-stu-id="1055e-322">The application or service has a Service Principal created for it in Azure AD, and authenticates using OAuth 2.0 tokens.</span></span> <span data-ttu-id="1055e-323">A végrehajtó folyamat meghívja a localhost címet beszerezni a jogkivonatot.</span><span class="sxs-lookup"><span data-stu-id="1055e-323">The executing process calls a localhost address to get the token.</span></span> <span data-ttu-id="1055e-324">Ezzel a módszerrel nem kell minden olyan jelszavakat és a kapcsolati karakterláncokat tárolja.</span><span class="sxs-lookup"><span data-stu-id="1055e-324">That way, you don't need to store any passwords or connection strings.</span></span> <span data-ttu-id="1055e-325">Használhatja a felügyelt identitások az aks-ben identitások rendel az egyes podok használatával a [aad-pod-identity](https://github.com/Azure/aad-pod-identity) projekt.</span><span class="sxs-lookup"><span data-stu-id="1055e-325">You can use managed identities in AKS by assigning identities to individual pods, using the [aad-pod-identity](https://github.com/Azure/aad-pod-identity) project.</span></span>

<span data-ttu-id="1055e-326">Jelenleg nem minden Azure-szolgáltatásokat támogatja a hitelesítés felügyelt identitások használatával.</span><span class="sxs-lookup"><span data-stu-id="1055e-326">Currently, not all Azure services support authentication using managed identities.</span></span> <span data-ttu-id="1055e-327">Egy listát lásd: [Azure-szolgáltatások, hogy a támogatás az Azure AD-hitelesítés](/azure/active-directory/managed-identities-azure-resources/services-support-msi).</span><span class="sxs-lookup"><span data-stu-id="1055e-327">For a list, see [Azure services that support Azure AD authentication](/azure/active-directory/managed-identities-azure-resources/services-support-msi).</span></span>

<span data-ttu-id="1055e-328">Még a felügyelt identitások, akkor valószínűleg kell egyes hitelesítő adatokat vagy más alkalmazás titkainak tárolásához az Azure-szolgáltatások, amelyek nem támogatják a felügyelt identitásokból, harmadik féltől származó szolgáltatásokkal, API-kulcsok és így tovább.</span><span class="sxs-lookup"><span data-stu-id="1055e-328">Even with managed identities, you'll probably need to store some credentials or other application secrets, whether for Azure services that don't support managed identities, third-party services, API keys, and so on.</span></span> <span data-ttu-id="1055e-329">Íme néhány lehetőség a titkos kulcsok biztonságos tárolása:</span><span class="sxs-lookup"><span data-stu-id="1055e-329">Here are some options for storing secrets securely:</span></span>

- <span data-ttu-id="1055e-330">Az Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="1055e-330">Azure Key Vault.</span></span> <span data-ttu-id="1055e-331">Az aks-ben akkor is csatlakoztathatja egy vagy több titkos kulcsok a Key Vaultból kötetként.</span><span class="sxs-lookup"><span data-stu-id="1055e-331">In AKS, you can mount one or more secrets from Key Vault as a volume.</span></span> <span data-ttu-id="1055e-332">A kötet a titkos kulcsok a Key Vault olvassa be.</span><span class="sxs-lookup"><span data-stu-id="1055e-332">The volume reads the secrets from Key Vault.</span></span> <span data-ttu-id="1055e-333">A pod el tudja olvasni a titkos kulcsok, csakúgy, mint a rendszeres kötet.</span><span class="sxs-lookup"><span data-stu-id="1055e-333">The pod can then read the secrets just like a regular volume.</span></span> <span data-ttu-id="1055e-334">További információkért lásd: a [Kubernetes-KeyVault-FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) projektet a Githubon.</span><span class="sxs-lookup"><span data-stu-id="1055e-334">For more information, see the [Kubernetes-KeyVault-FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol) project on GitHub.</span></span>

    <span data-ttu-id="1055e-335">A pod hitelesíti magát vagy egy pod identitással (fentebb leírt) vagy egy Azure AD-szolgáltatásnév és a egy ügyfélkulcsot használatával.</span><span class="sxs-lookup"><span data-stu-id="1055e-335">The pod authenticates itself by using either a pod identity (described above) or by using an Azure AD Service Principal along with a client secret.</span></span> <span data-ttu-id="1055e-336">Pod identitások használata ajánlott, mert a titkos ügyfélkulcsot ebben az esetben nincs szükség.</span><span class="sxs-lookup"><span data-stu-id="1055e-336">Using pod identities is recommended because the client secret isn't needed in that case.</span></span> 

- <span data-ttu-id="1055e-337">HashiCorp Vault.</span><span class="sxs-lookup"><span data-stu-id="1055e-337">HashiCorp Vault.</span></span> <span data-ttu-id="1055e-338">Kubernetes-alkalmazások az Azure ad-ben felügyelt identitások használatával HashiCorp Vault hitelesítheti.</span><span class="sxs-lookup"><span data-stu-id="1055e-338">Kubernetes applications can authenticate with HashiCorp Vault using Azure AD managed identities.</span></span> <span data-ttu-id="1055e-339">Lásd: [HashiCorp Vault ad elő az Azure Active Directory](https://open.microsoft.com/2018/04/10/scaling-tips-hashicorp-vault-azure-active-directory/).</span><span class="sxs-lookup"><span data-stu-id="1055e-339">See [HashiCorp Vault speaks Azure Active Directory](https://open.microsoft.com/2018/04/10/scaling-tips-hashicorp-vault-azure-active-directory/).</span></span> <span data-ttu-id="1055e-340">Vault helyezhet üzembe Kubernetes, de azt javasoljuk, futtatásához egy külön dedikált fürtben az alkalmazás-fürtből.</span><span class="sxs-lookup"><span data-stu-id="1055e-340">You can deploy Vault itself to Kubernetes, but it's recommend to run it in a separate dedicated cluster from your application cluster.</span></span> 

- <span data-ttu-id="1055e-341">Kubernetes titkos kulcsok.</span><span class="sxs-lookup"><span data-stu-id="1055e-341">Kubernetes secrets.</span></span> <span data-ttu-id="1055e-342">Egy másik lehetőség, egyszerűen Kubernetes titkos kódok használatára.</span><span class="sxs-lookup"><span data-stu-id="1055e-342">Another option is simply to use Kubernetes secrets.</span></span> <span data-ttu-id="1055e-343">Ez a beállítás a legkönnyebben konfigurálható, de áttekinthet néhány problémát.</span><span class="sxs-lookup"><span data-stu-id="1055e-343">This option is the easiest to configure but has some challenges.</span></span> <span data-ttu-id="1055e-344">Titkos kódok találhatók etcd, ez az elosztott kulcs-érték tároló.</span><span class="sxs-lookup"><span data-stu-id="1055e-344">Secrets are stored in etcd, which is a distributed key-value store.</span></span> <span data-ttu-id="1055e-345">Az AKS [titkosítja az inaktív etcd](https://github.com/Azure/kubernetes-kms#azure-kubernetes-service-aks).</span><span class="sxs-lookup"><span data-stu-id="1055e-345">AKS [encrypts etcd at rest](https://github.com/Azure/kubernetes-kms#azure-kubernetes-service-aks).</span></span> <span data-ttu-id="1055e-346">A Microsoft felügyeli, a titkosítási kulcsokat.</span><span class="sxs-lookup"><span data-stu-id="1055e-346">Microsoft manages the encryption keys.</span></span>

<span data-ttu-id="1055e-347">Több előnye is van, a rendszer, például a HashiCorp tár vagy az Azure Key Vault használatával például biztosítja:</span><span class="sxs-lookup"><span data-stu-id="1055e-347">Using a system like HashiCorp Vault or Azure Key Vault provides several advantages, such as:</span></span>

- <span data-ttu-id="1055e-348">A titkok központosított felügyeletet.</span><span class="sxs-lookup"><span data-stu-id="1055e-348">Centralized control of secrets.</span></span>
- <span data-ttu-id="1055e-349">Annak ellenőrzése, hogy az összes titkos inaktív vannak titkosítva.</span><span class="sxs-lookup"><span data-stu-id="1055e-349">Ensuring that all secrets are encrypted at rest.</span></span>
- <span data-ttu-id="1055e-350">Központi kulcskezelési.</span><span class="sxs-lookup"><span data-stu-id="1055e-350">Centralized key management.</span></span>
- <span data-ttu-id="1055e-351">Hozzáférés-vezérlés a titkos kulcsok.</span><span class="sxs-lookup"><span data-stu-id="1055e-351">Access control of secrets.</span></span>
- <span data-ttu-id="1055e-352">Naplózás</span><span class="sxs-lookup"><span data-stu-id="1055e-352">Auditing</span></span>

### <a name="pod-and-container-security"></a><span data-ttu-id="1055e-353">Podok és tárolók biztonságával</span><span class="sxs-lookup"><span data-stu-id="1055e-353">Pod and container security</span></span>

<span data-ttu-id="1055e-354">Ez a lista természetesen nem teljes körű, de Íme néhány a podok és tárolók biztonságával kapcsolatos ajánlott eljárásokat:</span><span class="sxs-lookup"><span data-stu-id="1055e-354">This list is certainly not exhaustive, but here are some recommended practices for securing your pods and containers:</span></span> 

<span data-ttu-id="1055e-355">Védett módban nem futnak a tárolók.</span><span class="sxs-lookup"><span data-stu-id="1055e-355">Don't run containers in privileged mode.</span></span> <span data-ttu-id="1055e-356">Védett módban hozzáférést biztosít egy tárolót a gazdagép összes eszközre.</span><span class="sxs-lookup"><span data-stu-id="1055e-356">Privileged mode gives a container access to all devices on the host.</span></span> <span data-ttu-id="1055e-357">A kiemelt jogosultságú módban futó tárolók letiltása a Pod biztonsági házirendjében is megadhatja.</span><span class="sxs-lookup"><span data-stu-id="1055e-357">You can set Pod Security Policy to disallow containers from running in privileged mode.</span></span> 

<span data-ttu-id="1055e-358">Ha lehetséges, kerülje a legfelső szintű tárolókban futó folyamatok.</span><span class="sxs-lookup"><span data-stu-id="1055e-358">When possible, avoid running processes as root inside containers.</span></span> <span data-ttu-id="1055e-359">Tárolók nem biztosítanak, biztonsági szempontból a teljes elkülönítést, így jobb egy tároló folyamatot futtató nem kiemelt jogosultságú felhasználó.</span><span class="sxs-lookup"><span data-stu-id="1055e-359">Containers do not provide complete isolation from a security standpoint, so it's better to run a container process as a non-privileged user.</span></span> 

<span data-ttu-id="1055e-360">Store kép olyan megbízható privát beállításjegyzékbe, például az Azure Container Registry vagy a Docker-beállításjegyzék megbízható.</span><span class="sxs-lookup"><span data-stu-id="1055e-360">Store images in a trusted private registry, such as Azure Container Registry or Docker Trusted Registry.</span></span> <span data-ttu-id="1055e-361">A Kubernetes érvényesítésekor már a betegfelvétel webhookok használatával győződjön meg arról, hogy podok is csak rendszerképek lekérése a megbízható beállításjegyzék.</span><span class="sxs-lookup"><span data-stu-id="1055e-361">Use a validating admission webhook in Kubernetes to ensure that pods can only pull images from the trusted registry.</span></span>

<span data-ttu-id="1055e-362">Az ismert biztonsági rések felderítéséhez, például Twistlock és a Tengerkék, amelyek az Azure piactéren elérhető keresési megoldások használata kiszűrhető.</span><span class="sxs-lookup"><span data-stu-id="1055e-362">Scan images for known vulnerabilities, using a scanning solution such as Twistlock and Aqua, which are available through the Azure Marketplace.</span></span>

<span data-ttu-id="1055e-363">Automatizálhatja a lemezkép javítás ACR feladatokat, az Azure Container Registry szolgáltatás használatával.</span><span class="sxs-lookup"><span data-stu-id="1055e-363">Automate image patching using ACR Tasks, a feature of Azure Container Registry.</span></span> <span data-ttu-id="1055e-364">Egy tárolórendszerképet a rétegek épül.</span><span class="sxs-lookup"><span data-stu-id="1055e-364">A container image is built up from layers.</span></span> <span data-ttu-id="1055e-365">Az alap réteg tartalmazza az operációsrendszer-lemezkép és az alkalmazás keretrendszer-lemezképek, például az ASP.NET Core- vagy node.js nyelven.</span><span class="sxs-lookup"><span data-stu-id="1055e-365">The base layers include the OS image and application framework images, such as ASP.NET Core or Node.js.</span></span> <span data-ttu-id="1055e-366">Az alaplemezképek általában jönnek létre az alkalmazásfejlesztők a felsőbb rétegbeli, és más projekt maintainers kell megőrizni.</span><span class="sxs-lookup"><span data-stu-id="1055e-366">The base images are typically created upstream from the application developers, and are maintained by other project maintainers.</span></span> <span data-ttu-id="1055e-367">Ha ezek a lemezképek felső telepítve, fontos frissítését, tesztelése és ismételt üzembe helyezése saját lemezképeket, hogy minden olyan ismert biztonsági rések nem hagyja.</span><span class="sxs-lookup"><span data-stu-id="1055e-367">When these images are patched upstream, it's important to update, test, and redeploy your own images, so that you don't leave any known security vulnerabilities.</span></span> <span data-ttu-id="1055e-368">ACR-feladatok segítségével automatizálni a folyamatot.</span><span class="sxs-lookup"><span data-stu-id="1055e-368">ACR Tasks can help to automate this process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="1055e-369">Üzembe helyezés (CI/CD) kapcsolatos szempontok</span><span class="sxs-lookup"><span data-stu-id="1055e-369">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="1055e-370">Az alábbiakban néhány célja a mikroszolgáltatási architektúra egy robusztus CI/CD folyamatot:</span><span class="sxs-lookup"><span data-stu-id="1055e-370">Here are some goals of a robust CI/CD process for a microservices architecture:</span></span>

- <span data-ttu-id="1055e-371">Minden egyes csapat létrehozhat és üzembe helyezése a szolgáltatások egymástól függetlenül, tulajdonos érintő vagy más csapatok megszakítása nélkül.</span><span class="sxs-lookup"><span data-stu-id="1055e-371">Each team can build and deploy the services that it owns independently, without affecting or disrupting other teams.</span></span>

- <span data-ttu-id="1055e-372">A szolgáltatás egy új verziója éles üzembe helyezés, mielőtt megtörténik fejlesztési/tesztelési/QA Environment ellenőrzés céljából.</span><span class="sxs-lookup"><span data-stu-id="1055e-372">Before a new version of a service is deployed to production, it gets deployed to dev/test/QA environments for validation.</span></span> <span data-ttu-id="1055e-373">Minőségi kapuk a rendszer minden egyes fázisában érvényesíti.</span><span class="sxs-lookup"><span data-stu-id="1055e-373">Quality gates are enforced at each stage.</span></span>

- <span data-ttu-id="1055e-374">A szolgáltatás egy új verziója lehet az üzembe helyezett egymás melletti korábbi verziójával.</span><span class="sxs-lookup"><span data-stu-id="1055e-374">A new version of a service can be deployed side-by-side with the previous version.</span></span>

- <span data-ttu-id="1055e-375">Megfelelő hozzáférés-vezérlési házirendeket vannak érvényben.</span><span class="sxs-lookup"><span data-stu-id="1055e-375">Sufficient access control policies are in place.</span></span>

- <span data-ttu-id="1055e-376">A tárolólemezképeket az éles környezetben üzembe helyezett megbízható.</span><span class="sxs-lookup"><span data-stu-id="1055e-376">You can trust the container images that are deployed to production.</span></span>

### <a name="isolation-of-environments"></a><span data-ttu-id="1055e-377">A környezetek elkülönítése</span><span class="sxs-lookup"><span data-stu-id="1055e-377">Isolation of environments</span></span>

<span data-ttu-id="1055e-378">Kell több környezetet, ahol a szolgáltatások, beleértve a fejlesztési, füst tesztelése, integráció tesztelése, terheléses tesztelés díjaival, és végül éles környezetben telepít.</span><span class="sxs-lookup"><span data-stu-id="1055e-378">You will have multiple environments where you deploy services, including environments for development, smoke testing, integration testing, load testing, and finally production.</span></span> <span data-ttu-id="1055e-379">Ezekben a környezetekben kell bizonyos fokú elkülönítés.</span><span class="sxs-lookup"><span data-stu-id="1055e-379">These environments need some level of isolation.</span></span> <span data-ttu-id="1055e-380">A Kubernetes választhat, hogy fizikai elkülönítése és logikai elkülönítése között.</span><span class="sxs-lookup"><span data-stu-id="1055e-380">In Kubernetes, you have a choice between physical isolation and logical isolation.</span></span> <span data-ttu-id="1055e-381">Fizikai elkülönítése azt jelenti, hogy különálló fürt üzembe helyezése.</span><span class="sxs-lookup"><span data-stu-id="1055e-381">Physical isolation means deploying to separate clusters.</span></span> <span data-ttu-id="1055e-382">Logikai elkülönítéssel használ, a névterek és a házirendeket, a fentebb leírt módon.</span><span class="sxs-lookup"><span data-stu-id="1055e-382">Logical isolation makes use of namespaces and policies, as described earlier.</span></span>

<span data-ttu-id="1055e-383">Azt javasoljuk, hogy hozzon létre egy dedikált fürt és a fejlesztési-tesztelési környezetek esetében külön fürtben.</span><span class="sxs-lookup"><span data-stu-id="1055e-383">Our recommendation is to create a dedicated production cluster along with a separate cluster for your dev/test environments.</span></span> <span data-ttu-id="1055e-384">Logikai elkülönítés használatával a fejlesztési-tesztelési fürtön belüli környezeteket.</span><span class="sxs-lookup"><span data-stu-id="1055e-384">Use logical isolation to separate environments within the dev/test cluster.</span></span> <span data-ttu-id="1055e-385">A fejlesztési-tesztelési fürtre telepített szolgáltatások soha nem üzleti adatokat tartalmazó adattárakra hozzáféréssel kell rendelkeznie.</span><span class="sxs-lookup"><span data-stu-id="1055e-385">Services deployed to the dev/test cluster should never have access to data stores that hold business data.</span></span> 

### <a name="helm"></a><span data-ttu-id="1055e-386">Helm</span><span class="sxs-lookup"><span data-stu-id="1055e-386">Helm</span></span>

<span data-ttu-id="1055e-387">Fontolja meg a Helm használatával létrehozásának és üzembe helyezésének a szolgáltatások kezeléséhez.</span><span class="sxs-lookup"><span data-stu-id="1055e-387">Consider using Helm to manage building and deploying services.</span></span> <span data-ttu-id="1055e-388">A Helm, amelyek segítenek a CI/CD-funkcióit tartalmazza:</span><span class="sxs-lookup"><span data-stu-id="1055e-388">Some of the features of Helm that help with CI/CD include:</span></span>

- <span data-ttu-id="1055e-389">Rendszerezéséhez a Kubernetes-objektumokat az egy adott mikroszolgáltatás egyetlen Helm-diagram be.</span><span class="sxs-lookup"><span data-stu-id="1055e-389">Organizing all of the Kubernetes objects for a particular microservice into a single Helm chart.</span></span>
- <span data-ttu-id="1055e-390">A diagram kubectl parancsokat helyett egy egyszeri helm parancs telepítése.</span><span class="sxs-lookup"><span data-stu-id="1055e-390">Deploying the chart as a single helm command, rather than a series of kubectl commands.</span></span>
- <span data-ttu-id="1055e-391">Követési frissítések és a módosításokat, Szemantikus verziószámozást elkészíthetők visszaállítása egy korábbi verziójának használatával.</span><span class="sxs-lookup"><span data-stu-id="1055e-391">Tracking updates and revisions, using semantic versioning, along with the ability to roll back to a previous version.</span></span>
- <span data-ttu-id="1055e-392">A sablonok információkat, például a címkék és a választók, elkerülhető a tartalomkiszolgálón használatát.</span><span class="sxs-lookup"><span data-stu-id="1055e-392">The use of templates to avoid duplicating information, such as labels and selectors, across many files.</span></span>
- <span data-ttu-id="1055e-393">Diagramok közötti függőségek kezelése.</span><span class="sxs-lookup"><span data-stu-id="1055e-393">Managing dependencies between charts.</span></span>
- <span data-ttu-id="1055e-394">Diagramok közzétételét egy Helm-adattárhoz, például az Azure Container Registrybe, és integrálja a buildelési folyamat.</span><span class="sxs-lookup"><span data-stu-id="1055e-394">Publishing charts to a Helm repository, such as Azure Container Registry, and integrating them with the build pipeline.</span></span>

<span data-ttu-id="1055e-395">További információ a Container Registry használatával, egy Helm-adattárhoz: [használata Azure Container Registry vagy a Helm az alkalmazás diagramok](/azure/container-registry/container-registry-helm-repos).</span><span class="sxs-lookup"><span data-stu-id="1055e-395">For more information about using Container Registry as a Helm repository, see [Use Azure Container Registry as a Helm repository for your application charts](/azure/container-registry/container-registry-helm-repos).</span></span>

### <a name="cicd-workflow"></a><span data-ttu-id="1055e-396">CI/CD-munkafolyamat</span><span class="sxs-lookup"><span data-stu-id="1055e-396">CI/CD workflow</span></span>

<span data-ttu-id="1055e-397">Mielőtt létrehozná a CI/CD munkafolyamat, ismernie kell a hogyan kódbázis fog strukturált és felügyelt.</span><span class="sxs-lookup"><span data-stu-id="1055e-397">Before creating a CI/CD workflow, you must know how the code base will be structured and managed.</span></span>

- <span data-ttu-id="1055e-398">Működnek-e a teams, külön referenciákhoz vagy egy monorepo (egyetlen adattár)?</span><span class="sxs-lookup"><span data-stu-id="1055e-398">Do teams work in separate respositories or in a monorepo (single respository)?</span></span>
- <span data-ttu-id="1055e-399">Mi az az elágazási stratégia?</span><span class="sxs-lookup"><span data-stu-id="1055e-399">What is your branching strategy?</span></span>
- <span data-ttu-id="1055e-400">Akik beküldéssel telepíthet az éles környezetbe?</span><span class="sxs-lookup"><span data-stu-id="1055e-400">Who can push code to production?</span></span> <span data-ttu-id="1055e-401">Egy kiadási szerepkör van?</span><span class="sxs-lookup"><span data-stu-id="1055e-401">Is there a release manager role?</span></span>

<span data-ttu-id="1055e-402">A monorepo megközelítés hozd hónappal számolunk, de vannak előnyei és hátrányai is.</span><span class="sxs-lookup"><span data-stu-id="1055e-402">The monorepo approach has been gaining favor but there are advantages and disadvantages to both.</span></span>

| &nbsp; | <span data-ttu-id="1055e-403">Monorepo</span><span class="sxs-lookup"><span data-stu-id="1055e-403">Monorepo</span></span> | <span data-ttu-id="1055e-404">Több adattárakkal</span><span class="sxs-lookup"><span data-stu-id="1055e-404">Multiple repos</span></span> |
|--------|----------|----------------|
| <span data-ttu-id="1055e-405">**Előnyök**</span><span class="sxs-lookup"><span data-stu-id="1055e-405">**Advantages**</span></span> | <span data-ttu-id="1055e-406">Kód megosztása</span><span class="sxs-lookup"><span data-stu-id="1055e-406">Code sharing</span></span><br/><span data-ttu-id="1055e-407">Könnyebben szabványosíthatja a kódot, és azokat az eszközöket</span><span class="sxs-lookup"><span data-stu-id="1055e-407">Easier to standardize code and tooling</span></span><br/><span data-ttu-id="1055e-408">Könnyebben újrabontása kód</span><span class="sxs-lookup"><span data-stu-id="1055e-408">Easier to refactor code</span></span><br/><span data-ttu-id="1055e-409">Könnyebben – a szabályzat egyetlen nézetben</span><span class="sxs-lookup"><span data-stu-id="1055e-409">Discoverability - single view of the code</span></span><br/> | <span data-ttu-id="1055e-410">Egyértelmű tulajdonjog csapatonként</span><span class="sxs-lookup"><span data-stu-id="1055e-410">Clear ownership per team</span></span><br/><span data-ttu-id="1055e-411">Potenciálisan kevesebb ütközések egyesítése</span><span class="sxs-lookup"><span data-stu-id="1055e-411">Potentially fewer merge conflicts</span></span><br/><span data-ttu-id="1055e-412">Elválasztás álló kényszerítése segít</span><span class="sxs-lookup"><span data-stu-id="1055e-412">Helps to enforce decoupling of microservices</span></span> |
| <span data-ttu-id="1055e-413">**Problémák**</span><span class="sxs-lookup"><span data-stu-id="1055e-413">**Challenges**</span></span> | <span data-ttu-id="1055e-414">Megosztott programkód módosítása hatással lehet a több mikroszolgáltatások</span><span class="sxs-lookup"><span data-stu-id="1055e-414">Changes to shared code can affect multiple microservices</span></span><br/><span data-ttu-id="1055e-415">Az egyesítési ütközések nagyobb lehetőségeit</span><span class="sxs-lookup"><span data-stu-id="1055e-415">Greater potential for merge conflicts</span></span><br/><span data-ttu-id="1055e-416">Azokat az eszközöket kell méretezhető, nagy méretű kódbázis</span><span class="sxs-lookup"><span data-stu-id="1055e-416">Tooling must scale to a large code base</span></span><br/><span data-ttu-id="1055e-417">Hozzáférés-vezérlés</span><span class="sxs-lookup"><span data-stu-id="1055e-417">Access control</span></span><br/><span data-ttu-id="1055e-418">Összetettebb telepítési folyamat</span><span class="sxs-lookup"><span data-stu-id="1055e-418">More complex deployment process</span></span> | <span data-ttu-id="1055e-419">Nehezebb lehet megosztani a kódot</span><span class="sxs-lookup"><span data-stu-id="1055e-419">Harder to share code</span></span><br/><span data-ttu-id="1055e-420">Nehezebb kódolási szabványok kikényszerítésére</span><span class="sxs-lookup"><span data-stu-id="1055e-420">Harder to enforce coding standards</span></span><br/><span data-ttu-id="1055e-421">Függőségkezelés</span><span class="sxs-lookup"><span data-stu-id="1055e-421">Dependency management</span></span><br/><span data-ttu-id="1055e-422">Kód alap, a gyenge felderíthetőség szórt</span><span class="sxs-lookup"><span data-stu-id="1055e-422">Diffuse code base, poor discoverability</span></span><br/><span data-ttu-id="1055e-423">Megosztott infrastruktúra hiánya</span><span class="sxs-lookup"><span data-stu-id="1055e-423">Lack of shared infrastructure</span></span>

<span data-ttu-id="1055e-424">Ebben a szakaszban azt jelenleg egy lehetséges CI/CD-munkafolyamatot, a következő feltételek alapján:</span><span class="sxs-lookup"><span data-stu-id="1055e-424">In this section, we present a possible CI/CD workflow, based on the following assumptions:</span></span>

- <span data-ttu-id="1055e-425">A kódtár monorepo mappák mikroszolgáltatás szerint vannak rendezve.</span><span class="sxs-lookup"><span data-stu-id="1055e-425">The code repository is monorepo, with folders organized by microservice.</span></span>
- <span data-ttu-id="1055e-426">A csapat stratégiáját az elágazási alapján [trönk-alapú fejlesztési](https://trunkbaseddevelopment.com/).</span><span class="sxs-lookup"><span data-stu-id="1055e-426">The team's branching strategy is based on [trunk-based development](https://trunkbaseddevelopment.com/).</span></span>
- <span data-ttu-id="1055e-427">A csapata által használt [Azure folyamatok](/azure/devops/pipelines) a CI/CD-folyamat futtatását.</span><span class="sxs-lookup"><span data-stu-id="1055e-427">The team uses [Azure Pipelines](/azure/devops/pipelines) to run the CI/CD process.</span></span>
- <span data-ttu-id="1055e-428">A csapata által használt [névterek](/azure/container-registry/container-registry-best-practices#repository-namespaces) az Azure Container Registry rendszerképek éles környezetben, amely továbbra is tesztelik rendszerképekből jóváhagyott elkülönítésére.</span><span class="sxs-lookup"><span data-stu-id="1055e-428">The team uses [namespaces](/azure/container-registry/container-registry-best-practices#repository-namespaces) in Azure Container Registry to isolate images that are approved for production from images that are still being tested.</span></span>

<span data-ttu-id="1055e-429">Ebben a példában egy fejlesztői dolgozik egy mikroszolgáltatás-kézbesítési szolgáltatás neve.</span><span class="sxs-lookup"><span data-stu-id="1055e-429">In this example, a developer is working on a microservice called Delivery Service.</span></span> <span data-ttu-id="1055e-430">(A név a leírt referenciaimplementációt származik [Itt](../../microservices/index.md#the-drone-delivery-application).) Egy új szolgáltatás fejlesztésekor a fejlesztői egy funkciót a főágban kód ellenőrzi.</span><span class="sxs-lookup"><span data-stu-id="1055e-430">(The name comes from the reference implementation described [here](../../microservices/index.md#the-drone-delivery-application).) While developing a new feature, the developer checks code into a feature branch.</span></span>

![CI/CD-munkafolyamat](./_images/aks-cicd-1.png)

<span data-ttu-id="1055e-432">Hogy a véglegesítéseket a fiókiroda tiggers a mikroszolgáltatás egy CI buildet.</span><span class="sxs-lookup"><span data-stu-id="1055e-432">Pushing commits to this branch tiggers a CI build for the microservice.</span></span> <span data-ttu-id="1055e-433">Szabályok szerint funkció ágak elnevezése `feature/*`.</span><span class="sxs-lookup"><span data-stu-id="1055e-433">By convention, feature branches are named `feature/*`.</span></span> <span data-ttu-id="1055e-434">A [létrehozása csomagdefiníciós fájl](/azure/devops/pipelines/yaml-schema) tartalmaz egy eseményindítót, amely a kiadásiág-nevet és a forrás elérési útja alapján szűri.</span><span class="sxs-lookup"><span data-stu-id="1055e-434">The [build definition file](/azure/devops/pipelines/yaml-schema) includes a trigger that filters by the branch name and the source path.</span></span> <span data-ttu-id="1055e-435">Ezt a módszert használja, minden egyes csapat a saját build folyamat lehet.</span><span class="sxs-lookup"><span data-stu-id="1055e-435">Using this approach, each team can have its own build pipeline.</span></span>

```yaml
trigger:
  batch: true
  branches:
    include:
    - master
    - feature/*

    exclude:
    - feature/experimental/*

  paths:
     include:
     - /src/shipping/delivery/
```

<span data-ttu-id="1055e-436">Ezen a ponton a munkafolyamatban a CI-build néhány csak minimális mennyiségű kódra ellenőrzés fut:</span><span class="sxs-lookup"><span data-stu-id="1055e-436">At this point in the workflow, the CI build runs some minimal code verification:</span></span>

1. <span data-ttu-id="1055e-437">Kód buildelése</span><span class="sxs-lookup"><span data-stu-id="1055e-437">Build code</span></span>
1. <span data-ttu-id="1055e-438">Futtatni az egységteszteket</span><span class="sxs-lookup"><span data-stu-id="1055e-438">Run unit tests</span></span>

<span data-ttu-id="1055e-439">Itt a cél, hogy tartsa a fejlesztési idő rövid, így a fejlesztő gyors visszajelzés.</span><span class="sxs-lookup"><span data-stu-id="1055e-439">The idea here is to keep the build times short so the developer can get quick feedback.</span></span> <span data-ttu-id="1055e-440">Ha a szolgáltatás készen áll a egyesítése a mesterrel, a fejlesztői megnyílik az új</span><span class="sxs-lookup"><span data-stu-id="1055e-440">When the feature is ready to merge into master, the developer opens a PR.</span></span> <span data-ttu-id="1055e-441">Ez elindít egy másik CI build néhány további ellenőrzést végző:</span><span class="sxs-lookup"><span data-stu-id="1055e-441">This triggers another CI build that performs some additional checks:</span></span>

1. <span data-ttu-id="1055e-442">Kód buildelése</span><span class="sxs-lookup"><span data-stu-id="1055e-442">Build code</span></span>
1. <span data-ttu-id="1055e-443">Futtatni az egységteszteket</span><span class="sxs-lookup"><span data-stu-id="1055e-443">Run unit tests</span></span>
1. <span data-ttu-id="1055e-444">A futtatókörnyezet tárolólemezkép létrehozásához</span><span class="sxs-lookup"><span data-stu-id="1055e-444">Build the runtime container image</span></span>
1. <span data-ttu-id="1055e-445">Futtassa a vizsgálatot a biztonsági rések a rendszerképen</span><span class="sxs-lookup"><span data-stu-id="1055e-445">Run vulnerability scans on the image</span></span>

![CI/CD-munkafolyamat](./_images/aks-cicd-2.png)

> [!NOTE]
> <span data-ttu-id="1055e-447">Az Azure-Adattárakkal, definiálhat [házirendek](/azure/devops/repos/git/branch-policies) ágak védelme érdekében.</span><span class="sxs-lookup"><span data-stu-id="1055e-447">In Azure Repos, you can define [policies](/azure/devops/repos/git/branch-policies) to protect branches.</span></span> <span data-ttu-id="1055e-448">Például a szabályzat szükségük CI a build sikeres létrehozása és a egy jóváhagyás a jóváhagyó egyesítése a mesterrel.</span><span class="sxs-lookup"><span data-stu-id="1055e-448">For example, the policy could require a successful CI build plus a sign-off from an approver in order to merge into master.</span></span>

<span data-ttu-id="1055e-449">Később a csapat a kézbesítési szolgáltatás új verziójának telepítése készen áll.</span><span class="sxs-lookup"><span data-stu-id="1055e-449">At some point, the team is ready to deploy a new version of the Delivery service.</span></span> <span data-ttu-id="1055e-450">Ehhez a kiadáskezelő hoz létre egy ágat a mintában az elnevezési mintázatot: `release/<microservice name>/<semver>`.</span><span class="sxs-lookup"><span data-stu-id="1055e-450">To do so, the release manager creates a branch from master with this naming pattern: `release/<microservice name>/<semver>`.</span></span> <span data-ttu-id="1055e-451">Például: `release/delivery/v1.0.2`.</span><span class="sxs-lookup"><span data-stu-id="1055e-451">For example, `release/delivery/v1.0.2`.</span></span>
<span data-ttu-id="1055e-452">Ez elindít egy teljes CI hozhat létre, amely az előző lépések és:</span><span class="sxs-lookup"><span data-stu-id="1055e-452">This triggers a full CI build that runs all the previous steps plus:</span></span>

1. <span data-ttu-id="1055e-453">A Docker-rendszerkép leküldése az Azure Container Registrybe.</span><span class="sxs-lookup"><span data-stu-id="1055e-453">Push the Docker image to Azure Container Registry.</span></span> <span data-ttu-id="1055e-454">A kép a kiadásiág-nevet származó verziószámmal van megjelölve.</span><span class="sxs-lookup"><span data-stu-id="1055e-454">The image is tagged with the version number taken from the branch name.</span></span>
2. <span data-ttu-id="1055e-455">Futtatás `helm package` csomagolása a Helm-diagram</span><span class="sxs-lookup"><span data-stu-id="1055e-455">Run `helm package` to package the Helm chart</span></span>
3. <span data-ttu-id="1055e-456">A Helm-csomag leküldése a Tárolójegyzékbe futtatásával `az acr helm push`.</span><span class="sxs-lookup"><span data-stu-id="1055e-456">Push the Helm package to Container Registry by running `az acr helm push`.</span></span>

<span data-ttu-id="1055e-457">Ha a build sikeres lesz, aktivál egy folyamatot egy Azure-folyamatok használatával [kibocsátási folyamatok](/azure/devops/pipelines/release/what-is-release-management).</span><span class="sxs-lookup"><span data-stu-id="1055e-457">Assuming this build succeeds, it triggers a deployment process using an Azure Pipelines [release pipeline](/azure/devops/pipelines/release/what-is-release-management).</span></span> <span data-ttu-id="1055e-458">Ez a folyamat</span><span class="sxs-lookup"><span data-stu-id="1055e-458">This pipeline</span></span>

1. <span data-ttu-id="1055e-459">Futtatás `helm upgrade` környezetben való üzembe helyezéséhez a Helm-diagramot a QA.</span><span class="sxs-lookup"><span data-stu-id="1055e-459">Run `helm upgrade` to deploy the Helm chart to a QA environment.</span></span>
1. <span data-ttu-id="1055e-460">Jóváhagyó jelentkezik, mielőtt a csomagot az éles környezetbe helyezi át.</span><span class="sxs-lookup"><span data-stu-id="1055e-460">An approver signs off before the package moves to production.</span></span> <span data-ttu-id="1055e-461">Lásd: [kiadási központi telepítés ellenőrzési jóváhagyások használatával](/azure/devops/pipelines/release/approvals/approvals).</span><span class="sxs-lookup"><span data-stu-id="1055e-461">See [Release deployment control using approvals](/azure/devops/pipelines/release/approvals/approvals).</span></span>
1. <span data-ttu-id="1055e-462">A Docker-rendszerképet az Azure Container Registry a termelési névtér újra címkékkel.</span><span class="sxs-lookup"><span data-stu-id="1055e-462">Re-tag the Docker image for the production namespace in Azure Container Registry.</span></span> <span data-ttu-id="1055e-463">Például, ha az aktuális címke `myrepo.azurecr.io/delivery:v1.0.2`, az éles címke `myrepo.azurecr.io/prod/delivery:v1.0.2`.</span><span class="sxs-lookup"><span data-stu-id="1055e-463">For example, if the current tag is `myrepo.azurecr.io/delivery:v1.0.2`, the production tag is `myrepo.azurecr.io/prod/delivery:v1.0.2`.</span></span>
1. <span data-ttu-id="1055e-464">Futtatás `helm upgrade` üzembe helyezéséhez a Helm-diagram az éles környezetbe.</span><span class="sxs-lookup"><span data-stu-id="1055e-464">Run `helm upgrade` to deploy the Helm chart to the production environment.</span></span>

![CI/CD-munkafolyamat](./_images/aks-cicd-3.png)

<span data-ttu-id="1055e-466">Fontos megjegyezni, hogy egy monorepo, még akkor is, ezek a feladatok korlátozhatja az egyes mikroszolgáltatások úgy, hogy a teams telepítheti a nagy sebességű.</span><span class="sxs-lookup"><span data-stu-id="1055e-466">It's important to remember that even in a monorepo, these tasks can be scoped to individual microservices, so that teams can deploy with high velocity.</span></span> <span data-ttu-id="1055e-467">A folyamat néhány manuális lépésből áll: Lekéréses kérelmek jóváhagyása, a kiadási ágak létrehozása és az éles fürt üzemelő jóváhagyása.</span><span class="sxs-lookup"><span data-stu-id="1055e-467">There are some manual steps in the process: Approving PRs, creating release branches, and approving deployments into the production cluster.</span></span> <span data-ttu-id="1055e-468">Ezen lépések végrehajtása manuális házirend &mdash; azok sikerült teljesen automatizálható, ha a szervezet részesíti előnyben.</span><span class="sxs-lookup"><span data-stu-id="1055e-468">These steps are manual by policy &mdash; they could be completely automated if the organization prefers.</span></span>
