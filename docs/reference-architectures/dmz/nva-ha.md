---
title: "Egy magas rendelkezésre állású virtuális hálózati berendezések telepítése"
description: "Ügyfélszoftverek központi telepítése a virtuális hálózati készülékek a magas rendelkezésre állású."
author: telmosampaio
ms.date: 12/06/2016
pnp.series.title: Network DMZ
pnp.series.prev: secure-vnet-dmz
cardTitle: Deploy highly available network virtual appliances
ms.openlocfilehash: 844c87f535d2a8cb415489cb2c8e840f8c585d7d
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 11/14/2017
---
# <a name="deploy-highly-available-network-virtual-appliances"></a><span data-ttu-id="6b773-103">Virtuális készülékek magas rendelkezésre állású hálózati telepítése</span><span class="sxs-lookup"><span data-stu-id="6b773-103">Deploy highly available network virtual appliances</span></span>

<span data-ttu-id="6b773-104">Ez a cikk a hálózati virtuális készülékek (NVAs) a magas rendelkezésre álláshoz az Azure-ban készlete telepítésének módját ismerteti.</span><span class="sxs-lookup"><span data-stu-id="6b773-104">This article shows how to deploy a set of network virtual appliances (NVAs) for high availability in Azure.</span></span> <span data-ttu-id="6b773-105">NVA általában használt hálózati forgalmat a szegélyhálózaton, más néven DMZ, és más hálózatok és alhálózatok üzenetáramlásának szabályozására.</span><span class="sxs-lookup"><span data-stu-id="6b773-105">An NVA is typically used to control the flow of network traffic from a perimeter network, also known as a DMZ, to other networks or subnets.</span></span> <span data-ttu-id="6b773-106">Az Azure-ban DMZ kapcsolatos további tudnivalókért lásd: [Microsoft cloud services és a hálózati biztonság][cloud-security].</span><span class="sxs-lookup"><span data-stu-id="6b773-106">To learn about implementing a DMZ in Azure, see [Microsoft cloud services and network security][cloud-security].</span></span> <span data-ttu-id="6b773-107">A cikk csak érkező, kimenő csak, és a bemenő és kimenő példa architektúrához tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="6b773-107">The article includes example architectures for ingress only, egress only, and both ingress and egress.</span></span> 

<span data-ttu-id="6b773-108">**Előfeltételek:** megismerheti az Azure hálózatkezelés, a jelen cikk feltételezi [Azure load Balancer terheléselosztók][lb-overview], és [felhasználó által definiált útvonalak] [ udr-overview] (Udr-EK).</span><span class="sxs-lookup"><span data-stu-id="6b773-108">**Prerequisites:** This article assumes a basic understanding of Azure networking, [Azure load balancers][lb-overview], and [user-defined routes][udr-overview] (UDRs).</span></span> 


## <a name="architecture-diagrams"></a><span data-ttu-id="6b773-109">Architektúra</span><span class="sxs-lookup"><span data-stu-id="6b773-109">Architecture Diagrams</span></span>

<span data-ttu-id="6b773-110">NVA számos különböző architektúrákban DMZ telepíthetők.</span><span class="sxs-lookup"><span data-stu-id="6b773-110">An NVA can be deployed to a DMZ in many different architectures.</span></span> <span data-ttu-id="6b773-111">Például a következőképpen ábrázolható használatát egy [NVA egyetlen] [ nva-scenario] érkező számára.</span><span class="sxs-lookup"><span data-stu-id="6b773-111">For example, the following figure illustrates the use of a [single NVA][nva-scenario] for ingress.</span></span> 

<span data-ttu-id="6b773-112">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="6b773-112">![[0]][0]</span></span>

<span data-ttu-id="6b773-113">Ebben az architektúrában az NVA biztosít a biztonságos hálózati határ ellenőrzése az összes bejövő és kimenő hálózati forgalom, és csak a forgalmat, amely megfelel a hálózati biztonsági szabályok átadásakor.</span><span class="sxs-lookup"><span data-stu-id="6b773-113">In this architecture, the NVA provides a secure network boundary by checking all inbound and outbound network traffic and passing only the traffic that meets network security rules.</span></span> <span data-ttu-id="6b773-114">Azonban, hogy az összes hálózati forgalom haladnak keresztül az NVA azt jelenti, hogy az NVA a hibaérzékeny pontok kialakulását a hálózaton.</span><span class="sxs-lookup"><span data-stu-id="6b773-114">However, the fact that all network traffic must pass through the NVA means that the NVA is a single point of failure in the network.</span></span> <span data-ttu-id="6b773-115">Az NVA nem sikerül, ha nincs más útvonal a hálózati forgalmat, és a háttér-alhálózat nem érhetők el.</span><span class="sxs-lookup"><span data-stu-id="6b773-115">If the NVA fails, there is no other path for network traffic and all the back-end subnets are unavailable.</span></span>

<span data-ttu-id="6b773-116">NVA magas rendelkezésre állásúvá tételéhez telepítsen több NVA be egy rendelkezésre állási csoportot.</span><span class="sxs-lookup"><span data-stu-id="6b773-116">To make an NVA highly available, deploy more than one NVA into an availability set.</span></span>    

<span data-ttu-id="6b773-117">A következő architektúrák azt mutatják be, az erőforrások és a magas rendelkezésre állású NVAs szükséges konfiguráció:</span><span class="sxs-lookup"><span data-stu-id="6b773-117">The following architectures describe the resources and configuration necessary for highly available NVAs:</span></span>

| <span data-ttu-id="6b773-118">Megoldás</span><span class="sxs-lookup"><span data-stu-id="6b773-118">Solution</span></span> | <span data-ttu-id="6b773-119">Előnyök</span><span class="sxs-lookup"><span data-stu-id="6b773-119">Benefits</span></span> | <span data-ttu-id="6b773-120">Megfontolandó szempontok</span><span class="sxs-lookup"><span data-stu-id="6b773-120">Considerations</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6b773-121">[A réteg 7 NVAs érkező][ingress-with-layer-7]</span><span class="sxs-lookup"><span data-stu-id="6b773-121">[Ingress with layer 7 NVAs][ingress-with-layer-7]</span></span> |<span data-ttu-id="6b773-122">NVA csomópontjaihoz aktívak.</span><span class="sxs-lookup"><span data-stu-id="6b773-122">All NVA nodes are active</span></span> |<span data-ttu-id="6b773-123">Állítsa le a kapcsolatok és SNAT használja NVA igényel</span><span class="sxs-lookup"><span data-stu-id="6b773-123">Requires an NVA that can terminate connections and use SNAT</span></span></br> <span data-ttu-id="6b773-124">Meg kell adni egy külön NVAs, és az Azure-ból az internetről érkező forgalom</span><span class="sxs-lookup"><span data-stu-id="6b773-124">Requires a separate set of NVAs for traffic coming from the Internet and from Azure</span></span> </br> <span data-ttu-id="6b773-125">Csak akkor használható a kívülről Azure származó forgalmat</span><span class="sxs-lookup"><span data-stu-id="6b773-125">Can only be used for traffic originating outside Azure</span></span> |
| <span data-ttu-id="6b773-126">[A réteg 7 NVAs kilépési][egress-with-layer-7]</span><span class="sxs-lookup"><span data-stu-id="6b773-126">[Egress with layer 7 NVAs][egress-with-layer-7]</span></span> |<span data-ttu-id="6b773-127">NVA csomópontjaihoz aktívak.</span><span class="sxs-lookup"><span data-stu-id="6b773-127">All NVA nodes are active</span></span> | <span data-ttu-id="6b773-128">Megköveteli, hogy a kapcsolatok és megvalósít forrás hálózati címfordítás (SNAT) is leáll NVA</span><span class="sxs-lookup"><span data-stu-id="6b773-128">Requires an NVA that can terminate connections and implements source network address translation (SNAT)</span></span>
| <span data-ttu-id="6b773-129">[A réteg 7 NVAs érkező-kimenő][ingress-egress-with-layer-7]</span><span class="sxs-lookup"><span data-stu-id="6b773-129">[Ingress-Egress with layer 7 NVAs][ingress-egress-with-layer-7]</span></span> |<span data-ttu-id="6b773-130">Minden csomópont aktívak.</span><span class="sxs-lookup"><span data-stu-id="6b773-130">All nodes are active</span></span><br/><span data-ttu-id="6b773-131">Tudja kezelni a forgalmat az Azure-ban</span><span class="sxs-lookup"><span data-stu-id="6b773-131">Able to handle traffic originated in Azure</span></span> |<span data-ttu-id="6b773-132">Állítsa le a kapcsolatok és SNAT használja NVA igényel</span><span class="sxs-lookup"><span data-stu-id="6b773-132">Requires an NVA that can terminate connections and use SNAT</span></span><br/><span data-ttu-id="6b773-133">Meg kell adni egy külön NVAs, és az Azure-ból az internetről érkező forgalom</span><span class="sxs-lookup"><span data-stu-id="6b773-133">Requires a separate set of NVAs for traffic coming from the Internet and from Azure</span></span> |
| <span data-ttu-id="6b773-134">[A PIP-UDR kapcsoló][pip-udr-switch]</span><span class="sxs-lookup"><span data-stu-id="6b773-134">[PIP-UDR switch][pip-udr-switch]</span></span> |<span data-ttu-id="6b773-135">Egyetlen halmazába NVAs összes forgalom</span><span class="sxs-lookup"><span data-stu-id="6b773-135">Single set of NVAs for all traffic</span></span><br/><span data-ttu-id="6b773-136">Az összes forgalom (portszabályokat korlátozva) is kezelése</span><span class="sxs-lookup"><span data-stu-id="6b773-136">Can handle all traffic (no limit on port rules)</span></span> |<span data-ttu-id="6b773-137">Aktív-passzív</span><span class="sxs-lookup"><span data-stu-id="6b773-137">Active-passive</span></span><br/><span data-ttu-id="6b773-138">A feladatátvételi folyamat igényel</span><span class="sxs-lookup"><span data-stu-id="6b773-138">Requires a failover process</span></span> |

## <a name="ingress-with-layer-7-nvas"></a><span data-ttu-id="6b773-139">A réteg 7 NVAs érkező</span><span class="sxs-lookup"><span data-stu-id="6b773-139">Ingress with layer 7 NVAs</span></span>

<span data-ttu-id="6b773-140">Az alábbi ábrán egy magas rendelkezésre állású architektúra, amely megvalósítja az érkező DMZ egy internetre irányuló terheléselosztó mögött.</span><span class="sxs-lookup"><span data-stu-id="6b773-140">The following figure shows a high availability architecture that implements an ingress DMZ behind an internet-facing load balancer.</span></span> <span data-ttu-id="6b773-141">Ez az architektúra arra tervezték, hogy csatlakozhasson az Azure munkaterhelések réteg 7-forgalom esetén például a HTTP vagy HTTPS:</span><span class="sxs-lookup"><span data-stu-id="6b773-141">This architecture is designed to provide connectivity to Azure workloads for layer 7 traffic, such as HTTP or HTTPS:</span></span>

<span data-ttu-id="6b773-142">![[1]][1]</span><span class="sxs-lookup"><span data-stu-id="6b773-142">![[1]][1]</span></span>

<span data-ttu-id="6b773-143">Az ebbe az architektúrába előnye, hogy minden NVAs aktív, és a terheléselosztó meghibásodásakor hálózati forgalmát átirányítja a más NVA.</span><span class="sxs-lookup"><span data-stu-id="6b773-143">The benefit of this architecture is that all NVAs are active, and if one fails the load balancer directs network traffic to the other NVA.</span></span> <span data-ttu-id="6b773-144">Irányíthatja a forgalmat a belső terheléselosztóhoz ezért mindaddig, amíg egy NVA aktív, forgalom mindkét NVAs továbbra is a.</span><span class="sxs-lookup"><span data-stu-id="6b773-144">Both NVAs route traffic to the internal load balancer so as long as one NVA is active, traffic continues to flow.</span></span> <span data-ttu-id="6b773-145">A NVAs szükséges terheléselosztónál zárja le a webes réteg virtuális gépek szánt SSL-forgalmat.</span><span class="sxs-lookup"><span data-stu-id="6b773-145">The NVAs are required to terminate SSL traffic intended for the web tier VMs.</span></span> <span data-ttu-id="6b773-146">Ezek NVAs nem terjeszthető ki a helyszíni-forgalom kezelésére, mert a helyszíni forgalom egy másik dedikált-készletet igényel NVAs a saját hálózati útvonalak.</span><span class="sxs-lookup"><span data-stu-id="6b773-146">These NVAs cannot be extended to handle on-premises traffic because on-premises traffic requires another dedicated set of NVAs with their own network routes.</span></span>

> [!NOTE]
> <span data-ttu-id="6b773-147">Ez az architektúra használatban van a [DMZ Azure és a helyszíni adatközpont között] [ dmz-on-prem] hivatkozhat architektúra és a [DMZ Azure és az Internet között] [ dmz-internet] architektúra hivatkozik.</span><span class="sxs-lookup"><span data-stu-id="6b773-147">This architecture is used in the [DMZ between Azure and your on-premises datacenter][dmz-on-prem] reference architecture and the [DMZ between Azure and the Internet][dmz-internet] reference architecture.</span></span> <span data-ttu-id="6b773-148">A referencia architektúra mindegyikének tartalmaz egy központi telepítési megoldás, amely használható.</span><span class="sxs-lookup"><span data-stu-id="6b773-148">Each of these reference architectures includes a deployment solution that you can use.</span></span> <span data-ttu-id="6b773-149">Hivatkozásokon talál további információt.</span><span class="sxs-lookup"><span data-stu-id="6b773-149">Follow the links for more information.</span></span>

## <a name="egress-with-layer-7-nvas"></a><span data-ttu-id="6b773-150">A réteg 7 NVAs kilépési</span><span class="sxs-lookup"><span data-stu-id="6b773-150">Egress with layer 7 NVAs</span></span>

<span data-ttu-id="6b773-151">Az előző architektúra bővíthet egy kimenő DMZ biztosít az Azure számítási származó kérelmek.</span><span class="sxs-lookup"><span data-stu-id="6b773-151">The previous architecture can be expanded to provide an egress DMZ for requests originating in the Azure workload.</span></span> <span data-ttu-id="6b773-152">A következő architektúra arra tervezték, hogy a Szegélyhálózaton lévő NVAs magas rendelkezésre állásának biztosítása a réteg 7-forgalmat, például HTTP vagy HTTPS:</span><span class="sxs-lookup"><span data-stu-id="6b773-152">The following architecture is designed to provide high availability of the NVAs in the DMZ for layer 7 traffic, such as HTTP or HTTPS:</span></span>

<span data-ttu-id="6b773-153">![[2]][2]</span><span class="sxs-lookup"><span data-stu-id="6b773-153">![[2]][2]</span></span>

<span data-ttu-id="6b773-154">Ebben az architektúrában az Azure-ban származó összes forgalmat egy belső terheléselosztóhoz történik.</span><span class="sxs-lookup"><span data-stu-id="6b773-154">In this architecture, all traffic originating in Azure is routed to an internal load balancer.</span></span> <span data-ttu-id="6b773-155">A terheléselosztó kimenő kérelmek NVAs közötti elosztása.</span><span class="sxs-lookup"><span data-stu-id="6b773-155">The load balancer distributes outgoing requests between a set of NVAs.</span></span> <span data-ttu-id="6b773-156">Ezek NVAs közvetlen forgalom az internethez, az egyes nyilvános IP-címek használatával.</span><span class="sxs-lookup"><span data-stu-id="6b773-156">These NVAs direct traffic to the Internet using their individual public IP addresses.</span></span>

> [!NOTE]
> <span data-ttu-id="6b773-157">Ez az architektúra használatban van a [DMZ Azure és a helyszíni adatközpont között] [ dmz-on-prem] hivatkozhat architektúra és a [DMZ Azure és az Internet között] [ dmz-internet] architektúra hivatkozik.</span><span class="sxs-lookup"><span data-stu-id="6b773-157">This architecture is used in the [DMZ between Azure and your on-premises datacenter][dmz-on-prem] reference architecture and the [DMZ between Azure and the Internet][dmz-internet] reference architecture.</span></span> <span data-ttu-id="6b773-158">A referencia architektúra mindegyikének tartalmaz egy központi telepítési megoldás, amely használható.</span><span class="sxs-lookup"><span data-stu-id="6b773-158">Each of these reference architectures includes a deployment solution that you can use.</span></span> <span data-ttu-id="6b773-159">Hivatkozásokon talál további információt.</span><span class="sxs-lookup"><span data-stu-id="6b773-159">Follow the links for more information.</span></span>

## <a name="ingress-egress-with-layer-7-nvas"></a><span data-ttu-id="6b773-160">A réteg 7 NVAs érkező-kimenő</span><span class="sxs-lookup"><span data-stu-id="6b773-160">Ingress-egress with layer 7 NVAs</span></span>

<span data-ttu-id="6b773-161">A két előző architektúrákban hiba történt a bemenő és kimenő külön DMZ.</span><span class="sxs-lookup"><span data-stu-id="6b773-161">In the two previous architectures, there was a separate DMZ for ingress and egress.</span></span> <span data-ttu-id="6b773-162">A következő architektúra bemutatja, hogyan kell létrehozni, amely egyaránt be- és kilépési réteg 7-forgalom esetén például a HTTP vagy HTTPS használható DMZ:</span><span class="sxs-lookup"><span data-stu-id="6b773-162">The following architecture demonstrates how to create a DMZ that can be used for both ingress and egress for layer 7 traffic, such as HTTP or HTTPS:</span></span> 

![[4]][4]

<span data-ttu-id="6b773-164">Ebben az architektúrában az NVAs feldolgozni az Alkalmazásátjáró érkező kéréseket.</span><span class="sxs-lookup"><span data-stu-id="6b773-164">In this architecture, the NVAs process incoming requests from the application gateway.</span></span> <span data-ttu-id="6b773-165">A NVAs is érkező a munkaterhelési virtuális gépek a háttér-készletben a terheléselosztó kimenő kérések feldolgozását.</span><span class="sxs-lookup"><span data-stu-id="6b773-165">The NVAs also process outgoing requests from the workload VMs in the back-end pool of the load balancer.</span></span> <span data-ttu-id="6b773-166">Bejövő forgalom az Alkalmazásátjáró történik, és a terheléselosztó kimenő forgalmat történik, mert a NVAs munkamenet affinitás karbantartásáért felelős.</span><span class="sxs-lookup"><span data-stu-id="6b773-166">Because incoming traffic is routed with an application gateway and outgoing traffic is routed with a load balancer, the NVAs are responsible for maintaining session affinity.</span></span> <span data-ttu-id="6b773-167">Ez azt jelenti, hogy az Alkalmazásátjáró fenntart egy táblázatot a bejövő és kimenő kérelmek, így a helyes választ az eredeti kérelmezőnek továbbíthatja.</span><span class="sxs-lookup"><span data-stu-id="6b773-167">That is, the application gateway maintains a mapping of inbound and outbound requests so it can forward the correct response to the original requestor.</span></span> <span data-ttu-id="6b773-168">A belső terheléselosztó azonban nincs hozzáférése a alkalmazástársítások átjáró, és használja a saját logikát a NVAs válaszokat küldhet.</span><span class="sxs-lookup"><span data-stu-id="6b773-168">However, the internal load balancer does not have access to the application gateway mappings, and uses its own logic to send responses to the NVAs.</span></span> <span data-ttu-id="6b773-169">Akkor lehet a terheléselosztó, amely nem kezdetben kapta meg a kérelmet az Alkalmazásátjáró NVA választ küldhet.</span><span class="sxs-lookup"><span data-stu-id="6b773-169">It's possible the load balancer could send a response to an NVA that did not initially receive the request from the application gateway.</span></span> <span data-ttu-id="6b773-170">Ebben az esetben a NVAs kell kommunikációhoz, és a válasz továbbít köztük, így a helyes NVA továbbíthatja az Alkalmazásátjáró válasz.</span><span class="sxs-lookup"><span data-stu-id="6b773-170">In this case, the NVAs must communicate and transfer the response between them so the correct NVA can forward the response to the application gateway.</span></span>

> [!NOTE]
> <span data-ttu-id="6b773-171">A NVAs hajtsa végre a bemeneti forrás a hálózati címfordítás (SNAT) biztosításával a aszimmetrikus útválasztási probléma is megoldható.</span><span class="sxs-lookup"><span data-stu-id="6b773-171">You can also solve the asymmetric routing issue by ensuring the NVAs perform inbound source network address translation (SNAT).</span></span> <span data-ttu-id="6b773-172">Ez az eredeti forrás IP-cím egy IP-címét használja a bejövő adatfolyam NVA azonosságát cserélje.</span><span class="sxs-lookup"><span data-stu-id="6b773-172">This would replace the original source IP of the requestor to one of the IP addresses of the NVA used on the inbound flow.</span></span> <span data-ttu-id="6b773-173">Ez biztosítja, hogy több NVAs használhatja egyszerre útvonal szimmetriája adatainak megőrzése mellett.</span><span class="sxs-lookup"><span data-stu-id="6b773-173">This ensures that you can use multiple NVAs at a time, while preserving the route symmetry.</span></span>

## <a name="pip-udr-switch-with-layer-4-nvas"></a><span data-ttu-id="6b773-174">4. rétegbeli NVAs PIP-UDR kapcsoló</span><span class="sxs-lookup"><span data-stu-id="6b773-174">PIP-UDR switch with layer 4 NVAs</span></span>

<span data-ttu-id="6b773-175">A következő architektúra egy aktív és passzív NVA egy architektúrát mutatja be.</span><span class="sxs-lookup"><span data-stu-id="6b773-175">The following architecture demonstrates an architecture with one active and one passive NVA.</span></span> <span data-ttu-id="6b773-176">Ez az architektúra is be- és kilépési a 4. rétegbeli forgalmat kezeli:</span><span class="sxs-lookup"><span data-stu-id="6b773-176">This architecture handles both ingress and egress for layer 4 traffic:</span></span> 

<span data-ttu-id="6b773-177">![[3]][3]</span><span class="sxs-lookup"><span data-stu-id="6b773-177">![[3]][3]</span></span>

<span data-ttu-id="6b773-178">Ez az architektúra a cikkben szereplő első architektúra hasonlít.</span><span class="sxs-lookup"><span data-stu-id="6b773-178">This architecture is similar to the first architecture discussed in this article.</span></span> <span data-ttu-id="6b773-179">Az architektúra része egy egyetlen NVA fogadása és 4. rétegbeli bejövő kérelmek szűrése.</span><span class="sxs-lookup"><span data-stu-id="6b773-179">That architecture included a single NVA accepting and filtering incoming layer 4 requests.</span></span> <span data-ttu-id="6b773-180">Ez az architektúra ad hozzá egy második passzív NVA magas rendelkezésre állás biztosításához.</span><span class="sxs-lookup"><span data-stu-id="6b773-180">This architecture adds a second passive NVA to provide high availability.</span></span> <span data-ttu-id="6b773-181">Az aktív NVA nem sikerül, ha a passzív NVA aktív legyen, és a UDR és a PIP megváltoznak, az aktív NVA hálózati kártyája mutasson.</span><span class="sxs-lookup"><span data-stu-id="6b773-181">If the active NVA fails, the passive NVA is made active and the UDR and PIP are changed to point to the NICs on the now active NVA.</span></span> <span data-ttu-id="6b773-182">A UDR és a PIP a módosítások is, vagy manuálisan kell elvégezni, vagy egy automatikus folyamat segítségével.</span><span class="sxs-lookup"><span data-stu-id="6b773-182">These changes to the UDR and PIP can either be done manually or using an automated process.</span></span> <span data-ttu-id="6b773-183">Az automatizált folyamat általában démon vagy más Azure-beli figyelőszolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="6b773-183">The automated process is typically daemon or other monitoring service running in Azure.</span></span> <span data-ttu-id="6b773-184">Lekérdezi a állapotmintáihoz meg az aktív NVA, és a UDR és PIP kapcsoló hajt végre, amikor azt észleli, hogy az NVA sikertelen.</span><span class="sxs-lookup"><span data-stu-id="6b773-184">It queries a health probe on the active NVA and performs the UDR and PIP switch when it detects a failure of the NVA.</span></span> 

<span data-ttu-id="6b773-185">A fenti ábra mutat egy példát [ZooKeeper] [ zookeeper] egy magas rendelkezésre állású démon biztosító fürt.</span><span class="sxs-lookup"><span data-stu-id="6b773-185">The preceding figure shows an example [ZooKeeper][zookeeper] cluster providing a high availability daemon.</span></span> <span data-ttu-id="6b773-186">A ZooKeeper fürtön belül a megfelelő kvórumú csomópont egy vezető választja.</span><span class="sxs-lookup"><span data-stu-id="6b773-186">Within the ZooKeeper cluster, a quorum of nodes elects a leader.</span></span> <span data-ttu-id="6b773-187">A kitöltés nem sikerül, ha a többi csomópontot tartsa egy új vezető kiválasztják választást.</span><span class="sxs-lookup"><span data-stu-id="6b773-187">If the leader fails, the remaining nodes hold an election to elect a new leader.</span></span> <span data-ttu-id="6b773-188">Az ebbe az architektúrába a vezető csomópont a démon a rendszerállapot-végpont az NVA lekérdező hajtja végre.</span><span class="sxs-lookup"><span data-stu-id="6b773-188">For this architecture, the leader node executes the daemon that queries the health endpoint on the NVA.</span></span> <span data-ttu-id="6b773-189">Az NVA nem válaszol a állapotmintáihoz, ha a démon a passzív NVA aktiválva lesz.</span><span class="sxs-lookup"><span data-stu-id="6b773-189">If the NVA fails to respond to the health probe, the daemon activates the passive NVA.</span></span> <span data-ttu-id="6b773-190">A démon majd az Azure REST API-t a PIP eltávolítása a sikertelen NVA, és csatolja az újonnan aktivált NVA.</span><span class="sxs-lookup"><span data-stu-id="6b773-190">The daemon then calls the Azure REST API to remove the PIP from the failed NVA and attaches it to newly activated NVA.</span></span> <span data-ttu-id="6b773-191">A démon ezután módosítja a UDR az újonnan aktivált NVA belső IP-címre mutasson.</span><span class="sxs-lookup"><span data-stu-id="6b773-191">The daemon then modifies the UDR to point to the newly activated NVA's internal IP address.</span></span>

> [!NOTE]
> <span data-ttu-id="6b773-192">Ne vegyen fel a ZooKeeper csomópontok egy alhálózatot, amely csak egy olyan útvonalat, amely tartalmazza az NVA segítségével érhető el.</span><span class="sxs-lookup"><span data-stu-id="6b773-192">Do not include the ZooKeeper nodes in a subnet that is only accessible using a route that includes the NVA.</span></span> <span data-ttu-id="6b773-193">Ellenkező esetben a ZooKeeper csomópontok nem érhetők az NVA meghibásodásakor.</span><span class="sxs-lookup"><span data-stu-id="6b773-193">Otherwise, the ZooKeeper nodes are inaccessible if the NVA fails.</span></span> <span data-ttu-id="6b773-194">Amennyiben a démon nem bármilyen okból, akkor nem fogja tudni a probléma diagnosztizálása érdekében a ZooKeeper csomópontok egyikét sem használni.</span><span class="sxs-lookup"><span data-stu-id="6b773-194">Should the daemon fail for any reason, you won't be able to access any of the ZooKeeper nodes to diagnose the problem.</span></span> 

<!--### Solution Deployment-->

<!-- instructions for deploying this solution here --> 

## <a name="next-steps"></a><span data-ttu-id="6b773-195">Következő lépések</span><span class="sxs-lookup"><span data-stu-id="6b773-195">Next steps</span></span>
* <span data-ttu-id="6b773-196">Megtudhatja, hogyan [valósítja meg az Azure és a helyszíni adatközpont között DMZ] [ dmz-on-prem] réteg-7 NVAs használatával.</span><span class="sxs-lookup"><span data-stu-id="6b773-196">Learn how to [implement a DMZ between Azure and your on-premises datacenter][dmz-on-prem] using layer-7 NVAs.</span></span>
* <span data-ttu-id="6b773-197">Megtudhatja, hogyan [valósítja meg az Azure és az Internet között DMZ] [ dmz-internet] réteg-7 NVAs használatával.</span><span class="sxs-lookup"><span data-stu-id="6b773-197">Learn how to [implement a DMZ between Azure and the Internet][dmz-internet] using layer-7 NVAs.</span></span>

<!-- links -->
[cloud-security]: /azure/best-practices-network-security
[dmz-on-prem]: ./secure-vnet-hybrid.md
[dmz-internet]: ./secure-vnet-dmz.md
[egress-with-layer-7]: #egress-with-layer-7-nvas
[ingress-with-layer-7]: #ingress-with-layer-7-nvas
[ingress-egress-with-layer-7]: #ingress-egress-with-layer-7-nvas
[lb-overview]: /azure/load-balancer/load-balancer-overview/
[nva-scenario]: /azure/virtual-network/virtual-network-scenario-udr-gw-nva/
[pip-udr-switch]: #pip-udr-switch-with-layer-4-nvas
[udr-overview]: /azure/virtual-network/virtual-networks-udr-overview/
[zookeeper]: https://zookeeper.apache.org/

<!-- images -->
[0]: ./images/nva-ha/single-nva.png "Egyetlen NVA architektúrája"
[1]: ./images/nva-ha/l7-ingress.png "Réteg 7 érkező"
[2]: ./images/nva-ha/l7-ingress-egress.png "Réteg 7 kimenő forgalom"
[3]: ./images/nva-ha/active-passive.png "Aktív-passzív fürt"
[4]: ./images/nva-ha/l7-ingress-egress-ag.png
