---
title: Biztonságos hibrid hálózati architektúra megvalósítása
titleSuffix: Azure Reference Architectures
description: Biztonságos hibrid hálózati architektúra megvalósítása az Azure-ban.
author: telmosampaio
ms.date: 10/22/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, networking
ms.openlocfilehash: 82327cca08e614bfe5226c9ca1a414388878a7c2
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/23/2019
ms.locfileid: "54482510"
---
# <a name="implement-a-dmz-between-azure-and-your-on-premises-datacenter"></a><span data-ttu-id="8ee7c-103">Az Azure és a helyszíni adatközpont közötti DMZ implementálása</span><span class="sxs-lookup"><span data-stu-id="8ee7c-103">Implement a DMZ between Azure and your on-premises datacenter</span></span>

<span data-ttu-id="8ee7c-104">Ez a referenciaarchitektúra egy biztonságos hibrid hálózatot mutat be, amely kiterjeszti a helyszíni hálózatot az Azure-ba.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-104">This reference architecture shows a secure hybrid network that extends an on-premises network to Azure.</span></span> <span data-ttu-id="8ee7c-105">Az architektúra egy *szegélyhálózatot* (DMZ-t) implementál a helyszíni hálózat és egy Azure Virtual Network (VNet) között.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-105">The architecture implements a DMZ, also called a *perimeter network*, between the on-premises network and an Azure virtual network (VNet).</span></span> <span data-ttu-id="8ee7c-106">A DMZ hálózati virtuális berendezéseket (network virtual appliance, NVA) tartalmaz, amelyek különböző biztonsági funkciókat implementálnak, például tűzfalakat és csomagvizsgálatot.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-106">The DMZ includes network virtual appliances (NVAs) that implement security functionality such as firewalls and packet inspection.</span></span> <span data-ttu-id="8ee7c-107">A VNet kimenő forgalma kényszerített bújtatással jut el az internetre a helyszíni hálózaton keresztül, így ellenőrizhető marad.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-107">All outgoing traffic from the VNet is force-tunneled to the Internet through the on-premises network, so that it can be audited.</span></span> <span data-ttu-id="8ee7c-108">[**A megoldás üzembe helyezése.**](#deploy-the-solution)</span><span class="sxs-lookup"><span data-stu-id="8ee7c-108">[**Deploy this solution**](#deploy-the-solution).</span></span>

> [!NOTE]
> <span data-ttu-id="8ee7c-109">Ebben a forgatókönyvben használatával is elvégezhető [Azure tűzfal](/azure/firewall/), egy felhőalapú hálózati biztonsági szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-109">This scenario can also be accomplished using [Azure Firewall](/azure/firewall/), a cloud-based network security service.</span></span>

![Biztonságos hibrid hálózati architektúra](./images/dmz-private.png)

<span data-ttu-id="8ee7c-111">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="8ee7c-111">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="8ee7c-112">Az architektúrának csatlakoznia kell a helyszíni adatközponthoz egy [VPN-átjáróval][ra-vpn] vagy egy [ExpressRoute][ra-expressroute]-kapcsolattal.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-112">This architecture requires a connection to your on-premises datacenter, using either a [VPN gateway][ra-vpn] or an [ExpressRoute][ra-expressroute] connection.</span></span> <span data-ttu-id="8ee7c-113">Az architektúra gyakori használati módjai többek között a következők:</span><span class="sxs-lookup"><span data-stu-id="8ee7c-113">Typical uses for this architecture include:</span></span>

- <span data-ttu-id="8ee7c-114">Hibrid alkalmazások, amelyekben a számítási feladatok részben a helyszínen, részben pedig az Azure-ban futnak.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-114">Hybrid applications where workloads run partly on-premises and partly in Azure.</span></span>
- <span data-ttu-id="8ee7c-115">Olyan infrastruktúra, amelyben szükséges az Azure VNetre a helyszíni adatközpontból érkező forgalom részletes szabályozása.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-115">Infrastructure that requires granular control over traffic entering an Azure VNet from an on-premises datacenter.</span></span>
- <span data-ttu-id="8ee7c-116">Olyan alkalmazások, amelyeknek ellenőrizniük kell a kimenő forgalmat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-116">Applications that must audit outgoing traffic.</span></span> <span data-ttu-id="8ee7c-117">Ez gyakran jogszabályi követelmény számos kereskedelmi rendszer esetében, és a segítségével elkerülhető a magánjellegű információk nyilvánosságra hozatala.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-117">This is often a regulatory requirement of many commercial systems and can help to prevent public disclosure of private information.</span></span>

## <a name="architecture"></a><span data-ttu-id="8ee7c-118">Architektúra</span><span class="sxs-lookup"><span data-stu-id="8ee7c-118">Architecture</span></span>

<span data-ttu-id="8ee7c-119">Az architektúra a következőkben leírt összetevőkből áll.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-119">The architecture consists of the following components.</span></span>

- <span data-ttu-id="8ee7c-120">**Helyszíni hálózat**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-120">**On-premises network**.</span></span> <span data-ttu-id="8ee7c-121">Egy helyi magánhálózat a vállalatban implementált.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-121">A private local-area network implemented in an organization.</span></span>
- <span data-ttu-id="8ee7c-122">**Azure Virtual Network (VNet)**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-122">**Azure virtual network (VNet)**.</span></span> <span data-ttu-id="8ee7c-123">A VNet tárolja az Azure-ban futó alkalmazást és egyéb erőforrásokat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-123">The VNet hosts the application and other resources running in Azure.</span></span>
- <span data-ttu-id="8ee7c-124">**Átjáró**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-124">**Gateway**.</span></span> <span data-ttu-id="8ee7c-125">Az átjáró biztosítja a helyszíni hálózat útválasztói és a VNet közötti kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-125">The gateway provides connectivity between the routers in the on-premises network and the VNet.</span></span>
- <span data-ttu-id="8ee7c-126">**Hálózati virtuális berendezés (NVA)**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-126">**Network virtual appliance (NVA)**.</span></span> <span data-ttu-id="8ee7c-127">A hálózati virtuális berendezés (NVA) általános kifejezés egy virtuális gépet jelent, amely olyan feladatokat lát el, mint a hozzáférés engedélyezése vagy elutasítása tűzfalként, a nagykiterjedésű hálózati (WAN-) műveletek optimalizálása (például hálózati tömörítés), egyéni útválasztás vagy egyéb hálózati funkciók.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-127">NVA is a generic term that describes a VM performing tasks such as allowing or denying access as a firewall, optimizing wide area network (WAN) operations (including network compression), custom routing, or other network functionality.</span></span>
- <span data-ttu-id="8ee7c-128">**Webes rétegbeli, üzleti rétegbeli és adatrétegbeli alhálózatok**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-128">**Web tier, business tier, and data tier subnets**.</span></span> <span data-ttu-id="8ee7c-129">A felhőben futó, 3 rétegbeli példaalkalmazást implementáló virtuális gépeket és szolgáltatásokat futtató alhálózatok.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-129">Subnets hosting the VMs and services that implement an example 3-tier application running in the cloud.</span></span> <span data-ttu-id="8ee7c-130">További információk: [Windows rendszerű virtuális gépek futtatása N szintű architektúrához az Azure-ban][ra-n-tier].</span><span class="sxs-lookup"><span data-stu-id="8ee7c-130">See [Running Windows VMs for an N-tier architecture on Azure][ra-n-tier] for more information.</span></span>
- <span data-ttu-id="8ee7c-131">**Felhasználó által megadott útvonalak (UDR)**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-131">**User defined routes (UDR)**.</span></span> <span data-ttu-id="8ee7c-132">A [felhasználó által megadott útvonalak][udr-overview] határozzák meg az IP-forgalom irányát az Azure VNetekben.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-132">[User defined routes][udr-overview] define the flow of IP traffic within Azure VNets.</span></span>

    > [!NOTE]
    > <span data-ttu-id="8ee7c-133">A VPN-kapcsolat követelményeitől függően UDR-ek használata helyett konfigurálhat Border Gateway Protocol- (BGP-) útvonalakat a forgalmat a helyszíni hálózaton keresztül visszairányító továbbítási szabályok megvalósításához.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-133">Depending on the requirements of your VPN connection, you can configure Border Gateway Protocol (BGP) routes instead of using UDRs to implement the forwarding rules that direct traffic back through the on-premises network.</span></span>
    >

- <span data-ttu-id="8ee7c-134">**Felügyeleti alhálózat**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-134">**Management subnet**.</span></span> <span data-ttu-id="8ee7c-135">Ez az alhálózat olyan virtuális gépeket tartalmaz, amelyek felügyeleti és monitorozási képességeket valósítanak meg a VNeten futó összetevők számára.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-135">This subnet contains VMs that implement management and monitoring capabilities for the components running in the VNet.</span></span>

## <a name="recommendations"></a><span data-ttu-id="8ee7c-136">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-136">Recommendations</span></span>

<span data-ttu-id="8ee7c-137">Az alábbi javaslatok a legtöbb forgatókönyvre vonatkoznak.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-137">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="8ee7c-138">Kövesse ezeket a javaslatokat, ha nincsenek ezeket felülíró követelményei.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-138">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="access-control-recommendations"></a><span data-ttu-id="8ee7c-139">A hozzáférés-vezérléssel kapcsolatos javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-139">Access control recommendations</span></span>

<span data-ttu-id="8ee7c-140">Használat [szerepköralapú hozzáférés-vezérlés] [ rbac] (RBAC) kezelése az alkalmazásában lévő erőforrásokat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-140">Use [Role-Based Access Control][rbac] (RBAC) to manage the resources in your application.</span></span> <span data-ttu-id="8ee7c-141">Fontolja meg a következő [egyéni szabályok][rbac-custom-roles] létrehozását:</span><span class="sxs-lookup"><span data-stu-id="8ee7c-141">Consider creating the following [custom roles][rbac-custom-roles]:</span></span>

- <span data-ttu-id="8ee7c-142">Egy fejlesztési és üzemeltetési szerepkör, amely rendelkezik az alkalmazás infrastruktúrájának felügyeletéhez, az alkalmazás összetevőinek üzembe helyezéséhez, valamint a virtuális gépek monitorozásához és újraindításához szükséges engedélyekkel.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-142">A DevOps role with permissions to administer the infrastructure for the application, deploy the application components, and monitor and restart VMs.</span></span>

- <span data-ttu-id="8ee7c-143">Egy központi informatikai rendszergazdai szerepkör a hálózati erőforrások kezeléséhez és monitorozásához.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-143">A centralized IT administrator role to manage and monitor network resources.</span></span>

- <span data-ttu-id="8ee7c-144">Egy biztonsági informatikai rendszergazdai szerepkör a biztonságos hálózati erőforrások (pl. NVA-k) kezeléséhez.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-144">A security IT administrator role to manage secure network resources such as the NVAs.</span></span>

<span data-ttu-id="8ee7c-145">A fejlesztési és üzemeltetési és informatikai rendszergazdai szerepkörök ne rendelkezzenek hozzáféréssel az NVA-erőforrásokhoz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-145">The DevOps and IT administrator roles should not have access to the NVA resources.</span></span> <span data-ttu-id="8ee7c-146">Az ezekhez való hozzáférést a biztonsági informatikai rendszergazdai szerepkörre kell korlátozni.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-146">This should be restricted to the security IT administrator role.</span></span>

### <a name="resource-group-recommendations"></a><span data-ttu-id="8ee7c-147">Erőforráscsoportra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-147">Resource group recommendations</span></span>

<span data-ttu-id="8ee7c-148">Az Azure-erőforrások (pl. virtuális gépek, virtuális hálózatok és terheléselosztók) könnyedén felügyelhetők, ha erőforráscsoportokba helyezi őket.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-148">Azure resources such as VMs, VNets, and load balancers can be easily managed by grouping them together into resource groups.</span></span> <span data-ttu-id="8ee7c-149">Rendeljen RBAC-szerepköröket az egyes erőforráscsoportokhoz a hozzáférés korlátozásához.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-149">Assign RBAC roles to each resource group to restrict access.</span></span>

<span data-ttu-id="8ee7c-150">A következő erőforráscsoportok létrehozását javasoljuk:</span><span class="sxs-lookup"><span data-stu-id="8ee7c-150">We recommend creating the following resource groups:</span></span>

- <span data-ttu-id="8ee7c-151">Egy erőforráscsoport, amely a VNetet (a virtuális gépeken kívül), az NSG-ket és a helyszíni hálózathoz való kapcsolódáshoz szükséges átjáróerőforrásokat tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-151">A resource group containing the VNet (excluding the VMs), NSGs, and the gateway resources for connecting to the on-premises network.</span></span> <span data-ttu-id="8ee7c-152">Rendelje hozzá a központi informatikai rendszergazdai szerepkört ehhez az erőforráscsoporthoz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-152">Assign the centralized IT administrator role to this resource group.</span></span>
- <span data-ttu-id="8ee7c-153">Egy erőforráscsoport, amely az NVA-k virtuális gépeit (beleértve a terheléselosztót), a jumpboxot és egyéb felügyeleti virtuális gépeket tartalmaz, valamint a forgalmat az NVA-kon keresztül kényszerítő átjáró alhálózatához tartozó UDR-t.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-153">A resource group containing the VMs for the NVAs (including the load balancer), the jumpbox and other management VMs, and the UDR for the gateway subnet that forces all traffic through the NVAs.</span></span> <span data-ttu-id="8ee7c-154">Rendelje hozzá a biztonsági informatikai rendszergazdai szerepkört ehhez az erőforráscsoporthoz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-154">Assign the security IT administrator role to this resource group.</span></span>
- <span data-ttu-id="8ee7c-155">Különítse el az erőforráscsoportokat a terheléselosztót és a virtuális gépeket tartalmazó alkalmazásrétegek esetében.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-155">Separate resource groups for each application tier that contain the load balancer and VMs.</span></span> <span data-ttu-id="8ee7c-156">Ügyeljen arra, hogy ez az erőforráscsoport ne tartalmazza az egyes rétegek alhálózatait.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-156">Note that this resource group shouldn't include the subnets for each tier.</span></span> <span data-ttu-id="8ee7c-157">Rendelje hozzá a fejlesztési és üzemeltetési szerepkört ehhez az erőforráscsoporthoz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-157">Assign the DevOps role to this resource group.</span></span>

### <a name="virtual-network-gateway-recommendations"></a><span data-ttu-id="8ee7c-158">Virtuális hálózati átjáróra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-158">Virtual network gateway recommendations</span></span>

<span data-ttu-id="8ee7c-159">A VNet felé irányuló helyszíni forgalom egy virtuális hálózati átjárón halad keresztül.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-159">On-premises traffic passes to the VNet through a virtual network gateway.</span></span> <span data-ttu-id="8ee7c-160">Javasoljuk egy [Azure VPN Gateway][guidance-vpn-gateway] vagy egy [Azure ExpressRoute-átjáró][guidance-expressroute] használatát.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-160">We recommend an [Azure VPN gateway][guidance-vpn-gateway] or an [Azure ExpressRoute gateway][guidance-expressroute].</span></span>

### <a name="nva-recommendations"></a><span data-ttu-id="8ee7c-161">Hálózati virtuális készülékre vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-161">NVA recommendations</span></span>

<span data-ttu-id="8ee7c-162">Az NVA-k különböző szolgáltatásokat biztosítanak a hálózati forgalom felügyeletéhez és monitorozásához.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-162">NVAs provide different services for managing and monitoring network traffic.</span></span> <span data-ttu-id="8ee7c-163">Az [Azure Marketplace][azure-marketplace-nva] számos külső féltől származó NVA-t kínál, amelyek használhatóak.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-163">The [Azure Marketplace][azure-marketplace-nva] offers several third-party vendor NVAs that you can use.</span></span> <span data-ttu-id="8ee7c-164">Ha ezek közül egyik sem felel meg az igényeinek, létrehozhat egyéni NVA-kat a virtuális gépek használatával.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-164">If none of these third-party NVAs meet your requirements, you can create a custom NVA using VMs.</span></span>

<span data-ttu-id="8ee7c-165">Ezen referenciaarchitektúra megoldásának üzembe helyezése például a következő funkciókkal rendelkező NVA-t valósít meg egy virtuális gépen:</span><span class="sxs-lookup"><span data-stu-id="8ee7c-165">For example, the solution deployment for this reference architecture implements an NVA with the following functionality on a VM:</span></span>

- <span data-ttu-id="8ee7c-166">A forgalom átirányítása [IP-továbbítással][ip-forwarding] történik az NVA hálózati adapterein.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-166">Traffic is routed using [IP forwarding][ip-forwarding] on the NVA network interfaces (NICs).</span></span>
- <span data-ttu-id="8ee7c-167">A forgalom csak akkor haladhat át az NVA-n, ha az megfelelő.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-167">Traffic is permitted to pass through the NVA only if it is appropriate to do so.</span></span> <span data-ttu-id="8ee7c-168">A referenciaarchitektúrában található minden NVA virtuális gép egy egyszerű Linux-útválasztó.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-168">Each NVA VM in the reference architecture is a simple Linux router.</span></span> <span data-ttu-id="8ee7c-169">A bejövő forgalom az *eth0* hálózati adapteren érkezik, az egyéni szkriptek által definiált szabályoknak megfelelő kimenő forgalom pedig az *eth1* hálózati adapteren keresztül távozik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-169">Inbound traffic arrives on network interface *eth0*, and outbound traffic matches rules defined by custom scripts dispatched through network interface *eth1*.</span></span>
- <span data-ttu-id="8ee7c-170">Az NVA-k csak a felügyeleti alhálózatról konfigurálhatók.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-170">The NVAs can only be configured from the management subnet.</span></span>
- <span data-ttu-id="8ee7c-171">A felügyeleti alhálózatra irányított forgalom nem halad át az NVA-kon.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-171">Traffic routed to the management subnet does not pass through the NVAs.</span></span> <span data-ttu-id="8ee7c-172">Ellenkező esetben az NVA-k meghibásodása esetén nem lenne elérhető útvonal a felügyeleti alhálózat felé azok javításához.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-172">Otherwise, if the NVAs fail, there would be no route to the management subnet to fix them.</span></span>
- <span data-ttu-id="8ee7c-173">Az NVA virtuális gépei egy [rendelkezésre állási csoportban][availability-set] vannak elhelyezve egy terheléselosztó mögött.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-173">The VMs for the NVA are placed in an [availability set][availability-set] behind a load balancer.</span></span> <span data-ttu-id="8ee7c-174">Az átjáróban található UDR átirányítja az NVA kéréseit a terheléselosztóhoz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-174">The UDR in the gateway subnet directs NVA requests to the load balancer.</span></span>

<span data-ttu-id="8ee7c-175">Alkalmazzon egy 7. rétegbeli NVA-t, amely megszakítja az alkalmazások kapcsolatát az NVA szintjén, és fenntartja az affinitást a háttérszintekkel.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-175">Include a layer-7 NVA to terminate application connections at the NVA level and maintain affinity with the backend tiers.</span></span> <span data-ttu-id="8ee7c-176">Ez garantálja a szimmetrikus kapcsolatokat, ahol a háttérbeli rétegekből érkező válaszforgalom az NVA-n halad át.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-176">This guarantees symmetric connectivity, in which response traffic from the backend tiers returns through the NVA.</span></span>

<span data-ttu-id="8ee7c-177">Egy másik megfontolandó lehetőség több NVA soros összekapcsolása, ahol minden NVA egy speciális biztonsági feladatot hajt végre.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-177">Another option to consider is connecting multiple NVAs in series, with each NVA performing a specialized security task.</span></span> <span data-ttu-id="8ee7c-178">Ez lehetővé teszi az egyes biztonsági funkciók NVA-nkénti felügyeletét.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-178">This allows each security function to be managed on a per-NVA basis.</span></span> <span data-ttu-id="8ee7c-179">Egy tűzfalat implementáló NVA például sorba kapcsolható egy identitásszolgáltatásokat futtató NVA-val.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-179">For example, an NVA implementing a firewall could be placed in series with an NVA running identity services.</span></span> <span data-ttu-id="8ee7c-180">A könnyű felügyelet ára azonban az, hogy a több hálózati ugrás növelheti a késést, ezért győződjön meg arról, hogy ez nem befolyásolja az alkalmazás teljesítményét.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-180">The tradeoff for ease of management is the addition of extra network hops that may increase latency, so ensure that this doesn't affect your application's performance.</span></span>

### <a name="nsg-recommendations"></a><span data-ttu-id="8ee7c-181">NSG-kre vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-181">NSG recommendations</span></span>

<span data-ttu-id="8ee7c-182">A VPN-átjáró közzétesz egy nyilvános IP-címet a helyszíni hálózattal való kapcsolat számára.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-182">The VPN gateway exposes a public IP address for the connection to the on-premises network.</span></span> <span data-ttu-id="8ee7c-183">Javasoljuk, hogy hozzon létre egy hálózati biztonsági csoportot (NSG-t) a bejövő NVA-alhálózat számára, amelynek szabályai blokkolnak minden forgalmat, amely nem a helyszíni hálózatról érkezik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-183">We recommend creating a network security group (NSG) for the inbound NVA subnet, with rules to block all traffic not originating from the on-premises network.</span></span>

<span data-ttu-id="8ee7c-184">Továbbá javasoljuk, hogy minden egyes alhálózathoz használjon hálózati biztonsági csoportokat. Ezek egy további védelmi szintet biztosítanak a hibásan konfigurált vagy letiltott NVA-kat megkerülő bejövő forgalommal szemben.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-184">We also recommend NSGs for each subnet to provide a second level of protection against inbound traffic bypassing an incorrectly configured or disabled NVA.</span></span> <span data-ttu-id="8ee7c-185">A referenciaarchitektúrában szereplő webes rétegbeli alhálózat például egy olyan NSG-t implementál, amely egyik szabálya figyelmen kívül hagy minden olyan forgalmat, amely nem a helyszíni hálózatról (192.168.0.0/16) vagy a VNetről érkezik, egy másik szabálya pedig figyelmen kívül hagy minden kérést, amely nem a 80-as porton érkezik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-185">For example, the web tier subnet in the reference architecture implements an NSG with a rule to ignore all requests other than those received from the on-premises network (192.168.0.0/16) or the VNet, and another rule that ignores all requests not made on port 80.</span></span>

### <a name="internet-access-recommendations"></a><span data-ttu-id="8ee7c-186">Internet-hozzáférésre vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-186">Internet access recommendations</span></span>

<span data-ttu-id="8ee7c-187">Használjon [kényszerített bújtatást][azure-forced-tunneling] a helyszíni hálózaton keresztüli összes kimenő internetes forgalomra egy helyek közötti VPN-alagút használatával, és irányítsa azt az internet felé hálózati címfordítás (NAT) használatával.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-187">[Force-tunnel][azure-forced-tunneling] all outbound Internet traffic through your on-premises network using the site-to-site VPN tunnel, and route to the Internet using network address translation (NAT).</span></span> <span data-ttu-id="8ee7c-188">Ez megakadályozza az adatrétegben tárolt bizalmas adatok véletlen kiszivárgását, és lehetővé teszi a teljes kimenő forgalom vizsgálatát és ellenőrzését.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-188">This prevents accidental leakage of any confidential information stored in your data tier and allows inspection and auditing of all outgoing traffic.</span></span>

> [!NOTE]
> <span data-ttu-id="8ee7c-189">Ne blokkolja teljesen az alkalmazásrétegből érkező internetes forgalmat, mivel az megakadályozná, hogy ezek a rétegek használhassák a nyilvános IP-címeket használó Azure PaaS szolgáltatásokat (pl. virtuális gépek diagnosztikájának naplózása, virtuálisgép-bővítmények letöltése és egyéb funkciók).</span><span class="sxs-lookup"><span data-stu-id="8ee7c-189">Don't completely block Internet traffic from the application tiers, as this will prevent these tiers from using Azure PaaS services that rely on public IP addresses, such as VM diagnostics logging, downloading of VM extensions, and other functionality.</span></span> <span data-ttu-id="8ee7c-190">Az Azure Diagnostics azt is megköveteli, hogy az összetevők olvashassanak és írhassanak az Azure Storage-fiókba.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-190">Azure diagnostics also requires that components can read and write to an Azure Storage account.</span></span>

<span data-ttu-id="8ee7c-191">Ellenőrizze, hogy a kimenő internetes forgalom kényszerített bújtatása megfelelő-e.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-191">Verify that outbound internet traffic is force-tunneled correctly.</span></span> <span data-ttu-id="8ee7c-192">Ha VPN-kapcsolattal csatlakozik egy helyszíni kiszolgálón található [útválasztási és távolelérési szolgáltatással][routing-and-remote-access-service], használja a [WireSharkot][wireshark], a [Microsoft Message Analyzert](https://www.microsoft.com/download/details.aspx?id=44226) vagy hasonló eszközt.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-192">If you're using a VPN connection with the [routing and remote access service][routing-and-remote-access-service] on an on-premises server, use a tool such as [WireShark][wireshark] or [Microsoft Message Analyzer](https://www.microsoft.com/download/details.aspx?id=44226).</span></span>

### <a name="management-subnet-recommendations"></a><span data-ttu-id="8ee7c-193">Felügyeleti alhálózatokra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-193">Management subnet recommendations</span></span>

<span data-ttu-id="8ee7c-194">A felügyeleti alhálózaton található jumpbox hajtja végre a felügyeleti és monitorozási funkciókat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-194">The management subnet contains a jumpbox that performs management and monitoring functionality.</span></span> <span data-ttu-id="8ee7c-195">Korlátozza az összes biztonságos felügyeleti feladat végrehajtását a jumpboxra.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-195">Restrict execution of all secure management tasks to the jumpbox.</span></span>

<span data-ttu-id="8ee7c-196">Ne hozzon létre nyilvános IP-címet a jumpbox számára.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-196">Do not create a public IP address for the jumpbox.</span></span> <span data-ttu-id="8ee7c-197">Ehelyett hozzon létre egy útvonalat a jumpbox eléréséhez a bejövő átjárón keresztül.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-197">Instead, create one route to access the jumpbox through the incoming gateway.</span></span> <span data-ttu-id="8ee7c-198">Hozzon létre NSG-szabályokat, hogy a felügyeleti alhálózat csak az engedélyezett útvonalról érkező kérésekre válaszoljon.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-198">Create NSG rules so the management subnet only responds to requests from the allowed route.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="8ee7c-199">Méretezési szempontok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-199">Scalability considerations</span></span>

<span data-ttu-id="8ee7c-200">A referenciaarchitektúra egy terheléselosztó használatával irányítja át a helyszíni hálózati forgalmat egy NVA-eszközökből álló készletbe, amely átirányítja a forgalmat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-200">The reference architecture uses a load balancer to direct on-premises network traffic to a pool of NVA devices, which route the traffic.</span></span> <span data-ttu-id="8ee7c-201">Az NVA-k egy [rendelkezésre állási csoportban][availability-set] vannak elhelyezve.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-201">The NVAs are placed in an [availability set][availability-set].</span></span> <span data-ttu-id="8ee7c-202">Ez a kialakítás lehetővé teszi az NVA-k teljesítményének monitorozását az időben, valamint NVA-eszközök hozzáadását a terhelés növekedése esetén.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-202">This design allows you to monitor the throughput of the NVAs over time and add NVA devices in response to increases in load.</span></span>

<span data-ttu-id="8ee7c-203">A VPN-átjáró szabványos termékváltozata legfeljebb 100 Mb/s folyamatos teljesítményt támogat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-203">The standard SKU VPN gateway supports sustained throughput of up to 100 Mbps.</span></span> <span data-ttu-id="8ee7c-204">A nagy teljesítményű termékváltozat akár 200 Mb/s teljesítményt biztosít.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-204">The High Performance SKU provides up to 200 Mbps.</span></span> <span data-ttu-id="8ee7c-205">Magasabb sávszélesség esetén fontolja meg az ExpressRoute-átjáróra való bővítést.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-205">For higher bandwidths, consider upgrading to an ExpressRoute gateway.</span></span> <span data-ttu-id="8ee7c-206">Az ExpressRoute akár 10 Gb/s sávszélességet és a VPN-kapcsolatnál kisebb késést biztosít.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-206">ExpressRoute provides up to 10 Gbps bandwidth with lower latency than a VPN connection.</span></span>

<span data-ttu-id="8ee7c-207">Az Azure-átjárók skálázhatóságával kapcsolatos további információkat a [hibrid hálózati architektúra Azure és helyszíni VPN használatával történő megvalósításáról][guidance-vpn-gateway-scalability] és a [hibrid hálózati architektúra Azure ExpressRoute használatával történő megvalósításáról][guidance-expressroute-scalability] szóló cikk skálázási szempontokkal kapcsolatos szakaszában olvashat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-207">For more information about the scalability of Azure gateways, see the scalability consideration section in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-scalability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-scalability].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="8ee7c-208">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-208">Availability considerations</span></span>

<span data-ttu-id="8ee7c-209">Ahogy arról a korábbiakban már volt szó, a referenciaarchitektúra egy terheléselosztó mögötti NVA-eszközkészletet alkalmaz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-209">As mentioned, the reference architecture uses a pool of NVA devices behind a load balancer.</span></span> <span data-ttu-id="8ee7c-210">A terheléselosztó egy állapotminta használatával monitorozza az egyes NVA-kat, és minden NVA-t eltávolít a készletből, amely nem válaszol.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-210">The load balancer uses a health probe to monitor each NVA and will remove any unresponsive NVAs from the pool.</span></span>

<span data-ttu-id="8ee7c-211">Ha az Azure ExpressRoute segítségével biztosítja a kapcsolatot a VNet és a helyszíni hálózat között, [konfiguráljon egy VPN-átjárót, hogy feladatátvételt biztosítson][ra-vpn-failover] arra az esetre, ha az ExpressRoute-kapcsolat elérhetetlenné válna.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-211">If you're using Azure ExpressRoute to provide connectivity between the VNet and on-premises network, [configure a VPN gateway to provide failover][ra-vpn-failover] if the ExpressRoute connection becomes unavailable.</span></span>

<span data-ttu-id="8ee7c-212">A VPN és ExpressRoute-kapcsolatok rendelkezésre állásásának fenntartásával kapcsolatos további információkat a [hibrid hálózati architektúra Azure és helyszíni VPN használatával történő megvalósításáról][guidance-vpn-gateway-availability] és a [hibrid hálózati architektúra Azure ExpressRoute használatával történő megvalósításáról][guidance-expressroute-availability] szóló cikk rendelkezésre állási szempontokkal kapcsolatos részében olvashat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-212">For specific information on maintaining availability for VPN and ExpressRoute connections, see the availability considerations in [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-availability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-availability].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="8ee7c-213">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-213">Manageability considerations</span></span>

<span data-ttu-id="8ee7c-214">Az alkalmazások és erőforrások monitorozása a felügyeleti alhálózaton található jumpbox feladata.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-214">All application and resource monitoring should be performed by the jumpbox in the management subnet.</span></span> <span data-ttu-id="8ee7c-215">Az alkalmazás követelményeitől függően előfordulhat, hogy további monitorozási erőforrásokra van szükség a felügyeleti alhálózaton.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-215">Depending on your application requirements, you may need additional monitoring resources in the management subnet.</span></span> <span data-ttu-id="8ee7c-216">Ebben az esetben az ilyen erőforrások elérését a jumpboxon keresztül kell biztosítani.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-216">If so, these resources should be accessed through the jumpbox.</span></span>

<span data-ttu-id="8ee7c-217">Ha a helyszíni hálózat és az Azure közötti átjárókapcsolat nem érhető el, a jumpboxot elérheti egy nyilvános IP-cím üzembe helyezésével és a jumpboxhoz való hozzáadásával, majd az internetről való távoli eljáráshívással.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-217">If gateway connectivity from your on-premises network to Azure is down, you can still reach the jumpbox by deploying a public IP address, adding it to the jumpbox, and remoting in from the internet.</span></span>

<span data-ttu-id="8ee7c-218">A referenciaarchitektúrában található minden réteg alhálózatát NSG-szabályok védik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-218">Each tier's subnet in the reference architecture is protected by NSG rules.</span></span> <span data-ttu-id="8ee7c-219">Lehet, hogy létre kell hoznia egy szabályt a 3389-es port megnyitásához az RDP-hozzáféréshez (Windows rendszerű virtuális gépek esetében), vagy a 22-es port megnyitásához az SSH-hozzáféréshez (Linux rendszerű virtuális gépek esetében).</span><span class="sxs-lookup"><span data-stu-id="8ee7c-219">You may need to create a rule to open port 3389 for remote desktop protocol (RDP) access on Windows VMs or port 22 for secure shell (SSH) access on Linux VMs.</span></span> <span data-ttu-id="8ee7c-220">Az egyéb felügyeleti és monitorozási eszközöknek szabályokra lehet szükségük további portok megnyitásához.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-220">Other management and monitoring tools may require rules to open additional ports.</span></span>

<span data-ttu-id="8ee7c-221">Ha az ExpressRoute használatával biztosítja a kapcsolatot a helyszíni adatközpont és az Azure között, az [Azure Connectivity Toolkit (AzureCT)][azurect] segítségével monitorozhatja és háríthatja el a csatlakozási hibákat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-221">If you're using ExpressRoute to provide the connectivity between your on-premises datacenter and Azure, use the [Azure Connectivity Toolkit (AzureCT)][azurect] to monitor and troubleshoot connection issues.</span></span>

<span data-ttu-id="8ee7c-222">A VPN- és ExpressRoute-kapcsolatok monitorozásával és felügyeletével kapcsolatos további információkat a [hibrid hálózati architektúra Azure és helyszíni VPN használatával történő megvalósításáról][guidance-vpn-gateway-manageability] és a [hibrid hálózati architektúra Azure ExpressRoute használatával történő megvalósításáról][guidance-expressroute-manageability] szóló cikkben olvashat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-222">You can find additional information specifically aimed at monitoring and managing VPN and ExpressRoute connections in the articles [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-manageability] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-manageability].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="8ee7c-223">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="8ee7c-223">Security considerations</span></span>

<span data-ttu-id="8ee7c-224">Ez a referenciaarchitektúra többszintű biztonságot valósít meg.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-224">This reference architecture implements multiple levels of security.</span></span>

### <a name="routing-all-on-premises-user-requests-through-the-nva"></a><span data-ttu-id="8ee7c-225">Összes helyszíni felhasználói kérés átirányítása az NVA-n keresztül</span><span class="sxs-lookup"><span data-stu-id="8ee7c-225">Routing all on-premises user requests through the NVA</span></span>

<span data-ttu-id="8ee7c-226">Az átjáró alhálózatán található UDR blokkolja az összes olyan felhasználói kérést, amely nem a helyszínről érkezik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-226">The UDR in the gateway subnet blocks all user requests other than those received from on-premises.</span></span> <span data-ttu-id="8ee7c-227">Az UDR átadja az engedélyezett kéréseket a privát DMZ alhálózatán lévő NVA-knak, ezek a kérések pedig továbbítva lesznek az alkalmazásnak, ha az NVA-szabályok ezt engedélyezik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-227">The UDR passes allowed requests to the NVAs in the private DMZ subnet, and these requests are passed on to the application if they are allowed by the NVA rules.</span></span> <span data-ttu-id="8ee7c-228">További útvonalakat is hozzáadhat az UDR-hez, de győződjön meg arról, hogy azok véletlenül sem kerülik meg az NVA-kat vagy blokkolják a felügyeleti alhálózat felé irányuló felügyeleti forgalmat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-228">You can add other routes to the UDR, but make sure they don't inadvertently bypass the NVAs or block administrative traffic intended for the management subnet.</span></span>

<span data-ttu-id="8ee7c-229">Az NVA-k előtti terheléselosztó emellett biztonsági eszközként is működik, amely figyelmen kívül hagyja a terheléselosztási szabályok szerint nem nyitott portokon keresztül érkező forgalmat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-229">The load balancer in front of the NVAs also acts as a security device by ignoring traffic on ports that are not open in the load balancing rules.</span></span> <span data-ttu-id="8ee7c-230">A referenciaarchitektúrában található terheléselosztók csak a 80-as porton érkező HTTP-, és a 443-as porton érkező HTTPS-kéréseket figyelik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-230">The load balancers in the reference architecture only listen for HTTP requests on port 80 and HTTPS requests on port 443.</span></span> <span data-ttu-id="8ee7c-231">Dokumentálja a terheléselosztóhoz hozzáadott további szabályokat, és monitorozza a forgalmat a biztonsági problémák elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-231">Document any additional rules that you add to the load balancers, and monitor traffic to ensure there are no security issues.</span></span>

### <a name="using-nsgs-to-blockpass-traffic-between-application-tiers"></a><span data-ttu-id="8ee7c-232">NSG-k használata az alkalmazásrétegek közötti forgalom blokkolására/átengedésére</span><span class="sxs-lookup"><span data-stu-id="8ee7c-232">Using NSGs to block/pass traffic between application tiers</span></span>

<span data-ttu-id="8ee7c-233">A rétegek közötti forgalom NSG-k használatával korlátozható.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-233">Traffic between tiers is restricted by using NSGs.</span></span> <span data-ttu-id="8ee7c-234">Az üzleti réteg blokkol minden forgalmat, amely nem a webes rétegből származik, az adatréteg pedig blokkol minden olyan forgalmat, amely nem az üzleti rétegből származik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-234">The business tier blocks all traffic that doesn't originate in the web tier, and the data tier blocks all traffic that doesn't originate in the business tier.</span></span> <span data-ttu-id="8ee7c-235">Ha a követelményei miatt bővíteni kívánja az NSG-szabályokat a rétegekhez való szélesebb körű hozzáférés biztosítása érdekében, mérlegelje az ezzel járó biztonsági kockázatokat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-235">If you have a requirement to expand the NSG rules to allow broader access to these tiers, weigh these requirements against the security risks.</span></span> <span data-ttu-id="8ee7c-236">Minden új bejövő útvonal újabb lehetőség a véletlen vagy szándékos adatvesztésre vagy az alkalmazás meghibásodására.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-236">Each new inbound pathway represents an opportunity for accidental or purposeful data leakage or application damage.</span></span>

### <a name="devops-access"></a><span data-ttu-id="8ee7c-237">Fejlesztési és üzemeltetési hozzáférés</span><span class="sxs-lookup"><span data-stu-id="8ee7c-237">DevOps access</span></span>

<span data-ttu-id="8ee7c-238">A fejlesztési és üzemeltetési csapat által az egyes rétegekben végrehajtható műveletek az [RBAC][rbac] használatával korlátozhatók.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-238">Use [RBAC][rbac] to restrict the operations that DevOps can perform on each tier.</span></span> <span data-ttu-id="8ee7c-239">Engedélyek megadása esetén alkalmazza a [legalacsonyabb jogosultsági szint elvét][security-principle-of-least-privilege].</span><span class="sxs-lookup"><span data-stu-id="8ee7c-239">When granting permissions, use the [principle of least privilege][security-principle-of-least-privilege].</span></span> <span data-ttu-id="8ee7c-240">Naplózzon minden felügyeleti műveletet, és rendszeresen végezzen ellenőrzést. Így meggyőződhet arról, hogy minden konfigurációmódosítás tervezett volt.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-240">Log all administrative operations and perform regular audits to ensure any configuration changes were planned.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="8ee7c-241">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="8ee7c-241">Deploy the solution</span></span>

<span data-ttu-id="8ee7c-242">Az ezeknek a javaslatoknak a figyelembe vételével megvalósított referenciaarchitektúra egy üzemelő példánya elérhető a [GitHubon][github-folder].</span><span class="sxs-lookup"><span data-stu-id="8ee7c-242">A deployment for a reference architecture that implements these recommendations is available on [GitHub][github-folder].</span></span>

### <a name="prerequisites"></a><span data-ttu-id="8ee7c-243">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="8ee7c-243">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-resources"></a><span data-ttu-id="8ee7c-244">Erőforrások üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="8ee7c-244">Deploy resources</span></span>

1. <span data-ttu-id="8ee7c-245">Keresse meg a `/dmz/secure-vnet-hybrid` referencia architektúrák GitHub-adattár mappát.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-245">Navigate to the `/dmz/secure-vnet-hybrid` folder of the reference architectures GitHub repository.</span></span>

2. <span data-ttu-id="8ee7c-246">Futtassa az alábbi parancsot:</span><span class="sxs-lookup"><span data-stu-id="8ee7c-246">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p onprem.json --deploy
    ```

3. <span data-ttu-id="8ee7c-247">Futtassa az alábbi parancsot:</span><span class="sxs-lookup"><span data-stu-id="8ee7c-247">Run the following command:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource_group_name> -l <region> -p secure-vnet-hybrid.json --deploy
    ```

### <a name="connect-the-on-premises-and-azure-gateways"></a><span data-ttu-id="8ee7c-248">A helyszíni és az Azure-átjárók csatlakoztatása</span><span class="sxs-lookup"><span data-stu-id="8ee7c-248">Connect the on-premises and Azure gateways</span></span>

<span data-ttu-id="8ee7c-249">Ebben a lépésben két helyi hálózati átjáró csatlakozik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-249">In this step, you will connect the two local network gateways.</span></span>

1. <span data-ttu-id="8ee7c-250">Az Azure Portalon keresse meg a létrehozott erőforráscsoportot.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-250">In the Azure Portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="8ee7c-251">Keresse meg az erőforrást nevű `ra-vpn-vgw-pip` , és másolja az IP-cím látható a **áttekintése** panelen.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-251">Find the resource named `ra-vpn-vgw-pip` and copy the IP address shown in the **Overview** blade.</span></span>

3. <span data-ttu-id="8ee7c-252">Keresse meg az erőforrást nevű `onprem-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-252">Find the resource named `onprem-vpn-lgw`.</span></span>

4. <span data-ttu-id="8ee7c-253">Kattintson a **konfigurációs** panelen.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-253">Click the **Configuration** blade.</span></span> <span data-ttu-id="8ee7c-254">A **IP-cím**, illessze be a 2. lépésben felírt IP-címet.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-254">Under **IP address**, paste in the IP address from step 2.</span></span>

    ![Képernyőkép az IP-cím mező](./images/local-net-gw.png)

5. <span data-ttu-id="8ee7c-256">Kattintson a **mentése** és várjon, amíg a művelet befejeződik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-256">Click **Save** and wait for the operation to complete.</span></span> <span data-ttu-id="8ee7c-257">Körülbelül 5 percet is igénybe vehet.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-257">It can take about 5 minutes.</span></span>

6. <span data-ttu-id="8ee7c-258">Keresse meg az erőforrást nevű `onprem-vpn-gateway1-pip`.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-258">Find the resource named `onprem-vpn-gateway1-pip`.</span></span> <span data-ttu-id="8ee7c-259">Másolja ki az IP-cím látható a **áttekintése** panelen.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-259">Copy the IP address shown in the **Overview** blade.</span></span>

7. <span data-ttu-id="8ee7c-260">Keresse meg az erőforrást nevű `ra-vpn-lgw`.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-260">Find the resource named `ra-vpn-lgw`.</span></span>

8. <span data-ttu-id="8ee7c-261">Kattintson a **konfigurációs** panelen.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-261">Click the **Configuration** blade.</span></span> <span data-ttu-id="8ee7c-262">A **IP-cím**, illessze be a 6. lépésben felírt IP-címet.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-262">Under **IP address**, paste in the IP address from step 6.</span></span>

9. <span data-ttu-id="8ee7c-263">Kattintson a **mentése** és várjon, amíg a művelet befejeződik.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-263">Click **Save** and wait for the operation to complete.</span></span>

10. <span data-ttu-id="8ee7c-264">A kapcsolat ellenőrzéséhez nyissa meg a **kapcsolatok** minden átjáró paneljét.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-264">To verify the connection, go to the **Connections** blade for each gateway.</span></span> <span data-ttu-id="8ee7c-265">A állapotúnak kell lennie **csatlakoztatva**.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-265">The status should be **Connected**.</span></span>

### <a name="verify-that-network-traffic-reaches-the-web-tier"></a><span data-ttu-id="8ee7c-266">Győződjön meg arról, hogy a hálózati forgalom eléri a webes szint</span><span class="sxs-lookup"><span data-stu-id="8ee7c-266">Verify that network traffic reaches the web tier</span></span>

1. <span data-ttu-id="8ee7c-267">Az Azure Portalon keresse meg a létrehozott erőforráscsoportot.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-267">In the Azure Portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="8ee7c-268">Keresse meg az erőforrást nevű `int-dmz-lb`, azaz előtti terheléselosztó tartománynévcímkéje a privát DMZ-t.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-268">Find the resource named `int-dmz-lb`, which is the load balancer in front of the private DMZ.</span></span> <span data-ttu-id="8ee7c-269">Másolja a magánhálózati IP-címet a **áttekintése** panelen.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-269">Copy the private IP address from the **Overview** blade.</span></span>

3. <span data-ttu-id="8ee7c-270">Keresse meg a virtuális gép nevű `jb-vm1`.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-270">Find the VM named `jb-vm1`.</span></span> <span data-ttu-id="8ee7c-271">Kattintson a **Connect** és a távoli asztal használata a virtuális Géphez való csatlakozáshoz.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-271">Click **Connect** and use Remote Desktop to connect to the VM.</span></span> <span data-ttu-id="8ee7c-272">A felhasználónév és jelszó a onprem.json fájlban vannak megadva.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-272">The user name and password are specified in the onprem.json file.</span></span>

4. <span data-ttu-id="8ee7c-273">A távoli asztali munkamenetet a nyisson meg egy webböngészőt, és keresse meg az IP-cím 2. lépés.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-273">From the Remote Desktop Session, open a web browser and navigate to the IP address from step 2.</span></span> <span data-ttu-id="8ee7c-274">Megtekintheti az Apache2 kiszolgáló alapértelmezett kezdőlapját.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-274">You should see the default Apache2 server home page.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8ee7c-275">További lépések</span><span class="sxs-lookup"><span data-stu-id="8ee7c-275">Next steps</span></span>

- <span data-ttu-id="8ee7c-276">Megtudhatja, hogyan implementálhat egy [DMZ-t az Azure és az internet között](./secure-vnet-dmz.md).</span><span class="sxs-lookup"><span data-stu-id="8ee7c-276">Learn how to implement a [DMZ between Azure and the Internet](./secure-vnet-dmz.md).</span></span>
- <span data-ttu-id="8ee7c-277">Megismerheti, hogyan implementálhat egy [magas rendelkezésre állású hibrid hálózati architektúrát][ra-vpn-failover].</span><span class="sxs-lookup"><span data-stu-id="8ee7c-277">Learn how to implement a [highly available hybrid network architecture][ra-vpn-failover].</span></span>
- <span data-ttu-id="8ee7c-278">További információt a hálózati biztonság Azure-ral történő felügyeletével kapcsolatban [a Microsoft-felhőszolgáltatásokkal és a hálózati biztonsággal][cloud-services-network-security] kapcsolatos cikkben olvashat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-278">For more information about managing network security with Azure, see [Microsoft cloud services and network security][cloud-services-network-security].</span></span>
- <span data-ttu-id="8ee7c-279">Az Azure-erőforrások védelmével kapcsolatos további információkat [a Microsoft Azure biztonsági szolgáltatásait ismertető][getting-started-with-azure-security] cikkben olvashat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-279">For detailed information about protecting resources in Azure, see [Getting started with Microsoft Azure security][getting-started-with-azure-security].</span></span>
- <span data-ttu-id="8ee7c-280">Az Azure-átjárókapcsolatokra vonatkozó biztonsági megfontolásokkal kapcsolatos további információkat a [hibrid hálózati architektúra Azure és helyszíni VPN használatával történő megvalósításáról][guidance-vpn-gateway-security] és a [hibrid hálózati architektúra Azure ExpressRoute használatával történő megvalósításáról][guidance-expressroute-security] szóló cikkben olvashat.</span><span class="sxs-lookup"><span data-stu-id="8ee7c-280">For additional details on addressing security concerns across an Azure gateway connection, see [Implementing a hybrid network architecture with Azure and on-premises VPN][guidance-vpn-gateway-security] and [Implementing a hybrid network architecture with Azure ExpressRoute][guidance-expressroute-security].</span></span>
- [<span data-ttu-id="8ee7c-281">Az Azure-ban a hálózati virtuális berendezés hibák elhárítása</span><span class="sxs-lookup"><span data-stu-id="8ee7c-281">Troubleshoot network virtual appliance issues in Azure</span></span>](/azure/virtual-network/virtual-network-troubleshoot-nva)

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azurect]: https://github.com/Azure/NetworkMonitoring/tree/master/AzureCT
[azure-forced-tunneling]: https://azure.microsoft.com/en-gb/documentation/articles/vpn-gateway-forced-tunneling-rm/
[azure-marketplace-nva]: https://azuremarketplace.microsoft.com/marketplace/apps/category/networking
[cloud-services-network-security]: /azure/best-practices-network-security
[getting-started-with-azure-security]: /azure/security/azure-security-getting-started
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/dmz/secure-vnet-hybrid
[guidance-expressroute]: ../hybrid-networking/expressroute.md
[guidance-expressroute-availability]: ../hybrid-networking/expressroute.md#availability-considerations
[guidance-expressroute-manageability]: ../hybrid-networking/expressroute.md#manageability-considerations
[guidance-expressroute-security]: ../hybrid-networking/expressroute.md#security-considerations
[guidance-expressroute-scalability]: ../hybrid-networking/expressroute.md#scalability-considerations
[guidance-vpn-gateway]: ../hybrid-networking/vpn.md
[guidance-vpn-gateway-availability]: ../hybrid-networking/vpn.md#availability-considerations
[guidance-vpn-gateway-manageability]: ../hybrid-networking/vpn.md#manageability-considerations
[guidance-vpn-gateway-scalability]: ../hybrid-networking/vpn.md#scalability-considerations
[guidance-vpn-gateway-security]: ../hybrid-networking/vpn.md#security-considerations
[ip-forwarding]: /azure/virtual-network/virtual-networks-udr-overview#ip-forwarding
[ra-expressroute]: ../hybrid-networking/expressroute.md
[ra-n-tier]: ../virtual-machines-windows/n-tier.md
[ra-vpn]: ../hybrid-networking/vpn.md
[ra-vpn-failover]: ../hybrid-networking/expressroute-vpn-failover.md
[rbac]: /azure/active-directory/role-based-access-control-configure
[rbac-custom-roles]: /azure/active-directory/role-based-access-control-custom-roles
[routing-and-remote-access-service]: https://technet.microsoft.com/library/dd469790(v=ws.11).aspx
[security-principle-of-least-privilege]: https://msdn.microsoft.com/library/hdb58b2f(v=vs.110).aspx#Anchor_1
[udr-overview]: /azure/virtual-network/virtual-networks-udr-overview
[visio-download]: https://archcenter.blob.core.windows.net/cdn/dmz-reference-architectures.vsdx
[wireshark]: https://www.wireshark.org/
