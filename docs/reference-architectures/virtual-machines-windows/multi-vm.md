---
title: "Azure virtuális gépek elosztott terhelésű futtassa a méretezhetőség és a rendelkezésre állási"
description: "Több Windows virtuális gépek futtatásához Azure a méretezhetőség és a rendelkezésre állási módját."
author: telmosampaio
ms.date: 11/16/2017
pnp.series.title: Windows VM workloads
pnp.series.next: n-tier
pnp.series.prev: single-vm
ms.openlocfilehash: 14e7e023afd7cb7cbe0e8db8e224ba777f6fe863
ms.sourcegitcommit: c9e6d8edb069b8c513de748ce8114c879bad5f49
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/08/2018
---
# <a name="run-load-balanced-vms-for-scalability-and-availability"></a><span data-ttu-id="3efb1-103">Virtuális gépek elosztott terhelésű a méretezhetőség és a rendelkezésre állási futtatása</span><span class="sxs-lookup"><span data-stu-id="3efb1-103">Run load-balanced VMs for scalability and availability</span></span>

<span data-ttu-id="3efb1-104">A referencia-architektúrában több Windows virtuális gépek (VM) futtatásához bevált gyakorlatok csoportja terjedő skálán rendelkezésre állás és méretezhetőség javítása érdekében egy terheléselosztó mögött beállítása jeleníti meg.</span><span class="sxs-lookup"><span data-stu-id="3efb1-104">This reference architecture shows a set of proven practices for running multiple Windows virtual machines (VMs) in a scale set behind a load balancer, to improve availability and scalability.</span></span> <span data-ttu-id="3efb1-105">Ez az architektúra bármely állapot nélküli alkalmazások és szolgáltatások, például webkiszolgálót, nem használható és alaprendszert n szintű alkalmazások központi telepítéséhez.</span><span class="sxs-lookup"><span data-stu-id="3efb1-105">This architecture can be used for any stateless workload, such as a web server, and is a foundation for deploying n-tier applications.</span></span> [<span data-ttu-id="3efb1-106">**A megoldás üzembe helyezése**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="3efb1-107">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="3efb1-107">![[0]][0]</span></span>

<span data-ttu-id="3efb1-108">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="3efb1-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="3efb1-109">Architektúra</span><span class="sxs-lookup"><span data-stu-id="3efb1-109">Architecture</span></span>

<span data-ttu-id="3efb1-110">Ez az architektúra épít, a [egyetlen virtuális gép referencia-architektúrában][single-vm].</span><span class="sxs-lookup"><span data-stu-id="3efb1-110">This architecture builds on the [Single VM reference architecture][single-vm].</span></span> <span data-ttu-id="3efb1-111">Az ajánlások ebbe az architektúrába is vonatkozik.</span><span class="sxs-lookup"><span data-stu-id="3efb1-111">Those recommendations also apply to this architecture.</span></span>

<span data-ttu-id="3efb1-112">Ebben az architektúrában az adott munkaterheléshez pontjain több Virtuálisgép-példányok.</span><span class="sxs-lookup"><span data-stu-id="3efb1-112">In this architecture, a workload is distributed across multiple VM instances.</span></span> <span data-ttu-id="3efb1-113">Egy egyetlen nyilvános IP-címet, és internetes forgalmat a virtuális gépeket, a terheléselosztó terjesztése.</span><span class="sxs-lookup"><span data-stu-id="3efb1-113">There is a single public IP address, and Internet traffic is distributed to the VMs using a load balancer.</span></span> <span data-ttu-id="3efb1-114">Ez az architektúra egyszintű alkalmazások, például az állapot nélküli webalkalmazás használható.</span><span class="sxs-lookup"><span data-stu-id="3efb1-114">This architecture can be used for a single-tier application, such as a stateless web application.</span></span>

<span data-ttu-id="3efb1-115">Az architektúra a következő részből áll:</span><span class="sxs-lookup"><span data-stu-id="3efb1-115">The architecture has the following components:</span></span>

* <span data-ttu-id="3efb1-116">**Erőforráscsoport.**</span><span class="sxs-lookup"><span data-stu-id="3efb1-116">**Resource group.**</span></span> <span data-ttu-id="3efb1-117">[Erőforráscsoportok] [ resource-manager-overview] erőforrások segítségével, így élettartamát, a tulajdonos vagy más feltételek felügyelhetők.</span><span class="sxs-lookup"><span data-stu-id="3efb1-117">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>
* <span data-ttu-id="3efb1-118">**Virtuális hálózat (VNet) és alhálózat.**</span><span class="sxs-lookup"><span data-stu-id="3efb1-118">**Virtual network (VNet) and subnet.**</span></span> <span data-ttu-id="3efb1-119">Minden Azure virtuális Gépen központilag telepítik egy Vnetet, amely több szegmentált is lehet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-119">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span>
* <span data-ttu-id="3efb1-120">**Azure Load Balancer**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-120">**Azure Load Balancer**.</span></span> <span data-ttu-id="3efb1-121">A [terheléselosztó] [ load-balancer] osztja el a Virtuálisgép-példányok bejövő Internet kéréseket.</span><span class="sxs-lookup"><span data-stu-id="3efb1-121">The [load balancer][load-balancer] distributes incoming Internet requests to the VM instances.</span></span> 
* <span data-ttu-id="3efb1-122">**Nyilvános IP-cím**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-122">**Public IP address**.</span></span> <span data-ttu-id="3efb1-123">Egy nyilvános IP-címet a terheléselosztóhoz internetes forgalom fogadására van szükség.</span><span class="sxs-lookup"><span data-stu-id="3efb1-123">A public IP address is needed for the load balancer to receive Internet traffic.</span></span>
* <span data-ttu-id="3efb1-124">**Az Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-124">**Azure DNS**.</span></span> <span data-ttu-id="3efb1-125">[Az Azure DNS] [ azure-dns] üzemeltetési szolgáltatás DNS-tartományok biztosítani a névfeloldást a Microsoft Azure-infrastruktúra használatával.</span><span class="sxs-lookup"><span data-stu-id="3efb1-125">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="3efb1-126">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="3efb1-126">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="3efb1-127">**Virtuálisgép-méretezési készlet**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-127">**VM scale set**.</span></span> <span data-ttu-id="3efb1-128">A [Virtuálisgép-méretezési készlet] [ vm-scaleset] üzemeltetni a munkaterhelés azonos virtuális gépek halmaza.</span><span class="sxs-lookup"><span data-stu-id="3efb1-128">A [VM scale set][vm-scaleset] is a set of identical VMs used to host a workload.</span></span> <span data-ttu-id="3efb1-129">Méretezési készlet lehetővé teszi a bejövő vagy kimenő tolja virtuális gépek számát manuálisan vagy automatikusan előre meghatározott szabályok alapján.</span><span class="sxs-lookup"><span data-stu-id="3efb1-129">Scale sets allow the number of VMs to be scaled in or out manually, or automatically based on predefined rules.</span></span>
* <span data-ttu-id="3efb1-130">**A rendelkezésre állási csoport**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-130">**Availability set**.</span></span> <span data-ttu-id="3efb1-131">A [rendelkezésre állási csoport] [ availability-set] tartalmazza a virtuális gépeket, így a virtuális gépeket abban az esetben jogosult a magasabb [szolgáltatásiszint-szerződés (SLA) szolgáltatás][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="3efb1-131">The [availability set][availability-set] contains the VMs, making the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span> <span data-ttu-id="3efb1-132">A magasabb garantált szolgáltatási szintje alkalmazandó a rendelkezésre állási csoport tartalmaznia kell legalább két virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="3efb1-132">For the higher SLA to apply, the availability set must include a minimum of two VMs.</span></span> <span data-ttu-id="3efb1-133">Rendelkezésre állási készletek implicit a méretezési készlet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-133">Availability sets are implicit in scale sets.</span></span> <span data-ttu-id="3efb1-134">A skála készleten kívüli virtuális gépeket hoz létre, ha meg szeretne létrehozni a rendelkezésre állási csoportot egymástól függetlenül.</span><span class="sxs-lookup"><span data-stu-id="3efb1-134">If you create VMs outside a scale set, you need to create the availability set independently.</span></span>
* <span data-ttu-id="3efb1-135">**Által kezelt lemezeken**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-135">**Managed disks**.</span></span> <span data-ttu-id="3efb1-136">Azure-lemezeket kezeli a virtuális merevlemez (VHD) fájlok, a virtuális gép lemezeivel kezelése.</span><span class="sxs-lookup"><span data-stu-id="3efb1-136">Azure Managed Disks manage the virtual hard disk (VHD) files for the VM disks.</span></span> 
* <span data-ttu-id="3efb1-137">**Tárolási**.</span><span class="sxs-lookup"><span data-stu-id="3efb1-137">**Storage**.</span></span> <span data-ttu-id="3efb1-138">Hozzon létre egy Azure Storage-fiók a virtuális gépek diagnosztikai naplók tárolásához.</span><span class="sxs-lookup"><span data-stu-id="3efb1-138">Create an Azure Storage acount to hold diagnostic logs for the VMs.</span></span>

## <a name="recommendations"></a><span data-ttu-id="3efb1-139">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="3efb1-139">Recommendations</span></span>

<span data-ttu-id="3efb1-140">A követelmények nem lehetséges, hogy teljesen igazodnak az itt leírt architektúra.</span><span class="sxs-lookup"><span data-stu-id="3efb1-140">Your requirements may not align completely with the architecture described here.</span></span> <span data-ttu-id="3efb1-141">Ezeket a javaslatokat tekintse kiindulópontnak.</span><span class="sxs-lookup"><span data-stu-id="3efb1-141">Use these recommendations as a starting point.</span></span> 

### <a name="availability-and-scalability-recommendations"></a><span data-ttu-id="3efb1-142">Rendelkezésre állás és méretezhetőség javaslatok</span><span class="sxs-lookup"><span data-stu-id="3efb1-142">Availability and scalability recommendations</span></span>

<span data-ttu-id="3efb1-143">A beállítás a rendelkezésre állást és méretezhetőséget, hogy használja a [virtuálisgép-méretezési csoport][vmss].</span><span class="sxs-lookup"><span data-stu-id="3efb1-143">An option for availability and scalability is to use a [virtual machine scale set][vmss].</span></span> <span data-ttu-id="3efb1-144">Virtuálisgép-méretezési készlet segítségével telepítheti és az azonos virtuális gépek kezelésére.</span><span class="sxs-lookup"><span data-stu-id="3efb1-144">VM scale sets help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="3efb1-145">Skálázási készletekben támogatási automatikus skálázás teljesítménymutatók alapján.</span><span class="sxs-lookup"><span data-stu-id="3efb1-145">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="3efb1-146">Ha a virtuális gépeken a terhelés növekszik, további virtuális gépeket a rendszer automatikusan hozzáadja a terheléselosztót.</span><span class="sxs-lookup"><span data-stu-id="3efb1-146">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="3efb1-147">Ha gyorsan terjessze ki a virtuális gépeket, vagy az automatikus skálázás kell módosítania, fontolja meg méretezési készlet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-147">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="3efb1-148">Alapértelmezés szerint méretezési készlet használhatja "elhelyezésétől", ami azt jelenti, a méretezési kezdetben látja el, mint hogy kérjen további virtuális gépeket, majd törli az extra virtuális Gépekért.</span><span class="sxs-lookup"><span data-stu-id="3efb1-148">By default, scale sets use "overprovisioning," which means the scale set initially provisions more VMs than you ask for, then deletes the extra VMs.</span></span> <span data-ttu-id="3efb1-149">Ez javítja az általános sikerességi arányát, a virtuális gépek kiépítésekor.</span><span class="sxs-lookup"><span data-stu-id="3efb1-149">This improves the overall success rate when provisioning the VMs.</span></span> <span data-ttu-id="3efb1-150">Ha nem használ [által kezelt lemezeken](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), legfeljebb 20 gépek javasoljuk a elhelyezésétől engedélyezve van, és legfeljebb 40 elhelyezésétől rendelkező virtuális gépek le van tiltva.</span><span class="sxs-lookup"><span data-stu-id="3efb1-150">If you are not using [managed disks](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), we recommend no more than 20 VMs per storage account with overprovisioning enabled, and no more than 40 VMs with overprovisioning disabled.</span></span>

<span data-ttu-id="3efb1-151">Méretezési csoportban lévő telepített virtuális gépek konfigurálása két alapvető módja van:</span><span class="sxs-lookup"><span data-stu-id="3efb1-151">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="3efb1-152">Bővítmények segítségével konfigurálhatja a virtuális Gépet, akkor kiépítése után.</span><span class="sxs-lookup"><span data-stu-id="3efb1-152">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="3efb1-153">Ezt a módszert új Virtuálisgép-példányok hosszabb időt vehet igénybe indul el, mint egy virtuális gép nem kiterjesztésű fájl.</span><span class="sxs-lookup"><span data-stu-id="3efb1-153">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="3efb1-154">Központi telepítése egy [felügyelt lemezes](/azure/storage/storage-managed-disks-overview) az egyéni lemezképet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-154">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="3efb1-155">Lehet, hogy ez a beállítás gyorsabban telepíthető.</span><span class="sxs-lookup"><span data-stu-id="3efb1-155">This option may be quicker to deploy.</span></span> <span data-ttu-id="3efb1-156">Azonban ehhez szükséges a kép naprakészen tartása.</span><span class="sxs-lookup"><span data-stu-id="3efb1-156">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="3efb1-157">További szempontokat lásd: [kialakítási szempontok a méretezési készlet][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="3efb1-157">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="3efb1-158">Minden automatikus skálázási megoldás használata esetén tesztelte éles szintű munkaterhelések jó előre.</span><span class="sxs-lookup"><span data-stu-id="3efb1-158">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="3efb1-159">Ha egy méretezési készlet nem használja, fontolja meg legalább használatával egy rendelkezésre állási csoportot.</span><span class="sxs-lookup"><span data-stu-id="3efb1-159">If you do not use a scale set, consider at least using an availability set.</span></span> <span data-ttu-id="3efb1-160">Hozzon létre legalább két virtuális gépek rendelkezésre állási csoportban, támogatásához a [Azure virtuális gépek SLA-elérhetőséget][vm-sla].</span><span class="sxs-lookup"><span data-stu-id="3efb1-160">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="3efb1-161">Az Azure load balancer is szükséges, hogy elosztott terhelésű virtuális gépek ugyanabban a rendelkezésre állási csoportba tartozik.</span><span class="sxs-lookup"><span data-stu-id="3efb1-161">The Azure load balancer also requires that load-balanced VMs belong to the same availability set.</span></span>

<span data-ttu-id="3efb1-162">Minden Azure-előfizetéssel rendelkezik alapértelmezett korlátokat, többek között a régiónként eltérő virtuális gépek maximális számát.</span><span class="sxs-lookup"><span data-stu-id="3efb1-162">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="3efb1-163">A korlát növeléséhez által tervátalakítási egy támogatási kérést.</span><span class="sxs-lookup"><span data-stu-id="3efb1-163">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="3efb1-164">További információkért lásd: [Azure-előfizetés és szolgáltatási korlátok, kvóták és megkötések][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="3efb1-164">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

### <a name="network-recommendations"></a><span data-ttu-id="3efb1-165">Hálózatokra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="3efb1-165">Network recommendations</span></span>

<span data-ttu-id="3efb1-166">Telepítse a virtuális gépeket ugyanazon az alhálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="3efb1-166">Deploy the VMs within the same subnet.</span></span> <span data-ttu-id="3efb1-167">Nem fedheti fel a virtuális gép közvetlenül az internethez, de ehelyett adjon egy magánhálózati IP-cím az egyes virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="3efb1-167">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="3efb1-168">A terheléselosztó a nyilvános IP-címet használja az ügyfelek kapcsolódnak.</span><span class="sxs-lookup"><span data-stu-id="3efb1-168">Clients connect using the public IP address of the load balancer.</span></span>

<span data-ttu-id="3efb1-169">Ha jelentkezzen be a virtuális gépeket, a terheléselosztó mögött van szüksége, fontolja meg egy virtuális egy jumpbox (más néven a megerősített gazdagépen), jelentkezzen be a nyilvános IP-címmel.</span><span class="sxs-lookup"><span data-stu-id="3efb1-169">If you need to log into the VMs behind the load balancer, consider adding a single VM as a jumpbox (also called a bastion host) with a public IP address you can log into.</span></span> <span data-ttu-id="3efb1-170">Majd jelentkezzen be a virtuális gépeket a jumpbox a terheléselosztó mögött.</span><span class="sxs-lookup"><span data-stu-id="3efb1-170">And then log into the VMs behind the load balancer from the jumpbox.</span></span> <span data-ttu-id="3efb1-171">Másik lehetőségként beállíthatja a terheléselosztó bejövő hálózati cím címfordítási (NAT) szabályok.</span><span class="sxs-lookup"><span data-stu-id="3efb1-171">Alternatively, you can configure the load balancer's inbound network address translation (NAT) rules.</span></span> <span data-ttu-id="3efb1-172">Azonban rendelkezik egy jumpbox esetén jobb megoldás n szintű munkaterhelések vagy több munkaterhelés üzemeltet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-172">However, having a jumpbox is a better solution when you are hosting n-tier workloads or multiple workloads.</span></span>

### <a name="load-balancer-recommendations"></a><span data-ttu-id="3efb1-173">Load balancer javaslatok</span><span class="sxs-lookup"><span data-stu-id="3efb1-173">Load balancer recommendations</span></span>

<span data-ttu-id="3efb1-174">Adja hozzá az összes virtuális gép rendelkezésre állási csoportban, a terheléselosztó a háttér-címkészlethez.</span><span class="sxs-lookup"><span data-stu-id="3efb1-174">Add all VMs in the availability set to the back-end address pool of the load balancer.</span></span>

<span data-ttu-id="3efb1-175">Adja meg a load balancer szabályok közvetlen hálózati forgalmat a virtuális gépekhez.</span><span class="sxs-lookup"><span data-stu-id="3efb1-175">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="3efb1-176">Ahhoz, hogy a HTTP-forgalom, hozzon létre például egy szabályt, amely leképezhető a 80-as porton az előtér-konfigurációból a háttér-címkészlet a 80-as porton.</span><span class="sxs-lookup"><span data-stu-id="3efb1-176">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="3efb1-177">Amikor egy ügyfél HTTP-kérelmet küld a 80-as porton, a terheléselosztó kiválasztja a háttér IP-címnek a [kivonatoló algoritmus] [ load-balancer-hashing] , amely tartalmazza a forrás IP-cím.</span><span class="sxs-lookup"><span data-stu-id="3efb1-177">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="3efb1-178">Ily módon ügyfélkéréseket a virtuális gépek különböző pontjain.</span><span class="sxs-lookup"><span data-stu-id="3efb1-178">In that way, client requests are distributed across all the VMs.</span></span>

<span data-ttu-id="3efb1-179">Irányíthatja a forgalmat egy adott virtuális géphez, használja a NAT-szabályok.</span><span class="sxs-lookup"><span data-stu-id="3efb1-179">To route traffic to a specific VM, use NAT rules.</span></span> <span data-ttu-id="3efb1-180">Ahhoz, hogy a virtuális gépek RDP, hozzon létre például egy külön NAT-szabály az egyes virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="3efb1-180">For example, to enable RDP to the VMs, create a separate NAT rule for each VM.</span></span> <span data-ttu-id="3efb1-181">Minden egyes szabály egy eltérő portszámot kell leképezése 3389-es, az alapértelmezett port RDP.</span><span class="sxs-lookup"><span data-stu-id="3efb1-181">Each rule should map a distinct port number to port 3389, the default port for RDP.</span></span> <span data-ttu-id="3efb1-182">Például a "VM1", "Vm2 virtuális gépnek," 50002 port 50001 portot használja, és így tovább.</span><span class="sxs-lookup"><span data-stu-id="3efb1-182">For example, use port 50001 for "VM1," port 50002 for "VM2," and so on.</span></span> <span data-ttu-id="3efb1-183">Rendelje hozzá a NAT-szabályok a hálózati adaptert a virtuális gépeken.</span><span class="sxs-lookup"><span data-stu-id="3efb1-183">Assign the NAT rules to the NICs on the VMs.</span></span>

### <a name="storage-account-recommendations"></a><span data-ttu-id="3efb1-184">Tárolási fiók javaslatok</span><span class="sxs-lookup"><span data-stu-id="3efb1-184">Storage account recommendations</span></span>

<span data-ttu-id="3efb1-185">Azt javasoljuk, hogy használatát [által kezelt lemezeken](/azure/storage/storage-managed-disks-overview) rendelkező [prémium szintű storage][premium].</span><span class="sxs-lookup"><span data-stu-id="3efb1-185">We recommend the use of [managed disks](/azure/storage/storage-managed-disks-overview) with [premium storage][premium].</span></span> <span data-ttu-id="3efb1-186">Kezelt lemezeken nincs szükség a storage-fiók.</span><span class="sxs-lookup"><span data-stu-id="3efb1-186">Managed disks do not require a storage account.</span></span> <span data-ttu-id="3efb1-187">Egyszerűen adja meg, méretének és típusú lemez, és azt egy magas rendelkezésre állású erőforrás van telepítve.</span><span class="sxs-lookup"><span data-stu-id="3efb1-187">You simply specify the size and type of disk and it is deployed as a highly available resource.</span></span>

<span data-ttu-id="3efb1-188">Ha nem felügyelt lemezt használ, hozzon létre külön az Azure storage-fiókok az egyes virtuális gépek a virtuális merevlemezek (VHD), ahhoz, hogy elérte-e a bemeneti/kimeneti műveletek száma másodpercenként elkerülése érdekében [(IOPS) vonatkozó korlátok] [ vm-disk-limits]storage-fiókok.</span><span class="sxs-lookup"><span data-stu-id="3efb1-188">If you are using unmanaged disks, create separate Azure storage accounts for each VM to hold the virtual hard disks (VHDs), in order to avoid hitting the input/output operations per second [(IOPS) limits][vm-disk-limits] for storage accounts.</span></span>

<span data-ttu-id="3efb1-189">Hozzon létre egy tárfiókot a diagnosztikai naplókat.</span><span class="sxs-lookup"><span data-stu-id="3efb1-189">Create one storage account for diagnostic logs.</span></span> <span data-ttu-id="3efb1-190">Ez a tárfiók a virtuális gépek megoszthatók.</span><span class="sxs-lookup"><span data-stu-id="3efb1-190">This storage account can be shared by all the VMs.</span></span> <span data-ttu-id="3efb1-191">Ez lehet normál lemezek nem felügyelt tárolási fiókot.</span><span class="sxs-lookup"><span data-stu-id="3efb1-191">This can be an unmanaged storage account using standard disks.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="3efb1-192">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="3efb1-192">Availability considerations</span></span>

<span data-ttu-id="3efb1-193">A rendelkezésre állási csoport hajt végre az alkalmazás rugalmasabb, mindkét tervezett és nem tervezett karbantartási események.</span><span class="sxs-lookup"><span data-stu-id="3efb1-193">The availability set makes your application more resilient to both planned and unplanned maintenance events.</span></span>

* <span data-ttu-id="3efb1-194">*A tervezett karbantartások* akkor fordul elő, amikor a Microsoft frissíti az alapul szolgáló platform néha a virtuális gépek újraindítását okozza.</span><span class="sxs-lookup"><span data-stu-id="3efb1-194">*Planned maintenance* occurs when Microsoft updates the underlying platform, sometimes causing VMs to be restarted.</span></span> <span data-ttu-id="3efb1-195">Azure biztosítja, hogy a virtuális gépek rendelkezésre állási csoport nem mindegyike egyszerre újraindul.</span><span class="sxs-lookup"><span data-stu-id="3efb1-195">Azure makes sure the VMs in an availability set are not all restarted at the same time.</span></span> <span data-ttu-id="3efb1-196">Legalább egy tartják mások újraindítása közben.</span><span class="sxs-lookup"><span data-stu-id="3efb1-196">At least one is kept running while others are restarting.</span></span>
* <span data-ttu-id="3efb1-197">*Nem tervezett karbantartás* hardverhiba esetén történik.</span><span class="sxs-lookup"><span data-stu-id="3efb1-197">*Unplanned maintenance* happens if there is a hardware failure.</span></span> <span data-ttu-id="3efb1-198">Azure gondoskodik arról, hogy a virtuális gépek rendelkezésre állási csoportba között egynél több kiszolgálószekrény törlődnek.</span><span class="sxs-lookup"><span data-stu-id="3efb1-198">Azure makes sure that VMs in an availability set are provisioned across more than one server rack.</span></span> <span data-ttu-id="3efb1-199">Ez segít a hardver meghibásodása hatásának csökkentéséhez, hálózati kimaradások, megszakítás mellett folytathatja a power és így tovább.</span><span class="sxs-lookup"><span data-stu-id="3efb1-199">This helps to reduce the impact of hardware failures, network outages, power interruptions, and so on.</span></span>

<span data-ttu-id="3efb1-200">További információkért lásd: [virtuális gépek rendelkezésre állásának kezelése][availability-set].</span><span class="sxs-lookup"><span data-stu-id="3efb1-200">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> <span data-ttu-id="3efb1-201">A következő videó is jó áttekintést nyújt a rendelkezésre állási csoportok: [konfigurálása a skála virtuális gépek rendelkezésre állási csoport][availability-set-ch9].</span><span class="sxs-lookup"><span data-stu-id="3efb1-201">The following video also provides a good overview of availability sets: [How Do I Configure an Availability Set to Scale VMs][availability-set-ch9].</span></span>

> [!WARNING]
> <span data-ttu-id="3efb1-202">Győződjön meg arról, hogy a rendelkezésre állási csoportot, ha a virtuális gép konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="3efb1-202">Make sure to configure the availability set when you provision the VM.</span></span> <span data-ttu-id="3efb1-203">Jelenleg nincs semmilyen módon nem adja hozzá a Resource Manager virtuális gépek rendelkezésre állási készlet a virtuális gép kiépítése után.</span><span class="sxs-lookup"><span data-stu-id="3efb1-203">Currently, there is no way to add a Resource Manager VM to an availability set after the VM is provisioned.</span></span>

<span data-ttu-id="3efb1-204">Használ a load balancer [állapotteljesítmény] [ health-probes] Virtuálisgép-példányok rendelkezésre állásának figyelésére.</span><span class="sxs-lookup"><span data-stu-id="3efb1-204">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="3efb1-205">Egy mintavételt nem érhető el egy példányt a határidőn belül, ha a terheléselosztó leállítja a forgalom küldése ezt a virtuális Gépet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-205">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="3efb1-206">Azonban továbbra is a terheléselosztó mintavételi, és ha a virtuális gép ismét elérhetővé válik, a terheléselosztó folytatja-e a forgalom küldése ezt a virtuális Gépet.</span><span class="sxs-lookup"><span data-stu-id="3efb1-206">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="3efb1-207">Az alábbiakban néhány javaslattal terheléselosztó:</span><span class="sxs-lookup"><span data-stu-id="3efb1-207">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="3efb1-208">Mintavételt tesztelheti, HTTP vagy TCP.</span><span class="sxs-lookup"><span data-stu-id="3efb1-208">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="3efb1-209">Ha a virtuális gépek futtatása a HTTP-kiszolgáló, hozzon létre egy HTTP-vizsgálatot.</span><span class="sxs-lookup"><span data-stu-id="3efb1-209">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="3efb1-210">Máskülönben hozzon létre egy TCP-Hálózatfigyelővel.</span><span class="sxs-lookup"><span data-stu-id="3efb1-210">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="3efb1-211">HTTP-vizsgálatot adja meg a HTTP-végpont elérési útja.</span><span class="sxs-lookup"><span data-stu-id="3efb1-211">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="3efb1-212">A mintavétel ellenőrzi, hogy az elérési út egy 200-as HTTP-válaszát.</span><span class="sxs-lookup"><span data-stu-id="3efb1-212">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="3efb1-213">Ez lehet a legfelső szintű elérési útja ("/"), vagy egy állapotfigyelés végpontot, amely megvalósítja az egyes egyéni logika az alkalmazás állapotának ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="3efb1-213">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="3efb1-214">A végpont engedélyeznie kell a névtelen HTTP-kérelmekre.</span><span class="sxs-lookup"><span data-stu-id="3efb1-214">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="3efb1-215">A mintavétel küldi a [ismert IP-cím][health-probe-ip], 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="3efb1-215">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="3efb1-216">Győződjön meg arról, hogy a bejövő és kimenő forgalmat a IP-cím bármely tűzfal házirendek és a hálózati biztonsági csoport (NSG) szabályok nem tiltja le.</span><span class="sxs-lookup"><span data-stu-id="3efb1-216">Make sure you don't block traffic to or from this IP address in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="3efb1-217">Használjon [állapot-mintavételi naplók] [ health-probe-log] a health mintavételt állapotának megtekintéséhez.</span><span class="sxs-lookup"><span data-stu-id="3efb1-217">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="3efb1-218">Az Azure-portál a terheléselosztók naplózásának engedélyezése.</span><span class="sxs-lookup"><span data-stu-id="3efb1-218">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="3efb1-219">Az Azure Blob storage írja a naplókat.</span><span class="sxs-lookup"><span data-stu-id="3efb1-219">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="3efb1-220">A naplók hány virtuális gépek megjelenítése a háttérben futó nem fordulnak elő a hálózati forgalom miatt sikertelen mintavételi válaszokat.</span><span class="sxs-lookup"><span data-stu-id="3efb1-220">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="3efb1-221">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="3efb1-221">Manageability considerations</span></span>

<span data-ttu-id="3efb1-222">Több virtuális géphez fontos folyamatok automatizálása, így azok a megbízható és ismételhető.</span><span class="sxs-lookup"><span data-stu-id="3efb1-222">With multiple VMs, it is important to automate processes so they are reliable and repeatable.</span></span> <span data-ttu-id="3efb1-223">Használhat [Azure Automation] [ azure-automation] telepítési, az operációs rendszer javítását és más feladatok automatizálásához.</span><span class="sxs-lookup"><span data-stu-id="3efb1-223">You can use [Azure Automation][azure-automation] to automate deployment, OS patching, and other tasks.</span></span> <span data-ttu-id="3efb1-224">[Azure Automation szolgáltatásbeli] [ azure-automation] az automation szolgáltatás alapul, amely nem használható a PowerShell.</span><span class="sxs-lookup"><span data-stu-id="3efb1-224">[Azure Automation][azure-automation] is an automation service based on PowerShell that can be used for this.</span></span> <span data-ttu-id="3efb1-225">Példa automatizálási parancsfájlokat érhetők el a [forgatókönyvek][runbook-gallery].</span><span class="sxs-lookup"><span data-stu-id="3efb1-225">Example automation scripts are available from the [Runbook Gallery][runbook-gallery].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="3efb1-226">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="3efb1-226">Security considerations</span></span>

<span data-ttu-id="3efb1-227">Virtuális hálózatok a forgalom elkülönítési határt alkotnak, az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="3efb1-227">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="3efb1-228">Egy virtuális hálózatot a virtuális gépek nem tud közvetlenül kommunikálni egy másik virtuális hálózatot a virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="3efb1-228">VMs in one VNet cannot communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="3efb1-229">Ugyanahhoz a virtuális gépek virtuális hálózat kommunikálhatnak, kivéve, ha hoz létre [hálózati biztonsági csoportok] [ nsg] (NSG-ket) korlátozzák a forgalmat.</span><span class="sxs-lookup"><span data-stu-id="3efb1-229">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="3efb1-230">További információkért lásd: [Microsoft cloud services és a hálózati biztonság][network-security].</span><span class="sxs-lookup"><span data-stu-id="3efb1-230">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="3efb1-231">A bejövő internetes forgalmat a betöltés terheléselosztó szabályok határozzák meg, melyik forgalmat el lehet-e érni a háttérben.</span><span class="sxs-lookup"><span data-stu-id="3efb1-231">For incoming Internet traffic, the load balancer rules define which traffic can reach the back end.</span></span> <span data-ttu-id="3efb1-232">Azonban load balancer szabályok nem támogatják a biztonságos IP-listákat, így ha azt szeretné, hogy bizonyos nyilvános IP-címek hozzáadása a biztonságos listáját, és adja hozzá egy NSG alhálózathoz.</span><span class="sxs-lookup"><span data-stu-id="3efb1-232">However, load balancer rules don't support IP safe lists, so if you want to add certain public IP addresses to a safe list, add an NSG to the subnet.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="3efb1-233">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="3efb1-233">Deploy the solution</span></span>

<span data-ttu-id="3efb1-234">Ez az architektúra telepítésének érhető el a [GitHub][github-folder].</span><span class="sxs-lookup"><span data-stu-id="3efb1-234">A deployment for this architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="3efb1-235">Telepíti a következő:</span><span class="sxs-lookup"><span data-stu-id="3efb1-235">It deploys the following:</span></span>

  * <span data-ttu-id="3efb1-236">Egy virtuális hálózatot egyetlen alhálózattal nevű **webes** , amely tartalmazza a virtuális gépeket.</span><span class="sxs-lookup"><span data-stu-id="3efb1-236">A virtual network with a single subnet named **web** that contains the VMs.</span></span>
  * <span data-ttu-id="3efb1-237">A virtuális gép méretezési csoport, amely tartalmazza a legújabb Windows Server 2016 Datacenter Edition futó virtuális gépeket.</span><span class="sxs-lookup"><span data-stu-id="3efb1-237">A VM scale set that contains VMs running the latest version of Windows Server 2016 Datacenter Edition.</span></span> <span data-ttu-id="3efb1-238">Automatikus skálázás engedélyezve van.</span><span class="sxs-lookup"><span data-stu-id="3efb1-238">Autoscale is enabled.</span></span>
  * <span data-ttu-id="3efb1-239">Olyan terheléselosztóhoz, amely az előtérben található a Virtuálisgép-méretezési állítva.</span><span class="sxs-lookup"><span data-stu-id="3efb1-239">A load balancer that sits in front of the VM scale set.</span></span>
  * <span data-ttu-id="3efb1-240">Az NSG bejövő szabályok, amelyek lehetővé teszik a HTTP-forgalom, hogy a Virtuálisgép-méretezési beállítása.</span><span class="sxs-lookup"><span data-stu-id="3efb1-240">An NSG with incoming rules that allow HTTP traffic to the VM scale set.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="3efb1-241">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="3efb1-241">Prerequisites</span></span>

<span data-ttu-id="3efb1-242">Mielőtt a saját előfizetésének telepítése a referencia-architektúrában, a következő lépésekkel kell azt.</span><span class="sxs-lookup"><span data-stu-id="3efb1-242">Before you can deploy the reference architecture to your own subscription, you must perform the following steps.</span></span>

1. <span data-ttu-id="3efb1-243">Klónozza, ágaztassa vagy a zip-fájl letöltése a [AzureCAT referencia architektúra] [ ref-arch-repo] GitHub-tárházban.</span><span class="sxs-lookup"><span data-stu-id="3efb1-243">Clone, fork, or download the zip file for the [AzureCAT reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="3efb1-244">Győződjön meg arról, hogy az Azure CLI 2.0 telepítve a számítógépre.</span><span class="sxs-lookup"><span data-stu-id="3efb1-244">Make sure you have the Azure CLI 2.0 installed on your computer.</span></span> <span data-ttu-id="3efb1-245">A parancssori felület telepítési utasításokért lásd: [Azure CLI 2.0 telepítése][azure-cli-2].</span><span class="sxs-lookup"><span data-stu-id="3efb1-245">For CLI installation instructions, see [Install Azure CLI 2.0][azure-cli-2].</span></span>

3. <span data-ttu-id="3efb1-246">Telepítse a [Azure építőelemeket] [ azbb] npm csomag.</span><span class="sxs-lookup"><span data-stu-id="3efb1-246">Install the [Azure building blocks][azbb] npm package.</span></span>

4. <span data-ttu-id="3efb1-247">A parancssorból bash, vagy PowerShell kérdés, jelentkezzen be az Azure-fiókjával használja az alábbi parancsok egyikét, és kövesse az utasításokat.</span><span class="sxs-lookup"><span data-stu-id="3efb1-247">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using one of the commands below, and follow the prompts.</span></span>

  ```bash
  az login
  ```

### <a name="deploy-the-solution-using-azbb"></a><span data-ttu-id="3efb1-248">Az üzembe helyezéséhez azbb használatával</span><span class="sxs-lookup"><span data-stu-id="3efb1-248">Deploy the solution using azbb</span></span>

<span data-ttu-id="3efb1-249">A minta egyetlen virtuális gép számítási feladat telepítéséhez kövesse az alábbi lépéseket:</span><span class="sxs-lookup"><span data-stu-id="3efb1-249">To deploy the sample single VM workload, follow these steps:</span></span>

1. <span data-ttu-id="3efb1-250">Keresse meg a `virtual-machines\multi-vm\parameters\windows` a fenti előfeltételek lépésben letöltött tárház mappát.</span><span class="sxs-lookup"><span data-stu-id="3efb1-250">Navigate to the `virtual-machines\multi-vm\parameters\windows` folder for the repository you downloaded in the pre-requisites step above.</span></span>

2. <span data-ttu-id="3efb1-251">Nyissa meg a `multi-vm-v2.json` fájlt, és adjon meg egy felhasználónevet és jelszót az idézőjelek között alább látható módon, majd mentse a fájlt.</span><span class="sxs-lookup"><span data-stu-id="3efb1-251">Open the `multi-vm-v2.json` file and enter a username and password between the quotes, as shown below, then save the file.</span></span>

  ```bash
  "adminUsername": "",
  "adminPassword": "",
  ```

3. <span data-ttu-id="3efb1-252">Futtatás `azbb` a virtuális gépek telepítése a lent látható módon.</span><span class="sxs-lookup"><span data-stu-id="3efb1-252">Run `azbb` to deploy the VMs as shown below.</span></span>

  ```bash
  azbb -s <subscription_id> -g <resource_group_name> -l <location> -p multi-vm-v2.json --deploy
  ```

<span data-ttu-id="3efb1-253">A minta referenciaarchitektúra telepítésével kapcsolatos további információkért látogasson el a [GitHub-tárházban][git].</span><span class="sxs-lookup"><span data-stu-id="3efb1-253">For more information on deploying this sample reference architecture, visit our [GitHub repository][git].</span></span>

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[availability-set-ch9]: https://channel9.msdn.com/Series/Microsoft-Azure-Fundamentals-Virtual-Machines/08
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[azure-automation]: /azure/automation/automation-intro
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-cli-2]: /azure/install-azure-cli?view=azure-cli-latest
[azure-dns]: /azure/dns/dns-overview
[git]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[load-balancer]: /azure/load-balancer/load-balancer-get-started-internet-arm-cli
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[naming-conventions]: ../../best-practices/naming-conventions.md
[network-security]: /azure/best-practices-network-security
[nsg]: /azure/virtual-network/virtual-networks-nsg
[premium]: /azure/storage/common/storage-premium-storage
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[runbook-gallery]: /azure/automation/automation-runbook-gallery#runbooks-in-runbook-gallery
[single-vm]: single-vm.md
[subscription-limits]: /azure/azure-subscription-service-limits
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[vm-disk-limits]: /azure/azure-subscription-service-limits#virtual-machine-disk-limits
[vm-scaleset]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vm-sizes]: https://azure.microsoft.com/documentation/articles/virtual-machines-windows-sizes/
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_2/
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[vmss-quickstart]: https://azure.microsoft.com/documentation/templates/?term=scale+set
[0]: ./images/multi-vm-diagram.png "Az Azure, amely magában foglalja a rendelkezésre állási készlet két virtuális gépek és a terheléselosztó virtuális Gépre kiterjedő megoldás architektúrája"
