---
title: "Windows virtuális gépek futtatása a több Azure-régiók a magas rendelkezésre állás"
description: "Ügyfélszoftverek központi telepítése a virtuális gépek magas rendelkezésre állást és a rugalmasság Azure több régióba."
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Windows VM workloads
pnp.series.prev: n-tier
ms.openlocfilehash: 9c54959da96115e55ba8a5c9e0f3c358d29ce5dd
ms.sourcegitcommit: c9e6d8edb069b8c513de748ce8114c879bad5f49
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/08/2018
---
# <a name="run-windows-vms-in-multiple-regions-for-high-availability"></a><span data-ttu-id="c9dcd-103">Futtassa a Windows virtuális gépek több régióba a magas rendelkezésre állás</span><span class="sxs-lookup"><span data-stu-id="c9dcd-103">Run Windows VMs in multiple regions for high availability</span></span>

<span data-ttu-id="c9dcd-104">A referencia-architektúrában futó N szintű alkalmazás több Azure-régiók, rendelkezésre állást és a hatékony vész-helyreállítási infrastruktúra elérése érdekében bevált gyakorlatok csoportja jeleníti meg.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span> 

<span data-ttu-id="c9dcd-105">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="c9dcd-105">[![0]][0]</span></span> 

<span data-ttu-id="c9dcd-106">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="c9dcd-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="c9dcd-107">Architektúra</span><span class="sxs-lookup"><span data-stu-id="c9dcd-107">Architecture</span></span> 

<span data-ttu-id="c9dcd-108">Ez az architektúra látható egy épít [futtassa a Windows virtuális gépek N szintű alkalmazások](n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="c9dcd-108">This architecture builds on the one shown in [Run Windows VMs for an N-tier application](n-tier.md).</span></span> 

* <span data-ttu-id="c9dcd-109">**Elsődleges és másodlagos régiók**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="c9dcd-110">Két régió segítségével magasabb rendelkezésre állásának eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="c9dcd-111">Az elsődleges régióban egyik.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-111">One is the primary region.</span></span> <span data-ttu-id="c9dcd-112">A más régióban van, a feladatátvételre.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-112">The other region is for failover.</span></span>
* <span data-ttu-id="c9dcd-113">**Az Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-113">**Azure DNS**.</span></span> <span data-ttu-id="c9dcd-114">[Az Azure DNS] [ azure-dns] üzemeltetési szolgáltatás DNS-tartományok biztosítani a névfeloldást a Microsoft Azure-infrastruktúra használatával.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-114">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="c9dcd-115">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-115">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="c9dcd-116">**Az Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-116">**Azure Traffic Manager**.</span></span> <span data-ttu-id="c9dcd-117">[A TRAFFIC Manager] [ traffic-manager] irányítja a bejövő kéréseket a régiók egyikéhez sem.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-117">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="c9dcd-118">A normál működés során az elsődleges régióban irányítja a kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-118">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="c9dcd-119">Ha az adott régióban, a Traffic Manager feladatátadás a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-119">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="c9dcd-120">További információkért tekintse meg a szakasz [Traffic Manager konfigurációs](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="c9dcd-120">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>
* <span data-ttu-id="c9dcd-121">**Erőforráscsoportok**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-121">**Resource groups**.</span></span> <span data-ttu-id="c9dcd-122">Hozzon létre külön [erőforráscsoportok] [ resource groups] az elsődleges régióban, a másodlagos régióba, és a Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-122">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="c9dcd-123">Ez lehetővé teszi a rugalmasság, minden egyes régió szerinti egyetlen gyűjtemény-erőforrások kezelésére.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-123">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="c9dcd-124">Például egy régió tartozik, sikerült újratelepítése nélkül a másik egy le.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-124">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="c9dcd-125">[Az erőforráscsoportok hivatkozás][resource-group-links], így az alkalmazás az erőforrások listájának lekérdezés futtatása.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-125">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>
* <span data-ttu-id="c9dcd-126">**Vnetek**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-126">**VNets**.</span></span> <span data-ttu-id="c9dcd-127">Hozzon létre egy külön hálózatok mindegyik régióhoz.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-127">Create a separate VNet for each region.</span></span> <span data-ttu-id="c9dcd-128">Ellenőrizze, hogy a címterek nem lehetnek átfedésben.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-128">Make sure the address spaces do not overlap.</span></span> 
* <span data-ttu-id="c9dcd-129">**SQL Server Always On rendelkezésre állási csoport**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-129">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="c9dcd-130">Ha az SQL Server rendszer használata esetén ajánlott [SQL Always On rendelkezésre állási csoportok] [ sql-always-on] a magas rendelkezésre állás érdekében.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-130">If you are using SQL Server, we recommend [SQL Always On Availability Groups][sql-always-on] for high availability.</span></span> <span data-ttu-id="c9dcd-131">Az SQL Server-példányokat tartalmazó mindkét régiókban egyetlen rendelkezésre állási csoport létrehozása.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-131">Create a single availability group that includes the SQL Server instances in both regions.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="c9dcd-132">Is érdemes lehet [Azure SQL Database][azure-sql-db], amely a relációs adatbázisok felhőszolgáltatásként biztosítja.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-132">Also consider [Azure SQL Database][azure-sql-db], which provides a relational database as a cloud service.</span></span> <span data-ttu-id="c9dcd-133">Az SQL Database nem kell egy rendelkezésre állási csoport konfigurálásához, vagy feladatátvételi kezelése.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-133">With SQL Database, you don't need to configure an availability group or manage failover.</span></span>  
    > 

* <span data-ttu-id="c9dcd-134">**VPN-átjárók**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-134">**VPN Gateways**.</span></span> <span data-ttu-id="c9dcd-135">Hozzon létre egy [VPN-átjáró] [ vpn-gateway] minden egyes virtuális, és konfigurálja a [VNet – VNet-kapcsolatot][vnet-to-vnet], a két Vnetek közötti hálózati forgalom engedélyezése .</span><span class="sxs-lookup"><span data-stu-id="c9dcd-135">Create a [VPN gateway][vpn-gateway] in each VNet, and configure a [VNet-to-VNet connection][vnet-to-vnet], to enable network traffic between the two VNets.</span></span> <span data-ttu-id="c9dcd-136">Ez elengedhetetlen ahhoz az SQL Always On rendelkezésre állási csoportnak.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-136">This is required for the SQL Always On Availability Group.</span></span>

## <a name="recommendations"></a><span data-ttu-id="c9dcd-137">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="c9dcd-137">Recommendations</span></span>

<span data-ttu-id="c9dcd-138">Egy több területi architektúra biztosít magas rendelkezésre állás érdekében, mint egyetlen régióban üzembe helyezni.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-138">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="c9dcd-139">Ha egy regionális kimaradás érinti az elsődleges régióban, [Traffic Manager] [ traffic-manager] hogy áthelyezze a feladatokat a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-139">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="c9dcd-140">Ez az architektúra segíthet is, ha az alkalmazás egy egyedi alrendszer nem tud.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-140">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="c9dcd-141">Magas rendelkezésre állás elérése érdekében a különböző régiókban néhány általános módszer van:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-141">There are several general approaches to achieving high availability across regions:</span></span> 

* <span data-ttu-id="c9dcd-142">A melegtartalék aktív/passzív.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-142">Active/passive with hot standby.</span></span> <span data-ttu-id="c9dcd-143">Forgalom kerül egy régió tartozik, a más vár melegtartalék közben.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-143">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="c9dcd-144">Meleg készenléti azt jelenti, hogy a virtuális gépeket, a másodlagos régióban lefoglalt és fut mindig.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-144">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="c9dcd-145">A meleg készenléti állapotban lévő aktív/passzív.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-145">Active/passive with cold standby.</span></span> <span data-ttu-id="c9dcd-146">Forgalom kerül egy régió tartozik, a más vár meleg készenléti közben.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-146">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="c9dcd-147">Meleg készenléti állapot azt jelenti, hogy a virtuális gépeket, a másodlagos régióban nem foglal le addig, amíg a feladatátvételi szükséges.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-147">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="c9dcd-148">Ez a megközelítés költségek kisebb futtatásához, de általában adott meghibásodás során online állapotba hosszabb ideig tart.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-148">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="c9dcd-149">Aktív.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-149">Active/active.</span></span> <span data-ttu-id="c9dcd-150">Mindkét régió aktív, és kérés kerül közöttük.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-150">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="c9dcd-151">Ha nem érhető el egy régió tartozik, az kívül Elforgatás lesz végrehajtva.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-151">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="c9dcd-152">A referencia-architektúrában melegtartalék feladatátvételi Traffic Manager használata az aktív/passzív összpontosít.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-152">This reference architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="c9dcd-153">Vegye figyelembe, hogy sikerült központi telepítése egy kis számú virtuális gépek melegtartalék és majd horizontális felskálázás igény szerint.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-153">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>

### <a name="regional-pairing"></a><span data-ttu-id="c9dcd-154">Regionális párosítás</span><span class="sxs-lookup"><span data-stu-id="c9dcd-154">Regional pairing</span></span>

<span data-ttu-id="c9dcd-155">Minden Azure-régió, egy másik ugyanazon a földrajzi régióját párosított.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-155">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="c9dcd-156">Régiók általában választhat a azonos regionális pár (például USA keleti régiója 2 és Velünk központi).</span><span class="sxs-lookup"><span data-stu-id="c9dcd-156">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="c9dcd-157">Ennek során a következő előnyöket nyújtja:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-157">Benefits of doing so include:</span></span>

* <span data-ttu-id="c9dcd-158">A széles körű kimaradás esetén legalább egy régió kívül minden pár helyreállítási prioritása van.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-158">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="c9dcd-159">Tervezett Azure rendszerfrissítések előkészítése már megkezdődött párosított régiók egymás után, az lehetséges állásidő minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-159">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
* <span data-ttu-id="c9dcd-160">Párok találhatók belül az azonos földrajzi adatok rezidens követelményeinek megfelelően.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-160">Pairs reside within the same geography, to meet data residency requirements.</span></span> 

<span data-ttu-id="c9dcd-161">Győződjön meg arról, hogy mindkét régió támogatja az összes Azure-szolgáltatás szükséges az alkalmazás (lásd: [régiói][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="c9dcd-161">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="c9dcd-162">Regionális párok kapcsolatos további információkért lásd: [üzleti folytonossági és vészhelyreállítási helyreállítási (BCDR): Azure-régiókat párosítva][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="c9dcd-162">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="c9dcd-163">A TRAFFIC Manager-konfiguráció</span><span class="sxs-lookup"><span data-stu-id="c9dcd-163">Traffic Manager configuration</span></span>

<span data-ttu-id="c9dcd-164">A Traffic Manager konfigurálásakor, vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-164">Consider the following points when configuring Traffic Manager:</span></span>

* <span data-ttu-id="c9dcd-165">**Útválasztás**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-165">**Routing**.</span></span> <span data-ttu-id="c9dcd-166">A TRAFFIC Manager támogatja több [útválasztási algoritmusok][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="c9dcd-166">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="c9dcd-167">A jelen cikkben ismertetett esetben használjon *prioritás* útválasztási (korábbi nevén *feladatátvételi* útválasztási).</span><span class="sxs-lookup"><span data-stu-id="c9dcd-167">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="c9dcd-168">Ezzel a beállítással a Traffic Manager minden kérést küld az elsődleges régióban, hacsak az elsődleges régióban el nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-168">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="c9dcd-169">Ezen a ponton akkor automatikusan átkerül a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-169">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="c9dcd-170">Lásd: [konfigurálhatja feladatátvételi útválasztási módszer][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="c9dcd-170">See [Configure Failover routing method][tm-configure-failover].</span></span>
* <span data-ttu-id="c9dcd-171">**Állapotmintáihoz**.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-171">**Health probe**.</span></span> <span data-ttu-id="c9dcd-172">HTTP (vagy HTTPS) használ a TRAFFIC Manager [mintavételi] [ tm-monitoring] minden egyes régió rendelkezésre állásának figyelésére.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-172">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="c9dcd-173">A mintavétel egy 200-as HTTP-választ a megadott URL-cím elérési keresi.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-173">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="c9dcd-174">Ajánlott eljárásként hozzon létre egy végpontot, amely jelent a alkalmazás általános állapotát, és használja ezt a végpontot a állapotmintáihoz.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-174">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="c9dcd-175">Ellenkező esetben a mintavétel előfordulhat, hogy jelentés a kifogástalan állapotú végpontok, ha az alkalmazás kritikus részei ténylegesen nem működnek.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-175">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="c9dcd-176">További információkért lásd: [állapotfigyelő végpont figyelési mintát][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="c9dcd-176">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>   

<span data-ttu-id="c9dcd-177">Amikor a Traffic Manager átadja a feladatokat a rendszer egy adott időn belül, ha ügyfelek nem tudják elérni az alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-177">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="c9dcd-178">A duration hatással van a következő tényezőket:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-178">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="c9dcd-179">A állapotmintáihoz észlelni kell, hogy az elsődleges régióban vált nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-179">The health probe must detect that the primary region has become unreachable.</span></span>
* <span data-ttu-id="c9dcd-180">DNS-kiszolgálók frissítenie kell a gyorsítótárban lévő DNS-rekordok az IP-címhez, amely a DNS--élettartama (TTL) függ.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-180">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="c9dcd-181">Az alapértelmezett élettartam 300 másodpercen (5 percen), de ezt az értéket a Traffic Manager-profil létrehozásakor konfigurálhatja.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-181">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="c9dcd-182">További információkért lásd: [kapcsolatos Traffic Manager figyelési][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="c9dcd-182">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="c9dcd-183">Ha a Traffic Manager átadja, ajánlott végrehajtása manuális feladat-visszavétel, nem pedig egy automatikus feladat-visszavétel végrehajtására.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-183">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="c9dcd-184">Ellenkező esetben hozhat létre olyan helyzet, amelyben az alkalmazás oda-vissza régiók közötti tükrözi.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-184">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="c9dcd-185">Ellenőrizze, hogy minden alkalmazás alrendszer visszavétele előtt kifogástalan.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-185">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="c9dcd-186">Vegye figyelembe, hogy a Traffic Manager vissza alapértelmezés szerint automatikusan nem.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-186">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="c9dcd-187">Ennek megelőzése érdekében manuálisan a Prioritás csökkentése az elsődleges régió egy feladatátvételi esemény után.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-187">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="c9dcd-188">Tegyük fel például, hogy az elsődleges régióban 1 prioritású virtuális gép, és a másodlagos prioritású 2.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-188">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="c9dcd-189">A feladatátvétel után állítsa be az elsődleges régióban prioritás 3, hogy megakadályozza az automatikus feladatátvételi.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-189">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="c9dcd-190">Ha készen áll vissza, frissítse a prioritás 1.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-190">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="c9dcd-191">A következő [Azure CLI] [ install-azure-cli] parancs frissíti a prioritás:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-191">The following [Azure CLI][install-azure-cli] command updates the priority:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --priority 3
```    

<span data-ttu-id="c9dcd-192">Egy másik megoldás, hogy ideiglenesen letilthatja a végpont, amíg készen feladat-visszavételt:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-192">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --status Disabled
```

<span data-ttu-id="c9dcd-193">A feladatátvételi függően szükség lehet újratelepíteni az erőforrások régión belül.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-193">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="c9dcd-194">Mielőtt ismét sikertelen, egy működőképesség tesztjének elvégzéséhez.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-194">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="c9dcd-195">A vizsgálat ellenőrizni kell, többek között:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-195">The test should verify things like:</span></span>

* <span data-ttu-id="c9dcd-196">Virtuális gépek helyesen vannak konfigurálva.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-196">VMs are configured correctly.</span></span> <span data-ttu-id="c9dcd-197">(Az összes szükséges szoftverek telepítve van, az IIS fut, és így tovább.)</span><span class="sxs-lookup"><span data-stu-id="c9dcd-197">(All required software is installed, IIS is running, and so on.)</span></span>
* <span data-ttu-id="c9dcd-198">Alkalmazás alrendszereket is megfelelő.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-198">Application subsystems are healthy.</span></span> 
* <span data-ttu-id="c9dcd-199">Funkcionális tesztelése.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-199">Functional testing.</span></span> <span data-ttu-id="c9dcd-200">(Például az adatbázis-rétegből érhető el a webes réteg alapján.)</span><span class="sxs-lookup"><span data-stu-id="c9dcd-200">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="configure-sql-server-always-on-availability-groups"></a><span data-ttu-id="c9dcd-201">SQL Server mindig a rendelkezésre állási csoportok konfigurálása</span><span class="sxs-lookup"><span data-stu-id="c9dcd-201">Configure SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="c9dcd-202">Windows Server 2016 előtti SQL Server Always On rendelkezésre állási csoportok igényli tartományvezérlő, és a rendelkezésre állási csoport összes csomópontjának azonos Active Directory (AD) tartományban kell lennie.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-202">Prior to Windows Server 2016, SQL Server Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same Active Directory (AD) domain.</span></span> 

<span data-ttu-id="c9dcd-203">A rendelkezésre állási csoport konfigurálásához:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-203">To configure the availability group:</span></span>

* <span data-ttu-id="c9dcd-204">Legalább két tartományvezérlő tegyen mindegyik régióhoz.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-204">At a minimum, place two domain controllers in each region.</span></span>
* <span data-ttu-id="c9dcd-205">Adjon meg egy statikus IP-cím minden tartományvezérlőn.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-205">Give each domain controller a static IP address.</span></span>
* <span data-ttu-id="c9dcd-206">A Vnetek közötti kommunikáció engedélyezésére VNet – VNet kapcsolat létrehozása.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-206">Create a VNet-to-VNet connection to enable communication between the VNets.</span></span>
* <span data-ttu-id="c9dcd-207">Minden egyes virtuális hálózat vegye fel az IP-címét a tartományvezérlők (mindkét régió) a DNS-kiszolgáló listájához.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-207">For each VNet, add the IP addresses of the domain controllers (from both regions) to the DNS server list.</span></span> <span data-ttu-id="c9dcd-208">A következő parancssori parancsot használhatja.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-208">You can use the following CLI command.</span></span> <span data-ttu-id="c9dcd-209">További információkért lásd: [egy virtuális hálózatot (VNet) által használt kezelése DNS-kiszolgálók][vnet-dns].</span><span class="sxs-lookup"><span data-stu-id="c9dcd-209">For more information, see [Manage DNS servers used by a virtual network (VNet)][vnet-dns].</span></span>

    ```bat
    azure network vnet set --resource-group dc01-rg --name dc01-vnet --dns-servers "10.0.0.4,10.0.0.6,172.16.0.4,172.16.0.6"
    ```

* <span data-ttu-id="c9dcd-210">Hozzon létre egy [Windows Server feladatátvételi fürtszolgáltatási] [ wsfc] (WSFC) fürt, amely tartalmazza az SQL Server-példányok mindkét régióban.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-210">Create a [Windows Server Failover Clustering][wsfc] (WSFC) cluster that includes the SQL Server instances in both regions.</span></span> 
* <span data-ttu-id="c9dcd-211">Hozzon létre egy SQL Server mindig a rendelkezésre állási csoportot, amely tartalmazza az SQL Server-példányok az elsődleges és másodlagos régiókban.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-211">Create a SQL Server Always On Availability Group that includes the SQL Server instances in both the primary and secondary regions.</span></span> <span data-ttu-id="c9dcd-212">Lásd: [kiterjesztése mindig a rendelkezésre állási csoport távoli Azure Datacenter (PowerShell)](https://blogs.msdn.microsoft.com/sqlcat/2014/09/22/extending-alwayson-availability-group-to-remote-azure-datacenter-powershell/) lépéseit.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-212">See [Extending Always On Availability Group to Remote Azure Datacenter (PowerShell)](https://blogs.msdn.microsoft.com/sqlcat/2014/09/22/extending-alwayson-availability-group-to-remote-azure-datacenter-powershell/) for the steps.</span></span>

    * <span data-ttu-id="c9dcd-213">Helyezze el az elsődleges másodpéldány az elsődleges régióban.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-213">Put the primary replica in the primary region.</span></span>
    * <span data-ttu-id="c9dcd-214">Egy vagy több másodlagos replikák helyezze el az elsődleges régióban.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-214">Put one or more secondary replicas in the primary region.</span></span> <span data-ttu-id="c9dcd-215">Konfigurálja azokat a szinkron véglegesítési használata automatikus feladatátvételre.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-215">Configure these to use synchronous commit with automatic failover.</span></span>
    * <span data-ttu-id="c9dcd-216">Egy vagy több másodlagos replikák helyezze el a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-216">Put one or more secondary replicas in the secondary region.</span></span> <span data-ttu-id="c9dcd-217">Konfigurálja azokat használni a *aszinkron* véglegesítési teljesítményének javítására szolgál.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-217">Configure these to use *asynchronous* commit, for performance reasons.</span></span> <span data-ttu-id="c9dcd-218">(Ellenkező esetben minden T-SQL-tranzakciót kell várnia az oda-vissza a hálózaton át a másodlagos régióba.)</span><span class="sxs-lookup"><span data-stu-id="c9dcd-218">(Otherwise, all T-SQL transactions have to wait on a round trip over the network to the secondary region.)</span></span>

    > [!NOTE]
    > <span data-ttu-id="c9dcd-219">Az aszinkron véglegesítésű replikák nem támogatják az automatikus feladatátvételre.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-219">Asynchronous commit replicas do not support automatic failover.</span></span>
    >
    >

<span data-ttu-id="c9dcd-220">További információkért lásd: [fut a Windows virtuális gépek az Azure-N szintű architektúra](n-tier.md).</span><span class="sxs-lookup"><span data-stu-id="c9dcd-220">For more information, see [Running Windows VMs for an N-tier architecture on Azure](n-tier.md).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="c9dcd-221">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="c9dcd-221">Availability considerations</span></span>

<span data-ttu-id="c9dcd-222">Egy összetett N szintű alkalmazást, nem kell replikálni a másodlagos régióban a teljes alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-222">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="c9dcd-223">Ehelyett csak lehet, hogy replikálja a kritikus alrendszer, az üzletmenet folytonossága támogatásához szükséges.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-223">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="c9dcd-224">A TRAFFIC Manager ponttá lehetséges hiba a rendszerben.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-224">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="c9dcd-225">A Traffic Manager szolgáltatás nem sikerül, ha az ügyfelek nem tudnak hozzáférni az alkalmazás a leállások során.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-225">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="c9dcd-226">Tekintse át a [Traffic Manager SLA][tm-sla], és döntse el, hogy kizárólag a Traffic Manager segítségével megfelel-e az üzleti követelményeinek, a magas rendelkezésre állás érdekében.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-226">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="c9dcd-227">Ha nem, akkor vegyen fel egy másik forgalom felügyeleti megoldás, a feladat-visszavételre.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-227">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="c9dcd-228">Ha az Azure Traffic Manager szolgáltatás nem sikerül, módosítsa a CNAME rekordot a DNS-ben, hogy a többi felügyeleti szolgálat mutasson.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-228">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="c9dcd-229">(Ebben a lépésben kézzel kell elvégezni, és az alkalmazás nem lehet a DNS-módosítások továbbítódnak.)</span><span class="sxs-lookup"><span data-stu-id="c9dcd-229">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="c9dcd-230">Az SQL Server-fürt van két feladatátvételi forgatókönyvek kell figyelembe venni:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-230">For the SQL Server cluster, there are two failover scenarios to consider:</span></span>

- <span data-ttu-id="c9dcd-231">Az SQL Server adatbázis-replikákat az elsődleges régióban összes sikertelen.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-231">All of the SQL Server database replicas in the primary region fail.</span></span> <span data-ttu-id="c9dcd-232">Például ez akkor fordulhat regionális kimaradás során.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-232">For example, this could happen during a regional outage.</span></span> <span data-ttu-id="c9dcd-233">Ebben az esetben kézi feladatátvételt kell a rendelkezésre állási csoportból, annak ellenére, hogy a Traffic Manager automatikusan átkerül a kezelőfelületre.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-233">In that case, you must manually fail over the availability group, even though Traffic Manager automatically fails over on the front end.</span></span> <span data-ttu-id="c9dcd-234">Kövesse a [egy SQL Server rendelkezésre állási csoport kényszerített kézi feladatátvétel végrehajtása](https://msdn.microsoft.com/library/ff877957.aspx), ismertető kényszerített feladatátvételre végrehajtani az SQL Server 2016 SQL Server Management Studio, a Transact-SQL vagy a PowerShell használatával.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-234">Follow the steps in [Perform a Forced Manual Failover of a SQL Server Availability Group](https://msdn.microsoft.com/library/ff877957.aspx), which describes how to perform a forced failover by using SQL Server Management Studio, Transact-SQL, or PowerShell in SQL Server 2016.</span></span>

   > [!WARNING]
   > <span data-ttu-id="c9dcd-235">A kényszerített feladatátvételi fennáll az adatvesztés.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-235">With forced failover, there is a risk of data loss.</span></span> <span data-ttu-id="c9dcd-236">Az elsődleges régióban újra online állapotba kerül, ha az adatbázis, és felhasználása [tablediff] különbségek kereséséhez.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-236">Once the primary region is back online, take a snapshot of the database and use [tablediff] to find the differences.</span></span>
   >
   >
- <span data-ttu-id="c9dcd-237">A TRAFFIC Manager átadja a feladatokat a másodlagos régióba, de az elsődleges SQL Server adatbázis-replika továbbra is elérhető.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-237">Traffic Manager fails over to the secondary region, but the primary SQL Server database replica is still available.</span></span> <span data-ttu-id="c9dcd-238">Például az előtér-réteg sikertelen lehet, az nem befolyásolja az SQL Server virtuális gépen.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-238">For example, the front-end tier might fail, without affecting the SQL Server VMs.</span></span> <span data-ttu-id="c9dcd-239">Ebben az esetben internetes továbbítódik a másodlagos régióban, és adott régióban még lehet kapcsolódni az elsődleges másodpéldány.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-239">In that case, Internet traffic is routed to the secondary region, and that region can still connect to the primary replica.</span></span> <span data-ttu-id="c9dcd-240">Azonban nem lesznek nagyobb késéseket, mert az SQL Serverhez való csatlakozást fog régiók között.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-240">However, there will be increased latency, because the SQL Server connections are going across regions.</span></span> <span data-ttu-id="c9dcd-241">Ebben a helyzetben végre kell hajtania a manuális feladatátvételt az alábbiak szerint:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-241">In this situation, you should perform a manual failover as follows:</span></span>

   1. <span data-ttu-id="c9dcd-242">Ideiglenes Váltás az SQL Server adatbázis-replikát a másodlagos régióban *szinkron* véglegesítési.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-242">Temporarily switch a SQL Server database replica in the secondary region to *synchronous* commit.</span></span> <span data-ttu-id="c9dcd-243">Ez biztosítja, nem lesznek adatvesztés a feladatátvétel során.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-243">This ensures there won't be data loss during the failover.</span></span>
   2. <span data-ttu-id="c9dcd-244">Feladatok átadása a, hogy a replika.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-244">Fail over to that replica.</span></span>
   3. <span data-ttu-id="c9dcd-245">Ha nem vissza az elsődleges régióban, a aszinkron véglegesítési beállítás visszaállításához.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-245">When you fail back to the primary region, restore the asynchronous commit setting.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="c9dcd-246">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="c9dcd-246">Manageability considerations</span></span>

<span data-ttu-id="c9dcd-247">Ha a telepítés frissítéséhez frissíteni egy régió tartozik csökkenti annak esélyét, a globális hibák egy helytelen konfiguráció vagy az alkalmazás hiba egyszerre.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-247">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="c9dcd-248">Tesztelje a rugalmasság, a rendszer a hibák.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-248">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="c9dcd-249">Alább található néhány gyakori meghibásodási helyzet:</span><span class="sxs-lookup"><span data-stu-id="c9dcd-249">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="c9dcd-250">Állítson le virtuálisgép-példányokat.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-250">Shut down VM instances.</span></span>
* <span data-ttu-id="c9dcd-251">Nyomás erőforrások, például CPU és memória.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-251">Pressure resources such as CPU and memory.</span></span>
* <span data-ttu-id="c9dcd-252">Hálózati kapcsolat bontása/késleltetés.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-252">Disconnect/delay network.</span></span>
* <span data-ttu-id="c9dcd-253">Váltsa ki egyes folyamatok összeomlását.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-253">Crash processes.</span></span>
* <span data-ttu-id="c9dcd-254">Alkalmazzon lejárt tanúsítványokat.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-254">Expire certificates.</span></span>
* <span data-ttu-id="c9dcd-255">Hardver hibák szimulálásához.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-255">Simulate hardware faults.</span></span>
* <span data-ttu-id="c9dcd-256">Állítsa le a DNS-szolgáltatás a tartományvezérlőkön.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-256">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="c9dcd-257">A helyreállítási idő mérését, és győződjön meg arról, hogy megfelelnek-e az üzleti igényeknek.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-257">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="c9dcd-258">Teszt sikertelen üzemmódot, valamint kombinációi.</span><span class="sxs-lookup"><span data-stu-id="c9dcd-258">Test combinations of failure modes, as well.</span></span>



<!-- Links -->
[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[azure-sla]: https://azure.microsoft.com/support/legal/sla/
[azure-sql-db]: https://azure.microsoft.com/documentation/services/sql-database/
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[install-azure-cli]: /azure/xplat-cli-install
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[services-by-region]: https://azure.microsoft.com/regions/#services
[sql-always-on]: https://msdn.microsoft.com/library/hh510230.aspx
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[vnet-dns]: /azure/virtual-network/virtual-networks-manage-dns-in-vnet
[vnet-to-vnet]: /azure/vpn-gateway/vpn-gateway-vnet-vnet-rm-ps
[vpn-gateway]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx

[0]: ./images/multi-region-application-diagram.png "Azure N szintű alkalmazásokhoz magas rendelkezésre állású hálózati architektúra"
