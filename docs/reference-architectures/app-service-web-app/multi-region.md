---
title: "Több területi webalkalmazás"
description: "Ajánlott architektúra magas rendelkezésre állással, a Microsoft Azure-ban futó webalkalmazás."
author: MikeWasson
ms.date: 11/23/2016
cardTitle: Run in multiple regions
ms.openlocfilehash: 50ac9636e1e3c25bd0403c89281a3a06915d065f
ms.sourcegitcommit: a7aae13569e165d4e768ce0aaaac154ba612934f
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/30/2018
---
# <a name="run-a-web-application-in-multiple-regions"></a><span data-ttu-id="7a709-103">Egy webalkalmazás több régióba futtatása</span><span class="sxs-lookup"><span data-stu-id="7a709-103">Run a web application in multiple regions</span></span>
[!INCLUDE [header](../../_includes/header.md)]

<span data-ttu-id="7a709-104">A referencia-architektúrában több régióba magas rendelkezésre állás biztosítása érdekében az Azure App Service-alkalmazás futtatását mutatja.</span><span class="sxs-lookup"><span data-stu-id="7a709-104">This reference architecture shows how to run an Azure App Service application in multiple regions to achieve high availability.</span></span> 

![Architektúra hivatkozni: magas rendelkezésre állású-webalkalmazás](./images/multi-region-web-app-diagram.png) 

<span data-ttu-id="7a709-106">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="7a709-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="7a709-107">Architektúra</span><span class="sxs-lookup"><span data-stu-id="7a709-107">Architecture</span></span> 

<span data-ttu-id="7a709-108">Ez az architektúra látható egy épít [webalkalmazás a méretezhetőség javítása][guidance-web-apps-scalability].</span><span class="sxs-lookup"><span data-stu-id="7a709-108">This architecture builds on the one shown in [Improve scalability in a web application][guidance-web-apps-scalability].</span></span> <span data-ttu-id="7a709-109">A fő különbségek a következők:</span><span class="sxs-lookup"><span data-stu-id="7a709-109">The main differences are:</span></span>

* <span data-ttu-id="7a709-110">**Elsődleges és másodlagos régiók**.</span><span class="sxs-lookup"><span data-stu-id="7a709-110">**Primary and secondary regions**.</span></span> <span data-ttu-id="7a709-111">Ez az architektúra két régió magasabb rendelkezésre állásának eléréséhez használja.</span><span class="sxs-lookup"><span data-stu-id="7a709-111">This architecture uses two regions to achieve higher availability.</span></span> <span data-ttu-id="7a709-112">Az alkalmazás központi telepítése mindegyik régióhoz.</span><span class="sxs-lookup"><span data-stu-id="7a709-112">The application is deployed to each region.</span></span> <span data-ttu-id="7a709-113">A normál működés során a rendszer a hálózati forgalom irányítja az elsődleges régióban.</span><span class="sxs-lookup"><span data-stu-id="7a709-113">During normal operations, network traffic is routed to the primary region.</span></span> <span data-ttu-id="7a709-114">Ha nem érhető el az elsődleges régióban, továbbítódik a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="7a709-114">If the primary region becomes unavailable, traffic is routed to the secondary region.</span></span> 
* <span data-ttu-id="7a709-115">**Az Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="7a709-115">**Azure DNS**.</span></span> <span data-ttu-id="7a709-116">[Az Azure DNS] [ azure-dns] üzemeltetési szolgáltatás DNS-tartományok biztosítani a névfeloldást a Microsoft Azure-infrastruktúra használatával.</span><span class="sxs-lookup"><span data-stu-id="7a709-116">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="7a709-117">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="7a709-117">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="7a709-118">**Az Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="7a709-118">**Azure Traffic Manager**.</span></span> <span data-ttu-id="7a709-119">[A TRAFFIC Manager] [ traffic-manager] irányítja a bejövő kéréseket az elsődleges régióban.</span><span class="sxs-lookup"><span data-stu-id="7a709-119">[Traffic Manager][traffic-manager] routes incoming requests to the primary region.</span></span> <span data-ttu-id="7a709-120">Ha az adott régióban futó alkalmazás nem érhető el, a Traffic Manager feladatátadás a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="7a709-120">If the application running that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span>
* <span data-ttu-id="7a709-121">**A georeplikáció** SQL-adatbázis és a Cosmos-adatbázis.</span><span class="sxs-lookup"><span data-stu-id="7a709-121">**Geo-replication** of SQL Database and Cosmos DB.</span></span> 

<span data-ttu-id="7a709-122">Egy több területi architektúra biztosít magas rendelkezésre állás érdekében, mint egyetlen régióban üzembe helyezni.</span><span class="sxs-lookup"><span data-stu-id="7a709-122">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="7a709-123">Ha egy regionális kimaradás érinti az elsődleges régióban, [Traffic Manager] [ traffic-manager] hogy áthelyezze a feladatokat a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="7a709-123">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="7a709-124">Ez az architektúra segíthet is, ha az alkalmazás egy egyedi alrendszer nem tud.</span><span class="sxs-lookup"><span data-stu-id="7a709-124">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="7a709-125">Magas rendelkezésre állás elérése érdekében a különböző régiókban néhány általános módszer van:</span><span class="sxs-lookup"><span data-stu-id="7a709-125">There are several general approaches to achieving high availability across regions:</span></span> 

* <span data-ttu-id="7a709-126">A melegtartalék aktív/passzív.</span><span class="sxs-lookup"><span data-stu-id="7a709-126">Active/passive with hot standby.</span></span> <span data-ttu-id="7a709-127">Forgalom kerül egy régió tartozik, a más vár melegtartalék közben.</span><span class="sxs-lookup"><span data-stu-id="7a709-127">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="7a709-128">Meleg készenléti azt jelenti, hogy a virtuális gépeket, a másodlagos régióban lefoglalt és fut mindig.</span><span class="sxs-lookup"><span data-stu-id="7a709-128">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="7a709-129">A meleg készenléti állapotban lévő aktív/passzív.</span><span class="sxs-lookup"><span data-stu-id="7a709-129">Active/passive with cold standby.</span></span> <span data-ttu-id="7a709-130">Forgalom kerül egy régió tartozik, a más vár meleg készenléti közben.</span><span class="sxs-lookup"><span data-stu-id="7a709-130">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="7a709-131">Meleg készenléti állapot azt jelenti, hogy a virtuális gépeket, a másodlagos régióban nem foglal le addig, amíg a feladatátvételi szükséges.</span><span class="sxs-lookup"><span data-stu-id="7a709-131">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="7a709-132">Ez a megközelítés költségek kisebb futtatásához, de általában adott meghibásodás során online állapotba hosszabb ideig tart.</span><span class="sxs-lookup"><span data-stu-id="7a709-132">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="7a709-133">Aktív.</span><span class="sxs-lookup"><span data-stu-id="7a709-133">Active/active.</span></span> <span data-ttu-id="7a709-134">Mindkét régió aktív, és kérés kerül közöttük.</span><span class="sxs-lookup"><span data-stu-id="7a709-134">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="7a709-135">Ha nem érhető el egy régió tartozik, az kívül Elforgatás lesz végrehajtva.</span><span class="sxs-lookup"><span data-stu-id="7a709-135">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="7a709-136">A referencia-architektúrában melegtartalék feladatátvételi Traffic Manager használata az aktív/passzív összpontosít.</span><span class="sxs-lookup"><span data-stu-id="7a709-136">This reference architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> 


## <a name="recommendations"></a><span data-ttu-id="7a709-137">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="7a709-137">Recommendations</span></span>

<span data-ttu-id="7a709-138">Az Ön követelményei eltérhetnek az itt leírt architektúrától.</span><span class="sxs-lookup"><span data-stu-id="7a709-138">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="7a709-139">A javaslatok használja ebben a szakaszban kiindulási pontként.</span><span class="sxs-lookup"><span data-stu-id="7a709-139">Use the recommendations in this section as a starting point.</span></span>

### <a name="regional-pairing"></a><span data-ttu-id="7a709-140">Regionális párosítás</span><span class="sxs-lookup"><span data-stu-id="7a709-140">Regional pairing</span></span>
<span data-ttu-id="7a709-141">Minden Azure-régió, egy másik ugyanazon a földrajzi régióját párosított.</span><span class="sxs-lookup"><span data-stu-id="7a709-141">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="7a709-142">Régiók általában választhat a azonos regionális pár (például USA keleti régiója 2. régiója, USA középső RÉGIÓJA).</span><span class="sxs-lookup"><span data-stu-id="7a709-142">In general, choose regions from the same regional pair (for example, East US 2 and Central US).</span></span> <span data-ttu-id="7a709-143">Ennek során a következő előnyöket nyújtja:</span><span class="sxs-lookup"><span data-stu-id="7a709-143">Benefits of doing so include:</span></span>

* <span data-ttu-id="7a709-144">A széles körű kimaradás esetén legalább egy régió kívül minden pár helyreállítási prioritása van.</span><span class="sxs-lookup"><span data-stu-id="7a709-144">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="7a709-145">Tervezett Azure rendszerfrissítések egymás után, az lehetséges állásidő minimalizálása érdekében párosított régiók már megkezdődött.</span><span class="sxs-lookup"><span data-stu-id="7a709-145">Planned Azure system updates are rolled out to paired regions sequentially to minimize possible downtime.</span></span>
* <span data-ttu-id="7a709-146">A legtöbb esetben a regionális párok található az ugyanazon földrajzi adatok rezidens követelményeinek megfelelően.</span><span class="sxs-lookup"><span data-stu-id="7a709-146">In most cases, regional pairs reside within the same geography to meet data residency requirements.</span></span>

<span data-ttu-id="7a709-147">Azonban győződjön meg arról, hogy mindkét régió támogatja az összes Azure-szolgáltatás szükséges az alkalmazáshoz.</span><span class="sxs-lookup"><span data-stu-id="7a709-147">However, make sure that both regions support all of the Azure services needed for your application.</span></span> <span data-ttu-id="7a709-148">Lásd: [régiói][services-by-region].</span><span class="sxs-lookup"><span data-stu-id="7a709-148">See [Services by region][services-by-region].</span></span> <span data-ttu-id="7a709-149">Regionális párok kapcsolatos további információkért lásd: [üzleti folytonossági és vészhelyreállítási helyreállítási (BCDR): Azure-régiókat párosítva][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="7a709-149">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="resource-groups"></a><span data-ttu-id="7a709-150">Erőforráscsoportok</span><span class="sxs-lookup"><span data-stu-id="7a709-150">Resource groups</span></span>
<span data-ttu-id="7a709-151">Vegye figyelembe az elsődleges régióban, a másodlagos régióba és a Traffic Manager elhelyezését külön [erőforráscsoportok][resource groups].</span><span class="sxs-lookup"><span data-stu-id="7a709-151">Consider placing the primary region, secondary region, and Traffic Manager into separate [resource groups][resource groups].</span></span> <span data-ttu-id="7a709-152">Ez lehetővé teszi minden egyes régió egyetlen gyűjteményként telepített erőforrások kezelését.</span><span class="sxs-lookup"><span data-stu-id="7a709-152">This lets you manage the resources deployed to each region as a single collection.</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="7a709-153">A TRAFFIC Manager-konfiguráció</span><span class="sxs-lookup"><span data-stu-id="7a709-153">Traffic Manager configuration</span></span> 

<span data-ttu-id="7a709-154">**Útválasztás**.</span><span class="sxs-lookup"><span data-stu-id="7a709-154">**Routing**.</span></span> <span data-ttu-id="7a709-155">A TRAFFIC Manager támogatja több [útválasztási algoritmusok][tm-routing].</span><span class="sxs-lookup"><span data-stu-id="7a709-155">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="7a709-156">A jelen cikkben ismertetett esetben használjon *prioritás* útválasztási (korábbi nevén *feladatátvételi* útválasztási).</span><span class="sxs-lookup"><span data-stu-id="7a709-156">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="7a709-157">Ezzel a beállítással a Traffic Manager minden kérést küld az elsődleges régióban hacsak az adott régió végpont el nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="7a709-157">With this setting, Traffic Manager sends all requests to the primary region unless the endpoint for that region becomes unreachable.</span></span> <span data-ttu-id="7a709-158">Ezen a ponton akkor automatikusan átkerül a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="7a709-158">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="7a709-159">Lásd: [konfigurálhatja feladatátvételi útválasztási módszer][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="7a709-159">See [Configure Failover routing method][tm-configure-failover].</span></span>

<span data-ttu-id="7a709-160">**Állapotmintáihoz**.</span><span class="sxs-lookup"><span data-stu-id="7a709-160">**Health probe**.</span></span> <span data-ttu-id="7a709-161">A TRAFFIC Manager egy HTTP-(vagy HTTPS) mintavételi használja a végpontok rendelkezésre állásának figyeléséhez.</span><span class="sxs-lookup"><span data-stu-id="7a709-161">Traffic Manager uses an HTTP (or HTTPS) probe to monitor the availability of each endpoint.</span></span> <span data-ttu-id="7a709-162">A mintavétel a másodlagos régióba feladatátvételét fázis/sikertelen próba adja meg a Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="7a709-162">The probe gives Traffic Manager a pass/fail test for failing over to the secondary region.</span></span> <span data-ttu-id="7a709-163">Működését tekintve a kérést küld a megadott URL-címe.</span><span class="sxs-lookup"><span data-stu-id="7a709-163">It works by sending a request to a specified URL path.</span></span> <span data-ttu-id="7a709-164">A határidőn belül nem 200 választ kap, ha a mintavételi sikertelen lesz.</span><span class="sxs-lookup"><span data-stu-id="7a709-164">If it gets a non-200 response within a timeout period, the probe fails.</span></span> <span data-ttu-id="7a709-165">Négy sikertelen kérelmek, miután a Traffic Manager jelöli meg a végpont állapota csökkentett teljesítményűre vált, és átadja a feladatokat a többi végpont.</span><span class="sxs-lookup"><span data-stu-id="7a709-165">After four failed requests, Traffic Manager marks the endpoint as degraded and fails over to the other endpoint.</span></span> <span data-ttu-id="7a709-166">További információkért lásd: [Traffic Manager-végpont figyelése és a feladatátvételi][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="7a709-166">For details, see [Traffic Manager endpoint monitoring and failover][tm-monitoring].</span></span>

<span data-ttu-id="7a709-167">Ajánlott eljárásként hozzon létre egy egészségügyi mintavételi végpontot, amely jelent a alkalmazás általános állapotát, és használni ezt a végpontot a állapotmintáihoz.</span><span class="sxs-lookup"><span data-stu-id="7a709-167">As a best practice, create a health probe endpoint that reports the overall health of the application and use this endpoint for the health probe.</span></span> <span data-ttu-id="7a709-168">A végpont ellenőrizni kell az App Service alkalmazások, a tároló várólista és az SQL-adatbázis például kritikus fontosságú függőségek.</span><span class="sxs-lookup"><span data-stu-id="7a709-168">The endpoint should check critical dependencies such as the App Service apps, storage queue, and SQL Database.</span></span> <span data-ttu-id="7a709-169">Ellenkező esetben a mintavétel előfordulhat, hogy jelentés a kifogástalan állapotú végpontok, ha az alkalmazás kritikus részei ténylegesen nem működnek.</span><span class="sxs-lookup"><span data-stu-id="7a709-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span>

<span data-ttu-id="7a709-170">Másrészről ne használja a állapotmintáihoz alacsonyabb prioritású virtuális gép szolgáltatások kereséséhez.</span><span class="sxs-lookup"><span data-stu-id="7a709-170">On the other hand, don't use the health probe to check lower priority services.</span></span> <span data-ttu-id="7a709-171">Például ha olyan e-mail szolgáltatás leáll az alkalmazás képes második-szolgáltatóra váltani, vagy csak később az e-mailek küldése.</span><span class="sxs-lookup"><span data-stu-id="7a709-171">For example, if an email service goes down the application can switch to a second provider or just send emails later.</span></span> <span data-ttu-id="7a709-172">Ez nem egy elég magas prioritású virtuális gép a feladatátvételt az alkalmazás.</span><span class="sxs-lookup"><span data-stu-id="7a709-172">This is not a high enough priority to cause the application to fail over.</span></span> <span data-ttu-id="7a709-173">További információkért lásd: [állapotfigyelő végpont figyelési mintát][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="7a709-173">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>
 
### <a name="sql-database"></a><span data-ttu-id="7a709-174">SQL Database</span><span class="sxs-lookup"><span data-stu-id="7a709-174">SQL Database</span></span>
<span data-ttu-id="7a709-175">Használjon [aktív Georeplikáció] [ sql-replication] olvasható másodlagos replika létrehozásához egy másik régióban.</span><span class="sxs-lookup"><span data-stu-id="7a709-175">Use [Active Geo-Replication][sql-replication] to create a readable secondary replica in a different region.</span></span> <span data-ttu-id="7a709-176">Legfeljebb négy olvasható másodlagos másodpéldányokra lehet.</span><span class="sxs-lookup"><span data-stu-id="7a709-176">You can have up to four readable secondary replicas.</span></span> <span data-ttu-id="7a709-177">Átadja egy másodlagos adatbázist, ha az elsődleges adatbázis meghibásodik vagy offline állapotba kell.</span><span class="sxs-lookup"><span data-stu-id="7a709-177">Fail over to a secondary database if your primary database fails or needs to be taken offline.</span></span> <span data-ttu-id="7a709-178">Aktív Georeplikáció a rugalmas adatbáziskészlet bármely adatbázis konfigurálható.</span><span class="sxs-lookup"><span data-stu-id="7a709-178">Active Geo-Replication can be configured for any database in any elastic database pool.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="7a709-179">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="7a709-179">Cosmos DB</span></span>
<span data-ttu-id="7a709-180">Cosmos DB georeplikáció különböző régiókban támogat.</span><span class="sxs-lookup"><span data-stu-id="7a709-180">Cosmos DB supports geo-replication across regions.</span></span> <span data-ttu-id="7a709-181">Egy régió tartozik kijelölt írható és a többi csak olvasható replika.</span><span class="sxs-lookup"><span data-stu-id="7a709-181">One region is designated as writable and the others are read-only replicas.</span></span>

<span data-ttu-id="7a709-182">Regionális kimaradás esetén is utasíthat el át egy másik régióban kell lennie a írási régió kiválasztásával.</span><span class="sxs-lookup"><span data-stu-id="7a709-182">If there is a regional outage, you can fail over by selecting another region to be the write region.</span></span> <span data-ttu-id="7a709-183">SDK automatikusan elküldi az ügyfélnek az aktuális írási terület, az írási kérelmeket szolgál, így nem kell frissíteni az ügyfél beállításait egy feladatátvétel után.</span><span class="sxs-lookup"><span data-stu-id="7a709-183">The client SDK automatically sends write requests to the current write region, so you don't need to update the client configuration after a failover.</span></span> <span data-ttu-id="7a709-184">További információkért lásd: [miként ossza el a globális adatok Azure Cosmos DB][cosmosdb-geo].</span><span class="sxs-lookup"><span data-stu-id="7a709-184">For more information, see [How to distribute data globally with Azure Cosmos DB][cosmosdb-geo].</span></span>

> [!NOTE]
> <span data-ttu-id="7a709-185">A replikák mindegyikét tartozik ugyanabban az erőforráscsoportban.</span><span class="sxs-lookup"><span data-stu-id="7a709-185">All of the replicas belong to the same resource group.</span></span>
>
>

### <a name="storage"></a><span data-ttu-id="7a709-186">Tárolás</span><span class="sxs-lookup"><span data-stu-id="7a709-186">Storage</span></span>
<span data-ttu-id="7a709-187">Az Azure Storage használata [írásvédett georedundáns tárolás] [ ra-grs] (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="7a709-187">For Azure Storage, use [read-access geo-redundant storage][ra-grs] (RA-GRS).</span></span> <span data-ttu-id="7a709-188">Az RA-GRS tárolással rendelkező másodlagos régióba replikálja az adatok.</span><span class="sxs-lookup"><span data-stu-id="7a709-188">With RA-GRS storage, the data is replicated to a secondary region.</span></span> <span data-ttu-id="7a709-189">Az adatok csak olvasási hozzáféréssel rendelkezik a másodlagos régióban külön végpontot keresztül.</span><span class="sxs-lookup"><span data-stu-id="7a709-189">You have read-only access to the data in the secondary region through a separate endpoint.</span></span> <span data-ttu-id="7a709-190">Ha egy regionális kimaradás vagy katasztrófa, az Azure Storage csapat dönthet, hogy a másodlagos régióba földrajzi-feladatátvétel végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="7a709-190">If there is a regional outage or disaster, the Azure Storage team might decide to perform a geo-failover to the secondary region.</span></span> <span data-ttu-id="7a709-191">Nincs nincs feladatátvételi szükség felhasználói beavatkozásra.</span><span class="sxs-lookup"><span data-stu-id="7a709-191">There is no customer action required for this failover.</span></span>

<span data-ttu-id="7a709-192">A Queue storage a biztonsági mentési várólista létrehozása a másodlagos régióban.</span><span class="sxs-lookup"><span data-stu-id="7a709-192">For Queue storage, create a backup queue in the secondary region.</span></span> <span data-ttu-id="7a709-193">A feladatátvétel során az alkalmazás használhatja a biztonsági mentési várólista, míg az elsődleges régióban elérhető újra.</span><span class="sxs-lookup"><span data-stu-id="7a709-193">During failover, the app can use the backup queue until the primary region becomes available again.</span></span> <span data-ttu-id="7a709-194">Így az alkalmazás továbbra is az új kérelmek tud feldolgozni.</span><span class="sxs-lookup"><span data-stu-id="7a709-194">That way, the application can still process new requests.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="7a709-195">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="7a709-195">Availability considerations</span></span>


### <a name="traffic-manager"></a><span data-ttu-id="7a709-196">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="7a709-196">Traffic Manager</span></span>

<span data-ttu-id="7a709-197">A TRAFFIC Manager automatikusan leállítja keresztül, ha az elsődleges régióban nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="7a709-197">Traffic Manager automatically fails over if the primary region becomes unavailable.</span></span> <span data-ttu-id="7a709-198">Ha a Traffic Manager átadja, van egy adott időn belül, ha ügyfelek nem tudják elérni az alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="7a709-198">When Traffic Manager fails over, there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="7a709-199">A duration hatással van a következő tényezőket:</span><span class="sxs-lookup"><span data-stu-id="7a709-199">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="7a709-200">A állapotmintáihoz észlelni kell, hogy az elsődleges adatközpont vált nem érhető el.</span><span class="sxs-lookup"><span data-stu-id="7a709-200">The health probe must detect that the primary data center has become unreachable.</span></span>
* <span data-ttu-id="7a709-201">Tartományi szolgáltatási (DNS) névkiszolgálók frissítenie kell a gyorsítótárban lévő DNS-rekordok az IP-címhez, amely a DNS--élettartama (TTL) függ.</span><span class="sxs-lookup"><span data-stu-id="7a709-201">Domain name service (DNS) servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="7a709-202">Az alapértelmezett élettartam 300 másodpercen (5 percen), de ezt az értéket a Traffic Manager-profil létrehozásakor konfigurálhatja.</span><span class="sxs-lookup"><span data-stu-id="7a709-202">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="7a709-203">További információkért lásd: [kapcsolatos Traffic Manager figyelési][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="7a709-203">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="7a709-204">A TRAFFIC Manager ponttá lehetséges hiba a rendszerben.</span><span class="sxs-lookup"><span data-stu-id="7a709-204">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="7a709-205">Ha a szolgáltatás nem sikerül, az ügyfelek nem tudnak hozzáférni az alkalmazás a leállások során.</span><span class="sxs-lookup"><span data-stu-id="7a709-205">If the service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="7a709-206">Tekintse át a [Traffic Manager szolgáltatásiszint-szerződéssel (SLA)] [ tm-sla] és döntse el, hogy kizárólag a Traffic Manager segítségével megfelel-e az üzleti követelményeinek, a magas rendelkezésre állás érdekében.</span><span class="sxs-lookup"><span data-stu-id="7a709-206">Review the [Traffic Manager service level agreement (SLA)][tm-sla] and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="7a709-207">Ha nem, akkor vegyen fel egy másik forgalom felügyeleti megoldás, a feladat-visszavételre.</span><span class="sxs-lookup"><span data-stu-id="7a709-207">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="7a709-208">Ha az Azure Traffic Manager szolgáltatás nem sikerül, módosítsa a kanonikus név (CNAME) rekord a DNS-ben, hogy a többi felügyeleti szolgálat mutasson.</span><span class="sxs-lookup"><span data-stu-id="7a709-208">If the Azure Traffic Manager service fails, change your canonical name (CNAME) records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="7a709-209">Ebben a lépésben kézzel kell elvégezni, és az alkalmazás sem lesznek elérhetők, amíg a DNS-módosításokat továbbítja.</span><span class="sxs-lookup"><span data-stu-id="7a709-209">This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.</span></span>

### <a name="sql-database"></a><span data-ttu-id="7a709-210">SQL Database</span><span class="sxs-lookup"><span data-stu-id="7a709-210">SQL Database</span></span>
<span data-ttu-id="7a709-211">A helyreállítási időkorlát (RPO) és az SQL-adatbázis becsült helyreállításkor (Beszúrása) című témakörben [az Azure SQL Database üzletmenet áttekintése][sql-rpo].</span><span class="sxs-lookup"><span data-stu-id="7a709-211">The recovery point objective (RPO) and estimated recovery time (ERT) for SQL Database are documented in [Overview of business continuity with Azure SQL Database][sql-rpo].</span></span> 

### <a name="storage"></a><span data-ttu-id="7a709-212">Tárolás</span><span class="sxs-lookup"><span data-stu-id="7a709-212">Storage</span></span>
<span data-ttu-id="7a709-213">RA-GRS tárolási tartós tárolására szolgál, de fontos tudni, mi történhet kimaradás során:</span><span class="sxs-lookup"><span data-stu-id="7a709-213">RA-GRS storage provides durable storage, but it's important to understand what can happen during an outage:</span></span>

* <span data-ttu-id="7a709-214">A tárolási tervezett kimaradás esetén nem lesznek egy adott időn belül, ha nem rendelkezik írási-férhetnek hozzá az adatokhoz.</span><span class="sxs-lookup"><span data-stu-id="7a709-214">If a storage outage occurs, there will be a period of time when you don't have write-access to the data.</span></span> <span data-ttu-id="7a709-215">Ön továbbra is olvashatók be a másodlagos végponti a szolgáltatáskimaradás elhárítása során.</span><span class="sxs-lookup"><span data-stu-id="7a709-215">You can still read from the secondary endpoint during the outage.</span></span>
* <span data-ttu-id="7a709-216">Ha egy regionális kimaradás vagy katasztrófa hatással van az elsődleges helyre, és nem lehet helyreállítani az adatokat, az Azure Storage csapat dönthet végezzen el egy földrajzi-feladatátvételt a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="7a709-216">If a regional outage or disaster affects the primary location and the data there cannot be recovered, the Azure Storage team may decide to perform a geo-failover to the secondary region.</span></span>
* <span data-ttu-id="7a709-217">A másodlagos régióba replikálása aszinkron módon történik.</span><span class="sxs-lookup"><span data-stu-id="7a709-217">Data replication to the secondary region is performed asynchronously.</span></span> <span data-ttu-id="7a709-218">Ezért a földrajzi feladatátvétel történik, ha adatvesztést, lehetséges, ha az adatokat nem lehet helyreállítani az elsődleges régióban.</span><span class="sxs-lookup"><span data-stu-id="7a709-218">Therefore, if a geo-failover is performed, some data loss is possible if the data can't be recovered from the primary region.</span></span>
* <span data-ttu-id="7a709-219">Átmeneti hibák, például egy hálózati kimaradás nem indít el a tárolási feladatátvevő.</span><span class="sxs-lookup"><span data-stu-id="7a709-219">Transient failures, such as a network outage, will not trigger a storage failover.</span></span> <span data-ttu-id="7a709-220">Tervezze meg az alkalmazás átmeneti hibák rugalmasak lehetnek.</span><span class="sxs-lookup"><span data-stu-id="7a709-220">Design your application to be resilient to transient failures.</span></span> <span data-ttu-id="7a709-221">Lehetséges megoldást:</span><span class="sxs-lookup"><span data-stu-id="7a709-221">Possible mitigations:</span></span>
  
  * <span data-ttu-id="7a709-222">A másodlagos régióba olvasni.</span><span class="sxs-lookup"><span data-stu-id="7a709-222">Read from the secondary region.</span></span>
  * <span data-ttu-id="7a709-223">Átmenetileg váltson egy másik tárfiókhoz új az írási műveletek (például, hogy a várólista-üzenetek).</span><span class="sxs-lookup"><span data-stu-id="7a709-223">Temporarily switch to another storage account for new write operations (for example, to queue messages).</span></span>
  * <span data-ttu-id="7a709-224">A másodlagos régióba adatainak másolása másik tárolási fiókot.</span><span class="sxs-lookup"><span data-stu-id="7a709-224">Copy data from the secondary region to another storage account.</span></span>
  * <span data-ttu-id="7a709-225">Adja meg a csökkentett, amíg a rendszer visszaállítása sikertelen.</span><span class="sxs-lookup"><span data-stu-id="7a709-225">Provide reduced functionality until the system fails back.</span></span>

<span data-ttu-id="7a709-226">További információkért lásd: [Mi a teendő, ha egy Azure Storage esetleges leálláskor][storage-outage].</span><span class="sxs-lookup"><span data-stu-id="7a709-226">For more information, see [What to do if an Azure Storage outage occurs][storage-outage].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="7a709-227">A kezelhetőséggel kapcsolatos szempontok</span><span class="sxs-lookup"><span data-stu-id="7a709-227">Manageability Considerations</span></span>

### <a name="traffic-manager"></a><span data-ttu-id="7a709-228">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="7a709-228">Traffic Manager</span></span>

<span data-ttu-id="7a709-229">Ha a Traffic Manager átadja, ajánlott végrehajtása manuális feladat-visszavétel, nem pedig egy automatikus feladat-visszavétel végrehajtására.</span><span class="sxs-lookup"><span data-stu-id="7a709-229">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="7a709-230">Ellenkező esetben hozhat létre olyan helyzet, amelyben az alkalmazás oda-vissza régiók közötti tükrözi.</span><span class="sxs-lookup"><span data-stu-id="7a709-230">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="7a709-231">Ellenőrizze, hogy minden alkalmazás alrendszer visszavétele előtt kifogástalan.</span><span class="sxs-lookup"><span data-stu-id="7a709-231">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="7a709-232">Vegye figyelembe, hogy a Traffic Manager vissza alapértelmezés szerint automatikusan nem.</span><span class="sxs-lookup"><span data-stu-id="7a709-232">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="7a709-233">Ennek megelőzése érdekében manuálisan a Prioritás csökkentése az elsődleges régió egy feladatátvételi esemény után.</span><span class="sxs-lookup"><span data-stu-id="7a709-233">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="7a709-234">Tegyük fel például, hogy az elsődleges régióban 1 prioritású virtuális gép, és a másodlagos prioritású 2.</span><span class="sxs-lookup"><span data-stu-id="7a709-234">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="7a709-235">A feladatátvétel után állítsa be az elsődleges régióban prioritás 3, hogy megakadályozza az automatikus feladatátvételi.</span><span class="sxs-lookup"><span data-stu-id="7a709-235">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="7a709-236">Ha készen áll vissza, frissítse a prioritás 1.</span><span class="sxs-lookup"><span data-stu-id="7a709-236">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="7a709-237">Az alábbi parancsokat a prioritás frissítése.</span><span class="sxs-lookup"><span data-stu-id="7a709-237">The following commands update the priority.</span></span>

<span data-ttu-id="7a709-238">**PowerShell**</span><span class="sxs-lookup"><span data-stu-id="7a709-238">**PowerShell**</span></span>

```bat
$endpoint = Get-AzureRmTrafficManagerEndpoint -Name <endpoint> -ProfileName <profile> -ResourceGroupName <resource-group> -Type AzureEndpoints
$endpoint.Priority = 3
Set-AzureRmTrafficManagerEndpoint -TrafficManagerEndpoint $endpoint
```

<span data-ttu-id="7a709-239">További információkért lásd: [Azure Traffic Manager parancsmagok][tm-ps].</span><span class="sxs-lookup"><span data-stu-id="7a709-239">For more information, see [Azure Traffic Manager Cmdlets][tm-ps].</span></span>

<span data-ttu-id="7a709-240">**Az Azure parancssori felület (CLI)**</span><span class="sxs-lookup"><span data-stu-id="7a709-240">**Azure command line interface (CLI)**</span></span>

```bat
azure network traffic-manager endpoint set --name <endpoint> --profile-name <profile> --resource-group <resource-group> --type AzureEndpoints --priority 3
```    

### <a name="sql-database"></a><span data-ttu-id="7a709-241">SQL Database</span><span class="sxs-lookup"><span data-stu-id="7a709-241">SQL Database</span></span>
<span data-ttu-id="7a709-242">Ha az elsődleges adatbázis, hajtsa végre a másodlagos adatbázis manuális feladatátvétele.</span><span class="sxs-lookup"><span data-stu-id="7a709-242">If the primary database fails, perform a manual failover to the secondary database.</span></span> <span data-ttu-id="7a709-243">Lásd: [egy Azure SQL Database vagy feladatátvételi visszaállításához a másodlagos][sql-failover].</span><span class="sxs-lookup"><span data-stu-id="7a709-243">See [Restore an Azure SQL Database or failover to a secondary][sql-failover].</span></span> <span data-ttu-id="7a709-244">A másodlagos adatbázis csak olvasható marad, amíg a rendszer átadja.</span><span class="sxs-lookup"><span data-stu-id="7a709-244">The secondary database remains read-only until you fail over.</span></span>


<!-- links -->

[azure-sql-db]: https://azure.microsoft.com/documentation/services/sql-database/
[azure-dns]: /azure/dns/dns-overview
[cosmosdb-geo]: /azure/cosmos-db/distribute-data-globally
[guidance-web-apps-scalability]: ./scalable-web-app.md
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[ra-grs]: /azure/storage/storage-redundancy#read-access-geo-redundant-storage
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview#resource-groups
[services-by-region]: https://azure.microsoft.com/regions/#services
[sql-failover]: /azure/sql-database/sql-database-disaster-recovery
[sql-replication]: /azure/sql-database/sql-database-geo-replication-overview
[sql-rpo]: /azure/sql-database/sql-database-business-continuity#sql-database-features-that-you-can-use-to-provide-business-continuity
[storage-outage]: /azure/storage/storage-disaster-recovery-guidance
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-ps]: https://msdn.microsoft.com/library/mt125941.aspx
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.azureedge.net/cdn/app-service-reference-architectures.vsdx
