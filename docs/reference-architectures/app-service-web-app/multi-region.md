---
title: Többrégiós webalkalmazás
description: A Microsoft Azure szolgáltatásban futó magas rendelkezésre állású webalkalmazásokhoz javasolt architektúra.
author: MikeWasson
ms.date: 11/23/2016
cardTitle: Run in multiple regions
ms.openlocfilehash: 9fae95c0c0d38a756c10f37864495caad5ebda3b
ms.sourcegitcommit: b2a4eb132857afa70201e28d662f18458865a48e
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/05/2018
ms.locfileid: "48819057"
---
# <a name="run-a-web-application-in-multiple-regions"></a><span data-ttu-id="eab3e-103">Webalkalmazás futtatása több régióban</span><span class="sxs-lookup"><span data-stu-id="eab3e-103">Run a web application in multiple regions</span></span>
[!INCLUDE [header](../../_includes/header.md)]

<span data-ttu-id="eab3e-104">Ez a referenciaarchitektúra bemutatja, hogyan futtatható egy Azure App Service-alkalmazás több régióban a magas rendelkezésre állás elérése érdekében.</span><span class="sxs-lookup"><span data-stu-id="eab3e-104">This reference architecture shows how to run an Azure App Service application in multiple regions to achieve high availability.</span></span> 

![Referenciaarchitektúra: Magas rendelkezésre állású webalkalmazás](./images/multi-region-web-app-diagram.png) 

<span data-ttu-id="eab3e-106">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="eab3e-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="eab3e-107">Architektúra</span><span class="sxs-lookup"><span data-stu-id="eab3e-107">Architecture</span></span> 

<span data-ttu-id="eab3e-108">Ez az architektúra [A méretezhetőség javítása webalkalmazásokban][guidance-web-apps-scalability] című cikkben bemutatott architektúrára épít.</span><span class="sxs-lookup"><span data-stu-id="eab3e-108">This architecture builds on the one shown in [Improve scalability in a web application][guidance-web-apps-scalability].</span></span> <span data-ttu-id="eab3e-109">A legfontosabb különbségek a következők:</span><span class="sxs-lookup"><span data-stu-id="eab3e-109">The main differences are:</span></span>

* <span data-ttu-id="eab3e-110">**Elsődleges és másodlagos régiók**.</span><span class="sxs-lookup"><span data-stu-id="eab3e-110">**Primary and secondary regions**.</span></span> <span data-ttu-id="eab3e-111">Ez az architektúra két régiót használ a magas rendelkezésre állás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="eab3e-111">This architecture uses two regions to achieve higher availability.</span></span> <span data-ttu-id="eab3e-112">A rendszer az összes régióban telepíti az alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="eab3e-112">The application is deployed to each region.</span></span> <span data-ttu-id="eab3e-113">A normál működés során a hálózati forgalom az elsődleges régió felé irányul.</span><span class="sxs-lookup"><span data-stu-id="eab3e-113">During normal operations, network traffic is routed to the primary region.</span></span> <span data-ttu-id="eab3e-114">Ha az elsődleges régió nem érhető el, a rendszer a másodlagos régió felé irányítja a forgalmat.</span><span class="sxs-lookup"><span data-stu-id="eab3e-114">If the primary region becomes unavailable, traffic is routed to the secondary region.</span></span> 
* <span data-ttu-id="eab3e-115">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="eab3e-115">**Azure DNS**.</span></span> <span data-ttu-id="eab3e-116">Az [Azure DNS][azure-dns] egy üzemeltetési szolgáltatás, amely a Microsoft Azure infrastruktúráját használja a DNS-tartományok névfeloldásához.</span><span class="sxs-lookup"><span data-stu-id="eab3e-116">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="eab3e-117">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="eab3e-117">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="eab3e-118">**Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="eab3e-118">**Azure Traffic Manager**.</span></span> <span data-ttu-id="eab3e-119">A [Traffic Manager][traffic-manager] az elsődleges régió felé irányítja a kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="eab3e-119">[Traffic Manager][traffic-manager] routes incoming requests to the primary region.</span></span> <span data-ttu-id="eab3e-120">Ha az adott régiót futtató alkalmazás nem érhető el, a Traffic Manager átirányítja a forgalmat a másodlagos régió felé.</span><span class="sxs-lookup"><span data-stu-id="eab3e-120">If the application running that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span>
* <span data-ttu-id="eab3e-121">Az SQL Database és a Cosmos DB **georeplikációja**.</span><span class="sxs-lookup"><span data-stu-id="eab3e-121">**Geo-replication** of SQL Database and Cosmos DB.</span></span> 

<span data-ttu-id="eab3e-122">A többrégiós architektúrák magasabb rendelkezésre állást biztosíthatnak, mint az egyetlen régióban történő üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="eab3e-122">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="eab3e-123">Ha egy régió üzemkimaradása hatással van az elsődleges régióra, a [Traffic Manager][traffic-manager] szolgáltatással feladatátvételt hajthat végre a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="eab3e-123">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="eab3e-124">Ez az architektúra az alkalmazás egy adott alrendszerének meghibásodása esetén is segíthet.</span><span class="sxs-lookup"><span data-stu-id="eab3e-124">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="eab3e-125">A régiók közötti magas rendelkezésre állás elérésének több általános megközelítése van:</span><span class="sxs-lookup"><span data-stu-id="eab3e-125">There are several general approaches to achieving high availability across regions:</span></span> 

* <span data-ttu-id="eab3e-126">Aktív/passzív készenléti kiszolgálóval.</span><span class="sxs-lookup"><span data-stu-id="eab3e-126">Active/passive with hot standby.</span></span> <span data-ttu-id="eab3e-127">A forgalom az egyik régióra irányul, míg a másik készenléti kiszolgálón várakozik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-127">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="eab3e-128">Készenléti kiszolgáló esetében a másodlagos régió virtuális gépei folyamatosan le vannak foglalva és futnak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-128">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="eab3e-129">Aktív/passzív hidegtartalékkal.</span><span class="sxs-lookup"><span data-stu-id="eab3e-129">Active/passive with cold standby.</span></span> <span data-ttu-id="eab3e-130">A forgalom az egyik régióra irányul, míg a másik hidegtartalékként áll készenlétben.</span><span class="sxs-lookup"><span data-stu-id="eab3e-130">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="eab3e-131">Hidegtartalék esetében a másodlagos régió virtuális gépei nincsenek lefoglalva, amíg nem szükségessé nem válnak feladatátvétel céljából.</span><span class="sxs-lookup"><span data-stu-id="eab3e-131">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="eab3e-132">Ezen megközelítés futtatása kevesebb költséggel jár, de a meghibásodáskor általában hosszabb időt vesz igénybe az üzembe állás.</span><span class="sxs-lookup"><span data-stu-id="eab3e-132">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="eab3e-133">Aktív/aktív.</span><span class="sxs-lookup"><span data-stu-id="eab3e-133">Active/active.</span></span> <span data-ttu-id="eab3e-134">Mindkét régió aktív, és a kérelmek terheléselosztással oszlanak meg közöttük.</span><span class="sxs-lookup"><span data-stu-id="eab3e-134">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="eab3e-135">Ha egy régió elérhetetlenné válik, kikerül a rotációból.</span><span class="sxs-lookup"><span data-stu-id="eab3e-135">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="eab3e-136">Ez a referenciaarchitektúra a készenléti kiszolgálóval konfigurált aktív/passzív üzemmódra összpontosít, a Traffic Managert használva a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="eab3e-136">This reference architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> 


## <a name="recommendations"></a><span data-ttu-id="eab3e-137">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="eab3e-137">Recommendations</span></span>

<span data-ttu-id="eab3e-138">Az Ön követelményei eltérhetnek az itt leírt architektúrától.</span><span class="sxs-lookup"><span data-stu-id="eab3e-138">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="eab3e-139">A jelen szakaszban leírt javaslatokat tekintse kiindulópontnak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-139">Use the recommendations in this section as a starting point.</span></span>

### <a name="regional-pairing"></a><span data-ttu-id="eab3e-140">Régiónkénti párosítás</span><span class="sxs-lookup"><span data-stu-id="eab3e-140">Regional pairing</span></span>
<span data-ttu-id="eab3e-141">Minden egyes Azure-régió párban áll egy másikkal egy azonos földrajzi területen belül.</span><span class="sxs-lookup"><span data-stu-id="eab3e-141">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="eab3e-142">Régiókat általában azonos regionális párokból érdemes választani (például: USA 2. keleti régiója és USA középső régiója).</span><span class="sxs-lookup"><span data-stu-id="eab3e-142">In general, choose regions from the same regional pair (for example, East US 2 and Central US).</span></span> <span data-ttu-id="eab3e-143">Ennek előnyei például a következők:</span><span class="sxs-lookup"><span data-stu-id="eab3e-143">Benefits of doing so include:</span></span>

* <span data-ttu-id="eab3e-144">Széles körű leállás esetén a helyreállításkor minden párból legalább az egyik régió előnyt élvez.</span><span class="sxs-lookup"><span data-stu-id="eab3e-144">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="eab3e-145">A tervezett Azure-rendszerfrissítések egyszerre csak a régiópár egyik tagján jelennek meg, ami csökkenti az állásidőt.</span><span class="sxs-lookup"><span data-stu-id="eab3e-145">Planned Azure system updates are rolled out to paired regions sequentially to minimize possible downtime.</span></span>
* <span data-ttu-id="eab3e-146">A legtöbb esetben a regionális párok azonos földrajzi helyen belül találhatók, hogy megfeleljenek az adatok tárolási helyére vonatkozó előírásoknak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-146">In most cases, regional pairs reside within the same geography to meet data residency requirements.</span></span>

<span data-ttu-id="eab3e-147">Azonban győződjön meg arról, hogy mindkét régió támogatja az összes Azure-szolgáltatást, amely szükséges az alkalmazásához.</span><span class="sxs-lookup"><span data-stu-id="eab3e-147">However, make sure that both regions support all of the Azure services needed for your application.</span></span> <span data-ttu-id="eab3e-148">Lásd: [Szolgáltatások régiónként][services-by-region].</span><span class="sxs-lookup"><span data-stu-id="eab3e-148">See [Services by region][services-by-region].</span></span> <span data-ttu-id="eab3e-149">További információ a regionális párokról: [Üzletmenet-folytonosság és vészhelyreállítás (BCDR): Az Azure párosított régiói][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="eab3e-149">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="resource-groups"></a><span data-ttu-id="eab3e-150">Erőforráscsoportok</span><span class="sxs-lookup"><span data-stu-id="eab3e-150">Resource groups</span></span>
<span data-ttu-id="eab3e-151">Fontolja meg az elsődleges és másodlagos régió, valamint a Traffic Manager külön [erőforráscsoportokban][resource groups] való elhelyezését.</span><span class="sxs-lookup"><span data-stu-id="eab3e-151">Consider placing the primary region, secondary region, and Traffic Manager into separate [resource groups][resource groups].</span></span> <span data-ttu-id="eab3e-152">Ez lehetővé teszi, hogy az egyes régiókban telepített erőforrásokat egyetlen gyűjteményként kezelje.</span><span class="sxs-lookup"><span data-stu-id="eab3e-152">This lets you manage the resources deployed to each region as a single collection.</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="eab3e-153">A Traffic Manager konfigurációja</span><span class="sxs-lookup"><span data-stu-id="eab3e-153">Traffic Manager configuration</span></span> 

<span data-ttu-id="eab3e-154">**Útválasztás**.</span><span class="sxs-lookup"><span data-stu-id="eab3e-154">**Routing**.</span></span> <span data-ttu-id="eab3e-155">A Traffic Manager többféle [útválasztási algoritmust][tm-routing] támogat.</span><span class="sxs-lookup"><span data-stu-id="eab3e-155">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="eab3e-156">A cikkben leírt forgatókönyvhöz a *prioritásos* útválasztást (régebbi nevén *feladatátvétel esetén használt* útválasztás) használja.</span><span class="sxs-lookup"><span data-stu-id="eab3e-156">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="eab3e-157">Ezzel a beállítással a Traffic Manager az összes kérelmet az elsődleges régió felé irányítja, kivéve akkor, ha az a régió elérhetetlenné válik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-157">With this setting, Traffic Manager sends all requests to the primary region unless the endpoint for that region becomes unreachable.</span></span> <span data-ttu-id="eab3e-158">Ebben az esetben automatikusan átadja a feladatokat a másodlagos régiónak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-158">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="eab3e-159">Lásd: [A feladatátvétel esetén használt útválasztás konfigurálása][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="eab3e-159">See [Configure Failover routing method][tm-configure-failover].</span></span>

<span data-ttu-id="eab3e-160">**Állapotminta**.</span><span class="sxs-lookup"><span data-stu-id="eab3e-160">**Health probe**.</span></span> <span data-ttu-id="eab3e-161">A Traffic Manager HTTP- (vagy HTTPS-) mintavételt használ az egyes végpontok rendelkezésre állásának monitorozására.</span><span class="sxs-lookup"><span data-stu-id="eab3e-161">Traffic Manager uses an HTTP (or HTTPS) probe to monitor the availability of each endpoint.</span></span> <span data-ttu-id="eab3e-162">A mintavétel egy megfelelt/nem felelt meg teszttel határozza meg a Traffic Manager számára, hogy át kell-e adnia a feladatokat a másodlagos régiónak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-162">The probe gives Traffic Manager a pass/fail test for failing over to the secondary region.</span></span> <span data-ttu-id="eab3e-163">Ehhez egy kérelmet küld egy meghatározott URL-címre.</span><span class="sxs-lookup"><span data-stu-id="eab3e-163">It works by sending a request to a specified URL path.</span></span> <span data-ttu-id="eab3e-164">Ha egy bizonyos időkorláton belül nem 200-as értékű választ kap, a mintavétel meghiúsul.</span><span class="sxs-lookup"><span data-stu-id="eab3e-164">If it gets a non-200 response within a timeout period, the probe fails.</span></span> <span data-ttu-id="eab3e-165">Négy sikertelen kérelem után a Traffic Manager csökkentett teljesítményűnek jelöli a végpontot, és átadja a feladatokat a másik végpontnak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-165">After four failed requests, Traffic Manager marks the endpoint as degraded and fails over to the other endpoint.</span></span> <span data-ttu-id="eab3e-166">Részletek: [Traffic Manager-végpont monitorozása és feladatátvétele][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="eab3e-166">For details, see [Traffic Manager endpoint monitoring and failover][tm-monitoring].</span></span>

<span data-ttu-id="eab3e-167">Ajánlott eljárásként hozzon létre egy olyan állapotminta-végpontot, amely az alkalmazás általános állapotáról ad jelentést, és ezt a végpontot használja az állapotmintához.</span><span class="sxs-lookup"><span data-stu-id="eab3e-167">As a best practice, create a health probe endpoint that reports the overall health of the application and use this endpoint for the health probe.</span></span> <span data-ttu-id="eab3e-168">A végpontnak a kritikus fontosságú függőségeket kell ellenőriznie, például az App Service-alkalmazásokat, a tárolási üzenetsort és az SQL Database-t.</span><span class="sxs-lookup"><span data-stu-id="eab3e-168">The endpoint should check critical dependencies such as the App Service apps, storage queue, and SQL Database.</span></span> <span data-ttu-id="eab3e-169">Ellenkező esetben előfordulhat, hogy a mintavétel megfelelően működő végpontot jelent, miközben az alkalmazás kritikus fontosságú részei valójában hibásak.</span><span class="sxs-lookup"><span data-stu-id="eab3e-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span>

<span data-ttu-id="eab3e-170">Másrészről viszont ne használja az állapotmintát alacsonyabb prioritású szolgáltatások ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="eab3e-170">On the other hand, don't use the health probe to check lower priority services.</span></span> <span data-ttu-id="eab3e-171">Ha például egy e-mail-szolgáltatás áll le, az alkalmazás képes egy második szolgáltatóra váltani, vagy egyszerűen később elküldeni az e-maileket.</span><span class="sxs-lookup"><span data-stu-id="eab3e-171">For example, if an email service goes down the application can switch to a second provider or just send emails later.</span></span> <span data-ttu-id="eab3e-172">Ez nem elég magas prioritás ahhoz, hogy az alkalmazás feladatátvételt kezdeményezzen.</span><span class="sxs-lookup"><span data-stu-id="eab3e-172">This is not a high enough priority to cause the application to fail over.</span></span> <span data-ttu-id="eab3e-173">További információk: [Állapot végponti monitorozását végző minta][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="eab3e-173">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>
 
### <a name="sql-database"></a><span data-ttu-id="eab3e-174">SQL Database</span><span class="sxs-lookup"><span data-stu-id="eab3e-174">SQL Database</span></span>
<span data-ttu-id="eab3e-175">Használjon [aktív georeplikációt][sql-replication] olvasható másodlagos replika létrehozásához egy másik régióban.</span><span class="sxs-lookup"><span data-stu-id="eab3e-175">Use [Active Geo-Replication][sql-replication] to create a readable secondary replica in a different region.</span></span> <span data-ttu-id="eab3e-176">Legfeljebb négy olvasható másodlagos replikával rendelkezhet.</span><span class="sxs-lookup"><span data-stu-id="eab3e-176">You can have up to four readable secondary replicas.</span></span> <span data-ttu-id="eab3e-177">Alkalmazzon feladatátvételt egy másodlagos adatbázisba, ha az elsődleges adatbázis meghibásodik vagy offline állapotba kell helyezni.</span><span class="sxs-lookup"><span data-stu-id="eab3e-177">Fail over to a secondary database if your primary database fails or needs to be taken offline.</span></span> <span data-ttu-id="eab3e-178">Az aktív georeplikáció bármilyen rugalmas adatbáziskészlet bármilyen adatbázishoz konfigurálható.</span><span class="sxs-lookup"><span data-stu-id="eab3e-178">Active Geo-Replication can be configured for any database in any elastic database pool.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="eab3e-179">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="eab3e-179">Cosmos DB</span></span>
<span data-ttu-id="eab3e-180">A Cosmos DB támogatja a régiók közötti georeplikációt.</span><span class="sxs-lookup"><span data-stu-id="eab3e-180">Cosmos DB supports geo-replication across regions.</span></span> <span data-ttu-id="eab3e-181">Az egyik régió írhatóként van kijelölve, a többi pedig csak olvasható replika.</span><span class="sxs-lookup"><span data-stu-id="eab3e-181">One region is designated as writable and the others are read-only replicas.</span></span>

<span data-ttu-id="eab3e-182">Regionális kimaradás esetén a feladatátvételhez kijelölhet egy másik régiót írhatóként.</span><span class="sxs-lookup"><span data-stu-id="eab3e-182">If there is a regional outage, you can fail over by selecting another region to be the write region.</span></span> <span data-ttu-id="eab3e-183">Az ügyfél-SDK automatikusan az aktuális írható régióba küldi az írási kérelmeket, így feladatátvétel után nem kell frissítenie az ügyfél konfigurációját.</span><span class="sxs-lookup"><span data-stu-id="eab3e-183">The client SDK automatically sends write requests to the current write region, so you don't need to update the client configuration after a failover.</span></span> <span data-ttu-id="eab3e-184">További információ: [Globális adatterjesztés az Azure Cosmos DB-vel][cosmosdb-geo].</span><span class="sxs-lookup"><span data-stu-id="eab3e-184">For more information, see [How to distribute data globally with Azure Cosmos DB][cosmosdb-geo].</span></span>

> [!NOTE]
> <span data-ttu-id="eab3e-185">A replikák mindegyike ugyanabba az erőforráscsoportba tartozik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-185">All of the replicas belong to the same resource group.</span></span>
>
>

### <a name="storage"></a><span data-ttu-id="eab3e-186">Storage</span><span class="sxs-lookup"><span data-stu-id="eab3e-186">Storage</span></span>
<span data-ttu-id="eab3e-187">Az Azure Storage szolgáltatáshoz [írásvédett georedundáns tárolást][ra-grs] (RA-GRS) használjon.</span><span class="sxs-lookup"><span data-stu-id="eab3e-187">For Azure Storage, use [read-access geo-redundant storage][ra-grs] (RA-GRS).</span></span> <span data-ttu-id="eab3e-188">Az RA-GRS típusú tárolással a rendszer az adatokat egy másodlagos régióba replikálja.</span><span class="sxs-lookup"><span data-stu-id="eab3e-188">With RA-GRS storage, the data is replicated to a secondary region.</span></span> <span data-ttu-id="eab3e-189">A másodlagos régióhoz csak olvasható hozzáférése van egy különálló végponton keresztül.</span><span class="sxs-lookup"><span data-stu-id="eab3e-189">You have read-only access to the data in the secondary region through a separate endpoint.</span></span> <span data-ttu-id="eab3e-190">Regionális kimaradás vagy vészhelyzet esetén az Azure Storage csapata dönthet úgy, hogy földrajzi feladatátvételt hajt végre a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="eab3e-190">If there is a regional outage or disaster, the Azure Storage team might decide to perform a geo-failover to the secondary region.</span></span> <span data-ttu-id="eab3e-191">Ehhez a feladatátvételhez nincs szükség az ügyfél beavatkozására.</span><span class="sxs-lookup"><span data-stu-id="eab3e-191">There is no customer action required for this failover.</span></span>

<span data-ttu-id="eab3e-192">A Queue Storage szolgáltatáshoz hozzon létre egy biztonsági várólistát a másodlagos régióban.</span><span class="sxs-lookup"><span data-stu-id="eab3e-192">For Queue storage, create a backup queue in the secondary region.</span></span> <span data-ttu-id="eab3e-193">A feladatátvétel során az alkalmazás a biztonsági várólistát használhatja, amíg az elsődleges régió újra elérhetővé nem válik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-193">During failover, the app can use the backup queue until the primary region becomes available again.</span></span> <span data-ttu-id="eab3e-194">Ezzel a módszerrel az alkalmazás továbbra is az új kérelmek tud feldolgozni.</span><span class="sxs-lookup"><span data-stu-id="eab3e-194">That way, the application can still process new requests.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="eab3e-195">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="eab3e-195">Availability considerations</span></span>


### <a name="traffic-manager"></a><span data-ttu-id="eab3e-196">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="eab3e-196">Traffic Manager</span></span>

<span data-ttu-id="eab3e-197">A Traffic Manager automatikusan elvégzi a feladatok átadását, ha az elsődleges régió elérhetetlenné válik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-197">Traffic Manager automatically fails over if the primary region becomes unavailable.</span></span> <span data-ttu-id="eab3e-198">Amikor a Traffic Manager átadja a feladatokat, az alkalmazás egy ideig nem lesz elérhető a felhasználók számára.</span><span class="sxs-lookup"><span data-stu-id="eab3e-198">When Traffic Manager fails over, there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="eab3e-199">Ez az időtartam a következő tényezőktől függ:</span><span class="sxs-lookup"><span data-stu-id="eab3e-199">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="eab3e-200">Az állapotmintának észlelnie kell, ha az elsődleges adatközpont elérhetetlenné válik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-200">The health probe must detect that the primary data center has become unreachable.</span></span>
* <span data-ttu-id="eab3e-201">A tartománynév-szolgáltatás (DNS) kiszolgálóinak frissíteniük kell az IP-címhez tartozó gyorsítótárazott DNS-rekordokat. Ez a DNS élettartamától (TTL) függ.</span><span class="sxs-lookup"><span data-stu-id="eab3e-201">Domain name service (DNS) servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="eab3e-202">Az alapértelmezett TTL 300 másodperc (5 perc), de ezt az értéket a Traffic Manager-profil létrehozásakor konfigurálhatja.</span><span class="sxs-lookup"><span data-stu-id="eab3e-202">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="eab3e-203">Részletek: [A Traffic Manager monitorozásának ismertetése][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="eab3e-203">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="eab3e-204">A Traffic Manager a rendszer egyik lehetséges meghibásodási pontja.</span><span class="sxs-lookup"><span data-stu-id="eab3e-204">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="eab3e-205">Ha a szolgáltatás meghibásodik, az ügyfelek a leállás ideje alatt nem érhetik el az alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="eab3e-205">If the service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="eab3e-206">Tekintse át a [Traffic Manager szolgáltatói szerződést (SLA)][tm-sla], és döntse el, hogy a Traffic Manager egyedüli használata elegendő-e vállalata magas rendelkezésre állásra vonatkozó követelményeihez.</span><span class="sxs-lookup"><span data-stu-id="eab3e-206">Review the [Traffic Manager service level agreement (SLA)][tm-sla] and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="eab3e-207">Ha nem, akkor a biztonság érdekében érdemes lehet hozzáadni egy másik forgalomkezelési szolgáltatást a feladat-visszavételhez.</span><span class="sxs-lookup"><span data-stu-id="eab3e-207">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="eab3e-208">Ha az Azure Traffic Manager szolgáltatás meghibásodik, módosítsa a saját kanonikus nevének (CNAME) rekordját a DNS-ben úgy, hogy a többi forgalomkezelő szolgáltatásra mutasson.</span><span class="sxs-lookup"><span data-stu-id="eab3e-208">If the Azure Traffic Manager service fails, change your canonical name (CNAME) records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="eab3e-209">Ezt a lépést manuálisan kell elvégezni. Amíg a DNS-módosítások érvénybe nem lépnek, az alkalmazás nem lesz elérhető.</span><span class="sxs-lookup"><span data-stu-id="eab3e-209">This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.</span></span>

### <a name="sql-database"></a><span data-ttu-id="eab3e-210">SQL Database</span><span class="sxs-lookup"><span data-stu-id="eab3e-210">SQL Database</span></span>
<span data-ttu-id="eab3e-211">Az SQL Database helyreállítási időkorlátjának (RPO) és becsült helyreállítási idejének (ERT) ismertetése [Az Azure SQL Database üzletmenet-folytonossági funkcióinak áttekintése][sql-rpo] című cikkben található.</span><span class="sxs-lookup"><span data-stu-id="eab3e-211">The recovery point objective (RPO) and estimated recovery time (ERT) for SQL Database are documented in [Overview of business continuity with Azure SQL Database][sql-rpo].</span></span> 

### <a name="storage"></a><span data-ttu-id="eab3e-212">Storage</span><span class="sxs-lookup"><span data-stu-id="eab3e-212">Storage</span></span>
<span data-ttu-id="eab3e-213">Az RA-GRS tároló tartós tárolást biztosít, de fontos tudni, mi történhet egy esetleges kimaradás során:</span><span class="sxs-lookup"><span data-stu-id="eab3e-213">RA-GRS storage provides durable storage, but it's important to understand what can happen during an outage:</span></span>

* <span data-ttu-id="eab3e-214">A tárhely leállásakor egy ideig nem lesz írási hozzáférése az adatokhoz.</span><span class="sxs-lookup"><span data-stu-id="eab3e-214">If a storage outage occurs, there will be a period of time when you don't have write-access to the data.</span></span> <span data-ttu-id="eab3e-215">Leállás során a másodlagos végponton keresztül továbbra is olvashatók az adatok.</span><span class="sxs-lookup"><span data-stu-id="eab3e-215">You can still read from the secondary endpoint during the outage.</span></span>
* <span data-ttu-id="eab3e-216">Ha egy regionális kimaradás vagy vészhelyzet hatással van az elsődleges helyszínre, és az ott található adatok nem állíthatók helyre, az Azure Storage csapata dönthet úgy, hogy földrajzi feladatátvételt hajt végre a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="eab3e-216">If a regional outage or disaster affects the primary location and the data there cannot be recovered, the Azure Storage team may decide to perform a geo-failover to the secondary region.</span></span>
* <span data-ttu-id="eab3e-217">Az adatok replikálása a másodlagos régióba aszinkron módon történik.</span><span class="sxs-lookup"><span data-stu-id="eab3e-217">Data replication to the secondary region is performed asynchronously.</span></span> <span data-ttu-id="eab3e-218">Ezért, amikor földrajzi feladatátvétel megy végbe, adatvesztés történhet, ha az adatok nem állíthatók teljesen helyre az elsődleges régióból.</span><span class="sxs-lookup"><span data-stu-id="eab3e-218">Therefore, if a geo-failover is performed, some data loss is possible if the data can't be recovered from the primary region.</span></span>
* <span data-ttu-id="eab3e-219">Az átmeneti hibák – például a hálózati leállások – nem indítják meg a tároló feladatátvételét.</span><span class="sxs-lookup"><span data-stu-id="eab3e-219">Transient failures, such as a network outage, will not trigger a storage failover.</span></span> <span data-ttu-id="eab3e-220">Tervezze alkalmazását úgy, hogy ellenálló legyen az átmeneti hibákkal szemben.</span><span class="sxs-lookup"><span data-stu-id="eab3e-220">Design your application to be resilient to transient failures.</span></span> <span data-ttu-id="eab3e-221">Lehetséges megoldások:</span><span class="sxs-lookup"><span data-stu-id="eab3e-221">Possible mitigations:</span></span>
  
  * <span data-ttu-id="eab3e-222">Olvasás a másodlagos régióból.</span><span class="sxs-lookup"><span data-stu-id="eab3e-222">Read from the secondary region.</span></span>
  * <span data-ttu-id="eab3e-223">Ideiglenes átváltás másik tárfiókra az új írási műveletekhez (például az üzenetek üzenetsorba való helyezéséhez).</span><span class="sxs-lookup"><span data-stu-id="eab3e-223">Temporarily switch to another storage account for new write operations (for example, to queue messages).</span></span>
  * <span data-ttu-id="eab3e-224">Adatok átmásolása a másodlagos régióból egy másik tárfiókba.</span><span class="sxs-lookup"><span data-stu-id="eab3e-224">Copy data from the secondary region to another storage account.</span></span>
  * <span data-ttu-id="eab3e-225">Csökkentett szolgáltatás nyújtása, amíg a rendszer végre nem hajtja a feladat-visszavételt.</span><span class="sxs-lookup"><span data-stu-id="eab3e-225">Provide reduced functionality until the system fails back.</span></span>

<span data-ttu-id="eab3e-226">További információk: [Mi a Mi a teendő az Azure Storage leállása esetén][storage-outage].</span><span class="sxs-lookup"><span data-stu-id="eab3e-226">For more information, see [What to do if an Azure Storage outage occurs][storage-outage].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="eab3e-227">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="eab3e-227">Manageability Considerations</span></span>

### <a name="traffic-manager"></a><span data-ttu-id="eab3e-228">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="eab3e-228">Traffic Manager</span></span>

<span data-ttu-id="eab3e-229">Ha a Traffic Manager feladatátvételt hajt végre, automatikus feladat-visszavétel megvalósítása helyett a manuális feladat-visszavételt ajánlunk.</span><span class="sxs-lookup"><span data-stu-id="eab3e-229">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="eab3e-230">Ellenkező esetben előfordulhat, hogy egyes esetekben az alkalmazás oda-vissza váltogat a régiók között.</span><span class="sxs-lookup"><span data-stu-id="eab3e-230">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="eab3e-231">A feladat-visszavétel előtt ellenőrizze, hogy az alkalmazás minden alrendszere működik-e.</span><span class="sxs-lookup"><span data-stu-id="eab3e-231">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="eab3e-232">Vegye figyelembe, hogy a Traffic Manager alapértelmezés szerint automatikusan végrehajtja a feladat-visszavételt.</span><span class="sxs-lookup"><span data-stu-id="eab3e-232">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="eab3e-233">Ennek megelőzéséhez manuálisan csökkentse az elsődleges régió prioritását a feladatátvétel után.</span><span class="sxs-lookup"><span data-stu-id="eab3e-233">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="eab3e-234">Tegyük fel például, hogy az elsődleges régió 1-es prioritású, a második pedig 2-es.</span><span class="sxs-lookup"><span data-stu-id="eab3e-234">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="eab3e-235">A feladatátvétel után az automatikus visszavétel megelőzéséhez állítsa az elsődleges régió prioritását 3-asra.</span><span class="sxs-lookup"><span data-stu-id="eab3e-235">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="eab3e-236">A prioritást akkor állítsa 1-esre, ha már készen áll a visszaváltásra.</span><span class="sxs-lookup"><span data-stu-id="eab3e-236">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="eab3e-237">A prioritás a következő parancsokkal frissíthető.</span><span class="sxs-lookup"><span data-stu-id="eab3e-237">The following commands update the priority.</span></span>

<span data-ttu-id="eab3e-238">**PowerShell**</span><span class="sxs-lookup"><span data-stu-id="eab3e-238">**PowerShell**</span></span>

```bat
$endpoint = Get-AzureRmTrafficManagerEndpoint -Name <endpoint> -ProfileName <profile> -ResourceGroupName <resource-group> -Type AzureEndpoints
$endpoint.Priority = 3
Set-AzureRmTrafficManagerEndpoint -TrafficManagerEndpoint $endpoint
```

<span data-ttu-id="eab3e-239">További információk: [Az Azure Traffic Manager parancsmagjai][tm-ps].</span><span class="sxs-lookup"><span data-stu-id="eab3e-239">For more information, see [Azure Traffic Manager Cmdlets][tm-ps].</span></span>

<span data-ttu-id="eab3e-240">**Azure parancssori felület (CLI)**</span><span class="sxs-lookup"><span data-stu-id="eab3e-240">**Azure command line interface (CLI)**</span></span>

```bat
azure network traffic-manager endpoint set --name <endpoint> --profile-name <profile> --resource-group <resource-group> --type AzureEndpoints --priority 3
```    

### <a name="sql-database"></a><span data-ttu-id="eab3e-241">SQL Database</span><span class="sxs-lookup"><span data-stu-id="eab3e-241">SQL Database</span></span>
<span data-ttu-id="eab3e-242">Ha az elsődleges adatbázis meghibásodik, hajtson végre manuális feladatátvételt a másodlagos adatbázisra.</span><span class="sxs-lookup"><span data-stu-id="eab3e-242">If the primary database fails, perform a manual failover to the secondary database.</span></span> <span data-ttu-id="eab3e-243">Lásd: [Az Azure SQL Database visszaállítása vagy feladatátvétel a másodlagos kiszolgálóra][sql-failover].</span><span class="sxs-lookup"><span data-stu-id="eab3e-243">See [Restore an Azure SQL Database or failover to a secondary][sql-failover].</span></span> <span data-ttu-id="eab3e-244">A másodlagos adatbázis csak olvasható marad, amíg el nem végzi a feladatátvételt.</span><span class="sxs-lookup"><span data-stu-id="eab3e-244">The secondary database remains read-only until you fail over.</span></span>


<!-- links -->

[azure-sql-db]: https://azure.microsoft.com/documentation/services/sql-database/
[azure-dns]: /azure/dns/dns-overview
[cosmosdb-geo]: /azure/cosmos-db/distribute-data-globally
[guidance-web-apps-scalability]: ./scalable-web-app.md
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[ra-grs]: /azure/storage/storage-redundancy#read-access-geo-redundant-storage
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview#resource-groups
[services-by-region]: https://azure.microsoft.com/regions/#services
[sql-failover]: /azure/sql-database/sql-database-disaster-recovery
[sql-replication]: /azure/sql-database/sql-database-geo-replication-overview
[sql-rpo]: /azure/sql-database/sql-database-business-continuity#sql-database-features-that-you-can-use-to-provide-business-continuity
[storage-outage]: /azure/storage/storage-disaster-recovery-guidance
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-ps]: /powershell/module/azurerm.trafficmanager
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager
[visio-download]: https://archcenter.blob.core.windows.net/cdn/app-service-reference-architectures.vsdx
