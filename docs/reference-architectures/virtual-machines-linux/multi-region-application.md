---
title: Linux rendszerű virtuális gépek futtatása több Azure-régióban a magas rendelkezésre állás érdekében
description: Virtuális gépek üzembe helyezése több régióban az Azure-on a magas rendelkezésre állás és rugalmasság érdekében.
author: MikeWasson
ms.date: 11/22/2016
pnp.series.title: Linux VM workloads
pnp.series.prev: n-tier
ms.openlocfilehash: 07ccf44f28203e6d5001475b47adce01437e9600
ms.sourcegitcommit: c441fd165e6bebbbbbc19854ec6f3676be9c3b25
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 03/30/2018
---
# <a name="run-linux-vms-in-multiple-regions-for-high-availability"></a><span data-ttu-id="948f5-103">Linux rendszerű virtuális gépek futtatása több régióban a magas rendelkezésre állás érdekében</span><span class="sxs-lookup"><span data-stu-id="948f5-103">Run Linux VMs in multiple regions for high availability</span></span>

<span data-ttu-id="948f5-104">Ez a referenciaarchitektúra néhány bevált eljárást mutat be egy N szintű alkalmazás több Azure-régióban való futtatásához a magas rendelkezésre állás eléréséhez és egy robusztus vészhelyreállítási infrastruktúra kiépítéséhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span> 

<span data-ttu-id="948f5-105">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="948f5-105">![[0]][0]</span></span>

<span data-ttu-id="948f5-106">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="948f5-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="948f5-107">Architektúra</span><span class="sxs-lookup"><span data-stu-id="948f5-107">Architecture</span></span> 

<span data-ttu-id="948f5-108">Ez az architektúra a [Linux rendszerű virtuális gépek futtatása N szintű alkalmazáshoz](n-tier.md) című cikkben bemutatott architektúrára épít.</span><span class="sxs-lookup"><span data-stu-id="948f5-108">This architecture builds on the one shown in [Run Linux VMs for an N-tier application](n-tier.md).</span></span> 

* <span data-ttu-id="948f5-109">**Elsődleges és másodlagos régiók**.</span><span class="sxs-lookup"><span data-stu-id="948f5-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="948f5-110">Használjon két régiót a magas rendelkezésre állás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="948f5-111">Az egyik ebben az esetben az elsődleges régió, a másik pedig a feladatátvétel során használt régió.</span><span class="sxs-lookup"><span data-stu-id="948f5-111">One is the primary region.The other region is for failover.</span></span>
* <span data-ttu-id="948f5-112">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="948f5-112">**Azure DNS**.</span></span> <span data-ttu-id="948f5-113">Az [Azure DNS][azure-dns] egy üzemeltetési szolgáltatás, amely a Microsoft Azure infrastruktúráját használja a DNS-tartományok névfeloldásához.</span><span class="sxs-lookup"><span data-stu-id="948f5-113">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="948f5-114">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="948f5-114">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="948f5-115">**Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="948f5-115">**Azure Traffic Manager**.</span></span> <span data-ttu-id="948f5-116">A [Traffic Manager][traffic-manager] az egyik régió felé irányítja a beérkező kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="948f5-116">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="948f5-117">A normál működés során a rendszer az elsődleges régió felé irányítja a kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="948f5-117">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="948f5-118">Ha az adott régió nem érhető el, a Traffic Manager átadj a feladatokat a másodlagos régiónak.</span><span class="sxs-lookup"><span data-stu-id="948f5-118">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="948f5-119">További információt a következő szakaszban talál: [A Traffic Manager konfigurációja](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="948f5-119">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>
* <span data-ttu-id="948f5-120">**Erőforráscsoportok**.</span><span class="sxs-lookup"><span data-stu-id="948f5-120">**Resource groups**.</span></span> <span data-ttu-id="948f5-121">Hozzon létre külön [erőforráscsoportokat][resource groups] az elsődleges régióhoz, a másodlagos régióhoz, valamint a Traffic Managerhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-121">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="948f5-122">Ennek köszönhetően rugalmasan, egyetlen erőforráskészletként kezelheti az egyes régiókat,</span><span class="sxs-lookup"><span data-stu-id="948f5-122">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="948f5-123">például ismételten üzembe helyezhet egy régiót a másik eltávolítása nélkül.</span><span class="sxs-lookup"><span data-stu-id="948f5-123">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="948f5-124">[Kapcsolja össze az erőforráscsoportokat][resource-group-links], hogy egy lekérdezés futtatásával listázhassa az alkalmazás összes erőforrását.</span><span class="sxs-lookup"><span data-stu-id="948f5-124">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>
* <span data-ttu-id="948f5-125">**Virtuális hálózatok**.</span><span class="sxs-lookup"><span data-stu-id="948f5-125">**VNets**.</span></span> <span data-ttu-id="948f5-126">Hozzon létre külön virtuális hálózatot mindegyik régióhoz.</span><span class="sxs-lookup"><span data-stu-id="948f5-126">Create a separate VNet for each region.</span></span> <span data-ttu-id="948f5-127">Ügyeljen arra, hogy a címterek ne legyenek átfedésben.</span><span class="sxs-lookup"><span data-stu-id="948f5-127">Make sure the address spaces do not overlap.</span></span>
* <span data-ttu-id="948f5-128">**Apache Cassandra**.</span><span class="sxs-lookup"><span data-stu-id="948f5-128">**Apache Cassandra**.</span></span> <span data-ttu-id="948f5-129">A Cassandra üzembe helyezése több Azure-régió adatközpontjaiban a magas rendelkezésre állás elérésének érdekében.</span><span class="sxs-lookup"><span data-stu-id="948f5-129">Deploy Cassandra in data centers across Azure regions for high availability.</span></span> <span data-ttu-id="948f5-130">A csomópontok minden régióban állvány-kompatibilis üzemmódban vannak konfigurálva tartalék és frissítési tartományokkal a régión belüli rugalmasság érdekében.</span><span class="sxs-lookup"><span data-stu-id="948f5-130">Within each region, nodes are configured in rack-aware mode with fault and upgrade domains, for resiliency inside the region.</span></span>

## <a name="recommendations"></a><span data-ttu-id="948f5-131">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="948f5-131">Recommendations</span></span>

<span data-ttu-id="948f5-132">A többrégiós architektúrák magasabb rendelkezésre állást biztosíthatnak, mint az egyetlen régióban történő üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="948f5-132">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="948f5-133">Ha egy régió üzemkimaradása hatással van az elsődleges régióra, a [Traffic Manager][traffic-manager] szolgáltatással feladatátvételt hajthat végre a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="948f5-133">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="948f5-134">Ez az architektúra az alkalmazás egy adott alrendszerének meghibásodása esetén is segíthet.</span><span class="sxs-lookup"><span data-stu-id="948f5-134">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="948f5-135">A régiók közötti magas rendelkezésre állás elérésének több általános megközelítése van:</span><span class="sxs-lookup"><span data-stu-id="948f5-135">There are several general approaches to achieving high availability across regions:</span></span>   

* <span data-ttu-id="948f5-136">Aktív/passzív készenléti kiszolgálóval.</span><span class="sxs-lookup"><span data-stu-id="948f5-136">Active/passive with hot standby.</span></span> <span data-ttu-id="948f5-137">A forgalom az egyik régióra irányul, míg a másik készenléti kiszolgálón várakozik.</span><span class="sxs-lookup"><span data-stu-id="948f5-137">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="948f5-138">Készenléti kiszolgáló esetében a másodlagos régió virtuális gépei folyamatosan le vannak foglalva és futnak.</span><span class="sxs-lookup"><span data-stu-id="948f5-138">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
* <span data-ttu-id="948f5-139">Aktív/passzív hidegtartalékkal.</span><span class="sxs-lookup"><span data-stu-id="948f5-139">Active/passive with cold standby.</span></span> <span data-ttu-id="948f5-140">A forgalom az egyik régióra irányul, míg a másik hidegtartalékként áll készenlétben.</span><span class="sxs-lookup"><span data-stu-id="948f5-140">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="948f5-141">Hidegtartalék esetében a másodlagos régió virtuális gépei nincsenek lefoglalva, amíg nem szükségessé nem válnak feladatátvétel céljából.</span><span class="sxs-lookup"><span data-stu-id="948f5-141">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="948f5-142">Ezen megközelítés futtatása kevesebb költséggel jár, de a meghibásodáskor általában hosszabb időt vesz igénybe az üzembe állás.</span><span class="sxs-lookup"><span data-stu-id="948f5-142">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
* <span data-ttu-id="948f5-143">Aktív/aktív.</span><span class="sxs-lookup"><span data-stu-id="948f5-143">Active/active.</span></span> <span data-ttu-id="948f5-144">Mindkét régió aktív, és a kérelmek terheléselosztással oszlanak meg közöttük.</span><span class="sxs-lookup"><span data-stu-id="948f5-144">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="948f5-145">Ha egy régió elérhetetlenné válik, kikerül a rotációból.</span><span class="sxs-lookup"><span data-stu-id="948f5-145">If one region becomes unavailable, it is taken out of rotation.</span></span> 

<span data-ttu-id="948f5-146">Ez az architektúra a készenléti kiszolgálóval konfigurált aktív/passzív üzemmódra összpontosít, a Traffic Managert használva a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-146">This architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="948f5-147">Vegye figyelembe, hogy ha kis számú virtuális gépet helyez üzembe készenléti kiszolgálóként, igény szerint később is elvégezheti a horizontális felskálázásukat.</span><span class="sxs-lookup"><span data-stu-id="948f5-147">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>


### <a name="regional-pairing"></a><span data-ttu-id="948f5-148">Régiónkénti párosítás</span><span class="sxs-lookup"><span data-stu-id="948f5-148">Regional pairing</span></span>

<span data-ttu-id="948f5-149">Minden egyes Azure-régió párban áll egy másikkal egy azonos földrajzi területen belül.</span><span class="sxs-lookup"><span data-stu-id="948f5-149">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="948f5-150">Régiókat általában azonos regionális párokból érdemes választani (például: USA 2. keleti régiója és USA középső régiója).</span><span class="sxs-lookup"><span data-stu-id="948f5-150">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="948f5-151">Ennek előnyei például a következők:</span><span class="sxs-lookup"><span data-stu-id="948f5-151">Benefits of doing so include:</span></span>

* <span data-ttu-id="948f5-152">Széles körű leállás esetén a helyreállításkor minden párból legalább az egyik régió előnyt élvez.</span><span class="sxs-lookup"><span data-stu-id="948f5-152">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
* <span data-ttu-id="948f5-153">A tervezett Azure-rendszerfrissítések egyszerre csak a régiópár egyik tagján jelennek meg, ami csökkenti az állásidőt.</span><span class="sxs-lookup"><span data-stu-id="948f5-153">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
* <span data-ttu-id="948f5-154">A párok azonos földrajzi helyen belül találhatók, hogy megfeleljenek az adatok tárolási helyére vonatkozó előírásoknak.</span><span class="sxs-lookup"><span data-stu-id="948f5-154">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="948f5-155">Azonban győződjön meg arról, hogy mindkét régió támogatja az összes Azure-szolgáltatást, amely szükséges az alkalmazásához (lásd: [Szolgáltatások régiónként][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="948f5-155">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="948f5-156">További információ a regionális párokról: [Üzletmenet-folytonosság és vészhelyreállítás (BCDR): Az Azure párosított régiói][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="948f5-156">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="948f5-157">A Traffic Manager konfigurációja</span><span class="sxs-lookup"><span data-stu-id="948f5-157">Traffic Manager configuration</span></span>

<span data-ttu-id="948f5-158">A Traffic Manager konfigurálásakor vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="948f5-158">Consider the following points when configuring Traffic Manager:</span></span>

* <span data-ttu-id="948f5-159">**Útválasztás**.</span><span class="sxs-lookup"><span data-stu-id="948f5-159">**Routing**.</span></span> <span data-ttu-id="948f5-160">A Traffic Manager többféle [útválasztási algoritmust][tm-routing] támogat.</span><span class="sxs-lookup"><span data-stu-id="948f5-160">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="948f5-161">A cikkben leírt forgatókönyvhöz a *prioritásos* útválasztást (régebbi nevén *feladatátvétel esetén használt* útválasztás) használja.</span><span class="sxs-lookup"><span data-stu-id="948f5-161">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="948f5-162">Ezzel a beállítással a Traffic Manager az összes kérelmet az elsődleges régió felé irányítja, kivétel akkor, ha az nem elérhető.</span><span class="sxs-lookup"><span data-stu-id="948f5-162">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="948f5-163">Ebben az esetben automatikusan átadja a feladatokat a másodlagos régiónak.</span><span class="sxs-lookup"><span data-stu-id="948f5-163">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="948f5-164">Lásd: [A feladatátvétel esetén használt útválasztás konfigurálása][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="948f5-164">See [Configure Failover routing method][tm-configure-failover].</span></span>
* <span data-ttu-id="948f5-165">**Állapotminta**.</span><span class="sxs-lookup"><span data-stu-id="948f5-165">**Health probe**.</span></span> <span data-ttu-id="948f5-166">A Traffic Manager HTTP- (vagy HTTPS-) [mintavételt][tm-monitoring] használ az egyes régiók rendelkezésre állásának monitorozására.</span><span class="sxs-lookup"><span data-stu-id="948f5-166">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="948f5-167">A mintavétel 200-as HTTP-választ vár egy megadott URL-címhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-167">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="948f5-168">Ajánlott eljárásként hozzon létre egy olyan végpontot, amely az alkalmazás általános állapotáról ad jelentést, és ezt a végpontot használja az állapotmintához.</span><span class="sxs-lookup"><span data-stu-id="948f5-168">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="948f5-169">Ellenkező esetben előfordulhat, hogy a mintavétel megfelelően működő végpontot jelent, miközben az alkalmazás kritikus fontosságú részei valójában hibásak.</span><span class="sxs-lookup"><span data-stu-id="948f5-169">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="948f5-170">További információk: [Állapot végponti monitorozását végző minta][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="948f5-170">For more information, see [Health Endpoint Monitoring Pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="948f5-171">Amikor a Traffic Manager átadja a feladatokat, az alkalmazás egy ideig nem lesz elérhető a felhasználók számára.</span><span class="sxs-lookup"><span data-stu-id="948f5-171">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="948f5-172">Ez az időtartam a következő tényezőktől függ:</span><span class="sxs-lookup"><span data-stu-id="948f5-172">The duration is affected by the following factors:</span></span>

* <span data-ttu-id="948f5-173">Az állapotmintának észlelnie kell, ha az elsődleges régió elérhetetlenné válik.</span><span class="sxs-lookup"><span data-stu-id="948f5-173">The health probe must detect that the primary region has become unreachable.</span></span>
* <span data-ttu-id="948f5-174">A DNS-kiszolgálóknak frissíteniük kell az IP-címhez tartozó gyorsítótárazott DNS-rekordokat. Ez a DNS élettartamától (TTL) függ.</span><span class="sxs-lookup"><span data-stu-id="948f5-174">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="948f5-175">Az alapértelmezett TTL 300 másodperc (5 perc), de ezt az értéket a Traffic Manager-profil létrehozásakor konfigurálhatja.</span><span class="sxs-lookup"><span data-stu-id="948f5-175">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="948f5-176">Részletek: [A Traffic Manager monitorozásának ismertetése][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="948f5-176">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="948f5-177">Ha a Traffic Manager feladatátvételt hajt végre, automatikus feladat-visszavétel megvalósítása helyett a manuális feladat-visszavételt ajánlunk.</span><span class="sxs-lookup"><span data-stu-id="948f5-177">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="948f5-178">Ellenkező esetben előfordulhat, hogy egyes esetekben az alkalmazás oda-vissza váltogat a régiók között.</span><span class="sxs-lookup"><span data-stu-id="948f5-178">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="948f5-179">A feladat-visszavétel előtt ellenőrizze, hogy az alkalmazás minden alrendszere működik-e.</span><span class="sxs-lookup"><span data-stu-id="948f5-179">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="948f5-180">Vegye figyelembe, hogy a Traffic Manager alapértelmezés szerint automatikusan végrehajtja a feladat-visszavételt.</span><span class="sxs-lookup"><span data-stu-id="948f5-180">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="948f5-181">Ennek megelőzéséhez manuálisan csökkentse az elsődleges régió prioritását a feladatátvétel után.</span><span class="sxs-lookup"><span data-stu-id="948f5-181">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="948f5-182">Tegyük fel például, hogy az elsődleges régió 1-es prioritású, a második pedig 2-es.</span><span class="sxs-lookup"><span data-stu-id="948f5-182">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="948f5-183">A feladatátvétel után az automatikus visszavétel megelőzéséhez állítsa az elsődleges régió prioritását 3-asra.</span><span class="sxs-lookup"><span data-stu-id="948f5-183">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="948f5-184">A prioritást akkor állítsa 1-esre, ha már készen áll a visszaváltásra.</span><span class="sxs-lookup"><span data-stu-id="948f5-184">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="948f5-185">A következő [Azure CLI][install-azure-cli]-parancsot frissíti a prioritást:</span><span class="sxs-lookup"><span data-stu-id="948f5-185">The following [Azure CLI][install-azure-cli] command updates the priority:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --priority 3
```    

<span data-ttu-id="948f5-186">Másik megoldásként ideiglenesen letilthatja a végpontot, amíg készen nem áll a feladat-visszavételre:</span><span class="sxs-lookup"><span data-stu-id="948f5-186">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```bat
azure network traffic-manager  endpoint set --resource-group <resource-group> --profile-name <profile>
    --name <traffic-manager-name> --type AzureEndpoints --status Disabled
```    

<span data-ttu-id="948f5-187">A feladatátvétel okától függően előfordulhat, hogy újra üzembe kell helyeznie az erőforrásokat a régión belül.</span><span class="sxs-lookup"><span data-stu-id="948f5-187">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="948f5-188">A feladat-visszavétel előtt tesztelje a működési készenlétet.</span><span class="sxs-lookup"><span data-stu-id="948f5-188">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="948f5-189">A teszt többek között a következőket ellenőrzi:</span><span class="sxs-lookup"><span data-stu-id="948f5-189">The test should verify things like:</span></span>

* <span data-ttu-id="948f5-190">A virtuális gépek megfelelően vannak-e konfigurálva.</span><span class="sxs-lookup"><span data-stu-id="948f5-190">VMs are configured correctly.</span></span> <span data-ttu-id="948f5-191">(Az összes szükséges szoftver telepítve van, az IIS fut stb.)</span><span class="sxs-lookup"><span data-stu-id="948f5-191">(All required software is installed, IIS is running, and so on.)</span></span>
* <span data-ttu-id="948f5-192">Az alkalmazás alrendszerei működőképesek-e.</span><span class="sxs-lookup"><span data-stu-id="948f5-192">Application subsystems are healthy.</span></span>
* <span data-ttu-id="948f5-193">Funkciótesztelés.</span><span class="sxs-lookup"><span data-stu-id="948f5-193">Functional testing.</span></span> <span data-ttu-id="948f5-194">(Pl. az adatbázisszint elérhető a webes szintről.)</span><span class="sxs-lookup"><span data-stu-id="948f5-194">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="cassandra-deployment-across-multiple-regions"></a><span data-ttu-id="948f5-195">A Cassandra üzembe helyezése több régióban</span><span class="sxs-lookup"><span data-stu-id="948f5-195">Cassandra deployment across multiple regions</span></span>

<span data-ttu-id="948f5-196">A Cassandra-adatközpontok egymáshoz kapcsolódó adatcsomópontok csoportjai, amelyek együtt vannak konfigurálva egy fürtön belül a replikációhoz és a feladatok elkülönítéséhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-196">Cassandra data centers are a group of related data nodes that are configured together within a cluster for replication and workload segregation.</span></span>

<span data-ttu-id="948f5-197">Éles környezetben ajánlott a [DataStax Enterprise][datastax] használata.</span><span class="sxs-lookup"><span data-stu-id="948f5-197">We recommend [DataStax Enterprise][datastax] for production use.</span></span> <span data-ttu-id="948f5-198">További információk a DataStax futtatásáról az Azure-ban: [A DataStax Enterprise üzembehelyezési útmutatója az Azure-hoz][cassandra-in-azure].</span><span class="sxs-lookup"><span data-stu-id="948f5-198">For more information on running DataStax in Azure, see [DataStax Enterprise Deployment Guide for Azure][cassandra-in-azure].</span></span> <span data-ttu-id="948f5-199">A következő általános javaslatok bármely Cassandra-kiadás esetében érvényesek:</span><span class="sxs-lookup"><span data-stu-id="948f5-199">The following general recommendations apply to any Cassandra edition:</span></span> 

* <span data-ttu-id="948f5-200">Rendeljen nyilvános IP-címet minden egyes csomóponthoz.</span><span class="sxs-lookup"><span data-stu-id="948f5-200">Assign a public IP address to each node.</span></span> <span data-ttu-id="948f5-201">Ez lehetővé teszi, hogy a fürtök az Azure gerincinfrastruktúráját használva kommunikáljanak egymással a régiókon át, ezzel magas teljesítményt biztosítva alacsony költségek mellett.</span><span class="sxs-lookup"><span data-stu-id="948f5-201">This enables the clusters to communicate across regions using the Azure backbone infrastructure, providing high throughput at low cost.</span></span>
* <span data-ttu-id="948f5-202">Védje a csomópontokat a megfelelő tűzfal- és hálózati biztonsági csoport (NSG-) konfigurációval, amely kizárólag az ismert forrásokból – például ügyfelektől és más csomópontfürtöktől – érkező, valamint az azok felé irányuló forgalmat engedi át.</span><span class="sxs-lookup"><span data-stu-id="948f5-202">Secure nodes using the appropriate firewall and network security group (NSG) configurations, allowing traffic only to and from known hosts, including clients and other cluster nodes.</span></span> <span data-ttu-id="948f5-203">Vegye figyelembe, hogy a Cassandra eltérő portokat használ a kommunikációhoz, az OpsCenterhez, a Sparkhoz és egyebekhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-203">Note that Cassandra uses different ports for communication, OpsCenter, Spark, and so forth.</span></span> <span data-ttu-id="948f5-204">További információk a Cassandra porthasználatáról: [Tűzfalak porthozzáférésének konfigurálása][cassandra-ports].</span><span class="sxs-lookup"><span data-stu-id="948f5-204">For port usage in Cassandra, see [Configuring firewall port access][cassandra-ports].</span></span>
* <span data-ttu-id="948f5-205">Használjon SSL-titkosítást az összes [ügyfél és csomópont][ssl-client-node], valamint [csomópont és csomópont közötti][ssl-node-node] kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="948f5-205">Use SSL encryption for all [client-to-node][ssl-client-node] and [node-to-node][ssl-node-node] communications.</span></span>
* <span data-ttu-id="948f5-206">Egy adott régión belül kövesse a [Cassandra – javaslatok](n-tier.md#cassandra) című cikk útmutatását.</span><span class="sxs-lookup"><span data-stu-id="948f5-206">Within a region, follow the guidelines in [Cassandra recommendations](n-tier.md#cassandra).</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="948f5-207">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="948f5-207">Availability considerations</span></span>

<span data-ttu-id="948f5-208">Komplex N szintű alkalmazás esetén előfordulhat, hogy nem kell replikálnia a teljes alkalmazást a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="948f5-208">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="948f5-209">Ehelyett elég lehet replikálni egy kritikus fontosságú alrendszert, amely az üzletmenet folytonosságának fenntartásához szükséges.</span><span class="sxs-lookup"><span data-stu-id="948f5-209">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="948f5-210">A Traffic Manager a rendszer egyik lehetséges meghibásodási pontja.</span><span class="sxs-lookup"><span data-stu-id="948f5-210">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="948f5-211">Ha a Traffic Manager szolgáltatás meghibásodik, az ügyfelek a leállás ideje alatt nem érhetik el az alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="948f5-211">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="948f5-212">Tekintse át a [Traffic Manager szolgáltatói szerződését][tm-sla], és döntse el, hogy a Traffic Manager egyedüli használata elegendő-e vállalata magas rendelkezésre állásra vonatkozó követelményeihez.</span><span class="sxs-lookup"><span data-stu-id="948f5-212">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="948f5-213">Ha nem, akkor a biztonság érdekében érdemes lehet hozzáadni egy másik forgalomkezelési szolgáltatást a feladat-visszavételhez.</span><span class="sxs-lookup"><span data-stu-id="948f5-213">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="948f5-214">Ha az Azure Traffic Manager szolgáltatás meghibásodik, módosítsa a CNAME rekordját a DNS-ben úgy, hogy a többi forgalomkezelő szolgáltatásra mutasson.</span><span class="sxs-lookup"><span data-stu-id="948f5-214">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="948f5-215">(Ezt a lépést manuálisan kell elvégezni. Amíg a DNS-módosítások érvénybe nem lépnek, az alkalmazás nem lesz elérhető.)</span><span class="sxs-lookup"><span data-stu-id="948f5-215">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="948f5-216">A Cassandra-fürt esetében a megfontolandó feladatátvételi forgatókönyvek az alkalmazás által használt konzisztenciaszintektől és a használt replikák számától függenek.</span><span class="sxs-lookup"><span data-stu-id="948f5-216">For the Cassandra cluster, the failover scenarios to consider depend on the consistency levels used by the application, as well as the number of replicas used.</span></span> <span data-ttu-id="948f5-217">További információk a konzisztenciaszintekről és azok használatáról a Cassandrában: [Adatkonzisztencia konfigurálása][cassandra-consistency] és [Cassandra: Hány csomóponttal folyik kommunikáció a Quorum esetében?][cassandra-consistency-usage]</span><span class="sxs-lookup"><span data-stu-id="948f5-217">For consistency levels and usage in Cassandra, see [Configuring data consistency][cassandra-consistency] and [Cassandra: How many nodes are talked to with Quorum?][cassandra-consistency-usage]</span></span> <span data-ttu-id="948f5-218">Az adatok elérhetősége a Cassandrában az alkalmazás által használt konzisztenciaszinttől és a replikációs mechanizmustól függ.</span><span class="sxs-lookup"><span data-stu-id="948f5-218">Data availability in Cassandra is determined by the consistency level used by the application and the replication mechanism.</span></span> <span data-ttu-id="948f5-219">További információ a replikációról a Cassandrában: [Adatok replikációja a NoSQL-adatbázisokban – Ismertetés][cassandra-replication].</span><span class="sxs-lookup"><span data-stu-id="948f5-219">For replication in Cassandra, see [Data Replication in NoSQL Databases Explained][cassandra-replication].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="948f5-220">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="948f5-220">Manageability considerations</span></span>

<span data-ttu-id="948f5-221">Amikor frissíti az üzemelő példányt, egyszerre egy régiót frissítsen. Ezzel csökkenthető a nem megfelelő konfiguráció vagy az alkalmazásban felmerülő hiba okozta globális meghibásodás esélye.</span><span class="sxs-lookup"><span data-stu-id="948f5-221">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="948f5-222">Tesztelje a rendszer meghibásodásokkal szembeni rugalmasságát.</span><span class="sxs-lookup"><span data-stu-id="948f5-222">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="948f5-223">Alább található néhány gyakori meghibásodási helyzet:</span><span class="sxs-lookup"><span data-stu-id="948f5-223">Here are some common failure scenarios to test:</span></span>

* <span data-ttu-id="948f5-224">Állítson le virtuálisgép-példányokat.</span><span class="sxs-lookup"><span data-stu-id="948f5-224">Shut down VM instances.</span></span>
* <span data-ttu-id="948f5-225">Terhelje az erőforrásokat, például a processzort és a memóriát.</span><span class="sxs-lookup"><span data-stu-id="948f5-225">Pressure resources such as CPU and memory.</span></span>
* <span data-ttu-id="948f5-226">Bontsa/késleltesse a hálózati kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="948f5-226">Disconnect/delay network.</span></span>
* <span data-ttu-id="948f5-227">Váltsa ki egyes folyamatok összeomlását.</span><span class="sxs-lookup"><span data-stu-id="948f5-227">Crash processes.</span></span>
* <span data-ttu-id="948f5-228">Alkalmazzon lejárt tanúsítványokat.</span><span class="sxs-lookup"><span data-stu-id="948f5-228">Expire certificates.</span></span>
* <span data-ttu-id="948f5-229">Szimuláljon hardverhibákat.</span><span class="sxs-lookup"><span data-stu-id="948f5-229">Simulate hardware faults.</span></span>
* <span data-ttu-id="948f5-230">Állítsa le a DNS-szolgáltatást a tartományvezérlőkön.</span><span class="sxs-lookup"><span data-stu-id="948f5-230">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="948f5-231">Mérje meg a helyreállítási időtartamokat, és győződjön meg róla, hogy azok megfelelnek az üzleti követelményeinek.</span><span class="sxs-lookup"><span data-stu-id="948f5-231">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="948f5-232">Több hibaállapot kombinációját is tesztelje.</span><span class="sxs-lookup"><span data-stu-id="948f5-232">Test combinations of failure modes, as well.</span></span>


<!-- Links -->
[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[cassandra-in-azure]: https://academy.datastax.com/resources/deployment-guide-azure
[cassandra-consistency]: http://docs.datastax.com/en/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html
[cassandra-replication]: http://www.planetcassandra.org/data-replication-in-nosql-databases-explained/
[cassandra-consistency-usage]: https://medium.com/@foundev/cassandra-how-many-nodes-are-talked-to-with-quorum-also-should-i-use-it-98074e75d7d5#.b4pb4alb2
[cassandra-ports]: https://docs.datastax.com/en/datastax_enterprise/5.0/datastax_enterprise/sec/configFirewallPorts.html
[datastax]: https://www.datastax.com/products/datastax-enterprise
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[install-azure-cli]: /azure/xplat-cli-install
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[services-by-region]: https://azure.microsoft.com/regions/#services
[ssl-client-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLClientToNode_t.html
[ssl-node-node]: http://docs.datastax.com/en/cassandra/2.0/cassandra/security/secureSSLNodeToNode_t.html
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager/v1_0/
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
[0]: ./images/multi-region-application-diagram.png "Magas rendelkezésre állású hálózati architektúra N szintű Azure-alkalmazásokhoz"
