---
title: "Elosztott terhelésű virtuális gépek üzemeltetése a méretezhetőség és a rendelkezésre állás érdekében"
description: "Több Linux rendszerű virtuális gép futtatása az Azure-ban a méretezhetőség és a rendelkezésre állás érdekében."
author: telmosampaio
ms.date: 11/16/2017
pnp.series.title: Linux VM workloads
pnp.series.next: n-tier
pnp.series.prev: single-vm
ms.openlocfilehash: baccf610e0859358ef71d0c5a1d6228752fc1e2f
ms.sourcegitcommit: ea7108f71dab09175ff69322874d1bcba800a37a
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 03/17/2018
---
# <a name="run-load-balanced-vms-for-scalability-and-availability"></a><span data-ttu-id="6b818-103">Elosztott terhelésű virtuális gépek üzemeltetése a méretezhetőség és a rendelkezésre állás érdekében</span><span class="sxs-lookup"><span data-stu-id="6b818-103">Run load-balanced VMs for scalability and availability</span></span>

<span data-ttu-id="6b818-104">Ez a referenciaarchitektúra bevált eljárásokat mutat be, amelyekkel a méretezhetőség és a rendelkezésre állás javítása érdekében több Linux rendszerű virtuális gép (VM) futtatható egy terheléselosztó mögötti méretezési csoportban.</span><span class="sxs-lookup"><span data-stu-id="6b818-104">This reference architecture shows a set of proven practices for running multiple Linux virtual machines (VMs) in a scale set behind a load balancer, to improve availability and scalability.</span></span> <span data-ttu-id="6b818-105">Ez az architektúra bármilyen állapot nélküli számítási feladathoz használható (például webkiszolgálókhoz), és alapul szolgál az N szintű alkalmazások üzembe helyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="6b818-105">This architecture can be used for any stateless workload, such as a web server, and is a foundation for deploying n-tier applications.</span></span> [<span data-ttu-id="6b818-106">**A megoldás üzembe helyezése**.</span><span class="sxs-lookup"><span data-stu-id="6b818-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="6b818-107">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="6b818-107">![[0]][0]</span></span>

<span data-ttu-id="6b818-108">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="6b818-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="6b818-109">Architektúra</span><span class="sxs-lookup"><span data-stu-id="6b818-109">Architecture</span></span>

<span data-ttu-id="6b818-110">Ez az architektúra az [egyetlen virtuális géppel rendelkező referenciaarchitektúrára][single-vm] épít.</span><span class="sxs-lookup"><span data-stu-id="6b818-110">This architecture builds on the [Single VM reference architecture][single-vm].</span></span> <span data-ttu-id="6b818-111">Az arra vonatkozó javaslatok erre az architektúrára is érvényesek.</span><span class="sxs-lookup"><span data-stu-id="6b818-111">Those recommendations also apply to this architecture.</span></span>

<span data-ttu-id="6b818-112">Ebben az architektúrában a számítási feladatok több virtuálisgép-példányon oszlanak el.</span><span class="sxs-lookup"><span data-stu-id="6b818-112">In this architecture, a workload is distributed across multiple VM instances.</span></span> <span data-ttu-id="6b818-113">Az architektúra egyetlen nyilvános IP-címet használ, és az internetes forgalom terheléselosztón keresztül jut el a virtuális gépekhez.</span><span class="sxs-lookup"><span data-stu-id="6b818-113">There is a single public IP address, and Internet traffic is distributed to the VMs using a load balancer.</span></span> <span data-ttu-id="6b818-114">Ez az architektúra egyrétegű alkalmazásokhoz, például állapot nélküli webalkalmazásokhoz használható.</span><span class="sxs-lookup"><span data-stu-id="6b818-114">This architecture can be used for a single-tier application, such as a stateless web application.</span></span>

<span data-ttu-id="6b818-115">Az architektúra a következő összetevőkből áll:</span><span class="sxs-lookup"><span data-stu-id="6b818-115">The architecture has the following components:</span></span>

* <span data-ttu-id="6b818-116">**Erőforráscsoport.**</span><span class="sxs-lookup"><span data-stu-id="6b818-116">**Resource group.**</span></span> <span data-ttu-id="6b818-117">Az [erőforráscsoportok][resource-manager-overview] az erőforrások csoportosítására használhatók, így élettartamuk, tulajdonosuk vagy egyéb jellemzőik alapján kezelhetők.</span><span class="sxs-lookup"><span data-stu-id="6b818-117">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>
* <span data-ttu-id="6b818-118">**Virtuális hálózat (VNet) és alhálózat.**</span><span class="sxs-lookup"><span data-stu-id="6b818-118">**Virtual network (VNet) and subnet.**</span></span> <span data-ttu-id="6b818-119">Az Azure-ban minden virtuális gép egy alhálózatokra osztható virtuális hálózatban van üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="6b818-119">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span>
* <span data-ttu-id="6b818-120">**Azure Load Balancer**.</span><span class="sxs-lookup"><span data-stu-id="6b818-120">**Azure Load Balancer**.</span></span> <span data-ttu-id="6b818-121">A [terheléselosztó][load-balancer] elosztja a beérkező internetes kérelmeket a virtuálisgép-példányok között.</span><span class="sxs-lookup"><span data-stu-id="6b818-121">The [load balancer][load-balancer] distributes incoming Internet requests to the VM instances.</span></span> 
* <span data-ttu-id="6b818-122">**Nyilvános IP-cím**.</span><span class="sxs-lookup"><span data-stu-id="6b818-122">**Public IP address**.</span></span> <span data-ttu-id="6b818-123">Ahhoz, hogy a terheléselosztó fogadni tudja az internetes forgalmat, egy nyilvános IP-címre van szükség.</span><span class="sxs-lookup"><span data-stu-id="6b818-123">A public IP address is needed for the load balancer to receive Internet traffic.</span></span>
* <span data-ttu-id="6b818-124">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="6b818-124">**Azure DNS**.</span></span> <span data-ttu-id="6b818-125">Az [Azure DNS][azure-dns] egy üzemeltetési szolgáltatás, amely a Microsoft Azure infrastruktúráját használja a DNS-tartományok névfeloldásához.</span><span class="sxs-lookup"><span data-stu-id="6b818-125">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="6b818-126">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="6b818-126">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>
* <span data-ttu-id="6b818-127">**Virtuálisgép-méretezési csoport**.</span><span class="sxs-lookup"><span data-stu-id="6b818-127">**VM scale set**.</span></span> <span data-ttu-id="6b818-128">A [Virtuálisgép-méretezési csoport] [ vm-scaleset] egymással megegyező virtuális gépek csoportja, amely egy adott számítási feladatot üzemeltet.</span><span class="sxs-lookup"><span data-stu-id="6b818-128">A [VM scale set][vm-scaleset] is a set of identical VMs used to host a workload.</span></span> <span data-ttu-id="6b818-129">A méretezési csoportok lehetővé teszik, hogy a virtuális gépek száma manuálisan, vagy előre meghatározott szabályok szerint automatikusan fel- vagy leskálázható legyen.</span><span class="sxs-lookup"><span data-stu-id="6b818-129">Scale sets allow the number of VMs to be scaled in or out manually, or automatically based on predefined rules.</span></span>
* <span data-ttu-id="6b818-130">**Rendelkezésre állási csoport**.</span><span class="sxs-lookup"><span data-stu-id="6b818-130">**Availability set**.</span></span> <span data-ttu-id="6b818-131">A [rendelkezésre állási csoport][availability-set] magában foglalja a virtuális gépeket, így azok magasabb szintű [szolgáltatói szerződésre (SLA-ra)][vm-sla] jogosultak.</span><span class="sxs-lookup"><span data-stu-id="6b818-131">The [availability set][availability-set] contains the VMs, making the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span> <span data-ttu-id="6b818-132">A magasabb szintű szolgáltatói szerződés érvénybe lépéséhez a rendelkezésre állási csoportnak legalább két virtuális gépet kell tartalmaznia.</span><span class="sxs-lookup"><span data-stu-id="6b818-132">For the higher SLA to apply, the availability set must include a minimum of two VMs.</span></span> <span data-ttu-id="6b818-133">A rendelkezésre állási csoportok a méretezési csoportokkal járnak.</span><span class="sxs-lookup"><span data-stu-id="6b818-133">Availability sets are implicit in scale sets.</span></span> <span data-ttu-id="6b818-134">Ha méretezési csoporton kívül hoz létre virtuális gépeket, külön létre kell hoznia a rendelkezésre állási csoportot.</span><span class="sxs-lookup"><span data-stu-id="6b818-134">If you create VMs outside a scale set, you need to create the availability set independently.</span></span>
* <span data-ttu-id="6b818-135">**Felügyelt lemezek**.</span><span class="sxs-lookup"><span data-stu-id="6b818-135">**Managed disks**.</span></span> <span data-ttu-id="6b818-136">Az Azure Managed Disks szolgáltatás kezeli a virtuális gépek lemezeihez tartozó virtuális merevlemezek (VHD) fájljait.</span><span class="sxs-lookup"><span data-stu-id="6b818-136">Azure Managed Disks manage the virtual hard disk (VHD) files for the VM disks.</span></span> 
* <span data-ttu-id="6b818-137">**Tárhely**.</span><span class="sxs-lookup"><span data-stu-id="6b818-137">**Storage**.</span></span> <span data-ttu-id="6b818-138">Hozzon létre egy Azure Storage-fiókot a virtuális gépek diagnosztikai naplóinak tárolására.</span><span class="sxs-lookup"><span data-stu-id="6b818-138">Create an Azure Storage acount to hold diagnostic logs for the VMs.</span></span>

## <a name="recommendations"></a><span data-ttu-id="6b818-139">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="6b818-139">Recommendations</span></span>

<span data-ttu-id="6b818-140">Az Ön követelményei eltérhetnek az itt leírt architektúrától.</span><span class="sxs-lookup"><span data-stu-id="6b818-140">Your requirements may not align completely with the architecture described here.</span></span> <span data-ttu-id="6b818-141">Ezeket a javaslatokat tekintse kiindulópontnak.</span><span class="sxs-lookup"><span data-stu-id="6b818-141">Use these recommendations as a starting point.</span></span> 

### <a name="availability-and-scalability-recommendations"></a><span data-ttu-id="6b818-142">Rendelkezésre állási és méretezhetőségi javaslatok</span><span class="sxs-lookup"><span data-stu-id="6b818-142">Availability and scalability recommendations</span></span>

<span data-ttu-id="6b818-143">A rendelkezésre állás és a méretezhetőség érdekében használható egyik lehetőség a [virtuálisgép-méretezési csoport][vmss].</span><span class="sxs-lookup"><span data-stu-id="6b818-143">An option for availability and scalability is to use a [virtual machine scale set][vmss].</span></span> <span data-ttu-id="6b818-144">A virtuálisgép-méretezési csoportok segítségével azonos virtuális gépek csoportját hozhatja létre és kezelheti.</span><span class="sxs-lookup"><span data-stu-id="6b818-144">VM scale sets help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="6b818-145">A méretezési csoportok támogatják a teljesítménymetrikák alapján történő automatikus skálázást.</span><span class="sxs-lookup"><span data-stu-id="6b818-145">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="6b818-146">Ahogy a terhelés növekszik a virtuális gépeken, a rendszer további virtuális gépeket ad a terheléselosztóhoz.</span><span class="sxs-lookup"><span data-stu-id="6b818-146">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="6b818-147">Fontolja meg a méretezési csoportok használatát, ha virtuális gépek gyors horizontális felskálázására vagy automatikus méretezésre van szüksége.</span><span class="sxs-lookup"><span data-stu-id="6b818-147">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="6b818-148">Alapértelmezés szerint a méretezési csoportok „túlzott mértékű kiépítést” használnak, ami azt jelenti, hogy a méretezési csoport kezdetben az Ön által igényeltnél több virtuális gépet oszt ki, majd törli a nem szükséges példányokat.</span><span class="sxs-lookup"><span data-stu-id="6b818-148">By default, scale sets use "overprovisioning," which means the scale set initially provisions more VMs than you ask for, then deletes the extra VMs.</span></span> <span data-ttu-id="6b818-149">Ez javítja az általános sikeresség arányát a virtuális gépek kiépítésekor.</span><span class="sxs-lookup"><span data-stu-id="6b818-149">This improves the overall success rate when provisioning the VMs.</span></span> <span data-ttu-id="6b818-150">Ha nem használ [felügyelt lemezeket](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), túlzott mértékű kiépítéssel beállított tárfiókonként 20-nál több virtuális gép használata nem ajánlott, a túlzott mértékű kiépítés letiltása mellett pedig legfeljebb 40 virtuális gép ajánlott.</span><span class="sxs-lookup"><span data-stu-id="6b818-150">If you are not using [managed disks](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-managed-disks), we recommend no more than 20 VMs per storage account with overprovisioning enabled, and no more than 40 VMs with overprovisioning disabled.</span></span>

<span data-ttu-id="6b818-151">A méretezési csoportokban üzembe helyezett virtuális gépek konfigurálásának két alapvető módja van:</span><span class="sxs-lookup"><span data-stu-id="6b818-151">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="6b818-152">Bővítmények segítségével konfigurálhatja a virtuális gépet annak kiépítése után.</span><span class="sxs-lookup"><span data-stu-id="6b818-152">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="6b818-153">Ezzel a módszerrel az új virtuálisgép-példányok indítása több időt vehet igénybe, mint a bővítmények nélküli virtuális gépeké.</span><span class="sxs-lookup"><span data-stu-id="6b818-153">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="6b818-154">Üzembe helyezhet egy [felügyelt lemezt](/azure/storage/storage-managed-disks-overview) egy egyéni rendszerképpel.</span><span class="sxs-lookup"><span data-stu-id="6b818-154">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="6b818-155">Ez a módszer gyorsabban kivitelezhető.</span><span class="sxs-lookup"><span data-stu-id="6b818-155">This option may be quicker to deploy.</span></span> <span data-ttu-id="6b818-156">Azonban ebben az esetben naprakészen kel tartania a rendszerképet.</span><span class="sxs-lookup"><span data-stu-id="6b818-156">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="6b818-157">További szempontokért lásd: [Kialakítási szempontok a méretezési csoportokhoz][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="6b818-157">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="6b818-158">Bármilyen automatikus méretezési megoldás használata esetén jóval előre tesztelje azt az éles környezetre jellemző mennyiségű számítási feladattal.</span><span class="sxs-lookup"><span data-stu-id="6b818-158">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="6b818-159">Ha nem használ méretezési csoportot, fontolja meg legalább egy rendelkezésre állási csoport használatát.</span><span class="sxs-lookup"><span data-stu-id="6b818-159">If you do not use a scale set, consider at least using an availability set.</span></span> <span data-ttu-id="6b818-160">Hozzon létre legalább két virtuális gépet a rendelkezésre állási csoportban az [Azure-beli virtuális gépekre vonatkozó rendelkezésre állási SLA][vm-sla] támogatásához.</span><span class="sxs-lookup"><span data-stu-id="6b818-160">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="6b818-161">Az Azure-terheléselosztó további követelménye, hogy az elosztott terhelésű virtuális gépek ugyanabba a rendelkezésre állási csoportba tartozzanak.</span><span class="sxs-lookup"><span data-stu-id="6b818-161">The Azure load balancer also requires that load-balanced VMs belong to the same availability set.</span></span>

<span data-ttu-id="6b818-162">Minden Azure-előfizetésre alapértelmezett korlátozások vonatkoznak. Ilyen például a régiónként alkalmazható virtuális gépek maximális száma.</span><span class="sxs-lookup"><span data-stu-id="6b818-162">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="6b818-163">Támogatási kérelem kitöltésével megnövelheti ezt a korlátot.</span><span class="sxs-lookup"><span data-stu-id="6b818-163">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="6b818-164">További információk: [Az Azure-előfizetések és -szolgáltatások korlátozásai, kvótái és megkötései][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="6b818-164">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

### <a name="network-recommendations"></a><span data-ttu-id="6b818-165">Hálózatokra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="6b818-165">Network recommendations</span></span>

<span data-ttu-id="6b818-166">A virtuális gépeket ugyanabban az alhálózatban helyezze üzembe.</span><span class="sxs-lookup"><span data-stu-id="6b818-166">Deploy the VMs within the same subnet.</span></span> <span data-ttu-id="6b818-167">Ne engedélyezze a virtuális gépek elérését közvetlenül az internetről – ehelyett adjon mindegyiknek privát IP-címet.</span><span class="sxs-lookup"><span data-stu-id="6b818-167">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="6b818-168">Az ügyfelek a terheléselosztó nyilvános IP-címével kapcsolódnak.</span><span class="sxs-lookup"><span data-stu-id="6b818-168">Clients connect using the public IP address of the load balancer.</span></span>

<span data-ttu-id="6b818-169">Ha a terheléselosztó mögötti virtuális gépekre kell bejelentkeznie, javasolt egy virtuális gép jumpboxként (más néven bástyagazdagépként) való hozzáadása egy olyan nyilvános IP-címmel, amelyre be tud jelentkezni.</span><span class="sxs-lookup"><span data-stu-id="6b818-169">If you need to log into the VMs behind the load balancer, consider adding a single VM as a jumpbox (also called a bastion host) with a public IP address you can log into.</span></span> <span data-ttu-id="6b818-170">Ezután jelentkezzen be a terheléselosztó mögötti virtuális gépekbe a jumpboxról.</span><span class="sxs-lookup"><span data-stu-id="6b818-170">And then log into the VMs behind the load balancer from the jumpbox.</span></span> <span data-ttu-id="6b818-171">Alternatív lehetőségként konfigurálhatja a terheléselosztó bejövő hálózati címfordítási (NAT-) szabályait.</span><span class="sxs-lookup"><span data-stu-id="6b818-171">Alternatively, you can configure the load balancer's inbound network address translation (NAT) rules.</span></span> <span data-ttu-id="6b818-172">Azonban a jumpbox jobb megoldás, ha N szintű számítási feladatokat vagy több számítási feladatot kíván futtatni.</span><span class="sxs-lookup"><span data-stu-id="6b818-172">However, having a jumpbox is a better solution when you are hosting n-tier workloads or multiple workloads.</span></span>

### <a name="load-balancer-recommendations"></a><span data-ttu-id="6b818-173">Terheléselosztóra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="6b818-173">Load balancer recommendations</span></span>

<span data-ttu-id="6b818-174">Adja hozzá a rendelkezésre állási csoportban található összes virtuális gépet a terheléselosztó háttércímkészletéhez.</span><span class="sxs-lookup"><span data-stu-id="6b818-174">Add all VMs in the availability set to the back-end address pool of the load balancer.</span></span>

<span data-ttu-id="6b818-175">Adja meg a terheléselosztó a virtuális gépek felé irányuló közvetlen hálózati forgalomra vonatkozó szabályait.</span><span class="sxs-lookup"><span data-stu-id="6b818-175">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="6b818-176">Például a HTTP-forgalom engedélyezéséhez hozzon létre egy szabályt, amely hozzárendeli a 80-as portot az előtérbeli konfigurációból a háttércímkészletben található 80-as porthoz.</span><span class="sxs-lookup"><span data-stu-id="6b818-176">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="6b818-177">Amikor egy ügyfél HTTP-kérelmet küld a 80-as port felé, a terheléselosztó kiválaszt egy háttérbeli IP-címet egy [kivonatoló algoritmus][load-balancer-hashing] használatával, amely tartalmazza a forrás IP-címét.</span><span class="sxs-lookup"><span data-stu-id="6b818-177">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="6b818-178">Így a kérelmek megoszlanak az összes virtuális gép között.</span><span class="sxs-lookup"><span data-stu-id="6b818-178">In that way, client requests are distributed across all the VMs.</span></span>

<span data-ttu-id="6b818-179">Ahhoz, hogy az adatforgalmat egy meghatározott virtuális gépre irányítsa, használjon NAT-szabályokat.</span><span class="sxs-lookup"><span data-stu-id="6b818-179">To route traffic to a specific VM, use NAT rules.</span></span> <span data-ttu-id="6b818-180">Ha például szeretné engedélyezni az RDP-vel való kapcsolódást a virtuális gépekhez, hozzon létre egy külön NAT-szabályt minden egyes virtuális gép számára.</span><span class="sxs-lookup"><span data-stu-id="6b818-180">For example, to enable RDP to the VMs, create a separate NAT rule for each VM.</span></span> <span data-ttu-id="6b818-181">Minden egyes szabálynak hozzá kell rendelnie egy meghatározott portszámot a 3389-es porthoz, azaz az RDP-hez használt alapértelmezett porthoz.</span><span class="sxs-lookup"><span data-stu-id="6b818-181">Each rule should map a distinct port number to port 3389, the default port for RDP.</span></span> <span data-ttu-id="6b818-182">Például használja az 50001-es portot a „VM1” virtuális géphez, az 50002-est a „VM2”-höz, és így tovább.</span><span class="sxs-lookup"><span data-stu-id="6b818-182">For example, use port 50001 for "VM1," port 50002 for "VM2," and so on.</span></span> <span data-ttu-id="6b818-183">A NAT-szabályokat a virtuális gépek hálózati adaptereihez rendelje hozzá.</span><span class="sxs-lookup"><span data-stu-id="6b818-183">Assign the NAT rules to the NICs on the VMs.</span></span>

### <a name="storage-account-recommendations"></a><span data-ttu-id="6b818-184">Tárfiókokra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="6b818-184">Storage account recommendations</span></span>

<span data-ttu-id="6b818-185">Javasoljuk a [felügyelt lemezek](/azure/storage/storage-managed-disks-overview) és a [prémium szintű tároló][premium] használatát.</span><span class="sxs-lookup"><span data-stu-id="6b818-185">We recommend the use of [managed disks](/azure/storage/storage-managed-disks-overview) with [premium storage][premium].</span></span> <span data-ttu-id="6b818-186">A felügyelt lemezek nem igényelnek tárfiókot.</span><span class="sxs-lookup"><span data-stu-id="6b818-186">Managed disks do not require a storage account.</span></span> <span data-ttu-id="6b818-187">Egyszerűen adja meg a méretet és a lemez típusát, és az magas rendelkezésre állású erőforrásként lesz üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="6b818-187">You simply specify the size and type of disk and it is deployed as a highly available resource.</span></span>

<span data-ttu-id="6b818-188">Ha nem felügyelt lemezeket használ, hozzon létre külön Azure Storage-fiókot minden virtuális géphez a virtuális merevlemezek (VHD-k) tárolására, hogy elkerülje az [IOPS-korlátok][vm-disk-limits] (másodpercenkénti bemeneti/kimeneti műveletek) elérését a tárfiókban.</span><span class="sxs-lookup"><span data-stu-id="6b818-188">If you are using unmanaged disks, create separate Azure storage accounts for each VM to hold the virtual hard disks (VHDs), in order to avoid hitting the input/output operations per second [(IOPS) limits][vm-disk-limits] for storage accounts.</span></span>

<span data-ttu-id="6b818-189">Hozzon létre egy tárfiókot a diagnosztikai naplók számára.</span><span class="sxs-lookup"><span data-stu-id="6b818-189">Create one storage account for diagnostic logs.</span></span> <span data-ttu-id="6b818-190">Ezt a tárfiókot az összes virtuális gép megoszthatja.</span><span class="sxs-lookup"><span data-stu-id="6b818-190">This storage account can be shared by all the VMs.</span></span> <span data-ttu-id="6b818-191">A fiók lehet általános lemezeket használó nem felügyelt tárfiók.</span><span class="sxs-lookup"><span data-stu-id="6b818-191">This can be an unmanaged storage account using standard disks.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="6b818-192">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="6b818-192">Availability considerations</span></span>

<span data-ttu-id="6b818-193">A rendelkezésre állási csoport rugalmasabbá teszi alkalmazását mind a tervezett, mind a nem tervezett karbantartási eseményekkel szemben.</span><span class="sxs-lookup"><span data-stu-id="6b818-193">The availability set makes your application more resilient to both planned and unplanned maintenance events.</span></span>

* <span data-ttu-id="6b818-194">*Tervezett karbantartás* akkor fordul elő, amikor a Microsoft frissíti az alapul szolgáló platformot. Ez olykor a virtuális gépek újraindításával jár.</span><span class="sxs-lookup"><span data-stu-id="6b818-194">*Planned maintenance* occurs when Microsoft updates the underlying platform, sometimes causing VMs to be restarted.</span></span> <span data-ttu-id="6b818-195">Az Azure gondoskodik arról, hogy egy rendelkezésre állási csoporton belüli virtuális gépek ne egy időben induljanak újra.</span><span class="sxs-lookup"><span data-stu-id="6b818-195">Azure makes sure the VMs in an availability set are not all restarted at the same time.</span></span> <span data-ttu-id="6b818-196">Legalább egy mindig fut, amíg a többi újraindítása folyamatban van.</span><span class="sxs-lookup"><span data-stu-id="6b818-196">At least one is kept running while others are restarting.</span></span>
* <span data-ttu-id="6b818-197">*Nem tervezett karbantartás* hardverhiba esetén történik.</span><span class="sxs-lookup"><span data-stu-id="6b818-197">*Unplanned maintenance* happens if there is a hardware failure.</span></span> <span data-ttu-id="6b818-198">Az Azure gondoskodik arról, hogy egy rendelkezésre állási csoporton belüli virtuális gépek több kiszolgálószekrényben helyezkedjenek el.</span><span class="sxs-lookup"><span data-stu-id="6b818-198">Azure makes sure that VMs in an availability set are provisioned across more than one server rack.</span></span> <span data-ttu-id="6b818-199">Ez csökkenti az esetleges hardverhibák, hálózati kimaradások, áramkimaradások és hasonlók hatását.</span><span class="sxs-lookup"><span data-stu-id="6b818-199">This helps to reduce the impact of hardware failures, network outages, power interruptions, and so on.</span></span>

<span data-ttu-id="6b818-200">További információk: [Virtuális gépek rendelkezésre állásának kezelése][availability-set].</span><span class="sxs-lookup"><span data-stu-id="6b818-200">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> <span data-ttu-id="6b818-201">A következő videó áttekintést nyújt a rendelkezésre állási csoportokról: [Hogyan konfigurálhatók rendelkezésre állási csoportok a virtuális gépek méretezéséhez?][availability-set-ch9].</span><span class="sxs-lookup"><span data-stu-id="6b818-201">The following video also provides a good overview of availability sets: [How Do I Configure an Availability Set to Scale VMs][availability-set-ch9].</span></span>

> [!WARNING]
> <span data-ttu-id="6b818-202">Mindenképp konfigurálja a rendelkezésre állási csoportot a virtuális gép kiépítésekor.</span><span class="sxs-lookup"><span data-stu-id="6b818-202">Make sure to configure the availability set when you provision the VM.</span></span> <span data-ttu-id="6b818-203">Jelenleg nem lehet Resource Manager-alapú virtuális gépet hozzáadni egy rendelkezésre állási csoporthoz a virtuális gép kiépítése után.</span><span class="sxs-lookup"><span data-stu-id="6b818-203">Currently, there is no way to add a Resource Manager VM to an availability set after the VM is provisioned.</span></span>

<span data-ttu-id="6b818-204">A terheléselosztó [állapotmintákat][health-probes] használ a virtuálisgép-példányok rendelkezésre állásának monitorozásához.</span><span class="sxs-lookup"><span data-stu-id="6b818-204">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="6b818-205">Ha a mintavétel nem ér el egy példányt egy bizonyos időkorláton belül, a terheléselosztó nem irányít több forgalmat az adott virtuális gép felé.</span><span class="sxs-lookup"><span data-stu-id="6b818-205">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="6b818-206">A terheléselosztó ezután is folytatja a mintavételezést, és amint a virtuális gép újra elérhetővé válik, a terheléselosztó ismét elkezd forgalmat irányítani felé.</span><span class="sxs-lookup"><span data-stu-id="6b818-206">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="6b818-207">Az alábbiakban néhány javaslat olvasható a terheléselosztó állapot-mintavételére vonatkozóan:</span><span class="sxs-lookup"><span data-stu-id="6b818-207">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="6b818-208">A mintavételek a HTTP-t vagy a TCP-t tesztelhetik.</span><span class="sxs-lookup"><span data-stu-id="6b818-208">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="6b818-209">Ha a virtuális gépek HTTP-kiszolgálót futtatnak, HTTP-mintavételt hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="6b818-209">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="6b818-210">Egyéb esetben TCP-mintavételt hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="6b818-210">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="6b818-211">A HTTP-mintavétel esetében adjon meg elérési utat egy HTTP-végponthoz.</span><span class="sxs-lookup"><span data-stu-id="6b818-211">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="6b818-212">A mintavétel 200-as HTTP-választ vár erről a megadott elérési útról.</span><span class="sxs-lookup"><span data-stu-id="6b818-212">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="6b818-213">Ez lehet a gyökérútvonal („/”) vagy egy állapotmonitorozó végpont, amely valamilyen egyéni logikát alkalmaz az alkalmazás állapotának ellenőrzésére.</span><span class="sxs-lookup"><span data-stu-id="6b818-213">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="6b818-214">A végpontnak engedélyeznie kell a névtelen HTTP-kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="6b818-214">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="6b818-215">A mintavétel [ismert IP-címről érkezik:][health-probe-ip] 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="6b818-215">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="6b818-216">Győződjön meg arról, hogy nem tiltja a bejövő és kimenő forgalmat erről az IP-címről valamelyik tűzfalszabályzatban vagy NSG-szabályban.</span><span class="sxs-lookup"><span data-stu-id="6b818-216">Make sure you don't block traffic to or from this IP address in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="6b818-217">Az állapotminták állapotának megtekintéséhez használjon [állapotminta-naplókat][health-probe-log].</span><span class="sxs-lookup"><span data-stu-id="6b818-217">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="6b818-218">Engedélyezze a naplózást az Azure Portalon minden egyes terheléselosztóra vonatkozóan.</span><span class="sxs-lookup"><span data-stu-id="6b818-218">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="6b818-219">A naplókat a rendszer az Azure Blob Storage-ba írja.</span><span class="sxs-lookup"><span data-stu-id="6b818-219">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="6b818-220">A naplók megmutatják, hány háttérbeli virtuális gép nem fogad hálózati forgalmat a meghiúsult mintavételi válaszok miatt.</span><span class="sxs-lookup"><span data-stu-id="6b818-220">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="6b818-221">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="6b818-221">Manageability considerations</span></span>

<span data-ttu-id="6b818-222">Több virtuális gép használata esetén fontos a folyamatok automatizálása azok megbízhatósága és megismételhetősége érdekében.</span><span class="sxs-lookup"><span data-stu-id="6b818-222">With multiple VMs, it is important to automate processes so they are reliable and repeatable.</span></span> <span data-ttu-id="6b818-223">Az [Azure Automation][azure-automation] használatával automatizálhatja az üzembe helyezést, az operációs rendszer javításait és az egyéb feladatokat.</span><span class="sxs-lookup"><span data-stu-id="6b818-223">You can use [Azure Automation][azure-automation] to automate deployment, OS patching, and other tasks.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="6b818-224">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="6b818-224">Security considerations</span></span>

<span data-ttu-id="6b818-225">A virtuális hálózatok forgalomelkülönítési határok az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="6b818-225">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="6b818-226">Egy adott virtuális hálózatban található virtuális gépek nem képesek közvetlenül kommunikálni egy másik virtuális hálózat gépeivel.</span><span class="sxs-lookup"><span data-stu-id="6b818-226">VMs in one VNet cannot communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="6b818-227">Az azonos virtuális hálózatban elhelyezkedő virtuális gépek képesek a kommunikációra, hacsak [hálózati biztonsági csoportokat] [ nsg] (NSG-ket) nem hoz létre a forgalom korlátozására.</span><span class="sxs-lookup"><span data-stu-id="6b818-227">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="6b818-228">További információ: [A Microsoft felhőszolgáltatásai és hálózati biztonság][network-security].</span><span class="sxs-lookup"><span data-stu-id="6b818-228">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="6b818-229">A bejövő internetes forgalom esetében a terheléselosztó szabályai határozzák meg, milyen forgalom érheti el a háttérrendszert.</span><span class="sxs-lookup"><span data-stu-id="6b818-229">For incoming Internet traffic, the load balancer rules define which traffic can reach the back end.</span></span> <span data-ttu-id="6b818-230">A terheléselosztó szabályai azonban nem támogatják a biztonságos IP-címek listázását, ezért ha fel kíván venni bizonyos nyilvános IP-címeket a biztonságos címek listájára, adjon hálózati biztonsági csoportot az alhálózathoz.</span><span class="sxs-lookup"><span data-stu-id="6b818-230">However, load balancer rules don't support IP safe lists, so if you want to add certain public IP addresses to a safe list, add an NSG to the subnet.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="6b818-231">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="6b818-231">Deploy the solution</span></span>

<span data-ttu-id="6b818-232">Ennek az architektúrának egy üzemelő példánya elérhető a [GitHubon][github-folder].</span><span class="sxs-lookup"><span data-stu-id="6b818-232">A deployment for this architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="6b818-233">A következőket helyezi üzembe:</span><span class="sxs-lookup"><span data-stu-id="6b818-233">It deploys the following:</span></span>

  * <span data-ttu-id="6b818-234">Egy virtuális hálózatot egyetlen, **web** nevű alhálózattal, amely tartalmazza a virtuális gépeket.</span><span class="sxs-lookup"><span data-stu-id="6b818-234">A virtual network with a single subnet named **web** that contains the VMs.</span></span>
  * <span data-ttu-id="6b818-235">Egy virtuálisgép-méretezési csoportot, amely az Ubuntu 16.04.3 LTS. legújabb verzióját futtató virtuális gépeket tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="6b818-235">A VM scale set that contains VMs running the latest version of Ubuntu 16.04.3 LTS.</span></span> <span data-ttu-id="6b818-236">Az automatikus méretezés engedélyezve van.</span><span class="sxs-lookup"><span data-stu-id="6b818-236">Autoscale is enabled.</span></span>
  * <span data-ttu-id="6b818-237">Egy terheléselosztót, amely a virtuálisgép-méretezési csoport előtt helyezkedik el.</span><span class="sxs-lookup"><span data-stu-id="6b818-237">A load balancer that sits in front of the VM scale set.</span></span>
  * <span data-ttu-id="6b818-238">Egy hálózati biztonsági csoportot bejövő forgalomra vonatkozó szabályokkal, amelyek engedélyezik a HTTP-forgalmat a virtuálisgép-méretezési csoport felé.</span><span class="sxs-lookup"><span data-stu-id="6b818-238">An NSG with incoming rules that allow HTTP traffic to the VM scale set.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="6b818-239">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="6b818-239">Prerequisites</span></span>

<span data-ttu-id="6b818-240">Mielőtt üzembe helyezhetné saját előfizetésében a referenciaarchitektúrát, az alábbi lépéseket kell elvégeznie.</span><span class="sxs-lookup"><span data-stu-id="6b818-240">Before you can deploy the reference architecture to your own subscription, you must perform the following steps.</span></span>

1. <span data-ttu-id="6b818-241">Klónozza, ágaztassa vagy a zip-fájl letöltése a [architektúrák hivatkozhat] [ ref-arch-repo] GitHub-tárházban.</span><span class="sxs-lookup"><span data-stu-id="6b818-241">Clone, fork, or download the zip file for the [reference architectures][ref-arch-repo] GitHub repository.</span></span>

2. <span data-ttu-id="6b818-242">Győződjön meg arról, hogy az Azure CLI 2.0 telepítve van a számítógépén.</span><span class="sxs-lookup"><span data-stu-id="6b818-242">Make sure you have the Azure CLI 2.0 installed on your computer.</span></span> <span data-ttu-id="6b818-243">Információk a CLI telepítésével kapcsolatban: [Az Azure CLI 2.0 telepítése][azure-cli-2].</span><span class="sxs-lookup"><span data-stu-id="6b818-243">For CLI installation instructions, see [Install Azure CLI 2.0][azure-cli-2].</span></span>

3. <span data-ttu-id="6b818-244">Telepítse [az Azure építőelemei][azbb] npm-csomagot.</span><span class="sxs-lookup"><span data-stu-id="6b818-244">Install the [Azure building blocks][azbb] npm package.</span></span>

4. <span data-ttu-id="6b818-245">Jelentkezzen be Azure-fiókjába egy parancssorból, Bash-parancssorból vagy PowerShell-parancssorból az alábbi parancsok egyikével, és kövesse az utasításokat.</span><span class="sxs-lookup"><span data-stu-id="6b818-245">From a command prompt, bash prompt, or PowerShell prompt, login to your Azure account by using one of the commands below, and follow the prompts.</span></span>

  ```bash
  az login
  ```

### <a name="deploy-the-solution-using-azbb"></a><span data-ttu-id="6b818-246">A megoldás üzembe helyezése az azbb használatával</span><span class="sxs-lookup"><span data-stu-id="6b818-246">Deploy the solution using azbb</span></span>

<span data-ttu-id="6b818-247">A mintául szolgáló, egyetlen virtuális gépet alkalmazó számítási feladat üzembe helyezéséhez kövesse az alábbi lépéseket:</span><span class="sxs-lookup"><span data-stu-id="6b818-247">To deploy the sample single VM workload, follow these steps:</span></span>

1. <span data-ttu-id="6b818-248">Navigáljon az előfeltételekre vonatkozó előző lépésekben letöltött adattár `virtual-machines\multi-vm\parameters\linux` mappájához.</span><span class="sxs-lookup"><span data-stu-id="6b818-248">Navigate to the `virtual-machines\multi-vm\parameters\linux` folder for the repository you downloaded in the pre-requisites step above.</span></span>

2. <span data-ttu-id="6b818-249">Nyissa meg a `multi-vm-v2.json` fájlt, és adjon meg egy felhasználónevet és egy SSH-kulcsot az idézőjelek között az alább látható módon, majd mentse a fájlt.</span><span class="sxs-lookup"><span data-stu-id="6b818-249">Open the `multi-vm-v2.json` file and enter a username and SSH key between the quotes, as shown below, then save the file.</span></span>

  ```bash
  "adminUsername": "",
  "sshPublicKey": "",
  ```

3. <span data-ttu-id="6b818-250">Az `azbb` futtatásával helyezze üzembe a virtuális gépet az alább látható módon.</span><span class="sxs-lookup"><span data-stu-id="6b818-250">Run `azbb` to deploy the VMs as shown below.</span></span>

  ```bash
  azbb -s <subscription_id> -g <resource_group_name> -l <location> -p multi-vm-v2.json --deploy
  ```

<span data-ttu-id="6b818-251">A mintául szolgáló referenciaarchitektúra üzembe helyezéséről további információkat a [GitHub-adattárban][git] talál.</span><span class="sxs-lookup"><span data-stu-id="6b818-251">For more information on deploying this sample reference architecture, visit our [GitHub repository][git].</span></span>

<!-- links -->

[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[availability-set-ch9]: https://channel9.msdn.com/Series/Microsoft-Azure-Fundamentals-Virtual-Machines/08
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[azure-automation]: /azure/automation/automation-intro
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-cli-2]: /azure/install-azure-cli?view=azure-cli-latest
[azure-dns]: /azure/dns/dns-overview
[git]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/multi-vm
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[load-balancer]: /azure/load-balancer/load-balancer-get-started-internet-arm-cli
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[naming-conventions]: ../../best-practices/naming-conventions.md
[network-security]: /azure/best-practices-network-security
[nsg]: /azure/virtual-network/virtual-networks-nsg
[premium]: /azure/storage/common/storage-premium-storage
[ref-arch-repo]: https://github.com/mspnp/reference-architectures
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[runbook-gallery]: /azure/automation/automation-runbook-gallery#runbooks-in-runbook-gallery
[single-vm]: single-vm.md
[subscription-limits]: /azure/azure-subscription-service-limits
[visio-download]: https://archcenter.azureedge.net/cdn/vm-reference-architectures.vsdx
[vm-disk-limits]: /azure/azure-subscription-service-limits#virtual-machine-disk-limits
[vm-scaleset]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vm-sizes]: https://azure.microsoft.com/documentation/articles/virtual-machines-windows-sizes/
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_2/
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[vmss-quickstart]: https://azure.microsoft.com/documentation/templates/?term=scale+set
[0]: ./images/multi-vm-diagram.png "Több Azure-beli virtuális gépet tartalmazó megoldás architektúrája, amely egy két virtuális gépet tartalmazó rendelkezésre állási csoportból és egy terheléselosztóból áll"
