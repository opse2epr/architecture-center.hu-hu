---
title: Az Azure Active Directory Domain Services (AD DS) kiterjesztése az Azure-ra
titleSuffix: Azure Reference Architectures
description: Kiterjesztheti a helyszíni Active Directory-tartomány az Azure-bA.
author: telmosampaio
ms.date: 05/02/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, identity
ms.openlocfilehash: 931d247f088055286a2832b886992dca8565b6a7
ms.sourcegitcommit: 273e690c0cfabbc3822089c7d8bc743ef41d2b6e
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 02/08/2019
ms.locfileid: "55897643"
---
# <a name="extend-active-directory-domain-services-ad-ds-to-azure"></a><span data-ttu-id="28e96-103">Az Azure Active Directory Domain Services (AD DS) kiterjesztése az Azure-ra</span><span class="sxs-lookup"><span data-stu-id="28e96-103">Extend Active Directory Domain Services (AD DS) to Azure</span></span>

<span data-ttu-id="28e96-104">Ez a referenciaarchitektúra bemutatja, hogyan terjeszthető ki a az Active Directory-környezetet az Azure Active Directory Domain Services (AD DS) használatával, elosztott hitelesítési szolgáltatások biztosításához.</span><span class="sxs-lookup"><span data-stu-id="28e96-104">This reference architecture shows how to extend your Active Directory environment to Azure to provide distributed authentication services using Active Directory Domain Services (AD DS).</span></span> <span data-ttu-id="28e96-105">[**A megoldás üzembe helyezése.**](#deploy-the-solution)</span><span class="sxs-lookup"><span data-stu-id="28e96-105">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Biztonságos hibrid hálózati architektúra az Active Directoryval](./images/adds-extend-domain.png)

<span data-ttu-id="28e96-107">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="28e96-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="28e96-108">Az AD DS egy biztonsági tartományban található felhasználó, számítógép, alkalmazás és egyéb identitások hitelesítésére használható.</span><span class="sxs-lookup"><span data-stu-id="28e96-108">AD DS is used to authenticate user, computer, application, or other identities that are included in a security domain.</span></span> <span data-ttu-id="28e96-109">Az AD DS üzemeltethető a helyszínen, de ha az alkalmazás részben a helyszínen, részben pedig az Azure-ban üzemel, a funkció Azure-ban való replikálása hatékonyabb lehet.</span><span class="sxs-lookup"><span data-stu-id="28e96-109">It can be hosted on-premises, but if your application is hosted partly on-premises and partly in Azure, it may be more efficient to replicate this functionality in Azure.</span></span> <span data-ttu-id="28e96-110">Ez csökkentheti a késést, amelyet a hitelesítési és a helyi engedélyezési kérelmek a felhőből a helyszínen futó AD DS-be való visszaküldése okoz.</span><span class="sxs-lookup"><span data-stu-id="28e96-110">This can reduce the latency caused by sending authentication and local authorization requests from the cloud back to AD DS running on-premises.</span></span>

<span data-ttu-id="28e96-111">Ezt az architektúrát gyakran használják, ha a helyszíni hálózatot és az Azure-beli virtuális hálózatot VPN- vagy ExpressRoute-kapcsolat köti össze.</span><span class="sxs-lookup"><span data-stu-id="28e96-111">This architecture is commonly used when the on-premises network and the Azure virtual network are connected by a VPN or ExpressRoute connection.</span></span> <span data-ttu-id="28e96-112">Ez az architektúra a kétirányú replikációt is támogatja, ez azt jelenti, hogy a módosítások a helyszínen vagy a felhőben is elvégezhetők, és mindkét forrás egységes lesz.</span><span class="sxs-lookup"><span data-stu-id="28e96-112">This architecture also supports bidirectional replication, meaning changes can be made either on-premises or in the cloud, and both sources will be kept consistent.</span></span> <span data-ttu-id="28e96-113">Az architektúra gyakori használati módjai közé tartoznak a hibrid alkalmazások, amelyekben a funkciók megoszlanak a helyszíni hely és az Azure között, valamint azok az alkalmazások és szolgáltatások, amelyek az Active Directoryval végzik el a hitelesítést.</span><span class="sxs-lookup"><span data-stu-id="28e96-113">Typical uses for this architecture include hybrid applications in which functionality is distributed between on-premises and Azure, and applications and services that perform authentication using Active Directory.</span></span>

<span data-ttu-id="28e96-114">További szempontok: [Megoldás választása a helyszíni Active Directory Azure-ral való integrálásához][considerations].</span><span class="sxs-lookup"><span data-stu-id="28e96-114">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span>

## <a name="architecture"></a><span data-ttu-id="28e96-115">Architektúra</span><span class="sxs-lookup"><span data-stu-id="28e96-115">Architecture</span></span>

<span data-ttu-id="28e96-116">Ez az architektúra a [Szegélyhálózat (DMZ) az Azure és az internet között][implementing-a-secure-hybrid-network-architecture-with-internet-access] című részben használt architektúrát bővíti ki.</span><span class="sxs-lookup"><span data-stu-id="28e96-116">This architecture extends the architecture shown in [DMZ between Azure and the Internet][implementing-a-secure-hybrid-network-architecture-with-internet-access].</span></span> <span data-ttu-id="28e96-117">A következő összetevőket tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="28e96-117">It has the following components.</span></span>

- <span data-ttu-id="28e96-118">**Helyszíni hálózat**.</span><span class="sxs-lookup"><span data-stu-id="28e96-118">**On-premises network**.</span></span> <span data-ttu-id="28e96-119">A helyszíni hálózat tartalmazza azokat a helyi Active Directory-kiszolgálókat, amelyek a helyszíni összetevők hitelesítését és engedélyezését végezhetik el.</span><span class="sxs-lookup"><span data-stu-id="28e96-119">The on-premises network includes local Active Directory servers that can perform authentication and authorization for components located on-premises.</span></span>
- <span data-ttu-id="28e96-120">**Active Directory-kiszolgálók**.</span><span class="sxs-lookup"><span data-stu-id="28e96-120">**Active Directory servers**.</span></span> <span data-ttu-id="28e96-121">Ezek a felhőben virtuális gépként futó tartományvezérlők, amelyek címtárszolgáltatásokat (AD DS) biztosítanak.</span><span class="sxs-lookup"><span data-stu-id="28e96-121">These are domain controllers implementing directory services (AD DS) running as VMs in the cloud.</span></span> <span data-ttu-id="28e96-122">Ezek a kiszolgálók az Azure-beli virtuális hálózaton futó összetevők hitelesítését végezhetik el.</span><span class="sxs-lookup"><span data-stu-id="28e96-122">These servers can provide authentication of components running in your Azure virtual network.</span></span>
- <span data-ttu-id="28e96-123">**Active Directory-alhálózat**.</span><span class="sxs-lookup"><span data-stu-id="28e96-123">**Active Directory subnet**.</span></span> <span data-ttu-id="28e96-124">Az AD DS-kiszolgálók külön alhálózaton üzemelnek.</span><span class="sxs-lookup"><span data-stu-id="28e96-124">The AD DS servers are hosted in a separate subnet.</span></span> <span data-ttu-id="28e96-125">A hálózati biztonsági csoport (NSG) szabályai megvédik az AD DS-kiszolgálókat, és tűzfalat biztosítanak a nem várt forrásból érkező adatforgalom ellen.</span><span class="sxs-lookup"><span data-stu-id="28e96-125">Network security group (NSG) rules protect the AD DS servers and provide a firewall against traffic from unexpected sources.</span></span>
- <span data-ttu-id="28e96-126">**Azure Gateway és Active Directory szinkronizálása**.</span><span class="sxs-lookup"><span data-stu-id="28e96-126">**Azure Gateway and Active Directory synchronization**.</span></span> <span data-ttu-id="28e96-127">Az Azure-átjáró kapcsolatot biztosít a helyszíni hálózat és az Azure-beli virtuális hálózat között.</span><span class="sxs-lookup"><span data-stu-id="28e96-127">The Azure gateway provides a connection between the on-premises network and the Azure VNet.</span></span> <span data-ttu-id="28e96-128">Ez lehet [VPN-kapcsolat] [ azure-vpn-gateway] vagy [Azure ExpressRoute][azure-expressroute].</span><span class="sxs-lookup"><span data-stu-id="28e96-128">This can be a [VPN connection][azure-vpn-gateway] or [Azure ExpressRoute][azure-expressroute].</span></span> <span data-ttu-id="28e96-129">A felhőben és a helyszínen lévő Active Directory-kiszolgálók közötti minden forgalom ezen az átjárón halad keresztül.</span><span class="sxs-lookup"><span data-stu-id="28e96-129">All synchronization requests between the Active Directory servers in the cloud and on-premises pass through the gateway.</span></span> <span data-ttu-id="28e96-130">A felhasználó által megadott útvonalak (UDR-ek) kezelik az Azure-ba tartó helyszíni forgalom útválasztását.</span><span class="sxs-lookup"><span data-stu-id="28e96-130">User-defined routes (UDRs) handle routing for on-premises traffic that passes to Azure.</span></span> <span data-ttu-id="28e96-131">Az Active Directory-kiszolgálók bemenő és kimenő forgalma nem halad át az ebben a forgatókönyvben használt hálózati virtuális berendezéseken (NVA-kon).</span><span class="sxs-lookup"><span data-stu-id="28e96-131">Traffic to and from the Active Directory servers does not pass through the network virtual appliances (NVAs) used in this scenario.</span></span>

<span data-ttu-id="28e96-132">További információ az UDR-ek és az NVA-k konfigurálásáról: [Biztonságos hibrid hálózati architektúra megvalósítása az Azure-ban][implementing-a-secure-hybrid-network-architecture].</span><span class="sxs-lookup"><span data-stu-id="28e96-132">For more information about configuring UDRs and the NVAs, see [Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture].</span></span>

## <a name="recommendations"></a><span data-ttu-id="28e96-133">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="28e96-133">Recommendations</span></span>

<span data-ttu-id="28e96-134">Az alábbi javaslatok a legtöbb forgatókönyvre vonatkoznak.</span><span class="sxs-lookup"><span data-stu-id="28e96-134">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="28e96-135">Kövesse ezeket a javaslatokat, ha nincsenek ezeket felülíró követelményei.</span><span class="sxs-lookup"><span data-stu-id="28e96-135">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="vm-recommendations"></a><span data-ttu-id="28e96-136">Virtuális gépekre vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="28e96-136">VM recommendations</span></span>

<span data-ttu-id="28e96-137">Határozza meg a [virtuális gép méretkövetelményeit][vm-windows-sizes] a hitelesítési kérelmek várt mérete alapján.</span><span class="sxs-lookup"><span data-stu-id="28e96-137">Determine your [VM size][vm-windows-sizes] requirements based on the expected volume of authentication requests.</span></span> <span data-ttu-id="28e96-138">Kiindulópontként használja az AD DS-t helyszínen üzemeltető gépek specifikációit, és egyeztesse őket az Azure-beli virtuális gépek méreteivel.</span><span class="sxs-lookup"><span data-stu-id="28e96-138">Use the specifications of the machines hosting AD DS on premises as a starting point, and match them with the Azure VM sizes.</span></span> <span data-ttu-id="28e96-139">Telepítés után monitorozza a kihasználtságot, és a virtuális gép tényleges terhelése alapján vertikálisan skálázza fel vagy le a kapacitást.</span><span class="sxs-lookup"><span data-stu-id="28e96-139">Once deployed, monitor utilization and scale up or down based on the actual load on the VMs.</span></span> <span data-ttu-id="28e96-140">További információ az AD DS-tartományvezérlők méretezéséről: [Az Active Directory Domain Services kapacitásának tervezése][capacity-planning-for-adds].</span><span class="sxs-lookup"><span data-stu-id="28e96-140">For more information about sizing AD DS domain controllers, see [Capacity Planning for Active Directory Domain Services][capacity-planning-for-adds].</span></span>

<span data-ttu-id="28e96-141">Hozzon létre egy külön virtuális adatlemezt az Active Directoryhoz tartozó adatbázis, naplók és SYSVOL tárolásához.</span><span class="sxs-lookup"><span data-stu-id="28e96-141">Create a separate virtual data disk for storing the database, logs, and SYSVOL for Active Directory.</span></span> <span data-ttu-id="28e96-142">Ezeket ne ugyanazon a lemezen tárolja, amelyen az operációs rendszer van.</span><span class="sxs-lookup"><span data-stu-id="28e96-142">Do not store these items on the same disk as the operating system.</span></span> <span data-ttu-id="28e96-143">Vegye figyelembe, hogy a virtuális géphez csatolt adatlemezek alapértelmezés szerint visszaírt gyorsítótárazást használnak.</span><span class="sxs-lookup"><span data-stu-id="28e96-143">Note that by default, data disks that are attached to a VM use write-through caching.</span></span> <span data-ttu-id="28e96-144">A gyorsítótárazás ezen formája azonban ütközhet az AD DS követelményeivel.</span><span class="sxs-lookup"><span data-stu-id="28e96-144">However, this form of caching can conflict with the requirements of AD DS.</span></span> <span data-ttu-id="28e96-145">Ezért az adatlemez *Host Cache Preference* (Gazdagép gyorsítótár-beállítása) beállítást állítsa *None* (Nincs) értékre.</span><span class="sxs-lookup"><span data-stu-id="28e96-145">For this reason, set the *Host Cache Preference* setting on the data disk to *None*.</span></span> <span data-ttu-id="28e96-146">További információkért lásd: [központi telepítése Windows Server Active Directory az Azure Virtual Machinesben irányelvek][adds-data-disks].</span><span class="sxs-lookup"><span data-stu-id="28e96-146">For more information, see [Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines][adds-data-disks].</span></span>

<span data-ttu-id="28e96-147">Helyezzen üzembe tartományvezérlőként legalább két, AD DS-t futtató virtuális gépet, és adja hozzá őket egy [rendelkezésre állási csoporthoz][availability-set].</span><span class="sxs-lookup"><span data-stu-id="28e96-147">Deploy at least two VMs running AD DS as domain controllers and add them to an [availability set][availability-set].</span></span>

### <a name="networking-recommendations"></a><span data-ttu-id="28e96-148">Hálózatokra vonatkozó javaslatok</span><span class="sxs-lookup"><span data-stu-id="28e96-148">Networking recommendations</span></span>

<span data-ttu-id="28e96-149">Konfigurálja minden AD DS-kiszolgáló virtuális gép hálózati adaptererét (NIC) konfigurálja egy statikus magánhálózati IP-címmel a tartománynév-szolgáltatás (DNS) teljes körű támogatása érdekében.</span><span class="sxs-lookup"><span data-stu-id="28e96-149">Configure the VM network interface (NIC) for each AD DS server with a static private IP address for full domain name service (DNS) support.</span></span> <span data-ttu-id="28e96-150">További információ: [Statikus magánhálózati IP-cím beállítása az Azure Portalon][set-a-static-ip-address].</span><span class="sxs-lookup"><span data-stu-id="28e96-150">For more information, see [How to set a static private IP address in the Azure portal][set-a-static-ip-address].</span></span>

> [!NOTE]
> <span data-ttu-id="28e96-151">Ne konfigurálja az AD DS-kiszolgálók virtuális gép hálózati adapterét nyilvános IP-címmel.</span><span class="sxs-lookup"><span data-stu-id="28e96-151">Do not configure the VM NIC for any AD DS with a public IP address.</span></span> <span data-ttu-id="28e96-152">További részleteket a [Biztonsági szempontok][security-considerations] című részben talál.</span><span class="sxs-lookup"><span data-stu-id="28e96-152">See [Security considerations][security-considerations] for more details.</span></span>
>

<span data-ttu-id="28e96-153">Az Active Directory alhálózati biztonsági csoporthoz olyan szabályok szükségesek, amelyek engedélyezik a helyszínről bejövő forgalmat.</span><span class="sxs-lookup"><span data-stu-id="28e96-153">The Active Directory subnet NSG requires rules to permit incoming traffic from on-premises.</span></span> <span data-ttu-id="28e96-154">Részletes információ az AD DS által használt portokról: [Az Active Directory és az Active Directory Domain Services portokra vonatkozó követelményei][ad-ds-ports].</span><span class="sxs-lookup"><span data-stu-id="28e96-154">For detailed information on the ports used by AD DS, see [Active Directory and Active Directory Domain Services Port Requirements][ad-ds-ports].</span></span> <span data-ttu-id="28e96-155">Győződjön meg arról is, hogy az UDR-táblák nem irányítják az AD DS-forgalmat az architektúrában használt NVA-kra.</span><span class="sxs-lookup"><span data-stu-id="28e96-155">Also, ensure the UDR tables do not route AD DS traffic through the NVAs used in this architecture.</span></span>

### <a name="active-directory-site"></a><span data-ttu-id="28e96-156">Active Directory-hely</span><span class="sxs-lookup"><span data-stu-id="28e96-156">Active Directory site</span></span>

<span data-ttu-id="28e96-157">Az AD DS-ben a hely egy fizikai helyet, hálózatot vagy eszközgyűjteményt jelent.</span><span class="sxs-lookup"><span data-stu-id="28e96-157">In AD DS, a site represents a physical location, network, or collection of devices.</span></span> <span data-ttu-id="28e96-158">Az AD DS-helyek az AD DS adatbázis-replikációk kezelésére használhatók az egymáshoz közel elhelyezkedő és nagy sebességű hálózattal összekapcsolt AD DS-objektumok csoportosításával.</span><span class="sxs-lookup"><span data-stu-id="28e96-158">AD DS sites are used to manage AD DS database replication by grouping together AD DS objects that are located close to one another and are connected by a high speed network.</span></span> <span data-ttu-id="28e96-159">Az AD DS beépített logikája képes kiválasztani az AD DS-adatbázisok helyek közötti replikációlásának legjobb stratégiáját.</span><span class="sxs-lookup"><span data-stu-id="28e96-159">AD DS includes logic to select the best strategy for replacating the AD DS database between sites.</span></span>

<span data-ttu-id="28e96-160">Azt javasoljuk, hogy hozzon létre egy AD DS-helyet, amely tartalmazza az Azure-ban lévő alkalmazáshoz megadott alhálózatokat.</span><span class="sxs-lookup"><span data-stu-id="28e96-160">We recommend that you create an AD DS site including the subnets defined for your application in Azure.</span></span> <span data-ttu-id="28e96-161">Ezután konfiguráljon egy helykapcsolatot a helyszíni AD DS-helyek között, és az AD DS automatikusan elvégzi a lehető leghatékonyabb adatbázis-replikációt.</span><span class="sxs-lookup"><span data-stu-id="28e96-161">Then, configure a site link between your on-premises AD DS sites, and AD DS will automatically perform the most efficient database replication possible.</span></span> <span data-ttu-id="28e96-162">Vegye figyelembe, hogy ez az adatbázis-replikáció a kezdeti konfigurációnál nem sokkal igényel többet.</span><span class="sxs-lookup"><span data-stu-id="28e96-162">Note that this database replication requires little beyond the initial configuration.</span></span>

### <a name="active-directory-operations-masters"></a><span data-ttu-id="28e96-163">Active Directory műveleti főkiszolgálók</span><span class="sxs-lookup"><span data-stu-id="28e96-163">Active Directory operations masters</span></span>

<span data-ttu-id="28e96-164">A műveleti főkiszolgálói szerepkör hozzárendelhető az AD DS-tartományvezérlőkhöz, így biztosítható a replikált AD DS-adatbázisok példányai közötti konzisztencia-ellenőrzés támogatása.</span><span class="sxs-lookup"><span data-stu-id="28e96-164">The operations masters role can be assigned to AD DS domain controllers to support consistency checking between instances of replicated AD DS databases.</span></span> <span data-ttu-id="28e96-165">Öt műveleti főkiszolgálói szerepkör van: sémakezelő főkiszolgáló, tartománynév-kiosztási főkiszolgáló, relatívazonosító-kezelő főkiszolgáló, elsődleges tartományvezérlő-főkiszolgáló emulátor, infrastruktúrakezelő főkiszolgáló.</span><span class="sxs-lookup"><span data-stu-id="28e96-165">There are five operations master roles: schema master, domain naming master, relative identifier master, primary domain controller master emulator, and infrastructure master.</span></span> <span data-ttu-id="28e96-166">További információ ezekről a szerepkörökről: [Mik a műveleti főkiszolgálók?][ad-ds-operations-masters].</span><span class="sxs-lookup"><span data-stu-id="28e96-166">For more information about these roles, see [What are Operations Masters?][ad-ds-operations-masters].</span></span>

<span data-ttu-id="28e96-167">Azt javasoljuk, hogy ne rendeljen főkiszolgálói szerepköröket az Azure-ban üzembe helyezett tartományvezérlőkhöz.</span><span class="sxs-lookup"><span data-stu-id="28e96-167">We recommend you do not assign operations masters roles to the domain controllers deployed in Azure.</span></span>

### <a name="monitoring"></a><span data-ttu-id="28e96-168">Figyelés</span><span class="sxs-lookup"><span data-stu-id="28e96-168">Monitoring</span></span>

<span data-ttu-id="28e96-169">Monitorozza a tartományvezérlő virtuális gépek, valamint az AD DS Services erőforrásait, és hozzon létre egy tervet az esetleges problémák gyors javítására.</span><span class="sxs-lookup"><span data-stu-id="28e96-169">Monitor the resources of the domain controller VMs as well as the AD DS Services and create a plan to quickly correct any problems.</span></span> <span data-ttu-id="28e96-170">További információ: [Az Active Directory monitorozása][monitoring_ad].</span><span class="sxs-lookup"><span data-stu-id="28e96-170">For more information, see [Monitoring Active Directory][monitoring_ad].</span></span> <span data-ttu-id="28e96-171">A feladatok megkönnyítéséhez olyan eszközöket is telepíthet a monitorozási kiszolgálóra (lásd az architektúra diagramját), mint a [Microsoft Systems Center][microsoft_systems_center].</span><span class="sxs-lookup"><span data-stu-id="28e96-171">You can also install tools such as [Microsoft Systems Center][microsoft_systems_center] on the monitoring server (see the architecture diagram) to help perform these tasks.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="28e96-172">Méretezési szempontok</span><span class="sxs-lookup"><span data-stu-id="28e96-172">Scalability considerations</span></span>

<span data-ttu-id="28e96-173">Az AD DS-t méretezhetőségre tervezték.</span><span class="sxs-lookup"><span data-stu-id="28e96-173">AD DS is designed for scalability.</span></span> <span data-ttu-id="28e96-174">Nem kell terheléselosztót vagy forgalomirányítót konfigurálnia a kérelmek AD DS-tartományvezérlőkre történő irányításához.</span><span class="sxs-lookup"><span data-stu-id="28e96-174">You don't need to configure a load balancer or traffic controller to direct requests to AD DS domain controllers.</span></span> <span data-ttu-id="28e96-175">Az egyetlen méretezhetőségi szempont az AD DS-t futtató virtuális gépek konfigurálása a hálózati terhelési követelményeinek megfelelően, a virtuális gépek terhelésének monitorozása, valamint a szükség szerinti vertikális fel- vagy leskálázás.</span><span class="sxs-lookup"><span data-stu-id="28e96-175">The only scalability consideration is to configure the VMs running AD DS with the correct size for your network load requirements, monitor the load on the VMs, and scale up or down as necessary.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="28e96-176">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="28e96-176">Availability considerations</span></span>

<span data-ttu-id="28e96-177">Az AD DS-t futtató virtuális gépeket egy [rendelkezésre állási csoportban][availability-set] helyezze üzembe.</span><span class="sxs-lookup"><span data-stu-id="28e96-177">Deploy the VMs running AD DS into an [availability set][availability-set].</span></span> <span data-ttu-id="28e96-178">Fontolja meg azt is, hogy a [készenléti műveleti főkiszolgálói][standby-operations-masters] szerepkört legalább egy, vagy lehetőség szerint több kiszolgálóhoz is hozzárendeli, a követelményektől függően.</span><span class="sxs-lookup"><span data-stu-id="28e96-178">Also, consider assigning the role of [standby operations master][standby-operations-masters] to at least one server, and possibly more depending on your requirements.</span></span> <span data-ttu-id="28e96-179">A készenléti műveleti főkiszolgáló a műveleti főkiszolgáló egy aktív másolata, amely az elsődleges műveleti főkiszolgáló helyett használható feladatátvételkor.</span><span class="sxs-lookup"><span data-stu-id="28e96-179">A standby operations master is an active copy of the operations master that can be used in place of the primary operations masters server during fail over.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="28e96-180">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="28e96-180">Manageability considerations</span></span>

<span data-ttu-id="28e96-181">Rendszeresen készítsen biztonsági mentést az AD DS-ről.</span><span class="sxs-lookup"><span data-stu-id="28e96-181">Perform regular AD DS backups.</span></span> <span data-ttu-id="28e96-182">A tartományvezérlők VHD-fájljait másolása nem elegendő a rendszeres biztonsági mentés helyett, mert előfordulhat, hogy a virtuális lemezen lévő AD DS-adatbázisfájlok nincsenek konzisztens állapotban a másoláskor, ezért az adatbázist nem lehet újraindítani.</span><span class="sxs-lookup"><span data-stu-id="28e96-182">Don't simply copy the VHD files of domain controllers instead of performing regular backups, because the AD DS database file on the VHD may not be in a consistent state when it's copied, making it impossible to restart the database.</span></span>

<span data-ttu-id="28e96-183">Ne állítsa le a tartományvezérlő virtuális gépeket az Azure Portalról.</span><span class="sxs-lookup"><span data-stu-id="28e96-183">Do not shut down a domain controller VM using Azure portal.</span></span> <span data-ttu-id="28e96-184">Ehelyett a vendég operációs rendszerből állítsa le és indítsa újra őket.</span><span class="sxs-lookup"><span data-stu-id="28e96-184">Instead, shut down and restart from the guest operating system.</span></span> <span data-ttu-id="28e96-185">A portálon keresztüli leállítás a virtuális gép felszabadítását okozza, amely alaphelyzetbe állítja az Active Directory-adattár `VM-GenerationID` és `invocationID` beállításait.</span><span class="sxs-lookup"><span data-stu-id="28e96-185">Shutting down through the portal causes the VM to be deallocated, which resets both the `VM-GenerationID` and the `invocationID` of the Active Directory repository.</span></span> <span data-ttu-id="28e96-186">Ez elveti az AD DS relatív azonosítójának (RID) készletét, nem mérvadóként jelöli meg a SYSVOL-t, és szükségessé teheti a tartományvezérlő újrakonfigurálását.</span><span class="sxs-lookup"><span data-stu-id="28e96-186">This discards the AD DS relative identifier (RID) pool and marks SYSVOL as nonauthoritative, and may require reconfiguration of the domain controller.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="28e96-187">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="28e96-187">Security considerations</span></span>

<span data-ttu-id="28e96-188">Az AD DS-kiszolgálók hitelesítési szolgáltatásokat nyújtanak, és a támadások vonzó célpontjai.</span><span class="sxs-lookup"><span data-stu-id="28e96-188">AD DS servers provide authentication services and are an attractive target for attacks.</span></span> <span data-ttu-id="28e96-189">A védelmük érdekében akadályozza meg a közvetlen internetkapcsolatot úgy, hogy az AD DS-kiszolgálókat egy külön alhálózatra helyezi, ahol egy hálózati biztonsági csoport tűzfalként szolgál.</span><span class="sxs-lookup"><span data-stu-id="28e96-189">To secure them, prevent direct Internet connectivity by placing the AD DS servers in a separate subnet with an NSG acting as a firewall.</span></span> <span data-ttu-id="28e96-190">Zárjon be minden portot az AD DS-kiszolgálókon, kivéve a hitelesítéshez, engedélyezéshez és kiszolgálószinkronizáláshoz szükséges portokat.</span><span class="sxs-lookup"><span data-stu-id="28e96-190">Close all ports on the AD DS servers except those necessary for authentication, authorization, and server synchronization.</span></span> <span data-ttu-id="28e96-191">További információ lásd: [Az Active Directory és az Active Directory Domain Services portjainak követelményei][ad-ds-ports].</span><span class="sxs-lookup"><span data-stu-id="28e96-191">For more information, see [Active Directory and Active Directory Domain Services Port Requirements][ad-ds-ports].</span></span>

<span data-ttu-id="28e96-192">Fontolja meg egy kiegészítő biztonsági terület létrehozását is a kiszolgálók körül két alhálózat és hálózati virtuális készülékek (NVA-k) használatával a [biztonságos, internet-hozzáféréssel rendelkező hibrid hálózati architektúra Azure-ban való megvalósítását][implementing-a-secure-hybrid-network-architecture-with-internet-access] ismertető dokumentumban leírtak szerint.</span><span class="sxs-lookup"><span data-stu-id="28e96-192">Consider implementing an additional security perimeter around servers with a pair of subnets and NVAs, as described in [Implementing a secure hybrid network architecture with Internet access in Azure][implementing-a-secure-hybrid-network-architecture-with-internet-access].</span></span>

<span data-ttu-id="28e96-193">A BitLocker vagy az Azure Disk Encryption használatával titkosítsa az AD DS-adatbázist üzemeltető lemezt.</span><span class="sxs-lookup"><span data-stu-id="28e96-193">Use either BitLocker or Azure disk encryption to encrypt the disk hosting the AD DS database.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="28e96-194">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="28e96-194">Deploy the solution</span></span>

<span data-ttu-id="28e96-195">Ennek az architektúrának egy üzemelő példánya elérhető a [GitHubon][github].</span><span class="sxs-lookup"><span data-stu-id="28e96-195">A deployment for this architecture is available on [GitHub][github].</span></span> <span data-ttu-id="28e96-196">Vegye figyelembe, hogy a teljes üzembe helyezés eltarthat akár két órát, amely tartalmazza a VPN gateway létrehozása, és futtatja a parancsfájlokat, amelyek az AD DS konfigurálása.</span><span class="sxs-lookup"><span data-stu-id="28e96-196">Note that the entire deployment can take up to two hours, which includes creating the VPN gateway and running the scripts that configure AD DS.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="28e96-197">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="28e96-197">Prerequisites</span></span>

1. <span data-ttu-id="28e96-198">Klónozza, ágaztassa vagy töltse le a zip-fájlját a [GitHub-adattár](https://github.com/mspnp/identity-reference-architectures).</span><span class="sxs-lookup"><span data-stu-id="28e96-198">Clone, fork, or download the zip file for the [GitHub repository](https://github.com/mspnp/identity-reference-architectures).</span></span>

2. <span data-ttu-id="28e96-199">Telepítés [az Azure CLI 2.0](/cli/azure/install-azure-cli?view=azure-cli-latest).</span><span class="sxs-lookup"><span data-stu-id="28e96-199">Install [Azure CLI 2.0](/cli/azure/install-azure-cli?view=azure-cli-latest).</span></span>

3. <span data-ttu-id="28e96-200">Telepítse a [Azure építőelemeiről](https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks) npm-csomag.</span><span class="sxs-lookup"><span data-stu-id="28e96-200">Install the [Azure building blocks](https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks) npm package.</span></span>

   ```bash
   npm install -g @mspnp/azure-building-blocks
   ```

4. <span data-ttu-id="28e96-201">Parancsot a parancssorba bash-parancssorból vagy PowerShell-parancssorból, jelentkezzen be Azure-fiókjába a következő:</span><span class="sxs-lookup"><span data-stu-id="28e96-201">From a command prompt, bash prompt, or PowerShell prompt, sign into your Azure account as follows:</span></span>

   ```bash
   az login
   ```

### <a name="deploy-the-simulated-on-premises-datacenter"></a><span data-ttu-id="28e96-202">A szimulált helyszíni adatközpont üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="28e96-202">Deploy the simulated on-premises datacenter</span></span>

1. <span data-ttu-id="28e96-203">Keresse meg a `identity/adds-extend-domain` mappájában, a GitHub-adattárban.</span><span class="sxs-lookup"><span data-stu-id="28e96-203">Navigate to the `identity/adds-extend-domain` folder of the GitHub repository.</span></span>

2. <span data-ttu-id="28e96-204">Nyissa meg az `onprem.json` fájlt.</span><span class="sxs-lookup"><span data-stu-id="28e96-204">Open the `onprem.json` file.</span></span> <span data-ttu-id="28e96-205">Keresse meg példányait `adminPassword` és `Password` és adja meg a jelszavak adatait.</span><span class="sxs-lookup"><span data-stu-id="28e96-205">Search for instances of `adminPassword` and `Password` and add values for the passwords.</span></span>

3. <span data-ttu-id="28e96-206">Futtassa a következő parancsot, és várjon, amíg a telepítés befejezéséhez:</span><span class="sxs-lookup"><span data-stu-id="28e96-206">Run the following command and wait for the deployment to finish:</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource group> -l <location> -p onprem.json --deploy
    ```

### <a name="deploy-the-azure-vnet"></a><span data-ttu-id="28e96-207">Az Azure virtuális hálózat üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="28e96-207">Deploy the Azure VNet</span></span>

1. <span data-ttu-id="28e96-208">Nyissa meg az `azure.json` fájlt.</span><span class="sxs-lookup"><span data-stu-id="28e96-208">Open the `azure.json` file.</span></span>  <span data-ttu-id="28e96-209">Keresse meg példányait `adminPassword` és `Password` és adja meg a jelszavak adatait.</span><span class="sxs-lookup"><span data-stu-id="28e96-209">Search for instances of `adminPassword` and `Password` and add values for the passwords.</span></span>

2. <span data-ttu-id="28e96-210">Ugyanebben a fájlban keresse meg a példányok `sharedKey` , és adja meg a VPN-kapcsolat megosztott kulcsok.</span><span class="sxs-lookup"><span data-stu-id="28e96-210">In the same file, search for instances of `sharedKey` and enter shared keys for the VPN connection.</span></span>

    ```json
    "sharedKey": "",
    ```

3. <span data-ttu-id="28e96-211">Futtassa a következő parancsot, és várjon, amíg az üzembe helyezés befejeződik.</span><span class="sxs-lookup"><span data-stu-id="28e96-211">Run the following command and wait for the deployment to finish.</span></span>

    ```bash
    azbb -s <subscription_id> -g <resource group> -l <location> -p azure.json --deploy
    ```

   <span data-ttu-id="28e96-212">Telepítse a helyszíni virtuális hálózatnak ugyanabban az erőforráscsoportban.</span><span class="sxs-lookup"><span data-stu-id="28e96-212">Deploy to the same resource group as the on-premises VNet.</span></span>

### <a name="test-connectivity-with-the-azure-vnet"></a><span data-ttu-id="28e96-213">Az Azure virtuális hálózatok közötti kapcsolat tesztelése</span><span class="sxs-lookup"><span data-stu-id="28e96-213">Test connectivity with the Azure VNet</span></span>

<span data-ttu-id="28e96-214">Üzembe helyezés befejezése után tesztelheti conectivity a szimulált helyszíni környezetből az Azure vnetre.</span><span class="sxs-lookup"><span data-stu-id="28e96-214">After deployment completes, you can test conectivity from the simulated on-premises environment to the Azure VNet.</span></span>

1. <span data-ttu-id="28e96-215">Az Azure Portallal, keresse meg a létrehozott erőforráscsoportot.</span><span class="sxs-lookup"><span data-stu-id="28e96-215">Use the Azure portal, navigate to the resource group that you created.</span></span>

2. <span data-ttu-id="28e96-216">Keresse meg a virtuális gép nevű `ra-onpremise-mgmt-vm1`.</span><span class="sxs-lookup"><span data-stu-id="28e96-216">Find the VM named `ra-onpremise-mgmt-vm1`.</span></span>

3. <span data-ttu-id="28e96-217">Kattintson a `Connect` parancsra egy, a virtuális gépre irányuló távoli asztali munkamenet megnyitásához.</span><span class="sxs-lookup"><span data-stu-id="28e96-217">Click `Connect` to open a remote desktop session to the VM.</span></span> <span data-ttu-id="28e96-218">A felhasználónév `contoso\testuser`, és a jelszó pedig a megadott a `onprem.json` alkalmazásparaméter-fájlt.</span><span class="sxs-lookup"><span data-stu-id="28e96-218">The username is `contoso\testuser`, and the password is the one that you specified in the `onprem.json` parameter file.</span></span>

4. <span data-ttu-id="28e96-219">A belül a távoli asztali munkamenetet, nyissa meg egy másik távoli asztali munkamenetet címe: 10.0.4.4, amely az IP-címet a virtuális gép nevű `adds-vm1`.</span><span class="sxs-lookup"><span data-stu-id="28e96-219">From inside your remote desktop session, open another remote desktop session to 10.0.4.4, which is the IP address of the VM named `adds-vm1`.</span></span> <span data-ttu-id="28e96-220">A felhasználónév `contoso\testuser`, és a jelszó pedig a megadott a `azure.json` alkalmazásparaméter-fájlt.</span><span class="sxs-lookup"><span data-stu-id="28e96-220">The username is `contoso\testuser`, and the password is the one that you specified in the `azure.json` parameter file.</span></span>

5. <span data-ttu-id="28e96-221">A belül a távoli asztali munkamenetet `adds-vm1`, lépjen a **Kiszolgálókezelő** kattintson **további kezelendő kiszolgálók hozzáadása**.</span><span class="sxs-lookup"><span data-stu-id="28e96-221">From inside the remote desktop session for `adds-vm1`, go to **Server Manager** and click **Add other servers to manage**.</span></span>

6. <span data-ttu-id="28e96-222">Az a **Active Directory** lapra, majd **Keresés most**.</span><span class="sxs-lookup"><span data-stu-id="28e96-222">In the **Active Directory** tab, click **Find now**.</span></span> <span data-ttu-id="28e96-223">Megjelenik egy listáját az Active Directory, AD DS és a webes virtuális gépeket.</span><span class="sxs-lookup"><span data-stu-id="28e96-223">You should see a list of the AD, AD DS, and Web VMs.</span></span>

   ![Kiszolgálók hozzáadása párbeszédpanel képernyőképe](./images/add-servers-dialog.png)

## <a name="next-steps"></a><span data-ttu-id="28e96-225">További lépések</span><span class="sxs-lookup"><span data-stu-id="28e96-225">Next steps</span></span>

- <span data-ttu-id="28e96-226">Az Azure-beli [AD DS-erőforráserdő létrehozására][adds-resource-forest] vonatkozó ajánlott eljárások megismerése.</span><span class="sxs-lookup"><span data-stu-id="28e96-226">Learn the best practices for [creating an AD DS resource forest][adds-resource-forest] in Azure.</span></span>
- <span data-ttu-id="28e96-227">Az Azure-alapú [Active Directory Federation Services- (AD FS-) infrastruktúra létrehozására][adfs] vonatkozó ajánlott eljárások megismerése.</span><span class="sxs-lookup"><span data-stu-id="28e96-227">Learn the best practices for [creating an Active Directory Federation Services (AD FS) infrastructure][adfs] in Azure.</span></span>

<!-- links -->

[adds-resource-forest]: adds-forest.md
[adfs]: adfs.md
[azure-cli-2]: /azure/install-azure-cli
[azbb]: https://github.com/mspnp/template-building-blocks/wiki/Install-Azure-Building-Blocks
[implementing-a-secure-hybrid-network-architecture]: ../dmz/secure-vnet-hybrid.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ../dmz/secure-vnet-dmz.md

[adds-data-disks]: https://msdn.microsoft.com/library/mt674703.aspx
[ad-ds-operations-masters]: https://technet.microsoft.com/library/cc779716(v=ws.10).aspx
[ad-ds-ports]: https://technet.microsoft.com/library/dd772723(v=ws.11).aspx
[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azure-expressroute]: /azure/expressroute/expressroute-introduction
[azure-vpn-gateway]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[capacity-planning-for-adds]: https://social.technet.microsoft.com/wiki/contents/articles/14355.capacity-planning-for-active-directory-domain-services.aspx
[considerations]: ./considerations.md
[GitHub]: https://github.com/mspnp/identity-reference-architectures/tree/master/adds-extend-domain
[microsoft_systems_center]: https://www.microsoft.com/download/details.aspx?id=50013
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[security-considerations]: #security-considerations
[set-a-static-ip-address]: /azure/virtual-network/virtual-networks-static-private-ip-arm-pportal
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
[vm-windows-sizes]: /azure/virtual-machines/virtual-machines-windows-sizes

[0]: ./images/adds-extend-domain.png "Biztonságos hibrid hálózati architektúra az Active Directoryval"
