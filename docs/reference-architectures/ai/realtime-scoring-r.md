---
title: Machine Learning-modellek valós idejű pontozása
description: Egy valós idejű előrejelzési szolgáltatás megvalósítása az R, Machine Learning-kiszolgáló futtatása az Azure Kubernetes Service (AKS) használatával.
author: njray
ms.date: 12/12/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: 5f3cc62c81c9ef9e5c3c27b1d66badd3e481c228
ms.sourcegitcommit: 1a3cc91530d56731029ea091db1f15d41ac056af
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 04/03/2019
ms.locfileid: "58887845"
---
# <a name="real-time-scoring-of-r-machine-learning-models-on-azure"></a><span data-ttu-id="26993-103">Valós idejű pontozás a R machine learning modellek az Azure-ban</span><span class="sxs-lookup"><span data-stu-id="26993-103">Real-time scoring of R machine learning models on Azure</span></span>

<span data-ttu-id="26993-104">Ez a referenciaarchitektúra bemutatja, hogyan egy valós idejű (szinkron) előrejelzési szolgáltatás megvalósítása az R Microsoft Machine Learning-kiszolgáló futtatása az Azure Kubernetes Service (AKS) használatával.</span><span class="sxs-lookup"><span data-stu-id="26993-104">This reference architecture shows how to implement a real-time (synchronous) prediction service in R using Microsoft Machine Learning Server running in Azure Kubernetes Service (AKS).</span></span> <span data-ttu-id="26993-105">Ez az architektúra célja, hogy általános és bármely valós idejű szolgáltatásként telepíteni kívánt R beépített prediktív modell számára a megfelelő.</span><span class="sxs-lookup"><span data-stu-id="26993-105">This architecture is intended to be generic and suited for any predictive model built in R that you want to deploy as a real-time service.</span></span> <span data-ttu-id="26993-106">**[A megoldás üzembe helyezése][github]**.</span><span class="sxs-lookup"><span data-stu-id="26993-106">**[Deploy this solution][github]**.</span></span>

## <a name="architecture"></a><span data-ttu-id="26993-107">Architektúra</span><span class="sxs-lookup"><span data-stu-id="26993-107">Architecture</span></span>

![Valós idejű pontozás a R machine learning modellek az Azure-ban][0]

<span data-ttu-id="26993-109">Ez a referenciaarchitektúra egy tároló-alapú megközelítést vesz igénybe.</span><span class="sxs-lookup"><span data-stu-id="26993-109">This reference architecture takes a container-based approach.</span></span> <span data-ttu-id="26993-110">Egy Docker-rendszerkép összeállításakor tartalmazó R, valamint a különböző összetevők szükséges új adatok pontozása céljából.</span><span class="sxs-lookup"><span data-stu-id="26993-110">A Docker image is built containing R, as well as the various artifacts needed to score new data.</span></span> <span data-ttu-id="26993-111">Ezek közé tartozik a modellobjektumot, saját maga és a egy pontozószkriptre.</span><span class="sxs-lookup"><span data-stu-id="26993-111">These include the model object itself and a scoring script.</span></span> <span data-ttu-id="26993-112">Ez a rendszerkép Docker-tárolójegyzék az Azure-ban üzemeltetett, és ezután üzembe helyezett egy Kubernetes-fürthöz emellett az Azure-ban való leküldésekor.</span><span class="sxs-lookup"><span data-stu-id="26993-112">This image is pushed to a Docker registry hosted in Azure, and then deployed to a Kubernetes cluster, also in Azure.</span></span>

<span data-ttu-id="26993-113">Ez a munkafolyamat architektúrája a következő összetevőket tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="26993-113">The architecture of this workflow includes the following components.</span></span>

- <span data-ttu-id="26993-114">**[Az Azure Container Registry] [ acr]**  a munkafolyamat a képek tárolására szolgál.</span><span class="sxs-lookup"><span data-stu-id="26993-114">**[Azure Container Registry][acr]** is used to store the images for this workflow.</span></span> <span data-ttu-id="26993-115">A beállításjegyzékek tároló-beállításjegyzék létrehozása a standard keresztül kezelhetők [Docker Registry V2 API] [ docker] és az ügyfél.</span><span class="sxs-lookup"><span data-stu-id="26993-115">Registries created with Container Registry can be managed via the standard [Docker Registry V2 API][docker] and client.</span></span>

- <span data-ttu-id="26993-116">**[Az Azure Kubernetes Service] [ aks]**  az üzembe helyezés és a szolgáltatás futtatására szolgál.</span><span class="sxs-lookup"><span data-stu-id="26993-116">**[Azure Kubernetes Service][aks]** is used to host the deployment and service.</span></span> <span data-ttu-id="26993-117">A standard használatával létrehozott AKS kezelhetők [Kubernetes API-t] [ k-api] és az ügyfél (kubectl).</span><span class="sxs-lookup"><span data-stu-id="26993-117">Clusters created with AKS can be managed using the standard [Kubernetes API][k-api] and client (kubectl).</span></span>

- <span data-ttu-id="26993-118">**[Microsoft Machine Learning-kiszolgáló] [ mmls]**  a REST API, a szolgáltatás meghatározására szolgál, és tartalmazza a [modell Operacionalizálás][operationalization].</span><span class="sxs-lookup"><span data-stu-id="26993-118">**[Microsoft Machine Learning Server][mmls]** is used to define the REST API for the service and includes [Model Operationalization][operationalization].</span></span> <span data-ttu-id="26993-119">A szolgáltatásorientált web server folyamat figyeli a kéréseket, amely majd jussanak el a többi háttérfolyamatot, amely a tényleges, az eredmények R-kód.</span><span class="sxs-lookup"><span data-stu-id="26993-119">This service-oriented web server process listens for requests, which are then handed off to other background processes that run the actual R code to generate the results.</span></span> <span data-ttu-id="26993-120">Ezeket a folyamatokat ebben a konfigurációban egy tárolóba van csomagolva egyetlen csomópontján fut.</span><span class="sxs-lookup"><span data-stu-id="26993-120">All these processes run on a single node in this configuration, which is wrapped in a container.</span></span> <span data-ttu-id="26993-121">Ezen kívül olyan fejlesztési-tesztelési környezet szolgáltatás használatával kapcsolatos részletekért forduljon a Microsoft helyi képviselőjéhez.</span><span class="sxs-lookup"><span data-stu-id="26993-121">For details about using this service outside a dev or test environment, contact your Microsoft representative.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="26993-122">A teljesítménnyel kapcsolatos megfontolások</span><span class="sxs-lookup"><span data-stu-id="26993-122">Performance considerations</span></span>

<span data-ttu-id="26993-123">Machine learning számítási feladatok általában nagy számítási igényű egyaránt betanításakor, és amikor új adatok pontozása.</span><span class="sxs-lookup"><span data-stu-id="26993-123">Machine learning workloads tend to be compute-intensive, both when training and when scoring new data.</span></span> <span data-ttu-id="26993-124">Javasolt próbálja nem magonként egynél több pontozási folyamat futtatásához.</span><span class="sxs-lookup"><span data-stu-id="26993-124">As a rule of thumb, try not to run more than one scoring process per core.</span></span> <span data-ttu-id="26993-125">Machine Learning-kiszolgáló lehetővé teszi az egyes tárolókban futó R-folyamatok számának meghatározásához.</span><span class="sxs-lookup"><span data-stu-id="26993-125">Machine Learning Server lets you define the number of R processes running in each container.</span></span> <span data-ttu-id="26993-126">Az alapértelmezett érték öt folyamatokat.</span><span class="sxs-lookup"><span data-stu-id="26993-126">The default is five processes.</span></span> <span data-ttu-id="26993-127">Egy viszonylag egyszerű, például a változók kis számú, vagy egy kis döntési fa egy lineáris regressziós modell létrehozása során növelheti a folyamatok számát.</span><span class="sxs-lookup"><span data-stu-id="26993-127">When creating a relatively simple model, such as a linear regression with a small number of variables, or a small decision tree, you can increase the number of processes.</span></span> <span data-ttu-id="26993-128">Figyelheti a CPU-terhelést, a fürtcsomópontokon meghatározni a megfelelő, a tárolók számára vonatkozó határértéket.</span><span class="sxs-lookup"><span data-stu-id="26993-128">Monitor the CPU load on your cluster nodes to determine the appropriate limit on the number of containers.</span></span>

<span data-ttu-id="26993-129">A GPU-kompatibilis fürt felgyorsítható a számítási feladatok és deep learning-modellek elsősorban bizonyos típusú.</span><span class="sxs-lookup"><span data-stu-id="26993-129">A GPU-enabled cluster can speed up some types of workloads, and deep learning models in particular.</span></span> <span data-ttu-id="26993-130">Nem minden munkaterhelésről kihasználhatja a GPU-k &mdash; mátrixalgebra használatát csak azok, amelyek (nagy erőforrásigényű).</span><span class="sxs-lookup"><span data-stu-id="26993-130">Not all workloads can take advantage of GPUs &mdash; only those that make heavy use of matrix algebra.</span></span> <span data-ttu-id="26993-131">Például fa épülő modellekhez, beleértve a véletlenszerű erdők és a modellek, kiemelési általában származtatást nem használja ki a GPU-kkal.</span><span class="sxs-lookup"><span data-stu-id="26993-131">For example, tree-based models, including random forests and boosting models, generally derive no advantage from GPUs.</span></span>

<span data-ttu-id="26993-132">Néhány adatmodell-típusokat, például a véletlenszerű erdők olyan nagymértékben párhuzamosítható a processzorok.</span><span class="sxs-lookup"><span data-stu-id="26993-132">Some model types such as random forests are massively parallelizable on CPUs.</span></span> <span data-ttu-id="26993-133">Ezekben az esetekben gyorsabb a pontozás egyetlen kérelem több mag között osztja meg a munkaterhelést.</span><span class="sxs-lookup"><span data-stu-id="26993-133">In these cases, speed up the scoring of a single request by distributing the workload across multiple cores.</span></span> <span data-ttu-id="26993-134">Ezzel azonban így csökkenti a kapacitás a megadott rögzített fürtméret több pontozási kérelmek.</span><span class="sxs-lookup"><span data-stu-id="26993-134">However, doing so reduces your capacity to handle multiple scoring requests given a fixed cluster size.</span></span>

<span data-ttu-id="26993-135">Általában a nyílt forráskódú R-modellek a memóriában tárolja az összes az adatokat, ezért győződjön meg arról, hogy a csomópontok rendelkeznek-e elegendő memória a folyamatok egyidejű futtatását tervezi.</span><span class="sxs-lookup"><span data-stu-id="26993-135">In general, open-source R models store all their data in memory, so ensure that your nodes have enough memory to accommodate the processes you plan to run concurrently.</span></span> <span data-ttu-id="26993-136">Machine Learning-kiszolgáló használ a modellekhez, ha a lemezen lévő adatokat tud feldolgozni tár ahelyett, hogy olvasó, mind a memóriába.</span><span class="sxs-lookup"><span data-stu-id="26993-136">If you are using Machine Learning Server to fit your models, use the libraries that can process data on disk, rather than reading it all into memory.</span></span> <span data-ttu-id="26993-137">Ez segít jelentősen csökkentheti a memóriára vonatkozó követelményeknek.</span><span class="sxs-lookup"><span data-stu-id="26993-137">This can help reduce memory requirements significantly.</span></span> <span data-ttu-id="26993-138">Függetlenül attól, hogy azt használni, Machine Learning-kiszolgáló vagy a nyílt forráskódú R győződjön meg arról, hogy a pontozási folyamatokat nem memória-fogy ki a csomópontok figyelése.</span><span class="sxs-lookup"><span data-stu-id="26993-138">Regardless of whether you use Machine Learning Server or open-source R, monitor your nodes to ensure that your scoring processes are not memory-starved.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="26993-139">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="26993-139">Security considerations</span></span>

### <a name="network-encryption"></a><span data-ttu-id="26993-140">hálózati titkosítás</span><span class="sxs-lookup"><span data-stu-id="26993-140">Network encryption</span></span>

<span data-ttu-id="26993-141">Ez a referenciaarchitektúra HTTPS engedélyezve van a fürt és a egy átmeneti tanúsítvány való kommunikációhoz [hozzunk titkosítása] [ encrypt] szolgál.</span><span class="sxs-lookup"><span data-stu-id="26993-141">In this reference architecture, HTTPS is enabled for communication with the cluster, and a staging certificate from [Let’s Encrypt][encrypt] is used.</span></span> <span data-ttu-id="26993-142">Élesben helyettesítse be egy megfelelő aláíró jogosultságokat a saját tanúsítványt.</span><span class="sxs-lookup"><span data-stu-id="26993-142">For production purposes, substitute your own certificate from an appropriate signing authority.</span></span>

### <a name="authentication-and-authorization"></a><span data-ttu-id="26993-143">Hitelesítés és engedélyezés</span><span class="sxs-lookup"><span data-stu-id="26993-143">Authentication and authorization</span></span>

<span data-ttu-id="26993-144">A Machine Learning-kiszolgáló [modell Operacionalizálás] [ operationalization] pontozási kérelmek hitelesítése szükséges.</span><span class="sxs-lookup"><span data-stu-id="26993-144">Machine Learning Server [Model Operationalization][operationalization] requires scoring requests to be authenticated.</span></span> <span data-ttu-id="26993-145">Ebben a felállásban felhasználónevet és jelszót használják.</span><span class="sxs-lookup"><span data-stu-id="26993-145">In this deployment, a username and password are used.</span></span> <span data-ttu-id="26993-146">A vállalati környezetben való felépítésüktől, engedélyezheti a hitelesítés [Azure Active Directory] [ AAD] vagy hozzon létre egy külön előtér [Azure API Management] [ API].</span><span class="sxs-lookup"><span data-stu-id="26993-146">In an enterprise setting, you can enable authentication using [Azure Active Directory][AAD] or create a separate front end using [Azure API Management][API].</span></span>

<span data-ttu-id="26993-147">A modell Operacionalizálás tárolók a Machine Learning-kiszolgáló megfelelően működjenek telepítenie kell egy JSON webes jogkivonat (JWT) tanúsítványt.</span><span class="sxs-lookup"><span data-stu-id="26993-147">For Model Operationalization to work correctly with Machine Learning Server on containers, you must install a JSON Web Token (JWT) certificate.</span></span> <span data-ttu-id="26993-148">A központi telepítés egy Microsoft által biztosított tanúsítványt használ.</span><span class="sxs-lookup"><span data-stu-id="26993-148">This deployment uses a certificate supplied by Microsoft.</span></span> <span data-ttu-id="26993-149">Egy éles beállításban adja meg a saját.</span><span class="sxs-lookup"><span data-stu-id="26993-149">In a production setting, supply your own.</span></span>

<span data-ttu-id="26993-150">Container Registry és az AKS közötti forgalom esetén érdemes lehet engedélyezni az [szerepköralapú hozzáférés-vezérlés] [ rbac] (RBAC) hozzáférés korlátozható, ha csak a szükséges.</span><span class="sxs-lookup"><span data-stu-id="26993-150">For traffic between Container Registry and AKS, consider enabling [role-based access control][rbac] (RBAC) to limit access privileges to only those needed.</span></span>

### <a name="separate-storage"></a><span data-ttu-id="26993-151">Külön tárolási</span><span class="sxs-lookup"><span data-stu-id="26993-151">Separate storage</span></span>

<span data-ttu-id="26993-152">Ez a referenciaarchitektúra egy egyszeri lemezképpel az alkalmazás (R) és az adatokat (a modell objektum és a pontozó szkript) bundles.</span><span class="sxs-lookup"><span data-stu-id="26993-152">This reference architecture bundles the application (R) and the data (model object and scoring script) into a single image.</span></span> <span data-ttu-id="26993-153">Néhány esetben lehet előnyös, ha ezek egymástól.</span><span class="sxs-lookup"><span data-stu-id="26993-153">In some cases, it may be beneficial to separate these.</span></span> <span data-ttu-id="26993-154">Az Azure blob- vagy elhelyezhet a modell adatait és a kód [tárolási][storage], és kérheti le az azokat tároló inicializáláskor.</span><span class="sxs-lookup"><span data-stu-id="26993-154">You can place the model data and code into Azure blob or file [storage][storage], and retrieve them at container initialization.</span></span> <span data-ttu-id="26993-155">Ebben az esetben győződjön meg arról, hogy a tárfiók értéke csak hitelesített hozzáférést, és a HTTPS protokollt használjon.</span><span class="sxs-lookup"><span data-stu-id="26993-155">In this case, ensure that the storage account is set to allow authenticated access only and require HTTPS.</span></span>

## <a name="monitoring-and-logging-considerations"></a><span data-ttu-id="26993-156">Figyelés és naplózás kapcsolatos szempontok</span><span class="sxs-lookup"><span data-stu-id="26993-156">Monitoring and logging considerations</span></span>

<span data-ttu-id="26993-157">Használja a [Kubernetes-irányítópult] [ dashboard] figyelheti az AKS-fürt általános állapotát.</span><span class="sxs-lookup"><span data-stu-id="26993-157">Use the [Kubernetes dashboard][dashboard] to monitor the overall status of your AKS cluster.</span></span> <span data-ttu-id="26993-158">Tekintse meg a fürt áttekintés panel az Azure Portalon további részletekért.</span><span class="sxs-lookup"><span data-stu-id="26993-158">See the cluster’s overview blade in Azure portal for more details.</span></span> <span data-ttu-id="26993-159">A [GitHub] [ github] erőforrásokat is bemutatják, hogyan viszi, megjelenik az irányítópulton az R.</span><span class="sxs-lookup"><span data-stu-id="26993-159">The [GitHub][github] resources also show how to bring up the dashboard from R.</span></span>

<span data-ttu-id="26993-160">Az irányítópult áttekintést nyújt egy, a fürt általános állapotát, de fontos is az egyes tárolók állapotának nyomon követését.</span><span class="sxs-lookup"><span data-stu-id="26993-160">Although the dashboard gives you a view of the overall health of your cluster, it’s also important to track the status of individual containers.</span></span> <span data-ttu-id="26993-161">Ehhez engedélyezze [Azure Monitor Insights] [ monitor] az Azure Portalon, vagy tekintse meg a fürt áttekintés panelen [-tárolókhoz az Azure Monitor] [ monitor-containers](az előzetes verzió).</span><span class="sxs-lookup"><span data-stu-id="26993-161">To do this, enable [Azure Monitor Insights][monitor] from the cluster overview blade in Azure portal, or see [Azure Monitor for containers][monitor-containers] (in preview).</span></span>

## <a name="cost-considerations"></a><span data-ttu-id="26993-162">Költségekkel kapcsolatos szempontok</span><span class="sxs-lookup"><span data-stu-id="26993-162">Cost considerations</span></span>

<span data-ttu-id="26993-163">Machine Learning-kiszolgáló van licencelése magonként alapul, és a fürt felé, a Machine Learning-kiszolgáló száma futtatandó összes mag.</span><span class="sxs-lookup"><span data-stu-id="26993-163">Machine Learning Server is licensed on a per-core basis, and all the cores in the cluster that will run Machine Learning  Server count towards this.</span></span> <span data-ttu-id="26993-164">Ha egy vállalati Machine Learning-kiszolgáló vagy a Microsoft SQL Server-ügyfél, a díjszabás részleteiért lépjen kapcsolatba a Microsoft helyi képviselőjéhez.</span><span class="sxs-lookup"><span data-stu-id="26993-164">If you are an enterprise Machine Learning Server or Microsoft SQL Server customer, contact your Microsoft representative for pricing details.</span></span>

<span data-ttu-id="26993-165">A Machine Learning-kiszolgáló nyílt forráskódú alternatív [Plumber][plumber], az R-csomag, amely a kód egy REST API-bA.</span><span class="sxs-lookup"><span data-stu-id="26993-165">An open-source alternative to Machine Learning Server is [Plumber][plumber], an R package that turns your code into a REST API.</span></span> <span data-ttu-id="26993-166">Plumber teljes kevesebb, mint a Machine Learning-kiszolgáló megjelent.</span><span class="sxs-lookup"><span data-stu-id="26993-166">Plumber is less fully featured than Machine Learning Server.</span></span> <span data-ttu-id="26993-167">Például alapértelmezés szerint azt a szolgáltatásokat, adja meg a hitelesítési kérelem nem tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="26993-167">For example, by default it doesn't include any features that provide request authentication.</span></span> <span data-ttu-id="26993-168">Ha Plumber használ, javasoljuk, hogy engedélyezze [Azure API Management] [ API] hitelesítési részletek kezeléséhez.</span><span class="sxs-lookup"><span data-stu-id="26993-168">If you use Plumber, it’s recommended that you enable [Azure API Management][API] to handle authentication details.</span></span>

<span data-ttu-id="26993-169">Mellett licencelés, a fő szempont költsége a Kubernetes-fürt számítási erőforrásokat.</span><span class="sxs-lookup"><span data-stu-id="26993-169">Besides licensing, the main cost consideration is the Kubernetes cluster's compute resources.</span></span> <span data-ttu-id="26993-170">A fürt elég nagynak kell lennie kezelni a várt kötet időszakokban, de ez a megközelítés hagyja erőforrások üresjárati más időpontban.</span><span class="sxs-lookup"><span data-stu-id="26993-170">The cluster must be large enough to handle the expected request volume at peak times, but this approach leaves resources idle at other times.</span></span> <span data-ttu-id="26993-171">Korlátozni az erőforrások üresjáratának hatását, engedélyezze a [vízszintes méretező] [ autoscaler] a fürthöz a kubectl eszközzel.</span><span class="sxs-lookup"><span data-stu-id="26993-171">To limit the impact of idle resources, enable the [horizontal autoscaler][autoscaler] for the cluster using the kubectl tool.</span></span> <span data-ttu-id="26993-172">Vagy használja az AKS [méretező fürt][cluster-autoscaler].</span><span class="sxs-lookup"><span data-stu-id="26993-172">Or use the AKS [cluster autoscaler][cluster-autoscaler].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="26993-173">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="26993-173">Deploy the solution</span></span>

<span data-ttu-id="26993-174">A referenciaimplementációt a jelen architektúra érhető el az [GitHub][github].</span><span class="sxs-lookup"><span data-stu-id="26993-174">The reference implementation of this architecture is available on [GitHub][github].</span></span> <span data-ttu-id="26993-175">Egy egyszerű prediktív modellen szolgáltatás telepítése nem ismertetett lépéseket követve.</span><span class="sxs-lookup"><span data-stu-id="26993-175">Follow the steps described there to deploy a simple predictive model as a service.</span></span>

<!-- links -->
[AAD]: /azure/active-directory/fundamentals/active-directory-whatis
[API]: /azure/api-management/api-management-key-concepts
[ACR]: /azure/container-registry/container-registry-intro
[AKS]: /azure/aks/intro-kubernetes
[autoscaler]: https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/
[cluster-autoscaler]: /azure/aks/autoscaler
[monitor]: /azure/monitoring/monitoring-container-insights-overview
[dashboard]: /azure/aks/kubernetes-dashboard
[docker]: https://docs.docker.com/registry/spec/api/
[encrypt]: https://letsencrypt.org/
[gitHub]: https://github.com/Azure/RealtimeRDeployment
[K-API]: https://kubernetes.io/docs/reference/
[MMLS]: /machine-learning-server/what-is-machine-learning-server
[monitor-containers]: /azure/azure-monitor/insights/container-insights-overview
[operationalization]: /machine-learning-server/what-is-operationalization
[plumber]: https://www.rplumber.io
[RBAC]: /azure/role-based-access-control/overview
[storage]: /azure/storage/common/storage-introduction
[0]: ./_images/realtime-scoring-r.png
