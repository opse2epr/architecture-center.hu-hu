---
title: A mélytanulási modellek kötegelt kiértékelése
titleSuffix: Azure Reference Architectures
description: Ez a referenciaarchitektúra bemutatja, hogyan Neurális stílus átviteli alkalmazandó egy videót, az Azure Batch AI segítségével.
author: jiata
ms.date: 10/02/2018
ms.custom: azcat-ai
ms.openlocfilehash: 0396903a39d00a4131df65872a63f4b3fde8dce7
ms.sourcegitcommit: 88a68c7e9b6b772172b7faa4b9fd9c061a9f7e9d
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 12/08/2018
ms.locfileid: "53119880"
---
# <a name="batch-scoring-on-azure-for-deep-learning-models"></a><span data-ttu-id="8b196-103">Kötegelt pontozási az Azure-on deep learning-modellek</span><span class="sxs-lookup"><span data-stu-id="8b196-103">Batch scoring on Azure for deep learning models</span></span>

<span data-ttu-id="8b196-104">Ez a referenciaarchitektúra bemutatja, hogyan Neurális stílus átviteli alkalmazandó egy videót, az Azure Batch AI segítségével.</span><span class="sxs-lookup"><span data-stu-id="8b196-104">This reference architecture shows how to apply neural style transfer to a video, using Azure Batch AI.</span></span> <span data-ttu-id="8b196-105">*Átviteli stílus* deep learning-módszer, amely egy másik képet stílusát egy meglévő kép composes.</span><span class="sxs-lookup"><span data-stu-id="8b196-105">*Style transfer* is a deep learning technique that composes an existing image in the style of another image.</span></span> <span data-ttu-id="8b196-106">Ez az architektúra bármilyen forgatókönyvhöz kötegelt pontozási használatával deep learninget használó is általánosítva.</span><span class="sxs-lookup"><span data-stu-id="8b196-106">This architecture can be generalized for any scenario that uses batch scoring with deep learning.</span></span> <span data-ttu-id="8b196-107">[**A megoldás üzembe helyezése.**](#deploy-the-solution)</span><span class="sxs-lookup"><span data-stu-id="8b196-107">[**Deploy this solution**](#deploy-the-solution).</span></span>

![Az Azure Batch AI segítségével mély tanulási modelleket architektúra diagramja](./_images/batch-ai-deep-learning.png)

<span data-ttu-id="8b196-109">**A forgatókönyv**: A media szervezete egy videót, amelynek stílusát, így jelenik meg szeretne, például egy adott festmény.</span><span class="sxs-lookup"><span data-stu-id="8b196-109">**Scenario**: A media organization has a video whose style they want to change to look like a specific painting.</span></span> <span data-ttu-id="8b196-110">A szervezet szeretne tudni a stílus alkalmazása időben, és automatizált módon zajlik a videó minden keretet.</span><span class="sxs-lookup"><span data-stu-id="8b196-110">The organization wants to be able to apply this style to all frames of the video in a timely manner and in an automated fashion.</span></span> <span data-ttu-id="8b196-111">További ismereteket a Neurális stílus átviteli algoritmusok, lásd: [kép stílus átvitel használata Konvolúciós Neurális hálózatokkal] [ image-style-transfer] (PDF).</span><span class="sxs-lookup"><span data-stu-id="8b196-111">For more background about neural style transfer algorithms, see [Image Style Transfer Using Convolutional Neural Networks][image-style-transfer] (PDF).</span></span>

| <span data-ttu-id="8b196-112">Style-lemezképet:</span><span class="sxs-lookup"><span data-stu-id="8b196-112">Style image:</span></span> | <span data-ttu-id="8b196-113">A videó bemeneti/tartalom:</span><span class="sxs-lookup"><span data-stu-id="8b196-113">Input/content video:</span></span> | <span data-ttu-id="8b196-114">Kimeneti videót:</span><span class="sxs-lookup"><span data-stu-id="8b196-114">Output video:</span></span> |
|--------|--------|---------|
| <img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/style_image.jpg" width="300"> | <span data-ttu-id="8b196-115">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video.mp4 "A videó bemeneti") *kattintson ide a megtekintéshez videó*</span><span class="sxs-lookup"><span data-stu-id="8b196-115">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/input_video.mp4 "Input Video") *click to view video*</span></span> | <span data-ttu-id="8b196-116">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video.mp4 "A videó kimeneti") *kattintson ide a megtekintéshez videó*</span><span class="sxs-lookup"><span data-stu-id="8b196-116">[<img src="https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video_image_0.jpg" width="300" height="300">](https://happypathspublic.blob.core.windows.net/assets/batch_scoring_for_dl/output_video.mp4 "Output Video") *click to view video*</span></span> |

<span data-ttu-id="8b196-117">Ez a referenciaarchitektúra a számítási feladatokat az Azure storage-ban új adathordozó jelenléte által aktivált lett tervezve.</span><span class="sxs-lookup"><span data-stu-id="8b196-117">This reference architecture is designed for workloads that are triggered by the presence of new media in Azure storage.</span></span> <span data-ttu-id="8b196-118">Feldolgozás az alábbi lépésekből áll:</span><span class="sxs-lookup"><span data-stu-id="8b196-118">Processing involves the following steps:</span></span>

1. <span data-ttu-id="8b196-119">Töltsön fel egy kijelölt stílus képet (például egy Van Gogh festmény) és a egy stílust parancsfájl átvitele a Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="8b196-119">Upload a selected style image (like a Van Gogh painting) and a style transfer script to Blob Storage.</span></span>
1. <span data-ttu-id="8b196-120">Hozzon létre egy automatikus skálázást egy Batch AI-fürtöt, amely megkezdheti a munkát véve.</span><span class="sxs-lookup"><span data-stu-id="8b196-120">Create an autoscaling Batch AI cluster that is ready to start taking work.</span></span>
1. <span data-ttu-id="8b196-121">Ossza fel a videófájlt egyes keretek, és azokat bármely feltöltése a Blob Storage-bA.</span><span class="sxs-lookup"><span data-stu-id="8b196-121">Split the video file into individual frames and upload those frames into Blob Storage.</span></span>
1. <span data-ttu-id="8b196-122">Az összes keretek feltöltése után eseményindító fájl feltöltése a Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="8b196-122">Once all frames are uploaded, upload a trigger file to Blob Storage.</span></span>
1. <span data-ttu-id="8b196-123">Ez a fájl egy logikai alkalmazást, amely létrehoz egy tárolót az Azure Container Instances szolgáltatásban futó aktivál.</span><span class="sxs-lookup"><span data-stu-id="8b196-123">This file triggers a Logic App that creates a container running in Azure Container Instances.</span></span>
1. <span data-ttu-id="8b196-124">A tároló fut egy parancsfájl, amely a Batch AI-feladatot hoz létre.</span><span class="sxs-lookup"><span data-stu-id="8b196-124">The container runs a script that creates the Batch AI jobs.</span></span> <span data-ttu-id="8b196-125">Minden egyes feladat a Neurális stílus átviteli párhuzamosan a Batch AI-fürt csomópontjai között vonatkozik.</span><span class="sxs-lookup"><span data-stu-id="8b196-125">Each job applies the neural style transfer in parallel across the nodes of the Batch AI cluster.</span></span>
1. <span data-ttu-id="8b196-126">Miután a képek jönnek létre, a rendszer menti a Blob Storage-ba való.</span><span class="sxs-lookup"><span data-stu-id="8b196-126">Once the images are generated, they are saved back to Blob Storage.</span></span>
1. <span data-ttu-id="8b196-127">Töltse le a létrehozott keretek, és vissza a képek, videó több.</span><span class="sxs-lookup"><span data-stu-id="8b196-127">Download the generated frames, and stitch back the images into a video.</span></span>

## <a name="architecture"></a><span data-ttu-id="8b196-128">Architektúra</span><span class="sxs-lookup"><span data-stu-id="8b196-128">Architecture</span></span>

<span data-ttu-id="8b196-129">Ez az architektúra a következő összetevőkből áll.</span><span class="sxs-lookup"><span data-stu-id="8b196-129">This architecture consists of the following components.</span></span>

### <a name="compute"></a><span data-ttu-id="8b196-130">Compute</span><span class="sxs-lookup"><span data-stu-id="8b196-130">Compute</span></span>

<span data-ttu-id="8b196-131">**[Az Azure Batch AI] [ batch-ai]**  a Neurális stílus átviteli algoritmus futtatására szolgál.</span><span class="sxs-lookup"><span data-stu-id="8b196-131">**[Azure Batch AI][batch-ai]** is used to run the neural style transfer algorithm.</span></span> <span data-ttu-id="8b196-132">A Batch AI támogatja a deep learning számítási feladatok azáltal, hogy előre konfigurált deep learning keretrendszerek GPU-kompatibilis virtuális gépeken a tárolóalapú környezetekben.</span><span class="sxs-lookup"><span data-stu-id="8b196-132">Batch AI supports deep learning workloads by providing containerized environments that are pre-configured for deep learning frameworks, on GPU-enabled VMs.</span></span> <span data-ttu-id="8b196-133">A Batch AI a számítási fürt is csatlakozhat a Blob storage.</span><span class="sxs-lookup"><span data-stu-id="8b196-133">Batch AI can also connect the compute cluster to Blob storage.</span></span>

### <a name="storage"></a><span data-ttu-id="8b196-134">Storage</span><span class="sxs-lookup"><span data-stu-id="8b196-134">Storage</span></span>

<span data-ttu-id="8b196-135">**[A BLOB storage-] [ blob-storage]**  tárolására szolgál az összes rendszerkép (a bemeneti képekhez, a stílus lemezképek és a kimeneti képek), a Batch AI előállított továbbá naplókat.</span><span class="sxs-lookup"><span data-stu-id="8b196-135">**[Blob storage][blob-storage]** is used to store all images (input images, style images, and output images) as well as all logs produced from Batch AI.</span></span> <span data-ttu-id="8b196-136">A Batch AI segítségével integrálja a BLOB storage [blobfuse][blobfuse], egy nyílt forráskódú virtuális fájlrendszer, amely a Blob storage használatával.</span><span class="sxs-lookup"><span data-stu-id="8b196-136">Blob storage integrates with Batch AI via [blobfuse][blobfuse], an open-source virtual filesystem that is backed by Blob storage.</span></span> <span data-ttu-id="8b196-137">A BLOB storage akkor is, amely a számítási feladat igényli a teljesítmény rendkívül költséghatékony.</span><span class="sxs-lookup"><span data-stu-id="8b196-137">Blob storage is also very cost-effective for the performance that this workload requires.</span></span>

### <a name="trigger--scheduling"></a><span data-ttu-id="8b196-138">Trigger / ütemezése</span><span class="sxs-lookup"><span data-stu-id="8b196-138">Trigger / scheduling</span></span>

<span data-ttu-id="8b196-139">**[Az Azure Logic Apps] [ logic-apps]**  a munkafolyamat elindítására szolgál.</span><span class="sxs-lookup"><span data-stu-id="8b196-139">**[Azure Logic Apps][logic-apps]** is used to trigger the workflow.</span></span> <span data-ttu-id="8b196-140">Amikor a logikai alkalmazás észleli, hogy hozzáadta-e egy blobot a tárolóhoz, a Batch AI-folyamat elindítja.</span><span class="sxs-lookup"><span data-stu-id="8b196-140">When the Logic App detects that a blob has been added to the container, it triggers the Batch AI process.</span></span> <span data-ttu-id="8b196-141">A Logic Apps egy jó észleli a módosításokat a blob storage-ban könnyedén, mert ez a referenciaarchitektúra alkalmas, és egy egyszerű folyamatot biztosít az eseményindító módosítása.</span><span class="sxs-lookup"><span data-stu-id="8b196-141">Logic Apps is a good fit for this reference architecture because it's an easy way to detect changes to blob storage and provides an easy process for changing the trigger.</span></span>

<span data-ttu-id="8b196-142">**[Az Azure Container Instances] [ container-instances]**  , amely a Batch AI-feladatok létrehozása a Python-szkriptek futtatására szolgál.</span><span class="sxs-lookup"><span data-stu-id="8b196-142">**[Azure Container Instances][container-instances]** is used to run the Python scripts that create the Batch AI jobs.</span></span> <span data-ttu-id="8b196-143">Ezek a szkriptek egy Docker-tárolóban futó kényelmes módja a igény szerinti futtatásához.</span><span class="sxs-lookup"><span data-stu-id="8b196-143">Running these scripts inside a Docker container is a convenient way to run them on demand.</span></span> <span data-ttu-id="8b196-144">Ebben az architektúrában használ Container Instances, mert egy előre elkészített logikai alkalmazás-összekötő, amely lehetővé teszi, hogy a logikai alkalmazás aktiválásához a Batch AI-feladat.</span><span class="sxs-lookup"><span data-stu-id="8b196-144">For this architecture, we use Container Instances because there is a pre-built Logic App connector for it, which allows the Logic App to trigger the Batch AI job.</span></span> <span data-ttu-id="8b196-145">Container Instances szolgáltatásban hozhatók létre újabb webpéldányok be állapot nélküli folyamatok gyors.</span><span class="sxs-lookup"><span data-stu-id="8b196-145">Container Instances can spin up stateless processes quickly.</span></span>

<span data-ttu-id="8b196-146">**[DockerHub] [ dockerhub]**  tárolja a Docker-rendszerképet, amely a Container Instances segítségével hajtsa végre a feladat létrehozását.</span><span class="sxs-lookup"><span data-stu-id="8b196-146">**[DockerHub][dockerhub]** is used to store the Docker image that Container Instances uses to execute the job creation process.</span></span> <span data-ttu-id="8b196-147">Az architektúra DockerHub választott, mert könnyen használható és az alapértelmezett lemezkép adattár a Docker-felhasználók.</span><span class="sxs-lookup"><span data-stu-id="8b196-147">DockerHub was chosen for this architecture because it's easy to use and is the default image repository for Docker users.</span></span> <span data-ttu-id="8b196-148">[Az Azure Container Registry] [ container-registry] is használható.</span><span class="sxs-lookup"><span data-stu-id="8b196-148">[Azure Container Registry][container-registry] can also be used.</span></span>

### <a name="data-preparation"></a><span data-ttu-id="8b196-149">Adatok előkészítése</span><span class="sxs-lookup"><span data-stu-id="8b196-149">Data preparation</span></span>

<span data-ttu-id="8b196-150">Ez a referenciaarchitektúra egy fa a Képanyag-orangutan használja.</span><span class="sxs-lookup"><span data-stu-id="8b196-150">This reference architecture uses video footage of an orangutan in a tree.</span></span> <span data-ttu-id="8b196-151">Letöltheti a Képanyag a [Itt] [ source-video] és feldolgozása a munkafolyamat az alábbi lépéseket:</span><span class="sxs-lookup"><span data-stu-id="8b196-151">You can download the footage from [here][source-video] and process it for the workflow by following these steps:</span></span>

1. <span data-ttu-id="8b196-152">Használat [AzCopy] [ azcopy] töltheti le a videót a nyilvános blob.</span><span class="sxs-lookup"><span data-stu-id="8b196-152">Use [AzCopy][azcopy] to download the video from the public blob.</span></span>
2. <span data-ttu-id="8b196-153">Használat [FFmpeg] [ ffmpeg] csomagolnia hang, úgy, hogy a hangfájl is lehet stitched a kimeneti videót be újra később.</span><span class="sxs-lookup"><span data-stu-id="8b196-153">Use [FFmpeg][ffmpeg] to extract the audio file, so that the audio file can be stitched back into the output video later.</span></span>
3. <span data-ttu-id="8b196-154">A videó felosztása egyes keretek a FFmpeg segítségével.</span><span class="sxs-lookup"><span data-stu-id="8b196-154">Use FFmpeg to break the video into individual frames.</span></span> <span data-ttu-id="8b196-155">A keretek egymástól függetlenül, párhuzamosan kerül feldolgozásra.</span><span class="sxs-lookup"><span data-stu-id="8b196-155">The frames will be processed independently, in parallel.</span></span>
4. <span data-ttu-id="8b196-156">Az AzCopy használatával az egyes keretek másolhatja a blobtárolóba.</span><span class="sxs-lookup"><span data-stu-id="8b196-156">Use AzCopy to copy the individual frames into your blob container.</span></span>

<span data-ttu-id="8b196-157">Ezen a ponton a videoanyagokat Neurális stílus adatátvitelhez használható formátumban van.</span><span class="sxs-lookup"><span data-stu-id="8b196-157">At this stage, the video footage is in a form that can be used for neural style transfer.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="8b196-158">A teljesítménnyel kapcsolatos megfontolások</span><span class="sxs-lookup"><span data-stu-id="8b196-158">Performance considerations</span></span>

### <a name="gpu-vs-cpu"></a><span data-ttu-id="8b196-159">GPU-és CPU</span><span class="sxs-lookup"><span data-stu-id="8b196-159">GPU vs CPU</span></span>

<span data-ttu-id="8b196-160">A deep learning számítási feladatokhoz gpu-k általánosan élekről végez, és processzorokat sávszélességétől, az processzorok marketingre fürt általában szükség hasonló teljesítmény eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="8b196-160">For deep learning workloads, GPUs will generally out-perform CPUs by a considerable amount, to the extent that a sizeable cluster of CPUs is usually needed to get comparable performance.</span></span> <span data-ttu-id="8b196-161">Bár a lehetőség csak processzorokat használata ebben az architektúrában, gpu-k egy sokkal jobb költség/teljesítmény profilt biztosít.</span><span class="sxs-lookup"><span data-stu-id="8b196-161">While it's an option to use only CPUs in this architecture, GPUs will provide a much better cost/performance profile.</span></span> <span data-ttu-id="8b196-162">Azt javasoljuk, hogy a legújabb [NCv3 sorozat] virtuálisgép-méretek – gpu használatával GPU-optimalizált virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="8b196-162">We recommend using the latest [NCv3 series]vm-sizes-gpu of GPU optimized VMs.</span></span>

<span data-ttu-id="8b196-163">Az összes régióban alapértelmezés szerint nem engedélyezettek a GPU-kkal.</span><span class="sxs-lookup"><span data-stu-id="8b196-163">GPUs are not enabled by default in all regions.</span></span> <span data-ttu-id="8b196-164">Ellenőrizze, hogy válasszon ki egy régiót a GPU-k engedélyezve van.</span><span class="sxs-lookup"><span data-stu-id="8b196-164">Make sure to select a region with GPUs enabled.</span></span> <span data-ttu-id="8b196-165">Emellett az előfizetések nulla magok alapértelmezett kvóta tartozik GPU-optimalizált virtuális gépek számára.</span><span class="sxs-lookup"><span data-stu-id="8b196-165">In addition, subscriptions have a default quota of zero cores for GPU-optimized VMs.</span></span> <span data-ttu-id="8b196-166">Nyissa meg a támogatási kérelmet a kvóta is növelheti.</span><span class="sxs-lookup"><span data-stu-id="8b196-166">You can raise this quota by opening a support request.</span></span> <span data-ttu-id="8b196-167">Győződjön meg arról, hogy előfizetése rendelkezik-e elegendő kvótával a számítási feladatok futtatásához.</span><span class="sxs-lookup"><span data-stu-id="8b196-167">Make sure that your subscription has enough quota to run your workload.</span></span>

### <a name="parallelizing-across-vms-vs-cores"></a><span data-ttu-id="8b196-168">Virtuális gépek és magok közötti párhuzamosan futtatni</span><span class="sxs-lookup"><span data-stu-id="8b196-168">Parallelizing across VMs vs cores</span></span>

<span data-ttu-id="8b196-169">Batch-feladat egy stílust átviteli folyamat fut, amikor a feladatok elsősorban a GPU-n futó virtuális gépek között méretezésnek megfelelően kell.</span><span class="sxs-lookup"><span data-stu-id="8b196-169">When running a style transfer process as a batch job, the jobs that run primarily on GPUs will have to be parallelized across VMs.</span></span> <span data-ttu-id="8b196-170">Két módszer lehetségesek: egyetlen GPU rendelkező virtuális gépeken nagyobb méretű fürtöt létrehozni, vagy hozzon létre egy kisebb fürtöt használó virtuális gépek sok gpu-kkal.</span><span class="sxs-lookup"><span data-stu-id="8b196-170">Two approaches are possible: You can create a larger cluster using VMs that have a single GPU, or create a smaller cluster using VMs with many GPUs.</span></span>

<span data-ttu-id="8b196-171">Ilyen számítási feladatok esetében két lesz hasonló teljesítményt.</span><span class="sxs-lookup"><span data-stu-id="8b196-171">For this workload, these two options will have comparable performance.</span></span> <span data-ttu-id="8b196-172">Virtuális gépenként több gpu-kkal kevesebb virtuális gépek használatával segíthet csökkenteni az adatok áthelyezését.</span><span class="sxs-lookup"><span data-stu-id="8b196-172">Using fewer VMs with more GPUs per VM can help to reduce data movement.</span></span> <span data-ttu-id="8b196-173">A számítási feladatonként adatmennyiség viszont nem nagyon nagy, ezért nem vizsgálja meg, mennyi szabályozás blob Storage.</span><span class="sxs-lookup"><span data-stu-id="8b196-173">However, the data volume per job for this workload is not very big, so you won't observe much throttling by blob storage.</span></span>

### <a name="images-batch-size-per-batch-ai-job"></a><span data-ttu-id="8b196-174">Képek kötegméret a Batch AI feladatonként</span><span class="sxs-lookup"><span data-stu-id="8b196-174">Images batch size per Batch AI job</span></span>

<span data-ttu-id="8b196-175">Egy másik, amelyet be kell állítani paramétere a Batch AI feladatonként feldolgozni képek számát.</span><span class="sxs-lookup"><span data-stu-id="8b196-175">Another parameter that must be configured is the number of images to process per Batch AI job.</span></span> <span data-ttu-id="8b196-176">Másrészről szeretné győződjön meg arról, hogy munkahelyi széles körben között megoszlik a csomópontok és, hogy ha egy feladat sikertelen volt, nem kell újra túl sok lemezképek.</span><span class="sxs-lookup"><span data-stu-id="8b196-176">On the one hand, you want to ensure that work is spread broadly across the nodes and that if a job fails, you don't have to retry too many images.</span></span> <span data-ttu-id="8b196-177">Több Batch AI-feladatok, és így feladatonként feldolgozni lemezképek száma kevés, amely mutat.</span><span class="sxs-lookup"><span data-stu-id="8b196-177">That points to having many Batch AI jobs and thus a low number of images to process per job.</span></span> <span data-ttu-id="8b196-178">Másrészről Ha túl kevés lemezképek feladatonként feldolgozása, a telepítő/indítási idejének válik aránytalanul nagy.</span><span class="sxs-lookup"><span data-stu-id="8b196-178">On the other hand, if too few images are processed per job, the setup/startup time becomes disproportionately large.</span></span> <span data-ttu-id="8b196-179">Beállíthatja, hogy a fürtben található csomópontok maximális száma egyenlő feladatok számát.</span><span class="sxs-lookup"><span data-stu-id="8b196-179">You can set the number of jobs to equal the maximum number of nodes in the cluster.</span></span> <span data-ttu-id="8b196-180">Ez lesz a legjobb teljesítménnyel rendelkezőt feltételezve, hogy nincs feladat nem sikerült, mert minimalizálja a telepítő/indítási költséget.</span><span class="sxs-lookup"><span data-stu-id="8b196-180">This will be the most performant assuming that no jobs fail, because it minimizes the amount of setup/startup cost.</span></span> <span data-ttu-id="8b196-181">Előfordulhat azonban, ha egy feladat sikertelen volt, egy képeket nagy számú kell futását újra.</span><span class="sxs-lookup"><span data-stu-id="8b196-181">However, if a job fails, a large number of images might need to be reprocessed.</span></span>

### <a name="file-servers"></a><span data-ttu-id="8b196-182">Fájlkiszolgálók</span><span class="sxs-lookup"><span data-stu-id="8b196-182">File servers</span></span>

<span data-ttu-id="8b196-183">Batch AI használata esetén kiválaszthatja a forgatókönyvhöz szükséges átviteli függően többféle tárolási lehetőség.</span><span class="sxs-lookup"><span data-stu-id="8b196-183">When using Batch AI, you can choose multiple storage options depending on the throughput needed for your scenario.</span></span> <span data-ttu-id="8b196-184">Az alacsony átviteli sebességet megkövetelő számítási feladatokhoz (keresztül blobfuse) a blob storage-dzsal legyen elegendő.</span><span class="sxs-lookup"><span data-stu-id="8b196-184">For workloads with low throughput requirements, using blob storage (via blobfuse) should be enough.</span></span> <span data-ttu-id="8b196-185">Azt is megteheti a Batch AI is támogatja a Batch AI-fájlkiszolgáló, egy felügyelt egycsomópontos NFS, amely a feladatok egy központilag elérhető tárhelyet biztosít a fürtcsomópontokon automatikusan csatlakoztathatók.</span><span class="sxs-lookup"><span data-stu-id="8b196-185">Alternatively, Batch AI also supports a Batch AI File Server, a managed single-node NFS, which can be automatically mounted on cluster nodes to provide a centrally accessible storage location for jobs.</span></span> <span data-ttu-id="8b196-186">A legtöbb esetben csak egy fájlkiszolgáló van szükség a munkaterületen, és meg is szét az adatokat a betanítási feladatokhoz más könyvtárban.</span><span class="sxs-lookup"><span data-stu-id="8b196-186">For most cases, only one file server is needed in a workspace, and you can separate data for your training jobs into different directories.</span></span> <span data-ttu-id="8b196-187">Ha egy egycsomópontos NFS nem megfelelő, a számítási feladatokhoz, Batch AI támogatja a más tárolási lehetőségeket, beleértve az Azure Files és az egyéni megoldások, például egy Gluster vagy Lustre fájlrendszer.</span><span class="sxs-lookup"><span data-stu-id="8b196-187">If a single-node NFS isn't appropriate for your workloads, Batch AI supports other storage options, including Azure Files or custom solutions such as a Gluster or Lustre file system.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="8b196-188">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="8b196-188">Security considerations</span></span>

### <a name="restricting-access-to-azure-blob-storage"></a><span data-ttu-id="8b196-189">Az Azure blob storage-ba való hozzáférés korlátozása</span><span class="sxs-lookup"><span data-stu-id="8b196-189">Restricting access to Azure blob storage</span></span>

<span data-ttu-id="8b196-190">Ez a referenciaarchitektúra az Azure blob storage a fő tárolási összetevő, amely a védendő.</span><span class="sxs-lookup"><span data-stu-id="8b196-190">In this reference architecture, Azure blob storage is the main storage component that needs to be protected.</span></span> <span data-ttu-id="8b196-191">A GitHub-adattárat látható az alapkonfigurációk azon központi telepítését tárfiókkulcsok segítségével a blobtároló eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="8b196-191">The baseline deployment shown in the GitHub repo uses storage account keys to access the blob storage.</span></span> <span data-ttu-id="8b196-192">További ellenőrzésére és védelmére fontolja meg egy közös hozzáférésű jogosultságkód (SAS) helyett.</span><span class="sxs-lookup"><span data-stu-id="8b196-192">For further control and protection, consider using a shared access signature (SAS) instead.</span></span> <span data-ttu-id="8b196-193">Ez a tároló objektumok korlátozott hozzáférést biztosít a anélkül, hogy keményen a fiókkulcsok code, vagy egyszerű szövegként menti.</span><span class="sxs-lookup"><span data-stu-id="8b196-193">This grants limited access to objects in storage, without needing to hard code the account keys or save them in plaintext.</span></span> <span data-ttu-id="8b196-194">Ez a módszer különösen hasznos, mert fiókkulcsok láthatók a sima szöveges Logic App Tervező felületen belül.</span><span class="sxs-lookup"><span data-stu-id="8b196-194">This approach is especially useful because account keys are visible in plaintext inside of Logic App's designer interface.</span></span> <span data-ttu-id="8b196-195">SAS használatával is biztosítható, hogy a tárfiók rendelkezik a megfelelő irányítás, és, hogy célja, hogy hozzáférhessenek a mobileszközeiken csak a személyeknek.</span><span class="sxs-lookup"><span data-stu-id="8b196-195">Using an SAS also helps to ensure that the storage account has proper governance, and that access is granted only to the people intended to have it.</span></span>

<span data-ttu-id="8b196-196">Forgatókönyvek a több bizalmas adatok győződjön meg arról, hogy a kulcsok összes védettek, mivel ezek a kulcsok teljes hozzáférési jogot az összes bemeneti és kimeneti adatok a munkaterhelési.</span><span class="sxs-lookup"><span data-stu-id="8b196-196">For scenarios with more sensitive data, make sure that all of your storage keys are protected, because these keys grant full access to all input and output data from the workload.</span></span>

### <a name="data-encryption-and-data-movement"></a><span data-ttu-id="8b196-197">Adattitkosítás és -adatok áthelyezése</span><span class="sxs-lookup"><span data-stu-id="8b196-197">Data encryption and data movement</span></span>

<span data-ttu-id="8b196-198">Ez a referenciaarchitektúra stílus átvitelt használ példaként szolgál a kötegelt pontozási a folyamatot.</span><span class="sxs-lookup"><span data-stu-id="8b196-198">This reference architecture uses style transfer as an example of a batch scoring process.</span></span> <span data-ttu-id="8b196-199">További adatok bizalmas forgatókönyvek esetén az adatok a storage-ban kell lennie titkosítása.</span><span class="sxs-lookup"><span data-stu-id="8b196-199">For more data-sensitive scenarios, the data in storage should be encrypted at rest.</span></span> <span data-ttu-id="8b196-200">Minden alkalommal adat áthelyezik az egyik helyről a következő, az SSL használatával biztonságossá tétele az adatátvitel.</span><span class="sxs-lookup"><span data-stu-id="8b196-200">Each time data is moved from one location to the next, use SSL to secure the data transfer.</span></span> <span data-ttu-id="8b196-201">További információkért lásd: [Azure Storage biztonsági útmutatóját][storage-security].</span><span class="sxs-lookup"><span data-stu-id="8b196-201">For more information, see [Azure Storage security guide][storage-security].</span></span>

### <a name="securing-data-in-a-virtual-network"></a><span data-ttu-id="8b196-202">A virtuális hálózatban az adatok védelme</span><span class="sxs-lookup"><span data-stu-id="8b196-202">Securing data in a virtual network</span></span>

<span data-ttu-id="8b196-203">A Batch AI-fürt üzembe helyezésekor, konfigurálhatja a fürt egy virtuális hálózat alhálózatán belül ki kell építeni.</span><span class="sxs-lookup"><span data-stu-id="8b196-203">When deploying your Batch AI cluster, you can configure your cluster to be provisioned inside a subnet of a virtual network.</span></span> <span data-ttu-id="8b196-204">Ez lehetővé teszi a számítási csomópontok, a fürt más virtuális gépekkel, vagy egy helyszíni hálózat mellett is biztonságosan kommunikál.</span><span class="sxs-lookup"><span data-stu-id="8b196-204">This allows the compute nodes in the cluster to communicate securely with other virtual machines, or even with an on-premises network.</span></span> <span data-ttu-id="8b196-205">Is [szolgáltatásvégpontokat] [ service-endpoints] a blob storage-hozzáférés biztosítása virtuális hálózatról, vagy a virtuális hálózaton belül egy egycsomópontos NFS használata a Batch AI, győződjön meg arról, hogy az adatok mindig védve van.</span><span class="sxs-lookup"><span data-stu-id="8b196-205">You can also use [service endpoints][service-endpoints] with blob storage to grant access from a virtual network or use a single-node NFS inside the VNET with Batch AI to ensure that the data is always protected.</span></span>

### <a name="protecting-against-malicious-activity"></a><span data-ttu-id="8b196-206">Rosszindulatú tevékenység elleni védelme</span><span class="sxs-lookup"><span data-stu-id="8b196-206">Protecting against malicious activity</span></span>

<span data-ttu-id="8b196-207">A forgatókönyvek, ahol több felhasználó van, győződjön meg arról, hogy kártékony tevékenységek ellen védett-e a bizalmas adatokat.</span><span class="sxs-lookup"><span data-stu-id="8b196-207">In scenarios where there are multiple users, make sure that sensitive data is protected against malicious activity.</span></span> <span data-ttu-id="8b196-208">Ha más felhasználók kapjanak hozzáférést ehhez a központi telepítéshez a bemeneti adatok testreszabása, jegyezze fel a következő óvintézkedéseket és szempontok:</span><span class="sxs-lookup"><span data-stu-id="8b196-208">If other users are given access to this deployment to customize the input data, take note of the following precautions and considerations:</span></span>

- <span data-ttu-id="8b196-209">Az RBAC használatával csak a számukra szükséges erőforrásokhoz való felhasználói hozzáférés korlátozására.</span><span class="sxs-lookup"><span data-stu-id="8b196-209">Use RBAC to limit users' access to only the resources they need.</span></span>
- <span data-ttu-id="8b196-210">Két különböző storage-fiókok kiépítéséhez.</span><span class="sxs-lookup"><span data-stu-id="8b196-210">Provision two separate storage accounts.</span></span> <span data-ttu-id="8b196-211">Az első fiók Store a bemeneti és kimeneti adatokat.</span><span class="sxs-lookup"><span data-stu-id="8b196-211">Store input and output data in the first account.</span></span> <span data-ttu-id="8b196-212">A külső felhasználók is hozzáférést kell biztosítani ehhez a fiókhoz.</span><span class="sxs-lookup"><span data-stu-id="8b196-212">External users can be given access to this account.</span></span> <span data-ttu-id="8b196-213">Store végrehajtható parancsfájlokat, és a kimeneti naplófájlokat a fiókban.</span><span class="sxs-lookup"><span data-stu-id="8b196-213">Store executable scripts and output log files in the other account.</span></span> <span data-ttu-id="8b196-214">A külső felhasználók nem kell a hozzáférést a fiókjához.</span><span class="sxs-lookup"><span data-stu-id="8b196-214">External users should not have access to this account.</span></span> <span data-ttu-id="8b196-215">Ez biztosítja, hogy a külső felhasználók nem módosítható a végrehajtható fájl (a kártevő kód beszúrása), és nem fér hozzá a logfiles, amelyek bizalmas információkat tartalmazhat.</span><span class="sxs-lookup"><span data-stu-id="8b196-215">This will ensure that external users cannot modify any executable files (to inject malicious code), and don't have access to logfiles, which could hold sensitive information.</span></span>
- <span data-ttu-id="8b196-216">Rosszindulatú felhasználók DDOS a feladat-várólistában vagy beszúrása a feladat-várólistában lévő helytelen formátumú ártalmas üzenetek okoz a rendszer zárolja, vagy üzenetmozgatót hibákat okoz.</span><span class="sxs-lookup"><span data-stu-id="8b196-216">Malicious users can DDOS the job queue or inject malformed poison messages in the job queue, causing the system to lock up or causing dequeuing errors.</span></span>

## <a name="monitoring-and-logging"></a><span data-ttu-id="8b196-217">Monitorozás és naplózás</span><span class="sxs-lookup"><span data-stu-id="8b196-217">Monitoring and logging</span></span>

### <a name="monitoring-batch-ai-jobs"></a><span data-ttu-id="8b196-218">Batch AI-feladatok figyelése</span><span class="sxs-lookup"><span data-stu-id="8b196-218">Monitoring Batch AI jobs</span></span>

<span data-ttu-id="8b196-219">A feladat futtatásakor fontos nyomon követheti, és győződjön meg arról, hogy a dolgok várt módon működik.</span><span class="sxs-lookup"><span data-stu-id="8b196-219">While running your job, it's important to monitor the progress and make sure that things are working as expected.</span></span> <span data-ttu-id="8b196-220">Azonban ez több aktív csomópontból álló fürtben figyelése kihívást jelenthet.</span><span class="sxs-lookup"><span data-stu-id="8b196-220">However, it can be a challenge to monitor across a cluster of active nodes.</span></span>

<span data-ttu-id="8b196-221">Megtapasztalhatja, a fürt általános állapotát, lépjen a Batch AI panel az Azure Portal vizsgálhatja meg a fürt csomópontjainak állapotát.</span><span class="sxs-lookup"><span data-stu-id="8b196-221">To get a sense of the overall state of the cluster, go to the Batch AI blade of the Azure Portal to inspect the state of the nodes in the cluster.</span></span> <span data-ttu-id="8b196-222">Ha egy csomópont nem aktív, vagy egy feladat sikertelen volt, a hibanaplókat blob storage-bA lesznek mentve, és is elérhetők az Azure portálon a feladatok panelen.</span><span class="sxs-lookup"><span data-stu-id="8b196-222">If a node is inactive or a job has failed, the error logs are saved to blob storage, and are also accessible in the Jobs blade in the Azure Portal.</span></span>

<span data-ttu-id="8b196-223">Figyelés is lehet további bővített naplók csatlakozik az Application Insights vagy a Batch AI-fürtöt és a feladatok állapotának lekérdezéséhez külön folyamatokba futtatja.</span><span class="sxs-lookup"><span data-stu-id="8b196-223">Monitoring can be further enriched by connecting logs to Application Insights or by running separate processes to poll for the state of the Batch AI cluster and its jobs.</span></span>

### <a name="logging-in-batch-ai"></a><span data-ttu-id="8b196-224">A Batch AI-naplózás</span><span class="sxs-lookup"><span data-stu-id="8b196-224">Logging in Batch AI</span></span>

<span data-ttu-id="8b196-225">A Batch AI automatikusan projekttárolóba összes stdout/stderr társítása a blob storage-fiókhoz.</span><span class="sxs-lookup"><span data-stu-id="8b196-225">Batch AI will automatically log all stdout/stderr to the associate blob storage account.</span></span> <span data-ttu-id="8b196-226">Egy tárolási navigációs eszköz, például a Storage Explorer használatával való navigáláshoz naplófájlokat egy sokkal könnyebb élményt biztosít.</span><span class="sxs-lookup"><span data-stu-id="8b196-226">Using a storage navigation tool such as Storage Explorer will provide a much easier experience for navigating log files.</span></span>

<span data-ttu-id="8b196-227">Ez a referenciaarchitektúra üzembe helyezési lépései is bemutatja, hogyan állíthat be egy több egyszerű naplózási rendszerben, hogy a különböző feladatok között a naplók ugyanabba a könyvtárba a blobtárolókban található lesznek mentve, ahogy az alábbi.</span><span class="sxs-lookup"><span data-stu-id="8b196-227">The deployment steps for this reference architecture also shows how to set up a more simple logging system, such that all the logs across the different jobs are saved to the same directory in your blob container, as shown below.</span></span> <span data-ttu-id="8b196-228">Ezek a naplók segítségével figyelheti, mennyi ideig tart minden egyes rendszerképek és feldolgozni.</span><span class="sxs-lookup"><span data-stu-id="8b196-228">Use these logs to monitor how long it takes for each job and each image to process.</span></span> <span data-ttu-id="8b196-229">Ekkor kap egy jobban érti, hogyan optimalizálható a folyamat tovább.</span><span class="sxs-lookup"><span data-stu-id="8b196-229">This will give you a better sense of how to optimize the process even further.</span></span>

![Bejelentkezés az Azure Batch AI szolgáltatással képernyőképe](./_images/batch-ai-logging.png)

## <a name="cost-considerations"></a><span data-ttu-id="8b196-231">Költségekkel kapcsolatos szempontok</span><span class="sxs-lookup"><span data-stu-id="8b196-231">Cost considerations</span></span>

<span data-ttu-id="8b196-232">A storage és az ütemezési összetevők képest, ez a referenciaarchitektúra a messze használt számítási erőforrások uralja költségei tekintetében.</span><span class="sxs-lookup"><span data-stu-id="8b196-232">Compared to the storage and scheduling components, the compute resources used in this reference architecture by far dominate in terms of costs.</span></span> <span data-ttu-id="8b196-233">Az egyik fő kihívása van hatékonyan párhuzamosan futtatni a munkahelyi GPU-kompatibilis gép egy fürtön.</span><span class="sxs-lookup"><span data-stu-id="8b196-233">One of the main challenges is effectively parallelizing the work across a cluster of GPU-enabled machines.</span></span>

<span data-ttu-id="8b196-234">A Batch AI-fürt mérete automatikusan méretezhetők felfelé és lefelé a várólistában a feladatok függően.</span><span class="sxs-lookup"><span data-stu-id="8b196-234">The Batch AI cluster size can automatically scale up and down depending on the jobs in the queue.</span></span> <span data-ttu-id="8b196-235">Automatikus méretezés a Batch AI és a két módszer egyikével engedélyezhető.</span><span class="sxs-lookup"><span data-stu-id="8b196-235">You can enable auto-scale with Batch AI in one of two ways.</span></span> <span data-ttu-id="8b196-236">Megteheti szoftveresen, amely konfigurálható a `.env` fájlt, amely része a [üzembe helyezési lépések][deployment], vagy módosíthatja a méretezési képletet közvetlenül a portálon, miután a fürt létrehozott.</span><span class="sxs-lookup"><span data-stu-id="8b196-236">You can do so programmatically, which can be configured in the `.env` file that is part of the [deployment steps][deployment], or you can change the scale formula directly in the portal after the cluster is created.</span></span>

<span data-ttu-id="8b196-237">És nem igényel azonnali feldolgozási munka konfigurálja az automatikus méretezési képletet, hogy az alapértelmezett állapot (legalább) az nulla csomópontból álló fürtben.</span><span class="sxs-lookup"><span data-stu-id="8b196-237">For work that doesn't require immediate processing, configure the auto-scale formula so the default state (minimum) is a cluster of zero nodes.</span></span> <span data-ttu-id="8b196-238">Ezzel a konfigurációval a fürt nullára a csomópontok kezdődik, és ha a várólistán lévő feladatok csak felskálázással.</span><span class="sxs-lookup"><span data-stu-id="8b196-238">With this configuration, the cluster starts with zero nodes and only scales up when it detects jobs in the queue.</span></span> <span data-ttu-id="8b196-239">Ha a kötegelt pontozási folyamat csak néhány alkalommal naponta történik vagy annál kisebb, ez a beállítás lehetővé teszi, hogy jelentős költségmegtakarítást.</span><span class="sxs-lookup"><span data-stu-id="8b196-239">If the batch scoring process only happens a few times a day or less, this setting enables significant cost savings.</span></span>

<span data-ttu-id="8b196-240">Automatikus méretezés nem lehet megfelelő kötegelt feladatok számához egymáshoz közel túl fordulhat elő.</span><span class="sxs-lookup"><span data-stu-id="8b196-240">Auto-scaling may not be appropriate for batch jobs that happen too close to each other.</span></span> <span data-ttu-id="8b196-241">A fürt számára le üzemeltethet a idejét is költségkezelési, így ha egy batch számítási feladatot csak néhány percet az előző feladat befejezése után kezdődik, költséghatékonyabb tartani a fürtön futó feladatok között lehet.</span><span class="sxs-lookup"><span data-stu-id="8b196-241">The time that it takes for a cluster to spin up and spin down also incur a cost, so if a batch workload begins only a few minutes after the previous job ends, it might be more cost effective to keep the cluster running between jobs.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="8b196-242">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="8b196-242">Deploy the solution</span></span>

<span data-ttu-id="8b196-243">Ez a referenciaarchitektúra üzembe helyezéséhez kövesse az ismertetett lépéseket a [GitHub-adattárat][deployment].</span><span class="sxs-lookup"><span data-stu-id="8b196-243">To deploy this reference architecture, follow the steps described in the [GitHub repo][deployment].</span></span>

<!-- links -->

[azcopy]: /azure/storage/common/storage-use-azcopy-linux
[batch-ai]: /azure/batch-ai/
[blobfuse]: https://github.com/Azure/azure-storage-fuse
[blob-storage]: /azure/storage/blobs/storage-blobs-introduction
[container-instances]: /azure/container-instances/
[container-registry]: /azure/container-registry/
[deployment]: https://github.com/Azure/batch-scoring-for-dl-models
[dockerhub]: https://hub.docker.com/
[ffmpeg]: https://www.ffmpeg.org/
[image-style-transfer]: https://www.cv-foundation.org/openaccess/content_cvpr_2016/papers/Gatys_Image_Style_Transfer_CVPR_2016_paper.pdf
[logic-apps]: /azure/logic-apps/
[service-endpoints]: /azure/storage/common/storage-network-security?toc=%2fazure%2fvirtual-network%2ftoc.json#grant-access-from-a-virtual-network
[source-video]: https://happypathspublic.blob.core.windows.net/videos/orangutan.mp4
[storage-security]: /azure/storage/common/storage-security-guide
[vm-sizes-gpu]: /azure/virtual-machines/windows/sizes-gpu