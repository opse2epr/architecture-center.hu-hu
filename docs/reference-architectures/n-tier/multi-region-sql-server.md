---
title: Többrégiós N szintű alkalmazás magas rendelkezésre állás érdekében
titleSuffix: Azure Reference Architectures
description: Alkalmazás üzembe helyezése az Azure-beli virtuális gépek több régióban a magas rendelkezésre állás és rugalmasság.
author: MikeWasson
ms.date: 07/19/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18
ms.openlocfilehash: 9fce082a0e762e25981929f6fa8685033017f3eb
ms.sourcegitcommit: f4ed242dff8b204cfd8ebebb7778f356a19f5923
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 02/13/2019
ms.locfileid: "56224181"
---
# <a name="run-an-n-tier-application-in-multiple-azure-regions-for-high-availability"></a><span data-ttu-id="2503a-103">Futtatása egy N szintű alkalmazás több Azure-régióban a magas rendelkezésre állás érdekében</span><span class="sxs-lookup"><span data-stu-id="2503a-103">Run an N-tier application in multiple Azure regions for high availability</span></span>

<span data-ttu-id="2503a-104">Ez a referenciaarchitektúra néhány bevált eljárást mutat be egy N szintű alkalmazás több Azure-régióban való futtatásához a magas rendelkezésre állás eléréséhez és egy robusztus vészhelyreállítási infrastruktúra kiépítéséhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-104">This reference architecture shows a set of proven practices for running an N-tier application in multiple Azure regions, in order to achieve availability and a robust disaster recovery infrastructure.</span></span>

![Magas rendelkezésre állású hálózati architektúra N szintű Azure-alkalmazásokhoz."](./images/multi-region-sql-server.png)

<span data-ttu-id="2503a-106">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="2503a-106">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="2503a-107">Architektúra</span><span class="sxs-lookup"><span data-stu-id="2503a-107">Architecture</span></span>

<span data-ttu-id="2503a-108">Ez az architektúra épít látható [SQL Servert használó N szintű alkalmazás](n-tier-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="2503a-108">This architecture builds on the one shown in [N-tier application with SQL Server](n-tier-sql-server.md).</span></span>

- <span data-ttu-id="2503a-109">**Elsődleges és másodlagos régiók**.</span><span class="sxs-lookup"><span data-stu-id="2503a-109">**Primary and secondary regions**.</span></span> <span data-ttu-id="2503a-110">Használjon két régiót a magas rendelkezésre állás eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-110">Use two regions to achieve higher availability.</span></span> <span data-ttu-id="2503a-111">Az egyik ebben az esetben az elsődleges régió.</span><span class="sxs-lookup"><span data-stu-id="2503a-111">One is the primary region.</span></span> <span data-ttu-id="2503a-112">A másik a feladatátvétel során használt régió.</span><span class="sxs-lookup"><span data-stu-id="2503a-112">The other region is for failover.</span></span>

- <span data-ttu-id="2503a-113">**Azure Traffic Manager**.</span><span class="sxs-lookup"><span data-stu-id="2503a-113">**Azure Traffic Manager**.</span></span> <span data-ttu-id="2503a-114">A [Traffic Manager][traffic-manager] az egyik régió felé irányítja a beérkező kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="2503a-114">[Traffic Manager][traffic-manager] routes incoming requests to one of the regions.</span></span> <span data-ttu-id="2503a-115">A normál működés során a rendszer az elsődleges régió felé irányítja a kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="2503a-115">During normal operations, it routes requests to the primary region.</span></span> <span data-ttu-id="2503a-116">Ha az adott régió nem érhető el, a Traffic Manager átadj a feladatokat a másodlagos régiónak.</span><span class="sxs-lookup"><span data-stu-id="2503a-116">If that region becomes unavailable, Traffic Manager fails over to the secondary region.</span></span> <span data-ttu-id="2503a-117">További információt a következő szakaszban talál: [A Traffic Manager konfigurációja](#traffic-manager-configuration).</span><span class="sxs-lookup"><span data-stu-id="2503a-117">For more information, see the section [Traffic Manager configuration](#traffic-manager-configuration).</span></span>

- <span data-ttu-id="2503a-118">**Erőforráscsoportok**.</span><span class="sxs-lookup"><span data-stu-id="2503a-118">**Resource groups**.</span></span> <span data-ttu-id="2503a-119">Hozzon létre külön [erőforráscsoportokat][resource groups] az elsődleges régióhoz, a másodlagos régióhoz, valamint a Traffic Managerhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-119">Create separate [resource groups][resource groups] for the primary region, the secondary region, and for Traffic Manager.</span></span> <span data-ttu-id="2503a-120">Ennek köszönhetően rugalmasan, egyetlen erőforráskészletként kezelheti az egyes régiókat,</span><span class="sxs-lookup"><span data-stu-id="2503a-120">This gives you the flexibility to manage each region as a single collection of resources.</span></span> <span data-ttu-id="2503a-121">például ismételten üzembe helyezhet egy régiót a másik eltávolítása nélkül.</span><span class="sxs-lookup"><span data-stu-id="2503a-121">For example, you could redeploy one region, without taking down the other one.</span></span> <span data-ttu-id="2503a-122">[Kapcsolja össze az erőforráscsoportokat][resource-group-links], hogy egy lekérdezés futtatásával listázhassa az alkalmazás összes erőforrását.</span><span class="sxs-lookup"><span data-stu-id="2503a-122">[Link the resource groups][resource-group-links], so that you can run a query to list all the resources for the application.</span></span>

- <span data-ttu-id="2503a-123">**Virtuális hálózatok**.</span><span class="sxs-lookup"><span data-stu-id="2503a-123">**VNets**.</span></span> <span data-ttu-id="2503a-124">Hozzon létre külön virtuális hálózatot mindegyik régióhoz.</span><span class="sxs-lookup"><span data-stu-id="2503a-124">Create a separate VNet for each region.</span></span> <span data-ttu-id="2503a-125">Ügyeljen arra, hogy a címterek ne legyenek átfedésben.</span><span class="sxs-lookup"><span data-stu-id="2503a-125">Make sure the address spaces do not overlap.</span></span>

- <span data-ttu-id="2503a-126">**SQL Server Always On rendelkezésre állási csoport**.</span><span class="sxs-lookup"><span data-stu-id="2503a-126">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="2503a-127">Az SQL Server használata esetén az [SQL Server Always On rendelkezésre állási csoportok][sql-always-on] használata javasolt a magas rendelkezésre állás érdekében.</span><span class="sxs-lookup"><span data-stu-id="2503a-127">If you are using SQL Server, we recommend [SQL Always On Availability Groups][sql-always-on] for high availability.</span></span> <span data-ttu-id="2503a-128">Hozzon létre egyetlen rendelkezésre állási csoportot, amely mindkét régióban tartalmazza az SQL Server-példányokat.</span><span class="sxs-lookup"><span data-stu-id="2503a-128">Create a single availability group that includes the SQL Server instances in both regions.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2503a-129">Másik lehetőségként fontolja meg az [Azure SQL Database][azure-sql-db] használatát, amely relációs adatbázist biztosít felhőszolgáltatás formájában.</span><span class="sxs-lookup"><span data-stu-id="2503a-129">Also consider [Azure SQL Database][azure-sql-db], which provides a relational database as a cloud service.</span></span> <span data-ttu-id="2503a-130">Az SQL Database használatával nem kell rendelkezésre állási csoportot konfigurálnia, vagy kezelnie a feladatátvételt.</span><span class="sxs-lookup"><span data-stu-id="2503a-130">With SQL Database, you don't need to configure an availability group or manage failover.</span></span>
    >

- <span data-ttu-id="2503a-131">**VPN-átjárók**.</span><span class="sxs-lookup"><span data-stu-id="2503a-131">**VPN Gateways**.</span></span> <span data-ttu-id="2503a-132">Hozzon létre egy [VPN-átjárót][vpn-gateway] mindkét virtuális hálózatban, és konfiguráljon egy [virtuális hálózatok közötti kapcsolatot][vnet-to-vnet], amely lehetővé teszi a hálózati forgalmat a kettő között.</span><span class="sxs-lookup"><span data-stu-id="2503a-132">Create a [VPN gateway][vpn-gateway] in each VNet, and configure a [VNet-to-VNet connection][vnet-to-vnet], to enable network traffic between the two VNets.</span></span> <span data-ttu-id="2503a-133">Ez szükséges az SQL Always On rendelkezésre állási csoport használatához.</span><span class="sxs-lookup"><span data-stu-id="2503a-133">This is required for the SQL Always On Availability Group.</span></span>

## <a name="recommendations"></a><span data-ttu-id="2503a-134">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="2503a-134">Recommendations</span></span>

<span data-ttu-id="2503a-135">A többrégiós architektúrák magasabb rendelkezésre állást biztosíthatnak, mint az egyetlen régióban történő üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="2503a-135">A multi-region architecture can provide higher availability than deploying to a single region.</span></span> <span data-ttu-id="2503a-136">Ha egy régió üzemkimaradása hatással van az elsődleges régióra, a [Traffic Manager][traffic-manager] szolgáltatással feladatátvételt hajthat végre a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="2503a-136">If a regional outage affects the primary region, you can use [Traffic Manager][traffic-manager] to fail over to the secondary region.</span></span> <span data-ttu-id="2503a-137">Ez az architektúra az alkalmazás egy adott alrendszerének meghibásodása esetén is segíthet.</span><span class="sxs-lookup"><span data-stu-id="2503a-137">This architecture can also help if an individual subsystem of the application fails.</span></span>

<span data-ttu-id="2503a-138">A régiók közötti magas rendelkezésre állás elérésének több általános megközelítése van:</span><span class="sxs-lookup"><span data-stu-id="2503a-138">There are several general approaches to achieving high availability across regions:</span></span>

- <span data-ttu-id="2503a-139">Aktív/passzív készenléti kiszolgálóval.</span><span class="sxs-lookup"><span data-stu-id="2503a-139">Active/passive with hot standby.</span></span> <span data-ttu-id="2503a-140">A forgalom az egyik régióra irányul, míg a másik készenléti kiszolgálón várakozik.</span><span class="sxs-lookup"><span data-stu-id="2503a-140">Traffic goes to one region, while the other waits on hot standby.</span></span> <span data-ttu-id="2503a-141">Készenléti kiszolgáló esetében a másodlagos régió virtuális gépei folyamatosan le vannak foglalva és futnak.</span><span class="sxs-lookup"><span data-stu-id="2503a-141">Hot standby means the VMs in the secondary region are allocated and running at all times.</span></span>
- <span data-ttu-id="2503a-142">Aktív/passzív hidegtartalékkal.</span><span class="sxs-lookup"><span data-stu-id="2503a-142">Active/passive with cold standby.</span></span> <span data-ttu-id="2503a-143">A forgalom az egyik régióra irányul, míg a másik hidegtartalékként áll készenlétben.</span><span class="sxs-lookup"><span data-stu-id="2503a-143">Traffic goes to one region, while the other waits on cold standby.</span></span> <span data-ttu-id="2503a-144">Hidegtartalék esetében a másodlagos régió virtuális gépei nincsenek lefoglalva, amíg nem szükségessé nem válnak feladatátvétel céljából.</span><span class="sxs-lookup"><span data-stu-id="2503a-144">Cold standby means the VMs in the secondary region are not allocated until needed for failover.</span></span> <span data-ttu-id="2503a-145">Ezen megközelítés futtatása kevesebb költséggel jár, de a meghibásodáskor általában hosszabb időt vesz igénybe az üzembe állás.</span><span class="sxs-lookup"><span data-stu-id="2503a-145">This approach costs less to run, but will generally take longer to come online during a failure.</span></span>
- <span data-ttu-id="2503a-146">Aktív/aktív.</span><span class="sxs-lookup"><span data-stu-id="2503a-146">Active/active.</span></span> <span data-ttu-id="2503a-147">Mindkét régió aktív, és a kérelmek terheléselosztással oszlanak meg közöttük.</span><span class="sxs-lookup"><span data-stu-id="2503a-147">Both regions are active, and requests are load balanced between them.</span></span> <span data-ttu-id="2503a-148">Ha egy régió elérhetetlenné válik, kikerül a rotációból.</span><span class="sxs-lookup"><span data-stu-id="2503a-148">If one region becomes unavailable, it is taken out of rotation.</span></span>

<span data-ttu-id="2503a-149">Ez a referenciaarchitektúra a készenléti kiszolgálóval konfigurált aktív/passzív üzemmódra összpontosít, a Traffic Managert használva a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-149">This reference architecture focuses on active/passive with hot standby, using Traffic Manager for failover.</span></span> <span data-ttu-id="2503a-150">Vegye figyelembe, hogy ha kis számú virtuális gépet helyez üzembe készenléti kiszolgálóként, igény szerint később is elvégezheti a horizontális felskálázásukat.</span><span class="sxs-lookup"><span data-stu-id="2503a-150">Note that you could deploy a small number of VMs for hot standby and then scale out as needed.</span></span>

### <a name="regional-pairing"></a><span data-ttu-id="2503a-151">Régiónkénti párosítás</span><span class="sxs-lookup"><span data-stu-id="2503a-151">Regional pairing</span></span>

<span data-ttu-id="2503a-152">Minden egyes Azure-régió párban áll egy másikkal egy azonos földrajzi területen belül.</span><span class="sxs-lookup"><span data-stu-id="2503a-152">Each Azure region is paired with another region within the same geography.</span></span> <span data-ttu-id="2503a-153">Régiókat általában azonos regionális párokból érdemes választani (például: USA 2. keleti régiója és USA középső régiója).</span><span class="sxs-lookup"><span data-stu-id="2503a-153">In general, choose regions from the same regional pair (for example, East US 2 and US Central).</span></span> <span data-ttu-id="2503a-154">Ennek előnyei például a következők:</span><span class="sxs-lookup"><span data-stu-id="2503a-154">Benefits of doing so include:</span></span>

- <span data-ttu-id="2503a-155">Széles körű leállás esetén a helyreállításkor minden párból legalább az egyik régió előnyt élvez.</span><span class="sxs-lookup"><span data-stu-id="2503a-155">If there is a broad outage, recovery of at least one region out of every pair is prioritized.</span></span>
- <span data-ttu-id="2503a-156">A tervezett Azure-rendszerfrissítések egyszerre csak a régiópár egyik tagján jelennek meg, ami csökkenti az állásidőt.</span><span class="sxs-lookup"><span data-stu-id="2503a-156">Planned Azure system updates are rolled out to paired regions sequentially, to minimize possible downtime.</span></span>
- <span data-ttu-id="2503a-157">A párok azonos földrajzi helyen belül találhatók, hogy megfeleljenek az adatok tárolási helyére vonatkozó előírásoknak.</span><span class="sxs-lookup"><span data-stu-id="2503a-157">Pairs reside within the same geography, to meet data residency requirements.</span></span>

<span data-ttu-id="2503a-158">Azonban győződjön meg arról, hogy mindkét régió támogatja az összes Azure-szolgáltatást, amely szükséges az alkalmazásához (lásd: [Szolgáltatások régiónként][services-by-region]).</span><span class="sxs-lookup"><span data-stu-id="2503a-158">However, make sure that both regions support all of the Azure services needed for your application (see [Services by region][services-by-region]).</span></span> <span data-ttu-id="2503a-159">További információ a regionális párokról: [üzleti folytonossági és vészhelyreállítási helyreállítási (BCDR): Az Azure párosított régiói][regional-pairs].</span><span class="sxs-lookup"><span data-stu-id="2503a-159">For more information about regional pairs, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions][regional-pairs].</span></span>

### <a name="traffic-manager-configuration"></a><span data-ttu-id="2503a-160">A Traffic Manager konfigurációja</span><span class="sxs-lookup"><span data-stu-id="2503a-160">Traffic Manager configuration</span></span>

<span data-ttu-id="2503a-161">A Traffic Manager konfigurálásakor vegye figyelembe a következő szempontokat:</span><span class="sxs-lookup"><span data-stu-id="2503a-161">Consider the following points when configuring Traffic Manager:</span></span>

- <span data-ttu-id="2503a-162">**Útválasztás**.</span><span class="sxs-lookup"><span data-stu-id="2503a-162">**Routing**.</span></span> <span data-ttu-id="2503a-163">A Traffic Manager többféle [útválasztási algoritmust][tm-routing] támogat.</span><span class="sxs-lookup"><span data-stu-id="2503a-163">Traffic Manager supports several [routing algorithms][tm-routing].</span></span> <span data-ttu-id="2503a-164">A cikkben leírt forgatókönyvhöz a *prioritásos* útválasztást (régebbi nevén *feladatátvétel esetén használt* útválasztás) használja.</span><span class="sxs-lookup"><span data-stu-id="2503a-164">For the scenario described in this article, use *priority* routing (formerly called *failover* routing).</span></span> <span data-ttu-id="2503a-165">Ezzel a beállítással a Traffic Manager az összes kérelmet az elsődleges régió felé irányítja, kivétel akkor, ha az nem elérhető.</span><span class="sxs-lookup"><span data-stu-id="2503a-165">With this setting, Traffic Manager sends all requests to the primary region, unless the primary region becomes unreachable.</span></span> <span data-ttu-id="2503a-166">Ebben az esetben automatikusan átadja a feladatokat a másodlagos régiónak.</span><span class="sxs-lookup"><span data-stu-id="2503a-166">At that point, it automatically fails over to the secondary region.</span></span> <span data-ttu-id="2503a-167">Lásd: [A feladatátvétel esetén használt útválasztás konfigurálása][tm-configure-failover].</span><span class="sxs-lookup"><span data-stu-id="2503a-167">See [Configure Failover routing method][tm-configure-failover].</span></span>
- <span data-ttu-id="2503a-168">**Állapotminta**.</span><span class="sxs-lookup"><span data-stu-id="2503a-168">**Health probe**.</span></span> <span data-ttu-id="2503a-169">A Traffic Manager HTTP- (vagy HTTPS-) [mintavételt][tm-monitoring] használ az egyes régiók rendelkezésre állásának monitorozására.</span><span class="sxs-lookup"><span data-stu-id="2503a-169">Traffic Manager uses an HTTP (or HTTPS) [probe][tm-monitoring] to monitor the availability of each region.</span></span> <span data-ttu-id="2503a-170">A mintavétel 200-as HTTP-választ vár egy megadott URL-címhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-170">The probe checks for an HTTP 200 response for a specified URL path.</span></span> <span data-ttu-id="2503a-171">Ajánlott eljárásként hozzon létre egy olyan végpontot, amely az alkalmazás általános állapotáról ad jelentést, és ezt a végpontot használja az állapotmintához.</span><span class="sxs-lookup"><span data-stu-id="2503a-171">As a best practice, create an endpoint that reports the overall health of the application, and use this endpoint for the health probe.</span></span> <span data-ttu-id="2503a-172">Ellenkező esetben előfordulhat, hogy a mintavétel megfelelően működő végpontot jelent, miközben az alkalmazás kritikus fontosságú részei valójában hibásak.</span><span class="sxs-lookup"><span data-stu-id="2503a-172">Otherwise, the probe might report a healthy endpoint when critical parts of the application are actually failing.</span></span> <span data-ttu-id="2503a-173">További információkért lásd: [állapot végponti Monitorozását végző minta][health-endpoint-monitoring-pattern].</span><span class="sxs-lookup"><span data-stu-id="2503a-173">For more information, see [Health Endpoint Monitoring pattern][health-endpoint-monitoring-pattern].</span></span>

<span data-ttu-id="2503a-174">Amikor a Traffic Manager átadja a feladatokat, az alkalmazás egy ideig nem lesz elérhető a felhasználók számára.</span><span class="sxs-lookup"><span data-stu-id="2503a-174">When Traffic Manager fails over there is a period of time when clients cannot reach the application.</span></span> <span data-ttu-id="2503a-175">Ez az időtartam a következő tényezőktől függ:</span><span class="sxs-lookup"><span data-stu-id="2503a-175">The duration is affected by the following factors:</span></span>

- <span data-ttu-id="2503a-176">Az állapotmintának észlelnie kell, ha az elsődleges régió elérhetetlenné válik.</span><span class="sxs-lookup"><span data-stu-id="2503a-176">The health probe must detect that the primary region has become unreachable.</span></span>
- <span data-ttu-id="2503a-177">A DNS-kiszolgálóknak frissíteniük kell az IP-címhez tartozó gyorsítótárazott DNS-rekordokat. Ez a DNS élettartamától (TTL) függ.</span><span class="sxs-lookup"><span data-stu-id="2503a-177">DNS servers must update the cached DNS records for the IP address, which depends on the DNS time-to-live (TTL).</span></span> <span data-ttu-id="2503a-178">Az alapértelmezett TTL 300 másodperc (5 perc), de ezt az értéket a Traffic Manager-profil létrehozásakor konfigurálhatja.</span><span class="sxs-lookup"><span data-stu-id="2503a-178">The default TTL is 300 seconds (5 minutes), but you can configure this value when you create the Traffic Manager profile.</span></span>

<span data-ttu-id="2503a-179">Részletek: [A Traffic Manager monitorozásának ismertetése][tm-monitoring].</span><span class="sxs-lookup"><span data-stu-id="2503a-179">For details, see [About Traffic Manager Monitoring][tm-monitoring].</span></span>

<span data-ttu-id="2503a-180">Ha a Traffic Manager feladatátvételt hajt végre, automatikus feladat-visszavétel megvalósítása helyett a manuális feladat-visszavételt ajánlunk.</span><span class="sxs-lookup"><span data-stu-id="2503a-180">If Traffic Manager fails over, we recommend performing a manual failback rather than implementing an automatic failback.</span></span> <span data-ttu-id="2503a-181">Ellenkező esetben előfordulhat, hogy egyes esetekben az alkalmazás oda-vissza váltogat a régiók között.</span><span class="sxs-lookup"><span data-stu-id="2503a-181">Otherwise, you can create a situation where the application flips back and forth between regions.</span></span> <span data-ttu-id="2503a-182">A feladat-visszavétel előtt ellenőrizze, hogy az alkalmazás minden alrendszere működik-e.</span><span class="sxs-lookup"><span data-stu-id="2503a-182">Verify that all application subsystems are healthy before failing back.</span></span>

<span data-ttu-id="2503a-183">Vegye figyelembe, hogy a Traffic Manager alapértelmezés szerint automatikusan végrehajtja a feladat-visszavételt.</span><span class="sxs-lookup"><span data-stu-id="2503a-183">Note that Traffic Manager automatically fails back by default.</span></span> <span data-ttu-id="2503a-184">Ennek megelőzéséhez manuálisan csökkentse az elsődleges régió prioritását a feladatátvétel után.</span><span class="sxs-lookup"><span data-stu-id="2503a-184">To prevent this, manually lower the priority of the primary region after a failover event.</span></span> <span data-ttu-id="2503a-185">Tegyük fel például, hogy az elsődleges régió 1-es prioritású, a második pedig 2-es.</span><span class="sxs-lookup"><span data-stu-id="2503a-185">For example, suppose the primary region is priority 1 and the secondary is priority 2.</span></span> <span data-ttu-id="2503a-186">A feladatátvétel után az automatikus visszavétel megelőzéséhez állítsa az elsődleges régió prioritását 3-asra.</span><span class="sxs-lookup"><span data-stu-id="2503a-186">After a failover, set the primary region to priority 3, to prevent automatic failback.</span></span> <span data-ttu-id="2503a-187">A prioritást akkor állítsa 1-esre, ha már készen áll a visszaváltásra.</span><span class="sxs-lookup"><span data-stu-id="2503a-187">When you are ready to switch back, update the priority to 1.</span></span>

<span data-ttu-id="2503a-188">A következő [Azure CLI][azure-cli]-parancsot frissíti a prioritást:</span><span class="sxs-lookup"><span data-stu-id="2503a-188">The following [Azure CLI][azure-cli] command updates the priority:</span></span>

```azurecli
az network traffic-manager endpoint update --resource-group <resource-group> --profile-name <profile>
    --name <endpoint-name> --type azureEndpoints --priority 3
```

<span data-ttu-id="2503a-189">Másik megoldásként ideiglenesen letilthatja a végpontot, amíg készen nem áll a feladat-visszavételre:</span><span class="sxs-lookup"><span data-stu-id="2503a-189">Another approach is to temporarily disable the endpoint until you are ready to fail back:</span></span>

```azurecli
az network traffic-manager endpoint update --resource-group <resource-group> --profile-name <profile>
    --name <endpoint-name> --type azureEndpoints --endpoint-status Disabled
```

<span data-ttu-id="2503a-190">A feladatátvétel okától függően előfordulhat, hogy újra üzembe kell helyeznie az erőforrásokat a régión belül.</span><span class="sxs-lookup"><span data-stu-id="2503a-190">Depending on the cause of a failover, you might need to redeploy the resources within a region.</span></span> <span data-ttu-id="2503a-191">A feladat-visszavétel előtt tesztelje a működési készenlétet.</span><span class="sxs-lookup"><span data-stu-id="2503a-191">Before failing back, perform an operational readiness test.</span></span> <span data-ttu-id="2503a-192">A teszt többek között a következőket ellenőrzi:</span><span class="sxs-lookup"><span data-stu-id="2503a-192">The test should verify things like:</span></span>

- <span data-ttu-id="2503a-193">A virtuális gépek megfelelően vannak-e konfigurálva.</span><span class="sxs-lookup"><span data-stu-id="2503a-193">VMs are configured correctly.</span></span> <span data-ttu-id="2503a-194">(Az összes szükséges szoftver telepítve van, az IIS fut stb.)</span><span class="sxs-lookup"><span data-stu-id="2503a-194">(All required software is installed, IIS is running, and so on.)</span></span>
- <span data-ttu-id="2503a-195">Az alkalmazás alrendszerei működőképesek-e.</span><span class="sxs-lookup"><span data-stu-id="2503a-195">Application subsystems are healthy.</span></span>
- <span data-ttu-id="2503a-196">Funkciótesztelés.</span><span class="sxs-lookup"><span data-stu-id="2503a-196">Functional testing.</span></span> <span data-ttu-id="2503a-197">(Pl. az adatbázisszint elérhető a webes szintről.)</span><span class="sxs-lookup"><span data-stu-id="2503a-197">(For example, the database tier is reachable from the web tier.)</span></span>

### <a name="configure-sql-server-always-on-availability-groups"></a><span data-ttu-id="2503a-198">Az SQL Server Always On rendelkezésre állási csoportok konfigurálása</span><span class="sxs-lookup"><span data-stu-id="2503a-198">Configure SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="2503a-199">A Windows Server 2016-nál régebbi kiadásokban az SQL Server Always On rendelkezésre állási csoportok tartományvezérlőt igényelnek, és a rendelkezésre állási csoport összes csomópontjának azonos Active Directory (AD) tartományban kell lennie.</span><span class="sxs-lookup"><span data-stu-id="2503a-199">Prior to Windows Server 2016, SQL Server Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same Active Directory (AD) domain.</span></span>

<span data-ttu-id="2503a-200">Az rendelkezésre állási csoport konfigurálása:</span><span class="sxs-lookup"><span data-stu-id="2503a-200">To configure the availability group:</span></span>

- <span data-ttu-id="2503a-201">Legalább két tartományvezérlőt helyezzen mindegyik régióba.</span><span class="sxs-lookup"><span data-stu-id="2503a-201">At a minimum, place two domain controllers in each region.</span></span>
- <span data-ttu-id="2503a-202">Minden tartományvezérlőhöz rendeljen egy statikus IP-címet.</span><span class="sxs-lookup"><span data-stu-id="2503a-202">Give each domain controller a static IP address.</span></span>
- <span data-ttu-id="2503a-203">Hozzon létre egy virtuális hálózatok közötti kapcsolatot a virtuális hálózatok közötti kommunikációhoz.</span><span class="sxs-lookup"><span data-stu-id="2503a-203">Create a VNet-to-VNet connection to enable communication between the VNets.</span></span>
- <span data-ttu-id="2503a-204">Minden egyes virtuális hálózat esetében adja hozzá a tartományvezérlők IP-címeit (mindkét régióból) a DNS-kiszolgálók listájához.</span><span class="sxs-lookup"><span data-stu-id="2503a-204">For each VNet, add the IP addresses of the domain controllers (from both regions) to the DNS server list.</span></span> <span data-ttu-id="2503a-205">Ezt az alábbi CLI-paranccsal teheti meg.</span><span class="sxs-lookup"><span data-stu-id="2503a-205">You can use the following CLI command.</span></span> <span data-ttu-id="2503a-206">További információkért lásd: [módosítása DNS-kiszolgálók][vnet-dns].</span><span class="sxs-lookup"><span data-stu-id="2503a-206">For more information, see [Change DNS servers][vnet-dns].</span></span>

    ```azurecli
    az network vnet update --resource-group <resource-group> --name <vnet-name> --dns-servers "10.0.0.4,10.0.0.6,172.16.0.4,172.16.0.6"
    ```

- <span data-ttu-id="2503a-207">Hozzon létre egy [Windows Server feladatátvételi fürtszolgáltatást][wsfc] (WSFC) fürtöt, amely mindkét régióban tartalmazza SQL Server-példányokat.</span><span class="sxs-lookup"><span data-stu-id="2503a-207">Create a [Windows Server Failover Clustering][wsfc] (WSFC) cluster that includes the SQL Server instances in both regions.</span></span>
- <span data-ttu-id="2503a-208">Hozzon létre egy SQL Server Always On rendelkezésre állási csoportot, amely tartalmazza az elsődleges és a másodlagos régió SQL Server-példányait.</span><span class="sxs-lookup"><span data-stu-id="2503a-208">Create a SQL Server Always On Availability Group that includes the SQL Server instances in both the primary and secondary regions.</span></span> <span data-ttu-id="2503a-209">Ennek lépéseit az [Always On rendelkezésre állási csoport kiterjesztése távoli Azure adatközpontra (PowerShell)](https://techcommunity.microsoft.com/t5/DataCAT/Extending-AlwaysOn-Availability-Group-to-Remote-Azure-Datacenter/ba-p/305217) című cikkben találja.</span><span class="sxs-lookup"><span data-stu-id="2503a-209">See [Extending Always On Availability Group to Remote Azure Datacenter (PowerShell)](https://techcommunity.microsoft.com/t5/DataCAT/Extending-AlwaysOn-Availability-Group-to-Remote-Azure-Datacenter/ba-p/305217) for the steps.</span></span>

  - <span data-ttu-id="2503a-210">Az elsődleges régiót helyezze az elsődleges régióba.</span><span class="sxs-lookup"><span data-stu-id="2503a-210">Put the primary replica in the primary region.</span></span>
  - <span data-ttu-id="2503a-211">Helyezzen egy vagy több másodlagos replikát az elsődleges régióba.</span><span class="sxs-lookup"><span data-stu-id="2503a-211">Put one or more secondary replicas in the primary region.</span></span> <span data-ttu-id="2503a-212">Konfigurálja azokat a szinkron véglegesítés használatára, automatikus feladatátvétellel.</span><span class="sxs-lookup"><span data-stu-id="2503a-212">Configure these to use synchronous commit with automatic failover.</span></span>
  - <span data-ttu-id="2503a-213">Helyezzen egy vagy több másodlagos replikát a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="2503a-213">Put one or more secondary replicas in the secondary region.</span></span> <span data-ttu-id="2503a-214">Ezeket a teljesítmény érdekében *aszinkron* véglegesítés használatára konfigurálja.</span><span class="sxs-lookup"><span data-stu-id="2503a-214">Configure these to use *asynchronous* commit, for performance reasons.</span></span> <span data-ttu-id="2503a-215">(Ellenkező esetben az összes T-SQL-tranzakciónak várnia kell, míg az adatok körbeérnek a hálózaton a másodlagos régióig.)</span><span class="sxs-lookup"><span data-stu-id="2503a-215">(Otherwise, all T-SQL transactions have to wait on a round trip over the network to the secondary region.)</span></span>

    > [!NOTE]
    > <span data-ttu-id="2503a-216">Az aszinkron véglegesítésű replikák nem támogatják az automatikus feladatátvételt.</span><span class="sxs-lookup"><span data-stu-id="2503a-216">Asynchronous commit replicas do not support automatic failover.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="2503a-217">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="2503a-217">Availability considerations</span></span>

<span data-ttu-id="2503a-218">Komplex N szintű alkalmazás esetén előfordulhat, hogy nem kell replikálnia a teljes alkalmazást a másodlagos régióba.</span><span class="sxs-lookup"><span data-stu-id="2503a-218">With a complex N-tier app, you may not need to replicate the entire application in the secondary region.</span></span> <span data-ttu-id="2503a-219">Ehelyett elég lehet replikálni egy kritikus fontosságú alrendszert, amely az üzletmenet folytonosságának fenntartásához szükséges.</span><span class="sxs-lookup"><span data-stu-id="2503a-219">Instead, you might just replicate a critical subsystem that is needed to support business continuity.</span></span>

<span data-ttu-id="2503a-220">A Traffic Manager a rendszer egyik lehetséges meghibásodási pontja.</span><span class="sxs-lookup"><span data-stu-id="2503a-220">Traffic Manager is a possible failure point in the system.</span></span> <span data-ttu-id="2503a-221">Ha a Traffic Manager szolgáltatás meghibásodik, az ügyfelek a leállás ideje alatt nem érhetik el az alkalmazást.</span><span class="sxs-lookup"><span data-stu-id="2503a-221">If the Traffic Manager service fails, clients cannot access your application during the downtime.</span></span> <span data-ttu-id="2503a-222">Tekintse át a [Traffic Manager szolgáltatói szerződését][tm-sla], és döntse el, hogy a Traffic Manager egyedüli használata elegendő-e vállalata magas rendelkezésre állásra vonatkozó követelményeihez.</span><span class="sxs-lookup"><span data-stu-id="2503a-222">Review the [Traffic Manager SLA][tm-sla], and determine whether using Traffic Manager alone meets your business requirements for high availability.</span></span> <span data-ttu-id="2503a-223">Ha nem, akkor a biztonság érdekében érdemes lehet hozzáadni egy másik forgalomkezelési szolgáltatást a feladat-visszavételhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-223">If not, consider adding another traffic management solution as a failback.</span></span> <span data-ttu-id="2503a-224">Ha az Azure Traffic Manager szolgáltatás meghibásodik, módosítsa a CNAME rekordját a DNS-ben úgy, hogy a többi forgalomkezelő szolgáltatásra mutasson.</span><span class="sxs-lookup"><span data-stu-id="2503a-224">If the Azure Traffic Manager service fails, change your CNAME records in DNS to point to the other traffic management service.</span></span> <span data-ttu-id="2503a-225">(Ezt a lépést manuálisan kell elvégezni. Amíg a DNS-módosítások érvénybe nem lépnek, az alkalmazás nem lesz elérhető.)</span><span class="sxs-lookup"><span data-stu-id="2503a-225">(This step must be performed manually, and your application will be unavailable until the DNS changes are propagated.)</span></span>

<span data-ttu-id="2503a-226">Az SQL Server-fürt esetében két feladatátvételi forgatókönyvet kell figyelembe venni:</span><span class="sxs-lookup"><span data-stu-id="2503a-226">For the SQL Server cluster, there are two failover scenarios to consider:</span></span>

- <span data-ttu-id="2503a-227">Az összes SQL Server-adatbázisreplika meghibásodik az elsődleges régióban.</span><span class="sxs-lookup"><span data-stu-id="2503a-227">All of the SQL Server database replicas in the primary region fail.</span></span> <span data-ttu-id="2503a-228">Ez például regionális kimaradás során fordulhat elő.</span><span class="sxs-lookup"><span data-stu-id="2503a-228">For example, this could happen during a regional outage.</span></span> <span data-ttu-id="2503a-229">Ebben az esetben manuálisan kell elvégeznie a rendelkezésre állási csoport feladatátvételét, annak ellenére, hogy a Traffic Manager az előtérben automatikusan elvégzi a feladatátvételt.</span><span class="sxs-lookup"><span data-stu-id="2503a-229">In that case, you must manually fail over the availability group, even though Traffic Manager automatically fails over on the front end.</span></span> <span data-ttu-id="2503a-230">Kövesse a [Kényszerített manuális feladatátvétel elvégzése SQL Server rendelkezésre állási csoporton](https://msdn.microsoft.com/library/ff877957.aspx) című cikk lépéseit. A cikk leírja, hogyan végezhető kényszerített feladatátvétel az SQL Server Management Studio, a Transact-SQL vagy a PowerShell használatával az SQL Server 2016-ban.</span><span class="sxs-lookup"><span data-stu-id="2503a-230">Follow the steps in [Perform a Forced Manual Failover of a SQL Server Availability Group](https://msdn.microsoft.com/library/ff877957.aspx), which describes how to perform a forced failover by using SQL Server Management Studio, Transact-SQL, or PowerShell in SQL Server 2016.</span></span>

   > [!WARNING]
   > <span data-ttu-id="2503a-231">A kényszerített feladatátvétel esetében adatvesztés fordulhat elő.</span><span class="sxs-lookup"><span data-stu-id="2503a-231">With forced failover, there is a risk of data loss.</span></span> <span data-ttu-id="2503a-232">Amint az elsődleges régió újra elérhetővé válik, készítsen pillanatfelvételt az adatbázisról, és használja a [tablediff] parancsot a különbségek megkereséséhez.</span><span class="sxs-lookup"><span data-stu-id="2503a-232">Once the primary region is back online, take a snapshot of the database and use [tablediff] to find the differences.</span></span>

- <span data-ttu-id="2503a-233">A Traffic Manager átadja a feladatokat a másodlagos régiónak, de az elsődleges SQL Server-adatbázisreplika továbbra is elérhető marad.</span><span class="sxs-lookup"><span data-stu-id="2503a-233">Traffic Manager fails over to the secondary region, but the primary SQL Server database replica is still available.</span></span> <span data-ttu-id="2503a-234">Például előfordulhat, hogy az előtérréteg meghibásodik, de ez nincs hatással az SQL Servert futtató virtuális gépekre.</span><span class="sxs-lookup"><span data-stu-id="2503a-234">For example, the front-end tier might fail, without affecting the SQL Server VMs.</span></span> <span data-ttu-id="2503a-235">Ebben az esetben a rendszer átirányítja az internetes forgalmat a másodlagos régióba, és ez a régió továbbra is csatlakozhat az elsődleges replikához.</span><span class="sxs-lookup"><span data-stu-id="2503a-235">In that case, Internet traffic is routed to the secondary region, and that region can still connect to the primary replica.</span></span> <span data-ttu-id="2503a-236">Ekkor azonban nagyobb lesz a késés, mivel az SQL Server-kapcsolatoknak több régión kell áthaladniuk.</span><span class="sxs-lookup"><span data-stu-id="2503a-236">However, there will be increased latency, because the SQL Server connections are going across regions.</span></span> <span data-ttu-id="2503a-237">Ebben a helyzetben manuálisan kell végrehajtania a feladatátvételt az alábbiak szerint:</span><span class="sxs-lookup"><span data-stu-id="2503a-237">In this situation, you should perform a manual failover as follows:</span></span>

   1. <span data-ttu-id="2503a-238">Ideiglenesen állítson át egy SQL Server-adatbázisreplikát a másodlagos régióban *szinkron* véglegesítésre.</span><span class="sxs-lookup"><span data-stu-id="2503a-238">Temporarily switch a SQL Server database replica in the secondary region to *synchronous* commit.</span></span> <span data-ttu-id="2503a-239">Ez biztosítja, hogy ne legyen adatvesztés a feladatátvétel során.</span><span class="sxs-lookup"><span data-stu-id="2503a-239">This ensures there won't be data loss during the failover.</span></span>
   2. <span data-ttu-id="2503a-240">Végezze el a feladatátvételt erre a replikára.</span><span class="sxs-lookup"><span data-stu-id="2503a-240">Fail over to that replica.</span></span>
   3. <span data-ttu-id="2503a-241">Miután megtörtént a feladat-visszavétel az elsődleges régióra, állítsa vissza az aszinkron véglegesítést.</span><span class="sxs-lookup"><span data-stu-id="2503a-241">When you fail back to the primary region, restore the asynchronous commit setting.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="2503a-242">Felügyeleti szempontok</span><span class="sxs-lookup"><span data-stu-id="2503a-242">Manageability considerations</span></span>

<span data-ttu-id="2503a-243">Amikor frissíti az üzemelő példányt, egyszerre egy régiót frissítsen. Ezzel csökkenthető a nem megfelelő konfiguráció vagy az alkalmazásban felmerülő hiba okozta globális meghibásodás esélye.</span><span class="sxs-lookup"><span data-stu-id="2503a-243">When you update your deployment, update one region at a time to reduce the chance of a global failure from an incorrect configuration or an error in the application.</span></span>

<span data-ttu-id="2503a-244">Tesztelje a rendszer meghibásodásokkal szembeni rugalmasságát.</span><span class="sxs-lookup"><span data-stu-id="2503a-244">Test the resiliency of the system to failures.</span></span> <span data-ttu-id="2503a-245">Alább található néhány gyakori meghibásodási helyzet:</span><span class="sxs-lookup"><span data-stu-id="2503a-245">Here are some common failure scenarios to test:</span></span>

- <span data-ttu-id="2503a-246">Állítson le virtuálisgép-példányokat.</span><span class="sxs-lookup"><span data-stu-id="2503a-246">Shut down VM instances.</span></span>
- <span data-ttu-id="2503a-247">Terhelje az erőforrásokat, például a processzort és a memóriát.</span><span class="sxs-lookup"><span data-stu-id="2503a-247">Pressure resources such as CPU and memory.</span></span>
- <span data-ttu-id="2503a-248">Bontsa/késleltesse a hálózati kapcsolatot.</span><span class="sxs-lookup"><span data-stu-id="2503a-248">Disconnect/delay network.</span></span>
- <span data-ttu-id="2503a-249">Váltsa ki egyes folyamatok összeomlását.</span><span class="sxs-lookup"><span data-stu-id="2503a-249">Crash processes.</span></span>
- <span data-ttu-id="2503a-250">Alkalmazzon lejárt tanúsítványokat.</span><span class="sxs-lookup"><span data-stu-id="2503a-250">Expire certificates.</span></span>
- <span data-ttu-id="2503a-251">Szimuláljon hardverhibákat.</span><span class="sxs-lookup"><span data-stu-id="2503a-251">Simulate hardware faults.</span></span>
- <span data-ttu-id="2503a-252">Állítsa le a DNS-szolgáltatást a tartományvezérlőkön.</span><span class="sxs-lookup"><span data-stu-id="2503a-252">Shut down the DNS service on the domain controllers.</span></span>

<span data-ttu-id="2503a-253">Mérje meg a helyreállítási időtartamokat, és győződjön meg róla, hogy azok megfelelnek az üzleti követelményeinek.</span><span class="sxs-lookup"><span data-stu-id="2503a-253">Measure the recovery times and verify they meet your business requirements.</span></span> <span data-ttu-id="2503a-254">Több hibaállapot kombinációját is tesztelje.</span><span class="sxs-lookup"><span data-stu-id="2503a-254">Test combinations of failure modes, as well.</span></span>

## <a name="related-resources"></a><span data-ttu-id="2503a-255">Kapcsolódó források (lehet, hogy a cikkek angol nyelvűek)</span><span class="sxs-lookup"><span data-stu-id="2503a-255">Related resources</span></span>

<span data-ttu-id="2503a-256">Tekintse át az alábbiakat érdemes [Azure példaforgatókönyvek](/azure/architecture/example-scenario) , amelyek bemutatják, hogy egyes technológiákat használó adott megoldások:</span><span class="sxs-lookup"><span data-stu-id="2503a-256">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="2503a-257">A helyreállításhoz magas rendelkezésre állás és vészhelyreállítás az Azure-ban létrehozott többrétegű webalkalmazást</span><span class="sxs-lookup"><span data-stu-id="2503a-257">Multitier web application built for high availability and disaster recovery on Azure</span></span>](/azure/architecture/example-scenario/infrastructure/multi-tier-app-disaster-recovery)
- [<span data-ttu-id="2503a-258">Biztonságos webes alkalmazások létrehozása a Windows virtual machines az Azure-ban</span><span class="sxs-lookup"><span data-stu-id="2503a-258">Building secure web applications with Windows virtual machines on Azure</span></span>](/azure/architecture/example-scenario/infrastructure/regulated-multitier-app)

<!-- links -->

[hybrid-vpn]: ../hybrid-networking/vpn.md
[azure-dns]: /azure/dns/dns-overview
[azure-sla]: https://azure.microsoft.com/support/legal/sla/
[azure-sql-db]: /azure/sql-database/
[health-endpoint-monitoring-pattern]: https://msdn.microsoft.com/library/dn589789.aspx
[azure-cli]: /cli/azure/
[regional-pairs]: /azure/best-practices-availability-paired-regions
[resource groups]: /azure/azure-resource-manager/resource-group-overview
[resource-group-links]: /azure/resource-group-link-resources
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[services-by-region]: https://azure.microsoft.com/regions/#services
[sql-always-on]: https://msdn.microsoft.com/library/hh510230.aspx
[tablediff]: https://msdn.microsoft.com/library/ms162843.aspx
[tm-configure-failover]: /azure/traffic-manager/traffic-manager-configure-failover-routing-method
[tm-monitoring]: /azure/traffic-manager/traffic-manager-monitoring
[tm-routing]: /azure/traffic-manager/traffic-manager-routing-methods
[tm-sla]: https://azure.microsoft.com/support/legal/sla/traffic-manager
[traffic-manager]: https://azure.microsoft.com/services/traffic-manager
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[vnet-dns]: /azure/virtual-network/manage-virtual-network#change-dns-servers
[vnet-to-vnet]: /azure/vpn-gateway/vpn-gateway-vnet-vnet-rm-ps
[vpn-gateway]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[wsfc]: https://msdn.microsoft.com/library/hh270278.aspx
