---
title: SQL Servert használó N szintű alkalmazás Windows
titleSuffix: Azure Reference Architectures
description: Egy többrétegű architektúra megvalósítása az Azure-ban a rendelkezésre állás, biztonság, skálázhatósággal és kezelhetőséggel.
author: MikeWasson
ms.date: 11/12/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.openlocfilehash: 22bad71910509a112ecee3b3639b4444b6a3d6ed
ms.sourcegitcommit: 273e690c0cfabbc3822089c7d8bc743ef41d2b6e
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 02/08/2019
ms.locfileid: "55898000"
---
# <a name="windows-n-tier-application-on-azure-with-sql-server"></a><span data-ttu-id="b9cf2-103">Az Azure-ban az SQL Server Windows N szintű alkalmazás</span><span class="sxs-lookup"><span data-stu-id="b9cf2-103">Windows N-tier application on Azure with SQL Server</span></span>

<span data-ttu-id="b9cf2-104">Ez a referenciaarchitektúra bemutatja, hogyan helyezhet üzembe virtuális gépeket és a egy virtuális hálózatot konfigurált egy [N szintű](../../guide/architecture-styles/n-tier.md) alkalmazást, az SQL Server használatával a Windows az adatréteg számára.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-104">This reference architecture shows how to deploy VMs and a virtual network configured for an [N-tier](../../guide/architecture-styles/n-tier.md) application, using SQL Server on Windows for the data tier.</span></span> <span data-ttu-id="b9cf2-105">[**A megoldás üzembe helyezése.**](#deploy-the-solution)</span><span class="sxs-lookup"><span data-stu-id="b9cf2-105">[**Deploy this solution**](#deploy-the-solution).</span></span>

![N szintű architektúrához a Microsoft Azure](./images/n-tier-sql-server.png)

<span data-ttu-id="b9cf2-107">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="b9cf2-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="b9cf2-108">Architektúra</span><span class="sxs-lookup"><span data-stu-id="b9cf2-108">Architecture</span></span>

<span data-ttu-id="b9cf2-109">Az architektúra a következő összetevőkből áll:</span><span class="sxs-lookup"><span data-stu-id="b9cf2-109">The architecture has the following components:</span></span>

- <span data-ttu-id="b9cf2-110">**Erőforráscsoport**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-110">**Resource group**.</span></span> <span data-ttu-id="b9cf2-111">Az [erőforráscsoportok][resource-manager-overview] az erőforrások csoportosítására használhatók, így élettartamuk, tulajdonosuk vagy egyéb jellemzőik alapján kezelhetők.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-111">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>

- <span data-ttu-id="b9cf2-112">**Virtuális hálózat (VNet) és alhálózatok**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-112">**Virtual network (VNet) and subnets**.</span></span> <span data-ttu-id="b9cf2-113">Minden Azure VM egy alhálózatokra osztható virtuális hálózatban van üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-113">Every Azure VM is deployed into a VNet that can be segmented into subnets.</span></span> <span data-ttu-id="b9cf2-114">Hozzon létre egy külön alhálózatot minden egyes szinthez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-114">Create a separate subnet for each tier.</span></span>

- <span data-ttu-id="b9cf2-115">**Az Application gateway**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-115">**Application gateway**.</span></span> <span data-ttu-id="b9cf2-116">[Az Azure Application Gateway](/azure/application-gateway/) egy 7. rétegbeli terheléselosztó.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-116">[Azure Application Gateway](/azure/application-gateway/) is a layer 7 load balancer.</span></span> <span data-ttu-id="b9cf2-117">Ebben az architektúrában, a web front end irányítja a HTTP-kérelmekre.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-117">In this architecture, it routes HTTP requests to the web front end.</span></span> <span data-ttu-id="b9cf2-118">Az Application Gateway is biztosít egy [webalkalmazási tűzfal](/azure/application-gateway/waf-overview) (WAF) az alkalmazás, amely védi a gyakori támadások és biztonsági rések.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-118">Application Gateway also provides a [web application firewall](/azure/application-gateway/waf-overview) (WAF) that protects the application from common exploits and vulnerabilities.</span></span>

- <span data-ttu-id="b9cf2-119">**NSG-k**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-119">**NSGs**.</span></span> <span data-ttu-id="b9cf2-120">Használjon [hálózati biztonsági csoportokat][nsg] (NSG-ket) a hálózati forgalom korlátozására a virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-120">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="b9cf2-121">Például a háromrétegű architektúra itt látható, az adatbázisszinten nem fogadja el a web front end, csak az üzleti szint és a felügyeleti alhálózatról érkező forgalmat.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-121">For example, in the three-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>

- <span data-ttu-id="b9cf2-122">**A DDoS Protection**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-122">**DDoS Protection**.</span></span> <span data-ttu-id="b9cf2-123">Bár az Azure platform lehetővé teszi, hogy alapvető védelmet az elosztott szolgáltatásmegtagadási (DDoS-) támadások ellen, javasoljuk a [DDoS Protection Standard][ddos], amely továbbfejlesztett DDoS-támadás kockázatcsökkentése szolgáltatások.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-123">Although the Azure platform provides basic protection against distributed denial of service (DDoS) attacks, we recommend using [DDoS Protection Standard][ddos], which has enhanced DDoS mitigation features.</span></span> <span data-ttu-id="b9cf2-124">Lásd: [biztonsági szempontok](#security-considerations).</span><span class="sxs-lookup"><span data-stu-id="b9cf2-124">See [Security considerations](#security-considerations).</span></span>

- <span data-ttu-id="b9cf2-125">**Virtuális gépek**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-125">**Virtual machines**.</span></span> <span data-ttu-id="b9cf2-126">Javaslatok a virtuális gépek konfigurálása, lásd: [Windows virtuális gépek futtatása az Azure-beli](./windows-vm.md) és [Linux rendszerű virtuális gép futtatása az Azure-ban](./linux-vm.md).</span><span class="sxs-lookup"><span data-stu-id="b9cf2-126">For recommendations on configuring VMs, see [Run a Windows VM on Azure](./windows-vm.md) and [Run a Linux VM on Azure](./linux-vm.md).</span></span>

- <span data-ttu-id="b9cf2-127">**Rendelkezésre állási csoportok**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-127">**Availability sets**.</span></span> <span data-ttu-id="b9cf2-128">Hozzon létre egy [rendelkezésre állási csoport] [ azure-availability-sets] mindegyik réteghez, és az egyes szintek, amelyek a virtuális gépek így magasabb szintű támogatásra jogosult legalább két virtuális gép kiépítése [szolgáltatói szerződést (SLA)] [ vm-sla].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-128">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier, which makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla].</span></span>

- <span data-ttu-id="b9cf2-129">**Terheléselosztók**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-129">**Load balancers**.</span></span> <span data-ttu-id="b9cf2-130">Használat [Azure Load Balancer] [ load-balancer] a webes szintről az üzleti szint és az üzleti szint az SQL-kiszolgálóra irányuló hálózati forgalom elosztására.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-130">Use [Azure Load Balancer][load-balancer] to distribute network traffic from the web tier to the business tier, and from the business tier to SQL Server.</span></span>

- <span data-ttu-id="b9cf2-131">**Nyilvános IP-cím**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-131">**Public IP address**.</span></span> <span data-ttu-id="b9cf2-132">Az alkalmazás internetes forgalmat fogadó nyilvános IP-cím van szükség.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-132">A public IP address is needed for the application to receive Internet traffic.</span></span>

- <span data-ttu-id="b9cf2-133">**Jumpbox**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-133">**Jumpbox**.</span></span> <span data-ttu-id="b9cf2-134">Más néven [bástyagazdagép].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-134">Also called a [bastion host].</span></span> <span data-ttu-id="b9cf2-135">A hálózaton található biztonságos virtuális gép, amelyet a rendszergazdák a többi virtuális géphez való kapcsolódásra használnak.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-135">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="b9cf2-136">A jumpbox olyan NSG-vel rendelkezik, amely csak a biztonságos elemek listáján szereplő nyilvános IP-címekről érkező távoli forgalmat engedélyezi.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-136">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="b9cf2-137">Az NSG-nek engedélyeznie kell a távoli asztali (RDP) forgalmat.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-137">The NSG should permit remote desktop (RDP) traffic.</span></span>

- <span data-ttu-id="b9cf2-138">**SQL Server Always On rendelkezésre állási csoport**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-138">**SQL Server Always On Availability Group**.</span></span> <span data-ttu-id="b9cf2-139">Magas rendelkezésre állást biztosít az adatszinten a replikáció és a feladatátvétel engedélyezésével.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-139">Provides high availability at the data tier, by enabling replication and failover.</span></span> <span data-ttu-id="b9cf2-140">Windows Server feladatátvételi fürt (WSFC) technológiát használ a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-140">It uses Windows Server Failover Cluster (WSFC) technology for failover.</span></span>

- <span data-ttu-id="b9cf2-141">**(AD DS) Active Directory Domain Services-kiszolgálók**</span><span class="sxs-lookup"><span data-stu-id="b9cf2-141">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="b9cf2-142">A feladatátvevő fürt és a kapcsolódó fürtözött szerepkörök számítógép-objektumai jönnek létre az Active Directory Domain Servicesben (AD DS).</span><span class="sxs-lookup"><span data-stu-id="b9cf2-142">The computer objects for the failover cluster and its associated clustered roles are created in Active Directory Domain Services (AD DS).</span></span>

- <span data-ttu-id="b9cf2-143">**Felhőbeli tanúsító**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-143">**Cloud Witness**.</span></span> <span data-ttu-id="b9cf2-144">A feladatátvevő fürtök csomópontjainak futnia kell, amelyről ismert, hogy a kvórum több mint felét van szükség.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-144">A failover cluster requires more than half of its nodes to be running, which is known as having quorum.</span></span> <span data-ttu-id="b9cf2-145">Ha a fürt csak két csomópontot tartalmaz, egy hálózati partíció okozhat, minden csomóponthoz gondolja, hogy a fő csomóponttal.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-145">If the cluster has just two nodes, a network partition could cause each node to think it's the master node.</span></span> <span data-ttu-id="b9cf2-146">Ebben az esetben van szüksége egy *tanúsító* ties felosztása és kvórumot hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-146">In that case, you need a *witness* to break ties and establish quorum.</span></span> <span data-ttu-id="b9cf2-147">Tanúsító például a megosztott lemezzel működő, egy tie megszakító kvórumot hozzon létre egy erőforrást.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-147">A witness is a resource such as a shared disk that can act as a tie breaker to establish quorum.</span></span> <span data-ttu-id="b9cf2-148">Felhőbeli tanúsító egy olyan típusú, amelyet az Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-148">Cloud Witness is a type of witness that uses Azure Blob Storage.</span></span> <span data-ttu-id="b9cf2-149">A kvórum fogalmát kapcsolatos további információkért lásd: [ismertetése fürt és a készlet kvórum](/windows-server/storage/storage-spaces/understand-quorum).</span><span class="sxs-lookup"><span data-stu-id="b9cf2-149">To learn more about the concept of quorum, see [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum).</span></span> <span data-ttu-id="b9cf2-150">További információ a Felhőbeli tanúsító: [Felhőbeli tanúsító telepítése feladatátvevő fürt](/windows-server/failover-clustering/deploy-cloud-witness).</span><span class="sxs-lookup"><span data-stu-id="b9cf2-150">For more information about Cloud Witness, see [Deploy a Cloud Witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness).</span></span>

- <span data-ttu-id="b9cf2-151">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-151">**Azure DNS**.</span></span> <span data-ttu-id="b9cf2-152">[Az Azure DNS] [ azure-dns] DNS-tartományok egy üzemeltetési szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-152">[Azure DNS][azure-dns] is a hosting service for DNS domains.</span></span> <span data-ttu-id="b9cf2-153">A Microsoft Azure infrastruktúráját használja a névfeloldást biztosít.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-153">It provides name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="b9cf2-154">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-154">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

## <a name="recommendations"></a><span data-ttu-id="b9cf2-155">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="b9cf2-155">Recommendations</span></span>

<span data-ttu-id="b9cf2-156">Az Ön követelményei eltérhetnek az itt leírt architektúrától.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-156">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="b9cf2-157">Ezeket a javaslatokat tekintse kiindulópontnak.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-157">Use these recommendations as a starting point.</span></span>

### <a name="vnet--subnets"></a><span data-ttu-id="b9cf2-158">Virtuális hálózat/alhálózatok</span><span class="sxs-lookup"><span data-stu-id="b9cf2-158">VNet / Subnets</span></span>

<span data-ttu-id="b9cf2-159">A virtuális hálózat létrehozásakor határozza meg az egyes alhálózatok erőforrásai által igényelt IP-címek számát.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-159">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="b9cf2-160">[CIDR] jelöléssel adjon meg egy alhálózati maszkot és egy virtuális hálózati címtartományt, amely elég nagy a szükséges IP-címekhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-160">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="b9cf2-161">Használjon a szabványos [magánhálózati IP-címblokkokba][private-ip-space] eső címterületet. Ezek az IP-címblokkok a következők: 10.0.0.0/8, 172.16.0.0/12 és 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-161">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="b9cf2-162">Válasszon olyan címtartományt, amely nincs átfedésben a helyszíni hálózattal, arra az esetre, ha később átjárót kell beállítania a virtuális hálózat és a helyszíni hálózat között.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-162">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="b9cf2-163">A virtuális hálózat létrehozása után a címtartomány nem módosítható.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-163">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="b9cf2-164">Az alhálózatokat a funkciók és a biztonsági követelmények szem előtt tartásával tervezze meg.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-164">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="b9cf2-165">Minden ugyanazon szinthez vagy szerepkörhöz tartozó virtuális gépnek egyazon alhálózaton kell lennie. Ez az alhálózat biztonsági korlátot is képezhet.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-165">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="b9cf2-166">A virtuális hálózatok és alhálózatok megtervezésével kapcsolatos további információkért lásd az [Azure-beli virtuális hálózatok tervezésével és kialakításával][plan-network] foglalkozó témakört.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-166">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

### <a name="load-balancers"></a><span data-ttu-id="b9cf2-167">Terheléselosztók</span><span class="sxs-lookup"><span data-stu-id="b9cf2-167">Load balancers</span></span>

<span data-ttu-id="b9cf2-168">Nem teszik elérhetővé a virtuális gépek közvetlenül az internethez, de ehelyett adjon mindegyiknek privát IP-címet.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-168">Don't expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="b9cf2-169">Az Application Gateway társított nyilvános IP-cím használatával az ügyfelek csatlakoznak.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-169">Clients connect using the public IP address associated with the Application Gateway.</span></span>

<span data-ttu-id="b9cf2-170">Adja meg a terheléselosztó a virtuális gépek felé irányuló közvetlen hálózati forgalomra vonatkozó szabályait.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-170">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="b9cf2-171">Például HTTP-forgalom engedélyezéséhez képezze le a 80-as porton az előtérbeli konfigurációból a háttér-címkészletet a 80-as porton.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-171">For example, to enable HTTP traffic, map port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="b9cf2-172">Amikor egy ügyfél HTTP-kérelmet küld a 80-as port felé, a terheléselosztó kiválaszt egy háttérbeli IP-címet egy [kivonatoló algoritmus][load-balancer-hashing] használatával, amely tartalmazza a forrás IP-címét.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-172">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="b9cf2-173">Kérelmek megoszlanak a háttér-címkészletben levő összes virtuális gép között.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-173">Client requests are distributed across all the VMs in the back-end address pool.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="b9cf2-174">Network security groups (Hálózati biztonsági csoportok)</span><span class="sxs-lookup"><span data-stu-id="b9cf2-174">Network security groups</span></span>

<span data-ttu-id="b9cf2-175">A szintek közötti forgalmat NSG-szabályokkal korlátozhatja.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-175">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="b9cf2-176">A fenti három rétegű architektúrában a webes szint nem kommunikál közvetlenül az adatbázisszint.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-176">In the three-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="b9cf2-177">Ennek kényszerítése érdekében az adatbázisszintnek blokkolnia kell a webes szint alhálózatáról érkező bejövő forgalmat.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-177">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>

1. <span data-ttu-id="b9cf2-178">Megtagadási az összes bejövő forgalmat a virtuális hálózatról.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-178">Deny all inbound traffic from the VNet.</span></span> <span data-ttu-id="b9cf2-179">(A szabályban használja a `VIRTUAL_NETWORK` címkét.)</span><span class="sxs-lookup"><span data-stu-id="b9cf2-179">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span>
2. <span data-ttu-id="b9cf2-180">Az üzleti szint alhálózatáról érkező forgalom engedélyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-180">Allow inbound traffic from the business tier subnet.</span></span>
3. <span data-ttu-id="b9cf2-181">Az adatbázisszint alhálózatán érkező forgalom engedélyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-181">Allow inbound traffic from the database tier subnet itself.</span></span> <span data-ttu-id="b9cf2-182">Ez a szabály lehetővé teszi, hogy szükség van az adatbázis-replikáció és feladatátvételi adatbázis-beli virtuális gépek közötti kommunikációt.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-182">This rule allows communication between the database VMs, which is needed for database replication and failover.</span></span>
4. <span data-ttu-id="b9cf2-183">Engedélyezze az RDP-forgalom (3389-es port) a jumpbox alhálózatáról származó.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-183">Allow RDP traffic (port 3389) from the jumpbox subnet.</span></span> <span data-ttu-id="b9cf2-184">Ez lehetővé teszi, hogy a rendszergazdák csatlakozni tudjanak az adatbázisszinthez a jumpboxból.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-184">This rule lets administrators connect to the database tier from the jumpbox.</span></span>

<span data-ttu-id="b9cf2-185">2-szabályok létrehozása &ndash; magasabb prioritású, mint az első szabály, így azt felülbírálják a 4.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-185">Create rules 2 &ndash; 4 with higher priority than the first rule, so they override it.</span></span>

### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="b9cf2-186">SQL Server Always On rendelkezésre állási csoportok</span><span class="sxs-lookup"><span data-stu-id="b9cf2-186">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="b9cf2-187">Magas rendelkezésre állású SQL Server esetén az [Always On rendelkezésre állási csoportok] [ sql-alwayson] használatát javasoljuk.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-187">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="b9cf2-188">A Windows Server 2016-nál régebbi kiadásokban az Always On rendelkezésre állási csoportok tartományvezérlőt igényelnek, és a rendelkezésre állási csoport összes csomópontjának azonos AD-tartományban kell lennie.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-188">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="b9cf2-189">A többi szint egy [rendelkezésre állási csoport figyelőjén][sql-alwayson-listeners] keresztül csatlakozik az adatbázishoz.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-189">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="b9cf2-190">A figyelő lehetővé teszi, hogy az SQL-ügyfél anélkül csatlakozzon, hogy ismerné az SQL-kiszolgáló fizikai példányának nevét.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-190">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="b9cf2-191">Az adatbázishoz hozzáférő virtuális gépeket csatlakozni kell a tartományhoz.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-191">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="b9cf2-192">Az ügyfél (ebben az esetben egy másik szint) DNS használatával oldja fel a figyelő virtuális hálózati nevét IP-címekké.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-192">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="b9cf2-193">A SQL Server Always On rendelkezésre állási csoportot az alábbiak szerint konfigurálja:</span><span class="sxs-lookup"><span data-stu-id="b9cf2-193">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="b9cf2-194">Hozzon létre egy Windows Server feladatátvételi fürtszolgáltatási (WSFC-) fürtöt, egy SQL Server Always On rendelkezésre állási csoportot és egy elsődleges replikát.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-194">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="b9cf2-195">További információ: [Ismerkedés az Always On rendelkezésre állási csoportokkal][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-195">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span>
2. <span data-ttu-id="b9cf2-196">Hozzon létre egy belső terheléselosztót statikus magánhálózati IP-címmel.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-196">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="b9cf2-197">Hozzon létre egy figyelőt a rendelkezésre állási csoporthoz, és rendelje hozzá a figyelő DNS-nevét a belső terheléselosztó IP-címéhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-197">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span>
4. <span data-ttu-id="b9cf2-198">Hozzon létre egy terheléselosztó szabályt az SQL Server figyelőportjához (alapértelmezés szerint az 1433-as TCP-port).</span><span class="sxs-lookup"><span data-stu-id="b9cf2-198">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="b9cf2-199">A terheléselosztó szabálynak engedélyeznie kell a *nem fix IP-címek* használatát, más néven a közvetlen kiszolgálói választ.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-199">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="b9cf2-200">Ezáltal a virtuális gép közvetlenül válaszol az ügyfélnek, és közvetlen kapcsolatot hozható létre az elsődleges replikával.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-200">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>

   > [!NOTE]
   > <span data-ttu-id="b9cf2-201">Ha a nem fix IP engedélyezve van, az előtérbeli portszámnak egyeznie kell a terheléselosztó szabály háttérbeli portszámával.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-201">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
   >

<span data-ttu-id="b9cf2-202">Ha egy SQL-ügyfél csatlakozni próbál, a terheléselosztó továbbítja az elsődleges replikának a kapcsolódási kérelmet.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-202">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="b9cf2-203">Ha feladatátvételt egy másik replikára, a terheléselosztó automatikusan egy új elsődleges replikára irányítja a kérelmeket új.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-203">If there is a failover to another replica, the load balancer automatically routes new requests to a new primary replica.</span></span> <span data-ttu-id="b9cf2-204">További információ: [ILB-figyelő konfigurálása SQL Server Always On rendelkezésre állási csoportokhoz][sql-alwayson-ilb].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-204">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="b9cf2-205">A feladatátvétel során a meglévő ügyfélkapcsolatok lezárulnak.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-205">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="b9cf2-206">A feladatátvétel befejezése után a rendszer az új elsődleges replikára irányítja az új kapcsolatokat.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-206">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="b9cf2-207">Ha az alkalmazás olvasási műveleteinek száma lényegesen több, mint az írási műveleteteké, a csak olvasási lekérdezések egy részét kiszervezheti egy másodlagos replikára.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-207">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="b9cf2-208">Lásd: [Csak olvasási másodlagos replikához való csatlakozás figyelővel (csak olvasási útválasztás)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-208">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="b9cf2-209">[Kényszerítse][sql-alwayson-force-failover] a rendelkezésre állási csoport manuális feladatátvételét az üzemelő példány teszteléséhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-209">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="b9cf2-210">Jumpbox</span><span class="sxs-lookup"><span data-stu-id="b9cf2-210">Jumpbox</span></span>

<span data-ttu-id="b9cf2-211">Tiltása RDP-hozzáférés a nyilvános internetről való az alkalmazás számítási feladatait futtató virtuális gépek.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-211">Don't allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="b9cf2-212">Az ilyen virtuális gépek RDP-hozzáférésének ehelyett a jumpboxon keresztül kell történnie.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-212">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="b9cf2-213">A rendszergazda először bejelentkezik a jumpboxba, majd azon keresztül bejelentkezik a többi virtuális gépbe.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-213">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="b9cf2-214">A jumpbox engedélyezi az internetről érkező RDP-forgalmat, de csak az ismert, biztonságos IP-címekről.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-214">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="b9cf2-215">A jumpbox rendelkezik a minimális teljesítménykövetelményei, ezért kattintson egy kisméretű Virtuálisgép-méretet.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-215">The jumpbox has minimal performance requirements, so select a small VM size.</span></span> <span data-ttu-id="b9cf2-216">Hozzon létre egy [nyilvános IP-címet] a jumpbox számára.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-216">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="b9cf2-217">Helyezze a jumpboxot a többi virtuális géppel megegyező virtuális hálózatba, de egy külön felügyeleti alhálózaton legyen.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-217">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="b9cf2-218">A jumpbox védelmére, adja hozzá egy NSG-szabályt, amely RDP-kapcsolatok kizárólag a nyilvános IP-címkészletekről engedélyezi.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-218">To secure the jumpbox, add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="b9cf2-219">Állítsa be az NSG-t a többi alhálózathoz is úgy, hogy engedélyezzék a felügyeleti alhálózatból érkező RDP-forgalmat.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-219">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="b9cf2-220">Méretezési szempontok</span><span class="sxs-lookup"><span data-stu-id="b9cf2-220">Scalability considerations</span></span>

<span data-ttu-id="b9cf2-221">A web és business szintek, érdemes lehet használatával [a virtual machine scale sets][vmss], állítsa be a különálló virtuális gépek rendelkezésre állási környezetbe való üzembe helyezés helyett.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-221">For the web and business tiers, consider using [virtual machine scale sets][vmss], instead of deploying separate VMs into an availability set.</span></span> <span data-ttu-id="b9cf2-222">Egy méretezési csoportot egyszerűen üzembe helyezheti és kezelheti az azonos virtuális gépek és az automatikus méretezés a virtuális gépek teljesítmény-mérőszámok alapján.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-222">A scale set makes it easy to deploy and manage a set of identical VMs, and autoscale the VMs based on performance metrics.</span></span> <span data-ttu-id="b9cf2-223">Ahogy a terhelés növekszik a virtuális gépeken, a rendszer további virtuális gépeket ad a terheléselosztóhoz.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-223">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="b9cf2-224">Fontolja meg a méretezési csoportok használatát, ha virtuális gépek gyors horizontális felskálázására vagy automatikus méretezésre van szüksége.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-224">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="b9cf2-225">A méretezési csoportokban üzembe helyezett virtuális gépek konfigurálásának két alapvető módja van:</span><span class="sxs-lookup"><span data-stu-id="b9cf2-225">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="b9cf2-226">Bővítmények segítségével konfigurálhatja a virtuális Gépet a telepítés után.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-226">Use extensions to configure the VM after it's deployed.</span></span> <span data-ttu-id="b9cf2-227">Ezzel a módszerrel az új virtuálisgép-példányok indítása több időt vehet igénybe, mint a bővítmények nélküli virtuális gépeké.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-227">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="b9cf2-228">Üzembe helyezhet egy [felügyelt lemezt](/azure/storage/storage-managed-disks-overview) egy egyéni rendszerképpel.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-228">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="b9cf2-229">Ez a módszer gyorsabban kivitelezhető.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-229">This option may be quicker to deploy.</span></span> <span data-ttu-id="b9cf2-230">Azonban ez megköveteli, hogy a kép naprakészen.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-230">However, it requires you to keep the image up-to-date.</span></span>

<span data-ttu-id="b9cf2-231">További információkért lásd: [kialakítási szempontok a méretezési csoportok][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-231">For more information, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="b9cf2-232">Bármilyen automatikus méretezési megoldás használata esetén jóval előre tesztelje azt az éles környezetre jellemző mennyiségű számítási feladattal.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-232">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="b9cf2-233">Minden Azure-előfizetésre alapértelmezett korlátozások vonatkoznak. Ilyen például a régiónként alkalmazható virtuális gépek maximális száma.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-233">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="b9cf2-234">Támogatási kérelem kitöltésével megnövelheti ezt a korlátot.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-234">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="b9cf2-235">További információk: [Az Azure-előfizetések és -szolgáltatások korlátozásai, kvótái és megkötései][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-235">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="b9cf2-236">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="b9cf2-236">Availability considerations</span></span>

<span data-ttu-id="b9cf2-237">Ha nem használja a virtual machine scale sets, helyezzen virtuális gépet az azonos szinten egy rendelkezésre állási csoportba.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-237">If you don't use virtual machine scale sets, put VMs for the same tier into an availability set.</span></span> <span data-ttu-id="b9cf2-238">Hozzon létre legalább két virtuális gépet a rendelkezésre állási csoportban az [Azure-beli virtuális gépekre vonatkozó rendelkezésre állási SLA][vm-sla] támogatásához.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-238">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="b9cf2-239">További információk: [Virtuális gépek rendelkezésre állásának kezelése][availability-set].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-239">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> <span data-ttu-id="b9cf2-240">A méretezési csoportok automatikus használata *elhelyezési csoportra*, amely szerepét egy implicit rendelkezésre állási csoportot.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-240">Scale sets automatically use *placement groups*, which act as an implicit availability set.</span></span>

<span data-ttu-id="b9cf2-241">A terheléselosztó [állapotmintákat][health-probes] használ a virtuálisgép-példányok rendelkezésre állásának monitorozásához.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-241">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="b9cf2-242">Ha a mintavétel nem ér el egy példányt egy bizonyos időkorláton belül, a terheléselosztó nem irányít forgalmat küld a virtuális Gépeket.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-242">If a probe can't reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="b9cf2-243">A terheléselosztó ezután is folytatja a mintavételezést, és amint a virtuális gép újra elérhetővé válik, a terheléselosztó ismét elkezd forgalmat irányítani felé.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-243">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="b9cf2-244">Az alábbiakban néhány javaslat olvasható a terheléselosztó állapot-mintavételére vonatkozóan:</span><span class="sxs-lookup"><span data-stu-id="b9cf2-244">Here are some recommendations on load balancer health probes:</span></span>

- <span data-ttu-id="b9cf2-245">A mintavételek a HTTP-t vagy a TCP-t tesztelhetik.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-245">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="b9cf2-246">Ha a virtuális gépek HTTP-kiszolgálót futtatnak, HTTP-mintavételt hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-246">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="b9cf2-247">Egyéb esetben TCP-mintavételt hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-247">Otherwise create a TCP probe.</span></span>
- <span data-ttu-id="b9cf2-248">A HTTP-mintavétel esetében adjon meg elérési utat egy HTTP-végponthoz.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-248">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="b9cf2-249">A mintavétel 200-as HTTP-választ vár erről a megadott elérési útról.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-249">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="b9cf2-250">Az elérési út lehet a gyökér elérési útja ("/"), vagy a végpont, amely valamilyen egyéni logikát az alkalmazás állapotának ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-250">This path can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="b9cf2-251">A végpontnak engedélyeznie kell a névtelen HTTP-kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-251">The endpoint must allow anonymous HTTP requests.</span></span>
- <span data-ttu-id="b9cf2-252">A mintavétel [ismert IP-címről érkezik:][health-probe-ip] 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-252">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="b9cf2-253">Nem blokkolja a bejövő és kimenő forgalmat az IP-címről valamelyik tűzfalszabályzatban vagy NSG-szabályok a.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-253">Don't block traffic to or from this IP address in any firewall policies or NSG rules.</span></span>
- <span data-ttu-id="b9cf2-254">Az állapotminták állapotának megtekintéséhez használjon [állapotminta-naplókat][health-probe-log].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-254">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="b9cf2-255">Engedélyezze a naplózást az Azure Portalon minden egyes terheléselosztóra vonatkozóan.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-255">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="b9cf2-256">A naplókat a rendszer az Azure Blob Storage-ba írja.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-256">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="b9cf2-257">A naplók megmutatják, hány virtuális gépet nincsenek rájuk vonatkozó hálózati forgalom meghiúsult mintavételi válaszok miatt.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-257">The logs show how many VMs aren't getting network traffic because of failed probe responses.</span></span>

<span data-ttu-id="b9cf2-258">Ha van szüksége, mint a magasabb rendelkezésre állás a [Azure SLA-beli virtuális gépek] [ vm-sla] biztosít, fontolja meg replikációs az alkalmazást két régióban, az Azure Traffic Managerrel a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-258">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, consider replication the application across two regions, using Azure Traffic Manager for failover.</span></span> <span data-ttu-id="b9cf2-259">További információkért lásd: [többrégiós N szintű alkalmazás magas rendelkezésre állású][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-259">For more information, see [Multi-region N-tier application for high availability][multi-dc].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="b9cf2-260">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="b9cf2-260">Security considerations</span></span>

<span data-ttu-id="b9cf2-261">A virtuális hálózatok forgalomelkülönítési határok az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-261">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="b9cf2-262">Egy virtuális hálózaton található virtuális gépek nem tud közvetlenül kommunikálni egy másik virtuális hálózattal a virtuális gépeket.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-262">VMs in one VNet can't communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="b9cf2-263">Az azonos virtuális hálózatban elhelyezkedő virtuális gépek képesek a kommunikációra, hacsak [hálózati biztonsági csoportokat] [ nsg] (NSG-ket) nem hoz létre a forgalom korlátozására.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-263">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="b9cf2-264">További információ: [A Microsoft felhőszolgáltatásai és hálózati biztonság][network-security].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-264">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="b9cf2-265">**SZEGÉLYHÁLÓZAT (DMZ)**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-265">**DMZ**.</span></span> <span data-ttu-id="b9cf2-266">Érdemes lehet hozzáadnia egy hálózati virtuális berendezést (network virtual appliance, NVA), hogy DMZ-t lehessen létrehozni az internet és az Azure-beli virtuális hálózat között.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-266">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="b9cf2-267">Az NVA egy általános kifejezés egy olyan virtuális berendezésre, amely hálózatokhoz kapcsolódó feladatokat lát el, például gondoskodik a tűzfalról, a csomagvizsgálatról, a naplózásról és az egyéni útválasztásról.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-267">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="b9cf2-268">További információkért lásd a [DMZ az Azure és az internet közötti implementálásával][dmz] foglalkozó témakört.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-268">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

<span data-ttu-id="b9cf2-269">**Titkosítási**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-269">**Encryption**.</span></span> <span data-ttu-id="b9cf2-270">Titkosíthatja az inaktív bizalmas adatokat, és az [Azure Key Vaulttal][azure-key-vault] kezelheti az adatbázis titkosítási kulcsait.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-270">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="b9cf2-271">A Key Vault képes a hardveres biztonsági modulok (HSM-ek) titkosítási kulcsainak tárolására.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-271">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="b9cf2-272">További információkért lásd: [konfigurálása az Azure Key Vault-integráció az SQL Server Azure virtuális gépeken][sql-keyvault].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-272">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault].</span></span> <span data-ttu-id="b9cf2-273">Emellett ajánlott alkalmazások titkos adatait, például az adatbázis kapcsolati karakterláncainak tárolása a Key Vaultban.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-273">It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

<span data-ttu-id="b9cf2-274">**A DDoS protection**.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-274">**DDoS protection**.</span></span> <span data-ttu-id="b9cf2-275">Az Azure platform alapértelmezés szerint alapszintű DDoS elleni védelmet biztosít.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-275">The Azure platform provides basic DDoS protection by default.</span></span> <span data-ttu-id="b9cf2-276">Ez a alapvető védelem célja védelme az Azure-infrastruktúra egészében.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-276">This basic protection is targeted at protecting the Azure infrastructure as a whole.</span></span> <span data-ttu-id="b9cf2-277">Alapszintű DDoS elleni védelem automatikusan engedélyezve van, de javasoljuk a [DDoS Protection Standard][ddos].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-277">Although basic DDoS protection is automatically enabled, we recommend using [DDoS Protection Standard][ddos].</span></span> <span data-ttu-id="b9cf2-278">Standard szintű védelem használatával adaptív finomhangolási, az alkalmazás hálózati forgalmi minták alapján észlelheti a fenyegetéseket.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-278">Standard protection uses adaptive tuning, based on your application's network traffic patterns, to detect threats.</span></span> <span data-ttu-id="b9cf2-279">Ez lehetővé teszi, hogy az infrastruktúra-szintű DDoS szabályzatok egyébként észrevétlenül DDoS-támadásokkal szembeni tulajdonosaival.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-279">This allows it to apply mitigations against DDoS attacks that might go unnoticed by the infrastructure-wide DDoS policies.</span></span> <span data-ttu-id="b9cf2-280">Standard szintű védelmet is biztosít a riasztás, a telemetria és az Azure Monitor-analitikát.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-280">Standard protection also provides alerting, telemetry, and analytics through Azure Monitor.</span></span> <span data-ttu-id="b9cf2-281">További információkért lásd: [Azure DDoS Protection: Ajánlott eljárások és referenciaarchitektúrákat][ddos-best-practices].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-281">For more information, see [Azure DDoS Protection: Best practices and reference architectures][ddos-best-practices].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="b9cf2-282">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="b9cf2-282">Deploy the solution</span></span>

<span data-ttu-id="b9cf2-283">Ennek a referenciaarchitektúrának egy üzemelő példánya elérhető a [GitHubon][github-folder].</span><span class="sxs-lookup"><span data-stu-id="b9cf2-283">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="b9cf2-284">A teljes üzembe helyezés eltarthat akár két órát, amely tartalmazza az Active Directory tartományi szolgáltatások, a Windows Server feladatátvevő fürt és az SQL Server rendelkezésre állási csoport konfigurálása a szkriptek futtatására.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-284">The entire deployment can take up to two hours, which includes running the scripts to configure AD DS, the Windows Server failover cluster, and the SQL Server availability group.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="b9cf2-285">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="b9cf2-285">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deployment-steps"></a><span data-ttu-id="b9cf2-286">A központi telepítés lépései</span><span class="sxs-lookup"><span data-stu-id="b9cf2-286">Deployment steps</span></span>

1. <span data-ttu-id="b9cf2-287">A következő paranccsal hozzon létre egy erőforráscsoportot.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-287">Run the following command to create a resource group.</span></span>

    ```azurecli
    az group create --location <location> --name <resource-group-name>
    ```

2. <span data-ttu-id="b9cf2-288">A következő parancsot a Felhőbeli tanúsító a Storage-fiók létrehozása.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-288">Run the following command to create a Storage account for the Cloud Witness.</span></span>

    ```azurecli
    az storage account create --location <location> \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --sku Standard_LRS
    ```

3. <span data-ttu-id="b9cf2-289">Keresse meg a `virtual-machines\n-tier-windows` referencia architektúrák GitHub-adattár mappát.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-289">Navigate to the `virtual-machines\n-tier-windows` folder of the reference architectures GitHub repository.</span></span>

4. <span data-ttu-id="b9cf2-290">Nyissa meg az `n-tier-windows.json` fájlt.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-290">Open the `n-tier-windows.json` file.</span></span>

5. <span data-ttu-id="b9cf2-291">Keresse meg az "witnessStorageBlobEndPoint" összes példányát, és cserélje le a helyőrző szöveg a 2. lépés a tárfiók nevére.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-291">Search for all instances of "witnessStorageBlobEndPoint" and replace the placeholder text with the name of the Storage account from step 2.</span></span>

    ```json
    "witnessStorageBlobEndPoint": "https://[replace-with-storageaccountname].blob.core.windows.net",
    ```

6. <span data-ttu-id="b9cf2-292">A következő parancsot a tárfiók fiók kulcsainak listázása.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-292">Run the following command to list the account keys for the storage account.</span></span>

    ```azurecli
    az storage account keys list \
      --account-name <storage-account-name> \
      --resource-group <resource-group-name>
    ```

    <span data-ttu-id="b9cf2-293">A kimenet a következőhöz hasonlóan kell kinéznie.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-293">The output should look like the following.</span></span> <span data-ttu-id="b9cf2-294">Másolja a `key1` értékét.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-294">Copy the value of `key1`.</span></span>

    ```json
    [
    {
        "keyName": "key1",
        "permissions": "Full",
        "value": "..."
    },
    {
        "keyName": "key2",
        "permissions": "Full",
        "value": "..."
    }
    ]
    ```

7. <span data-ttu-id="b9cf2-295">Az a `n-tier-windows.json` fájlt, keressen a "witnessStorageAccountKey", és illessze be a fiókkulcsot.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-295">In the `n-tier-windows.json` file, search for all instances of "witnessStorageAccountKey" and paste in the account key.</span></span>

    ```json
    "witnessStorageAccountKey": "[replace-with-storagekey]"
    ```

8. <span data-ttu-id="b9cf2-296">Az a `n-tier-windows.json` fájlt, keresse meg az összes példányát `[replace-with-password]` és `[replace-with-sql-password]` egy erős jelszót cserélje le őket.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-296">In the `n-tier-windows.json` file, search for all instances of `[replace-with-password]` and `[replace-with-sql-password]` replace them with a strong password.</span></span> <span data-ttu-id="b9cf2-297">Mentse a fájlt.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-297">Save the file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b9cf2-298">Ha módosítja a rendszergazda felhasználóneve, frissíteni kell a `extensions` letiltja a JSON-fájlban.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-298">If you change the administrator user name, you must also update the `extensions` blocks in the JSON file.</span></span>

9. <span data-ttu-id="b9cf2-299">Futtassa a következő parancsot az architektúra üzembe helyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-299">Run the following command to deploy the architecture.</span></span>

    ```azurecli
    azbb -s <your subscription_id> -g <resource_group_name> -l <location> -p n-tier-windows.json --deploy
    ```

<span data-ttu-id="b9cf2-300">A mintául szolgáló referenciaarchitektúra Azure-építőelemekkel történő üzembe helyezéséről további információkat a [GitHub-adattárban][git] talál.</span><span class="sxs-lookup"><span data-stu-id="b9cf2-300">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>

## <a name="next-steps"></a><span data-ttu-id="b9cf2-301">További lépések</span><span class="sxs-lookup"><span data-stu-id="b9cf2-301">Next steps</span></span>

- [<span data-ttu-id="b9cf2-302">A Microsoft Learn modul: Bemutató: az N szintű architektúrastílus</span><span class="sxs-lookup"><span data-stu-id="b9cf2-302">Microsoft Learn module: Tour the N-tier architecture style</span></span>](/learn/modules/n-tier-architecture/)

<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-sql-server.md
[n-tier]: n-tier.md
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-dns]: /azure/dns/dns-overview
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[bástyagazdagép]: https://en.wikipedia.org/wiki/Bastion_host
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[ddos]: /azure/virtual-network/ddos-protection-overview
[ddos-best-practices]: /azure/security/azure-ddos-best-practices
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[nsg]: /azure/virtual-network/virtual-networks-nsg
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[nyilvános IP-címet]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[load-balancer]: /azure/load-balancer/
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[subscription-limits]: /azure/azure-subscription-service-limits
[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[network-security]: /azure/best-practices-network-security
