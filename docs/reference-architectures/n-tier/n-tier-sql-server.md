---
title: SQL Servert használó N szintű alkalmazás
description: Egy többrétegű architektúra megvalósítása az Azure-ban, a rendelkezésre állás, biztonság, skálázhatósággal és kezelhetőséggel módja.
author: MikeWasson
ms.date: 06/23/2018
ms.openlocfilehash: 7c8184d25cf6b3bd358adc2728329fd3bd08503a
ms.sourcegitcommit: 58d93e7ac9a6d44d5668a187a6827d7cd4f5a34d
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 07/02/2018
ms.locfileid: "37142301"
---
# <a name="n-tier-application-with-sql-server"></a><span data-ttu-id="40867-103">SQL Servert használó N szintű alkalmazás</span><span class="sxs-lookup"><span data-stu-id="40867-103">N-tier application with SQL Server</span></span>

<span data-ttu-id="40867-104">Ez a referenciaarchitektúra bemutatja, hogyan helyezhet üzembe a virtuális gépek és a egy N szintű alkalmazáshoz, a Windows SQL Server használata az adatréteg számára konfigurált virtuális hálózatot.</span><span class="sxs-lookup"><span data-stu-id="40867-104">This reference architecture shows how to deploy VMs and a virtual network configured for an N-tier application, using SQL Server on Windows for the data tier.</span></span> [<span data-ttu-id="40867-105">**A megoldás üzembe helyezése**.</span><span class="sxs-lookup"><span data-stu-id="40867-105">**Deploy this solution**.</span></span>](#deploy-the-solution) 

<span data-ttu-id="40867-106">![[0]][0]</span><span class="sxs-lookup"><span data-stu-id="40867-106">![[0]][0]</span></span>

<span data-ttu-id="40867-107">*Töltse le az architektúra [Visio-fájlját][visio-download].*</span><span class="sxs-lookup"><span data-stu-id="40867-107">*Download a [Visio file][visio-download] of this architecture.*</span></span>

## <a name="architecture"></a><span data-ttu-id="40867-108">Architektúra</span><span class="sxs-lookup"><span data-stu-id="40867-108">Architecture</span></span> 

<span data-ttu-id="40867-109">Az architektúra a következő összetevőkből áll:</span><span class="sxs-lookup"><span data-stu-id="40867-109">The architecture has the following components:</span></span>

* <span data-ttu-id="40867-110">**Erőforráscsoport.**</span><span class="sxs-lookup"><span data-stu-id="40867-110">**Resource group.**</span></span> <span data-ttu-id="40867-111">Az [erőforráscsoportok][resource-manager-overview] az erőforrások csoportosítására használhatók, így élettartamuk, tulajdonosuk vagy egyéb jellemzőik alapján kezelhetők.</span><span class="sxs-lookup"><span data-stu-id="40867-111">[Resource groups][resource-manager-overview] are used to group resources so they can be managed by lifetime, owner, or other criteria.</span></span>

* <span data-ttu-id="40867-112">**Virtuális hálózat (VNet) és alhálózatok.**</span><span class="sxs-lookup"><span data-stu-id="40867-112">**Virtual network (VNet) and subnets.**</span></span> <span data-ttu-id="40867-113">Az Azure-ban minden virtuális gép egy alhálózatokra osztható virtuális hálózatban van üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="40867-113">Every Azure VM is deployed into a VNet that can be segmented into multiple subnets.</span></span> <span data-ttu-id="40867-114">Hozzon létre egy külön alhálózatot minden egyes szinthez.</span><span class="sxs-lookup"><span data-stu-id="40867-114">Create a separate subnet for each tier.</span></span> 

* <span data-ttu-id="40867-115">**NSG-k**.</span><span class="sxs-lookup"><span data-stu-id="40867-115">**NSGs.**</span></span> <span data-ttu-id="40867-116">Használjon [hálózati biztonsági csoportokat][nsg] (NSG-ket) a hálózati forgalom korlátozására a virtuális hálózaton belül.</span><span class="sxs-lookup"><span data-stu-id="40867-116">Use [network security groups][nsg] (NSGs) to restrict network traffic within the VNet.</span></span> <span data-ttu-id="40867-117">Az itt látható 3 szintű architektúrában például az adatbázisszint csak az üzleti szintről és a felügyeleti alhálózatról érkező forgalmat fogadja, a webes kezelőfelület felől érkező forgalmat nem.</span><span class="sxs-lookup"><span data-stu-id="40867-117">For example, in the 3-tier architecture shown here, the database tier does not accept traffic from the web front end, only from the business tier and the management subnet.</span></span>

* <span data-ttu-id="40867-118">**Virtuális gépek**.</span><span class="sxs-lookup"><span data-stu-id="40867-118">**Virtual machines**.</span></span> <span data-ttu-id="40867-119">Javaslatok a virtuális gépek konfigurálása, lásd: [Windows virtuális gépek futtatása az Azure-beli](./windows-vm.md) és [Linux rendszerű virtuális gép futtatása az Azure-ban](./linux-vm.md).</span><span class="sxs-lookup"><span data-stu-id="40867-119">For recommendations on configuring VMs, see [Run a Windows VM on Azure](./windows-vm.md) and [Run a Linux VM on Azure](./linux-vm.md).</span></span>

* <span data-ttu-id="40867-120">**Rendelkezésre állási csoportok.**</span><span class="sxs-lookup"><span data-stu-id="40867-120">**Availability sets.**</span></span> <span data-ttu-id="40867-121">Hozzon létre egy [rendelkezésre állási csoportot][azure-availability-sets] minden szinthez, majd minden szinten építsen ki legalább két virtuális gépet.</span><span class="sxs-lookup"><span data-stu-id="40867-121">Create an [availability set][azure-availability-sets] for each tier, and provision at least two VMs in each tier.</span></span> <span data-ttu-id="40867-122">Így a virtuális gépek magasabb szintű [szolgáltatói szerződésre (SLA-ra)][vm-sla] jogosultak.</span><span class="sxs-lookup"><span data-stu-id="40867-122">This makes the VMs eligible for a higher [service level agreement (SLA)][vm-sla] for VMs.</span></span> 

* <span data-ttu-id="40867-123">**Virtuálisgép-méretezési csoportot** (nem látható).</span><span class="sxs-lookup"><span data-stu-id="40867-123">**VM scale set** (not shown).</span></span> <span data-ttu-id="40867-124">A [Virtuálisgép-méretezési csoportot] [ vmss] van egy rendelkezésre állási csoport használata helyett.</span><span class="sxs-lookup"><span data-stu-id="40867-124">A [VM scale set][vmss] is an alternative to using an availability set.</span></span> <span data-ttu-id="40867-125">A méretezési csoportok teszi egyszerűvé a horizontális felskálázás az egy szinten lévő virtuális gépek, vagy manuálisan vagy automatikusan előre meghatározott szabályok alapján.</span><span class="sxs-lookup"><span data-stu-id="40867-125">A scale sets makes it easy to scale out the VMs in a tier, either manually or automatically based on predefined rules.</span></span>

* <span data-ttu-id="40867-126">**Az Azure Load Balancer terheléselosztók.**</span><span class="sxs-lookup"><span data-stu-id="40867-126">**Azure Load balancers.**</span></span> <span data-ttu-id="40867-127">A [terheléselosztók] [ load-balancer] beérkező internetes kérelmeket a Virtuálisgép-példányok elosztása.</span><span class="sxs-lookup"><span data-stu-id="40867-127">The [load balancers][load-balancer] distribute incoming Internet requests to the VM instances.</span></span> <span data-ttu-id="40867-128">Használja a [nyilvános load balancer] [ load-balancer-external] terjeszteni a bejövő internetes forgalom webes szinten és a egy [belső load balancer] [ load-balancer-internal] , elosztja a hálózati forgalmat a webes szintről az üzleti szint.</span><span class="sxs-lookup"><span data-stu-id="40867-128">Use a [public load balancer][load-balancer-external] to distribute incoming Internet traffic to the web tier, and an [internal load balancer][load-balancer-internal] to distribute network traffic from the web tier to the business tier.</span></span>

* <span data-ttu-id="40867-129">**Nyilvános IP-cím**.</span><span class="sxs-lookup"><span data-stu-id="40867-129">**Public IP address**.</span></span> <span data-ttu-id="40867-130">A nyilvános load balancer az internetes forgalmat fogadó nyilvános IP-cím szükséges.</span><span class="sxs-lookup"><span data-stu-id="40867-130">A public IP address is needed for the public load balancer to receive Internet traffic.</span></span>

* <span data-ttu-id="40867-131">**Jumpbox.**</span><span class="sxs-lookup"><span data-stu-id="40867-131">**Jumpbox.**</span></span> <span data-ttu-id="40867-132">Más néven [bástyagazdagép].</span><span class="sxs-lookup"><span data-stu-id="40867-132">Also called a [bastion host].</span></span> <span data-ttu-id="40867-133">A hálózaton található biztonságos virtuális gép, amelyet a rendszergazdák a többi virtuális géphez való kapcsolódásra használnak.</span><span class="sxs-lookup"><span data-stu-id="40867-133">A secure VM on the network that administrators use to connect to the other VMs.</span></span> <span data-ttu-id="40867-134">A jumpbox olyan NSG-vel rendelkezik, amely csak a biztonságos elemek listáján szereplő nyilvános IP-címekről érkező távoli forgalmat engedélyezi.</span><span class="sxs-lookup"><span data-stu-id="40867-134">The jumpbox has an NSG that allows remote traffic only from public IP addresses on a safe list.</span></span> <span data-ttu-id="40867-135">Az NSG-nek engedélyeznie kell a távoli asztali (RDP) forgalmat.</span><span class="sxs-lookup"><span data-stu-id="40867-135">The NSG should permit remote desktop (RDP) traffic.</span></span>

* <span data-ttu-id="40867-136">**SQL Server Always On rendelkezésre állási csoport.**</span><span class="sxs-lookup"><span data-stu-id="40867-136">**SQL Server Always On Availability Group.**</span></span> <span data-ttu-id="40867-137">Magas rendelkezésre állást biztosít az adatszinten a replikáció és a feladatátvétel engedélyezésével.</span><span class="sxs-lookup"><span data-stu-id="40867-137">Provides high availability at the data tier, by enabling replication and failover.</span></span> <span data-ttu-id="40867-138">Windows Server feladatátvételi fürt (WSFC) technológiát használ a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="40867-138">It uses Windows Server Failover Cluster (WSFC) technology for failover.</span></span>

* <span data-ttu-id="40867-139">**(AD DS) Active Directory Domain Services-kiszolgálók**</span><span class="sxs-lookup"><span data-stu-id="40867-139">**Active Directory Domain Services (AD DS) Servers**.</span></span> <span data-ttu-id="40867-140">A feladatátvevő fürt és a kapcsolódó fürtözött szerepkörök számítógép-objektumai jönnek létre az Active Directory Domain Servicesben (AD DS).</span><span class="sxs-lookup"><span data-stu-id="40867-140">The computer objects for the failover cluster and its associated clustered roles are created in Active Directory Domain Services (AD DS).</span></span>

* <span data-ttu-id="40867-141">**Felhőbeli tanúsító**.</span><span class="sxs-lookup"><span data-stu-id="40867-141">**Cloud Witness**.</span></span> <span data-ttu-id="40867-142">A feladatátvevő fürtök csomópontjainak futnia kell, amelyről ismert, hogy a kvórum több mint felét van szükség.</span><span class="sxs-lookup"><span data-stu-id="40867-142">A failover cluster requires more than half of its nodes to be running, which is known as having quorum.</span></span> <span data-ttu-id="40867-143">Ha a fürt csak két csomópontot tartalmaz, egy hálózati partíció okozhat, minden csomóponthoz gondolja, hogy a fő csomóponttal.</span><span class="sxs-lookup"><span data-stu-id="40867-143">If the cluster has just two nodes, a network partition could cause each node to think it's the master node.</span></span> <span data-ttu-id="40867-144">Ebben az esetben van szüksége egy *tanúsító* ties felosztása és kvórumot hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="40867-144">In that case, you need a *witness* to break ties and establish quorum.</span></span> <span data-ttu-id="40867-145">Tanúsító például a megosztott lemezzel működő, egy tie megszakító kvórumot hozzon létre egy erőforrást.</span><span class="sxs-lookup"><span data-stu-id="40867-145">A witness is a resource such as a shared disk that can act as a tie breaker to establish quorum.</span></span> <span data-ttu-id="40867-146">Felhőbeli tanúsító egy olyan típusú, amelyet az Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="40867-146">Cloud Witness is a type of witness that uses Azure Blob Storage.</span></span> <span data-ttu-id="40867-147">A kvórum fogalmát kapcsolatos további információkért lásd: [ismertetése fürt és a készlet kvórum](/windows-server/storage/storage-spaces/understand-quorum).</span><span class="sxs-lookup"><span data-stu-id="40867-147">To learn more about the concept of quorum, see [Understanding cluster and pool quorum](/windows-server/storage/storage-spaces/understand-quorum).</span></span> <span data-ttu-id="40867-148">További információ a Felhőbeli tanúsító: [Felhőbeli tanúsító telepítése feladatátvevő fürt](/windows-server/failover-clustering/deploy-cloud-witness).</span><span class="sxs-lookup"><span data-stu-id="40867-148">For more information about Cloud Witness, see [Deploy a Cloud Witness for a Failover Cluster](/windows-server/failover-clustering/deploy-cloud-witness).</span></span> 

* <span data-ttu-id="40867-149">**Azure DNS**.</span><span class="sxs-lookup"><span data-stu-id="40867-149">**Azure DNS**.</span></span> <span data-ttu-id="40867-150">Az [Azure DNS][azure-dns] egy üzemeltetési szolgáltatás, amely a Microsoft Azure infrastruktúráját használja a DNS-tartományok névfeloldásához.</span><span class="sxs-lookup"><span data-stu-id="40867-150">[Azure DNS][azure-dns] is a hosting service for DNS domains, providing name resolution using Microsoft Azure infrastructure.</span></span> <span data-ttu-id="40867-151">Ha tartományait az Azure-ban üzemelteti, DNS-rekordjait a többi Azure-szolgáltatáshoz is használt hitelesítő adatokkal, API-kkal, eszközökkel és számlázási információkkal kezelheti.</span><span class="sxs-lookup"><span data-stu-id="40867-151">By hosting your domains in Azure, you can manage your DNS records using the same credentials, APIs, tools, and billing as your other Azure services.</span></span>

## <a name="recommendations"></a><span data-ttu-id="40867-152">Javaslatok</span><span class="sxs-lookup"><span data-stu-id="40867-152">Recommendations</span></span>

<span data-ttu-id="40867-153">Az Ön követelményei eltérhetnek az itt leírt architektúrától.</span><span class="sxs-lookup"><span data-stu-id="40867-153">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="40867-154">Ezeket a javaslatokat tekintse kiindulópontnak.</span><span class="sxs-lookup"><span data-stu-id="40867-154">Use these recommendations as a starting point.</span></span> 

### <a name="vnet--subnets"></a><span data-ttu-id="40867-155">Virtuális hálózat/alhálózatok</span><span class="sxs-lookup"><span data-stu-id="40867-155">VNet / Subnets</span></span>

<span data-ttu-id="40867-156">A virtuális hálózat létrehozásakor határozza meg az egyes alhálózatok erőforrásai által igényelt IP-címek számát.</span><span class="sxs-lookup"><span data-stu-id="40867-156">When you create the VNet, determine how many IP addresses your resources in each subnet require.</span></span> <span data-ttu-id="40867-157">[CIDR] jelöléssel adjon meg egy alhálózati maszkot és egy virtuális hálózati címtartományt, amely elég nagy a szükséges IP-címekhez.</span><span class="sxs-lookup"><span data-stu-id="40867-157">Specify a subnet mask and a VNet address range large enough for the required IP addresses, using [CIDR] notation.</span></span> <span data-ttu-id="40867-158">Használjon a szabványos [magánhálózati IP-címblokkokba][private-ip-space] eső címterületet. Ezek az IP-címblokkok a következők: 10.0.0.0/8, 172.16.0.0/12 és 192.168.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="40867-158">Use an address space that falls within the standard [private IP address blocks][private-ip-space], which are 10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16.</span></span>

<span data-ttu-id="40867-159">Válasszon olyan címtartományt, amely nincs átfedésben a helyszíni hálózattal, arra az esetre, ha később átjárót kell beállítania a virtuális hálózat és a helyszíni hálózat között.</span><span class="sxs-lookup"><span data-stu-id="40867-159">Choose an address range that does not overlap with your on-premises network, in case you need to set up a gateway between the VNet and your on-premise network later.</span></span> <span data-ttu-id="40867-160">A virtuális hálózat létrehozása után a címtartomány nem módosítható.</span><span class="sxs-lookup"><span data-stu-id="40867-160">Once you create the VNet, you can't change the address range.</span></span>

<span data-ttu-id="40867-161">Az alhálózatokat a funkciók és a biztonsági követelmények szem előtt tartásával tervezze meg.</span><span class="sxs-lookup"><span data-stu-id="40867-161">Design subnets with functionality and security requirements in mind.</span></span> <span data-ttu-id="40867-162">Minden ugyanazon szinthez vagy szerepkörhöz tartozó virtuális gépnek egyazon alhálózaton kell lennie. Ez az alhálózat biztonsági korlátot is képezhet.</span><span class="sxs-lookup"><span data-stu-id="40867-162">All VMs within the same tier or role should go into the same subnet, which can be a security boundary.</span></span> <span data-ttu-id="40867-163">A virtuális hálózatok és alhálózatok megtervezésével kapcsolatos további információkért lásd az [Azure-beli virtuális hálózatok tervezésével és kialakításával][plan-network] foglalkozó témakört.</span><span class="sxs-lookup"><span data-stu-id="40867-163">For more information about designing VNets and subnets, see [Plan and design Azure Virtual Networks][plan-network].</span></span>

### <a name="load-balancers"></a><span data-ttu-id="40867-164">Terheléselosztók</span><span class="sxs-lookup"><span data-stu-id="40867-164">Load balancers</span></span>

<span data-ttu-id="40867-165">Ne engedélyezze a virtuális gépek elérését közvetlenül az internetről – ehelyett adjon mindegyiknek privát IP-címet.</span><span class="sxs-lookup"><span data-stu-id="40867-165">Do not expose the VMs directly to the Internet, but instead give each VM a private IP address.</span></span> <span data-ttu-id="40867-166">Az IP-cím a nyilvános load Balancer használatával az ügyfelek csatlakoznak.</span><span class="sxs-lookup"><span data-stu-id="40867-166">Clients connect using the IP address of the public load balancer.</span></span>

<span data-ttu-id="40867-167">Adja meg a terheléselosztó a virtuális gépek felé irányuló közvetlen hálózati forgalomra vonatkozó szabályait.</span><span class="sxs-lookup"><span data-stu-id="40867-167">Define load balancer rules to direct network traffic to the VMs.</span></span> <span data-ttu-id="40867-168">Például a HTTP-forgalom engedélyezéséhez hozzon létre egy szabályt, amely hozzárendeli a 80-as portot az előtérbeli konfigurációból a háttércímkészletben található 80-as porthoz.</span><span class="sxs-lookup"><span data-stu-id="40867-168">For example, to enable HTTP traffic, create a rule that maps port 80 from the front-end configuration to port 80 on the back-end address pool.</span></span> <span data-ttu-id="40867-169">Amikor egy ügyfél HTTP-kérelmet küld a 80-as port felé, a terheléselosztó kiválaszt egy háttérbeli IP-címet egy [kivonatoló algoritmus][load-balancer-hashing] használatával, amely tartalmazza a forrás IP-címét.</span><span class="sxs-lookup"><span data-stu-id="40867-169">When a client sends an HTTP request to port 80, the load balancer selects a back-end IP address by using a [hashing algorithm][load-balancer-hashing] that includes the source IP address.</span></span> <span data-ttu-id="40867-170">Így a kérelmek megoszlanak az összes virtuális gép között.</span><span class="sxs-lookup"><span data-stu-id="40867-170">In that way, client requests are distributed across all the VMs.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="40867-171">Network security groups (Hálózati biztonsági csoportok)</span><span class="sxs-lookup"><span data-stu-id="40867-171">Network security groups</span></span>

<span data-ttu-id="40867-172">A szintek közötti forgalmat NSG-szabályokkal korlátozhatja.</span><span class="sxs-lookup"><span data-stu-id="40867-172">Use NSG rules to restrict traffic between tiers.</span></span> <span data-ttu-id="40867-173">A fenti 3 szintes architektúra esetén például a webes szint nem kommunikál közvetlenül az adatbázisszinttel.</span><span class="sxs-lookup"><span data-stu-id="40867-173">For example, in the 3-tier architecture shown above, the web tier does not communicate directly with the database tier.</span></span> <span data-ttu-id="40867-174">Ennek kényszerítése érdekében az adatbázisszintnek blokkolnia kell a webes szint alhálózatáról érkező bejövő forgalmat.</span><span class="sxs-lookup"><span data-stu-id="40867-174">To enforce this, the database tier should block incoming traffic from the web tier subnet.</span></span>  

1. <span data-ttu-id="40867-175">Megtagadási az összes bejövő forgalmat a virtuális hálózatról.</span><span class="sxs-lookup"><span data-stu-id="40867-175">Deny all inbound traffic from the VNet.</span></span> <span data-ttu-id="40867-176">(A szabályban használja a `VIRTUAL_NETWORK` címkét.)</span><span class="sxs-lookup"><span data-stu-id="40867-176">(Use the `VIRTUAL_NETWORK` tag in the rule.)</span></span> 
2. <span data-ttu-id="40867-177">Az üzleti szint alhálózatáról érkező forgalom engedélyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="40867-177">Allow inbound traffic from the business tier subnet.</span></span>  
3. <span data-ttu-id="40867-178">Az adatbázisszint alhálózatán érkező forgalom engedélyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="40867-178">Allow inbound traffic from the database tier subnet itself.</span></span> <span data-ttu-id="40867-179">Ez a szabály lehetővé teszi, hogy szükség van az adatbázis-replikáció és feladatátvételi adatbázis-beli virtuális gépek közötti kommunikációt.</span><span class="sxs-lookup"><span data-stu-id="40867-179">This rule allows communication between the database VMs, which is needed for database replication and failover.</span></span>
4. <span data-ttu-id="40867-180">Engedélyezze az RDP-forgalom (3389-es port) a jumpbox alhálózatáról származó.</span><span class="sxs-lookup"><span data-stu-id="40867-180">Allow RDP traffic (port 3389) from the jumpbox subnet.</span></span> <span data-ttu-id="40867-181">Ez lehetővé teszi, hogy a rendszergazdák csatlakozni tudjanak az adatbázisszinthez a jumpboxból.</span><span class="sxs-lookup"><span data-stu-id="40867-181">This rule lets administrators connect to the database tier from the jumpbox.</span></span>

<span data-ttu-id="40867-182">2-szabályok létrehozása &ndash; magasabb prioritású, mint az első szabály, így azt felülbírálják a 4.</span><span class="sxs-lookup"><span data-stu-id="40867-182">Create rules 2 &ndash; 4 with higher priority than the first rule, so they override it.</span></span>


### <a name="sql-server-always-on-availability-groups"></a><span data-ttu-id="40867-183">SQL Server Always On rendelkezésre állási csoportok</span><span class="sxs-lookup"><span data-stu-id="40867-183">SQL Server Always On Availability Groups</span></span>

<span data-ttu-id="40867-184">Magas rendelkezésre állású SQL Server esetén az [Always On rendelkezésre állási csoportok] [ sql-alwayson] használatát javasoljuk.</span><span class="sxs-lookup"><span data-stu-id="40867-184">We recommend [Always On Availability Groups][sql-alwayson] for SQL Server high availability.</span></span> <span data-ttu-id="40867-185">A Windows Server 2016-nál régebbi kiadásokban az Always On rendelkezésre állási csoportok tartományvezérlőt igényelnek, és a rendelkezésre állási csoport összes csomópontjának azonos AD-tartományban kell lennie.</span><span class="sxs-lookup"><span data-stu-id="40867-185">Prior to Windows Server 2016, Always On Availability Groups require a domain controller, and all nodes in the availability group must be in the same AD domain.</span></span>

<span data-ttu-id="40867-186">A többi szint egy [rendelkezésre állási csoport figyelőjén][sql-alwayson-listeners] keresztül csatlakozik az adatbázishoz.</span><span class="sxs-lookup"><span data-stu-id="40867-186">Other tiers connect to the database through an [availability group listener][sql-alwayson-listeners].</span></span> <span data-ttu-id="40867-187">A figyelő lehetővé teszi, hogy az SQL-ügyfél anélkül csatlakozzon, hogy ismerné az SQL-kiszolgáló fizikai példányának nevét.</span><span class="sxs-lookup"><span data-stu-id="40867-187">The listener enables a SQL client to connect without knowing the name of the physical instance of SQL Server.</span></span> <span data-ttu-id="40867-188">Az adatbázishoz hozzáférő virtuális gépeket csatlakozni kell a tartományhoz.</span><span class="sxs-lookup"><span data-stu-id="40867-188">VMs that access the database must be joined to the domain.</span></span> <span data-ttu-id="40867-189">Az ügyfél (ebben az esetben egy másik szint) DNS használatával oldja fel a figyelő virtuális hálózati nevét IP-címekké.</span><span class="sxs-lookup"><span data-stu-id="40867-189">The client (in this case, another tier) uses DNS to resolve the listener's virtual network name into IP addresses.</span></span>

<span data-ttu-id="40867-190">A SQL Server Always On rendelkezésre állási csoportot az alábbiak szerint konfigurálja:</span><span class="sxs-lookup"><span data-stu-id="40867-190">Configure the SQL Server Always On Availability Group as follows:</span></span>

1. <span data-ttu-id="40867-191">Hozzon létre egy Windows Server feladatátvételi fürtszolgáltatási (WSFC-) fürtöt, egy SQL Server Always On rendelkezésre állási csoportot és egy elsődleges replikát.</span><span class="sxs-lookup"><span data-stu-id="40867-191">Create a Windows Server Failover Clustering (WSFC) cluster, a SQL Server Always On Availability Group, and a primary replica.</span></span> <span data-ttu-id="40867-192">További információ: [Ismerkedés az Always On rendelkezésre állási csoportokkal][sql-alwayson-getting-started].</span><span class="sxs-lookup"><span data-stu-id="40867-192">For more information, see [Getting Started with Always On Availability Groups][sql-alwayson-getting-started].</span></span> 
2. <span data-ttu-id="40867-193">Hozzon létre egy belső terheléselosztót statikus magánhálózati IP-címmel.</span><span class="sxs-lookup"><span data-stu-id="40867-193">Create an internal load balancer with a static private IP address.</span></span>
3. <span data-ttu-id="40867-194">Hozzon létre egy figyelőt a rendelkezésre állási csoporthoz, és rendelje hozzá a figyelő DNS-nevét a belső terheléselosztó IP-címéhez.</span><span class="sxs-lookup"><span data-stu-id="40867-194">Create an availability group listener, and map the listener's DNS name to the IP address of an internal load balancer.</span></span> 
4. <span data-ttu-id="40867-195">Hozzon létre egy terheléselosztó szabályt az SQL Server figyelőportjához (alapértelmezés szerint az 1433-as TCP-port).</span><span class="sxs-lookup"><span data-stu-id="40867-195">Create a load balancer rule for the SQL Server listening port (TCP port 1433 by default).</span></span> <span data-ttu-id="40867-196">A terheléselosztó szabálynak engedélyeznie kell a *nem fix IP-címek* használatát, más néven a közvetlen kiszolgálói választ.</span><span class="sxs-lookup"><span data-stu-id="40867-196">The load balancer rule must enable *floating IP*, also called Direct Server Return.</span></span> <span data-ttu-id="40867-197">Ezáltal a virtuális gép közvetlenül válaszol az ügyfélnek, és közvetlen kapcsolatot hozható létre az elsődleges replikával.</span><span class="sxs-lookup"><span data-stu-id="40867-197">This causes the VM to reply directly to the client, which enables a direct connection to the primary replica.</span></span>
  
   > [!NOTE]
   > <span data-ttu-id="40867-198">Ha a nem fix IP engedélyezve van, az előtérbeli portszámnak egyeznie kell a terheléselosztó szabály háttérbeli portszámával.</span><span class="sxs-lookup"><span data-stu-id="40867-198">When floating IP is enabled, the front-end port number must be the same as the back-end port number in the load balancer rule.</span></span>
   > 
   > 

<span data-ttu-id="40867-199">Ha egy SQL-ügyfél csatlakozni próbál, a terheléselosztó továbbítja az elsődleges replikának a kapcsolódási kérelmet.</span><span class="sxs-lookup"><span data-stu-id="40867-199">When a SQL client tries to connect, the load balancer routes the connection request to the primary replica.</span></span> <span data-ttu-id="40867-200">Ha feladatátvitel történik egy másik replikára, akkor a terheléselosztó automatikusan egy új elsődleges replikához továbbítja a további kéréseket.</span><span class="sxs-lookup"><span data-stu-id="40867-200">If there is a failover to another replica, the load balancer automatically routes subsequent requests to a new primary replica.</span></span> <span data-ttu-id="40867-201">További információ: [ILB-figyelő konfigurálása SQL Server Always On rendelkezésre állási csoportokhoz][sql-alwayson-ilb].</span><span class="sxs-lookup"><span data-stu-id="40867-201">For more information, see [Configure an ILB listener for SQL Server Always On Availability Groups][sql-alwayson-ilb].</span></span>

<span data-ttu-id="40867-202">A feladatátvétel során a meglévő ügyfélkapcsolatok lezárulnak.</span><span class="sxs-lookup"><span data-stu-id="40867-202">During a failover, existing client connections are closed.</span></span> <span data-ttu-id="40867-203">A feladatátvétel befejezése után a rendszer az új elsődleges replikára irányítja az új kapcsolatokat.</span><span class="sxs-lookup"><span data-stu-id="40867-203">After the failover completes, new connections will be routed to the new primary replica.</span></span>

<span data-ttu-id="40867-204">Ha az alkalmazás olvasási műveleteinek száma lényegesen több, mint az írási műveleteteké, a csak olvasási lekérdezések egy részét kiszervezheti egy másodlagos replikára.</span><span class="sxs-lookup"><span data-stu-id="40867-204">If your application makes significantly more reads than writes, you can offload some of the read-only queries to a secondary replica.</span></span> <span data-ttu-id="40867-205">Lásd: [Csak olvasási másodlagos replikához való csatlakozás figyelővel (csak olvasási útválasztás)][sql-alwayson-read-only-routing].</span><span class="sxs-lookup"><span data-stu-id="40867-205">See [Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)][sql-alwayson-read-only-routing].</span></span>

<span data-ttu-id="40867-206">[Kényszerítse][sql-alwayson-force-failover] a rendelkezésre állási csoport manuális feladatátvételét az üzemelő példány teszteléséhez.</span><span class="sxs-lookup"><span data-stu-id="40867-206">Test your deployment by [forcing a manual failover][sql-alwayson-force-failover] of the availability group.</span></span>

### <a name="jumpbox"></a><span data-ttu-id="40867-207">Jumpbox</span><span class="sxs-lookup"><span data-stu-id="40867-207">Jumpbox</span></span>

<span data-ttu-id="40867-208">Az alkalmazás számítási feladatait futtató virtuális gépek nyilvános internetről való RDP-hozzáférését ne engedélyezze.</span><span class="sxs-lookup"><span data-stu-id="40867-208">Do not allow RDP access from the public Internet to the VMs that run the application workload.</span></span> <span data-ttu-id="40867-209">Az ilyen virtuális gépek RDP-hozzáférésének ehelyett a jumpboxon keresztül kell történnie.</span><span class="sxs-lookup"><span data-stu-id="40867-209">Instead, all RDP access to these VMs must come through the jumpbox.</span></span> <span data-ttu-id="40867-210">A rendszergazda először bejelentkezik a jumpboxba, majd azon keresztül bejelentkezik a többi virtuális gépbe.</span><span class="sxs-lookup"><span data-stu-id="40867-210">An administrator logs into the jumpbox, and then logs into the other VM from the jumpbox.</span></span> <span data-ttu-id="40867-211">A jumpbox engedélyezi az internetről érkező RDP-forgalmat, de csak az ismert, biztonságos IP-címekről.</span><span class="sxs-lookup"><span data-stu-id="40867-211">The jumpbox allows RDP traffic from the Internet, but only from known, safe IP addresses.</span></span>

<span data-ttu-id="40867-212">A jumpbox rendelkezik a minimális teljesítménykövetelményei, ezért kattintson egy kisméretű Virtuálisgép-méretet.</span><span class="sxs-lookup"><span data-stu-id="40867-212">The jumpbox has minimal performance requirements, so select a small VM size.</span></span> <span data-ttu-id="40867-213">Hozzon létre egy [nyilvános IP-cím] a jumpbox számára.</span><span class="sxs-lookup"><span data-stu-id="40867-213">Create a [public IP address] for the jumpbox.</span></span> <span data-ttu-id="40867-214">Helyezze a jumpboxot a többi virtuális géppel megegyező virtuális hálózatba, de egy külön felügyeleti alhálózaton legyen.</span><span class="sxs-lookup"><span data-stu-id="40867-214">Place the jumpbox in the same VNet as the other VMs, but in a separate management subnet.</span></span>

<span data-ttu-id="40867-215">A jumpbox védelmére, adja hozzá egy NSG-szabályt, amely RDP-kapcsolatok kizárólag a nyilvános IP-címkészletekről engedélyezi.</span><span class="sxs-lookup"><span data-stu-id="40867-215">To secure the jumpbox, add an NSG rule that allows RDP connections only from a safe set of public IP addresses.</span></span> <span data-ttu-id="40867-216">Állítsa be az NSG-t a többi alhálózathoz is úgy, hogy engedélyezzék a felügyeleti alhálózatból érkező RDP-forgalmat.</span><span class="sxs-lookup"><span data-stu-id="40867-216">Configure the NSGs for the other subnets to allow RDP traffic from the management subnet.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="40867-217">Méretezési szempontok</span><span class="sxs-lookup"><span data-stu-id="40867-217">Scalability considerations</span></span>

<span data-ttu-id="40867-218">[Virtuálisgép-méretezési csoportok] [ vmss] üzembe helyezése és kezelése, amelyek azonos virtuális gépek segítségével.</span><span class="sxs-lookup"><span data-stu-id="40867-218">[VM scale sets][vmss] help you to deploy and manage a set of identical VMs.</span></span> <span data-ttu-id="40867-219">A méretezési csoportok támogatják a teljesítménymetrikák alapján történő automatikus skálázást.</span><span class="sxs-lookup"><span data-stu-id="40867-219">Scale sets support autoscaling based on performance metrics.</span></span> <span data-ttu-id="40867-220">Ahogy a terhelés növekszik a virtuális gépeken, a rendszer további virtuális gépeket ad a terheléselosztóhoz.</span><span class="sxs-lookup"><span data-stu-id="40867-220">As the load on the VMs increases, additional VMs are automatically added to the load balancer.</span></span> <span data-ttu-id="40867-221">Fontolja meg a méretezési csoportok használatát, ha virtuális gépek gyors horizontális felskálázására vagy automatikus méretezésre van szüksége.</span><span class="sxs-lookup"><span data-stu-id="40867-221">Consider scale sets if you need to quickly scale out VMs, or need to autoscale.</span></span>

<span data-ttu-id="40867-222">A méretezési csoportokban üzembe helyezett virtuális gépek konfigurálásának két alapvető módja van:</span><span class="sxs-lookup"><span data-stu-id="40867-222">There are two basic ways to configure VMs deployed in a scale set:</span></span>

- <span data-ttu-id="40867-223">Bővítmények segítségével konfigurálhatja a virtuális gépet annak kiépítése után.</span><span class="sxs-lookup"><span data-stu-id="40867-223">Use extensions to configure the VM after it is provisioned.</span></span> <span data-ttu-id="40867-224">Ezzel a módszerrel az új virtuálisgép-példányok indítása több időt vehet igénybe, mint a bővítmények nélküli virtuális gépeké.</span><span class="sxs-lookup"><span data-stu-id="40867-224">With this approach, new VM instances may take longer to start up than a VM with no extensions.</span></span>

- <span data-ttu-id="40867-225">Üzembe helyezhet egy [felügyelt lemezt](/azure/storage/storage-managed-disks-overview) egy egyéni rendszerképpel.</span><span class="sxs-lookup"><span data-stu-id="40867-225">Deploy a [managed disk](/azure/storage/storage-managed-disks-overview) with a custom disk image.</span></span> <span data-ttu-id="40867-226">Ez a módszer gyorsabban kivitelezhető.</span><span class="sxs-lookup"><span data-stu-id="40867-226">This option may be quicker to deploy.</span></span> <span data-ttu-id="40867-227">Azonban ebben az esetben naprakészen kel tartania a rendszerképet.</span><span class="sxs-lookup"><span data-stu-id="40867-227">However, it requires you to keep the image up to date.</span></span>

<span data-ttu-id="40867-228">További szempontokért lásd: [Kialakítási szempontok a méretezési csoportokhoz][vmss-design].</span><span class="sxs-lookup"><span data-stu-id="40867-228">For additional considerations, see [Design considerations for scale sets][vmss-design].</span></span>

> [!TIP]
> <span data-ttu-id="40867-229">Bármilyen automatikus méretezési megoldás használata esetén jóval előre tesztelje azt az éles környezetre jellemző mennyiségű számítási feladattal.</span><span class="sxs-lookup"><span data-stu-id="40867-229">When using any autoscale solution, test it with production-level workloads well in advance.</span></span>

<span data-ttu-id="40867-230">Minden Azure-előfizetésre alapértelmezett korlátozások vonatkoznak. Ilyen például a régiónként alkalmazható virtuális gépek maximális száma.</span><span class="sxs-lookup"><span data-stu-id="40867-230">Each Azure subscription has default limits in place, including a maximum number of VMs per region.</span></span> <span data-ttu-id="40867-231">Támogatási kérelem kitöltésével megnövelheti ezt a korlátot.</span><span class="sxs-lookup"><span data-stu-id="40867-231">You can increase the limit by filing a support request.</span></span> <span data-ttu-id="40867-232">További információk: [Az Azure-előfizetések és -szolgáltatások korlátozásai, kvótái és megkötései][subscription-limits].</span><span class="sxs-lookup"><span data-stu-id="40867-232">For more information, see [Azure subscription and service limits, quotas, and constraints][subscription-limits].</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="40867-233">Rendelkezésre állási szempontok</span><span class="sxs-lookup"><span data-stu-id="40867-233">Availability considerations</span></span>

<span data-ttu-id="40867-234">Ha nem használ a Virtuálisgép-méretezési csoportok virtuális gépek rendelkezésre állási csoport azonos szinten üzembe.</span><span class="sxs-lookup"><span data-stu-id="40867-234">If you are not using VM scale sets, put VMs in the same tier into an availability set.</span></span> <span data-ttu-id="40867-235">Hozzon létre legalább két virtuális gépet a rendelkezésre állási csoportban az [Azure-beli virtuális gépekre vonatkozó rendelkezésre állási SLA][vm-sla] támogatásához.</span><span class="sxs-lookup"><span data-stu-id="40867-235">Create at least two VMs in the availability set to support the [availability SLA for Azure VMs][vm-sla].</span></span> <span data-ttu-id="40867-236">További információk: [Virtuális gépek rendelkezésre állásának kezelése][availability-set].</span><span class="sxs-lookup"><span data-stu-id="40867-236">For more information, see [Manage the availability of virtual machines][availability-set].</span></span> 

<span data-ttu-id="40867-237">A terheléselosztó [állapotmintákat][health-probes] használ a virtuálisgép-példányok rendelkezésre állásának monitorozásához.</span><span class="sxs-lookup"><span data-stu-id="40867-237">The load balancer uses [health probes][health-probes] to monitor the availability of VM instances.</span></span> <span data-ttu-id="40867-238">Ha a mintavétel nem ér el egy példányt egy bizonyos időkorláton belül, a terheléselosztó nem irányít több forgalmat az adott virtuális gép felé.</span><span class="sxs-lookup"><span data-stu-id="40867-238">If a probe cannot reach an instance within a timeout period, the load balancer stops sending traffic to that VM.</span></span> <span data-ttu-id="40867-239">A terheléselosztó ezután is folytatja a mintavételezést, és amint a virtuális gép újra elérhetővé válik, a terheléselosztó ismét elkezd forgalmat irányítani felé.</span><span class="sxs-lookup"><span data-stu-id="40867-239">However, the load balancer will continue to probe, and if the VM becomes available again, the load balancer resumes sending traffic to that VM.</span></span>

<span data-ttu-id="40867-240">Az alábbiakban néhány javaslat olvasható a terheléselosztó állapot-mintavételére vonatkozóan:</span><span class="sxs-lookup"><span data-stu-id="40867-240">Here are some recommendations on load balancer health probes:</span></span>

* <span data-ttu-id="40867-241">A mintavételek a HTTP-t vagy a TCP-t tesztelhetik.</span><span class="sxs-lookup"><span data-stu-id="40867-241">Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="40867-242">Ha a virtuális gépek HTTP-kiszolgálót futtatnak, HTTP-mintavételt hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="40867-242">If your VMs run an HTTP server, create an HTTP probe.</span></span> <span data-ttu-id="40867-243">Egyéb esetben TCP-mintavételt hozzon létre.</span><span class="sxs-lookup"><span data-stu-id="40867-243">Otherwise create a TCP probe.</span></span>
* <span data-ttu-id="40867-244">A HTTP-mintavétel esetében adjon meg elérési utat egy HTTP-végponthoz.</span><span class="sxs-lookup"><span data-stu-id="40867-244">For an HTTP probe, specify the path to an HTTP endpoint.</span></span> <span data-ttu-id="40867-245">A mintavétel 200-as HTTP-választ vár erről a megadott elérési útról.</span><span class="sxs-lookup"><span data-stu-id="40867-245">The probe checks for an HTTP 200 response from this path.</span></span> <span data-ttu-id="40867-246">Ez lehet a gyökérútvonal („/”) vagy egy állapotmonitorozó végpont, amely valamilyen egyéni logikát alkalmaz az alkalmazás állapotának ellenőrzésére.</span><span class="sxs-lookup"><span data-stu-id="40867-246">This can be the root path ("/"), or a health-monitoring endpoint that implements some custom logic to check the health of the application.</span></span> <span data-ttu-id="40867-247">A végpontnak engedélyeznie kell a névtelen HTTP-kérelmeket.</span><span class="sxs-lookup"><span data-stu-id="40867-247">The endpoint must allow anonymous HTTP requests.</span></span>
* <span data-ttu-id="40867-248">A mintavétel [ismert IP-címről érkezik:][health-probe-ip] 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="40867-248">The probe is sent from a [known IP address][health-probe-ip], 168.63.129.16.</span></span> <span data-ttu-id="40867-249">Győződjön meg arról, hogy nem tiltja a bejövő és kimenő forgalmat erről az IP-címről valamelyik tűzfalszabályzatban vagy NSG-szabályban.</span><span class="sxs-lookup"><span data-stu-id="40867-249">Make sure you don't block traffic to or from this IP address in any firewall policies or network security group (NSG) rules.</span></span>
* <span data-ttu-id="40867-250">Az állapotminták állapotának megtekintéséhez használjon [állapotminta-naplókat][health-probe-log].</span><span class="sxs-lookup"><span data-stu-id="40867-250">Use [health probe logs][health-probe-log] to view the status of the health probes.</span></span> <span data-ttu-id="40867-251">Engedélyezze a naplózást az Azure Portalon minden egyes terheléselosztóra vonatkozóan.</span><span class="sxs-lookup"><span data-stu-id="40867-251">Enable logging in the Azure portal for each load balancer.</span></span> <span data-ttu-id="40867-252">A naplókat a rendszer az Azure Blob Storage-ba írja.</span><span class="sxs-lookup"><span data-stu-id="40867-252">Logs are written to Azure Blob storage.</span></span> <span data-ttu-id="40867-253">A naplók megmutatják, hány háttérbeli virtuális gép nem fogad hálózati forgalmat a meghiúsult mintavételi válaszok miatt.</span><span class="sxs-lookup"><span data-stu-id="40867-253">The logs show how many VMs on the back end are not receiving network traffic due to failed probe responses.</span></span>

<span data-ttu-id="40867-254">Ha van szüksége, mint a magasabb rendelkezésre állás a [Azure SLA-beli virtuális gépek] [ vm-sla] biztosít, fontolja meg replikációs az alkalmazást két régióban, az Azure Traffic Managerrel a feladatátvételhez.</span><span class="sxs-lookup"><span data-stu-id="40867-254">If you need higher availability than the [Azure SLA for VMs][vm-sla] provides, consider replication the application across two regions, using Azure Traffic Manager for failover.</span></span> <span data-ttu-id="40867-255">További információkért lásd: [többrégiós N szintű alkalmazás magas rendelkezésre állású][multi-dc].</span><span class="sxs-lookup"><span data-stu-id="40867-255">For more information, see [Multi-region N-tier application for high availability][multi-dc].</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="40867-256">Biztonsági szempontok</span><span class="sxs-lookup"><span data-stu-id="40867-256">Security considerations</span></span>

<span data-ttu-id="40867-257">A virtuális hálózatok forgalomelkülönítési határok az Azure-ban.</span><span class="sxs-lookup"><span data-stu-id="40867-257">Virtual networks are a traffic isolation boundary in Azure.</span></span> <span data-ttu-id="40867-258">Egy adott virtuális hálózatban található virtuális gépek nem képesek közvetlenül kommunikálni egy másik virtuális hálózat gépeivel.</span><span class="sxs-lookup"><span data-stu-id="40867-258">VMs in one VNet cannot communicate directly with VMs in a different VNet.</span></span> <span data-ttu-id="40867-259">Az azonos virtuális hálózatban elhelyezkedő virtuális gépek képesek a kommunikációra, hacsak [hálózati biztonsági csoportokat] [ nsg] (NSG-ket) nem hoz létre a forgalom korlátozására.</span><span class="sxs-lookup"><span data-stu-id="40867-259">VMs within the same VNet can communicate, unless you create [network security groups][nsg] (NSGs) to restrict traffic.</span></span> <span data-ttu-id="40867-260">További információ: [A Microsoft felhőszolgáltatásai és hálózati biztonság][network-security].</span><span class="sxs-lookup"><span data-stu-id="40867-260">For more information, see [Microsoft cloud services and network security][network-security].</span></span>

<span data-ttu-id="40867-261">A bejövő internetes forgalom esetében a terheléselosztó szabályai határozzák meg, milyen forgalom érheti el a háttérrendszert.</span><span class="sxs-lookup"><span data-stu-id="40867-261">For incoming Internet traffic, the load balancer rules define which traffic can reach the back end.</span></span> <span data-ttu-id="40867-262">A terheléselosztó szabályai azonban nem támogatják a biztonságos IP-címek listázását, ezért ha fel kíván venni bizonyos nyilvános IP-címeket a biztonságos címek listájára, adjon hálózati biztonsági csoportot az alhálózathoz.</span><span class="sxs-lookup"><span data-stu-id="40867-262">However, load balancer rules don't support IP safe lists, so if you want to add certain public IP addresses to a safe list, add an NSG to the subnet.</span></span>

<span data-ttu-id="40867-263">Érdemes lehet hozzáadnia egy hálózati virtuális berendezést (network virtual appliance, NVA), hogy DMZ-t lehessen létrehozni az internet és az Azure-beli virtuális hálózat között.</span><span class="sxs-lookup"><span data-stu-id="40867-263">Consider adding a network virtual appliance (NVA) to create a DMZ between the Internet and the Azure virtual network.</span></span> <span data-ttu-id="40867-264">Az NVA egy általános kifejezés egy olyan virtuális berendezésre, amely hálózatokhoz kapcsolódó feladatokat lát el, például gondoskodik a tűzfalról, a csomagvizsgálatról, a naplózásról és az egyéni útválasztásról.</span><span class="sxs-lookup"><span data-stu-id="40867-264">NVA is a generic term for a virtual appliance that can perform network-related tasks, such as firewall, packet inspection, auditing, and custom routing.</span></span> <span data-ttu-id="40867-265">További információkért lásd a [DMZ az Azure és az internet közötti implementálásával][dmz] foglalkozó témakört.</span><span class="sxs-lookup"><span data-stu-id="40867-265">For more information, see [Implementing a DMZ between Azure and the Internet][dmz].</span></span>

<span data-ttu-id="40867-266">Titkosíthatja az inaktív bizalmas adatokat, és az [Azure Key Vaulttal][azure-key-vault] kezelheti az adatbázis titkosítási kulcsait.</span><span class="sxs-lookup"><span data-stu-id="40867-266">Encrypt sensitive data at rest and use [Azure Key Vault][azure-key-vault] to manage the database encryption keys.</span></span> <span data-ttu-id="40867-267">A Key Vault képes a hardveres biztonsági modulok (HSM-ek) titkosítási kulcsainak tárolására.</span><span class="sxs-lookup"><span data-stu-id="40867-267">Key Vault can store encryption keys in hardware security modules (HSMs).</span></span> <span data-ttu-id="40867-268">További információkért lásd: [konfigurálása az Azure Key Vault-integráció az SQL Server Azure virtuális gépeken][sql-keyvault].</span><span class="sxs-lookup"><span data-stu-id="40867-268">For more information, see [Configure Azure Key Vault Integration for SQL Server on Azure VMs][sql-keyvault].</span></span> <span data-ttu-id="40867-269">Emellett ajánlott alkalmazások titkos adatait, például az adatbázis kapcsolati karakterláncainak tárolása a Key Vaultban.</span><span class="sxs-lookup"><span data-stu-id="40867-269">It's also recommended to store application secrets, such as database connection strings, in Key Vault.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="40867-270">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="40867-270">Deploy the solution</span></span>

<span data-ttu-id="40867-271">Ennek a referenciaarchitektúrának egy üzemelő példánya elérhető a [GitHubon][github-folder].</span><span class="sxs-lookup"><span data-stu-id="40867-271">A deployment for this reference architecture is available on [GitHub][github-folder].</span></span> <span data-ttu-id="40867-272">Vegye figyelembe, hogy a teljes üzembe helyezés eltarthat akár két órát, amely tartalmazza az Active Directory tartományi szolgáltatások, a Windows Server feladatátvevő fürt és az SQL Server rendelkezésre állási csoport konfigurálása a szkriptek futtatására.</span><span class="sxs-lookup"><span data-stu-id="40867-272">Note that the entire deployment can take up to two hours, which includes running the scripts to configure AD DS, the Windows Server failover cluster, and the SQL Server availability group.</span></span>

### <a name="prerequisites"></a><span data-ttu-id="40867-273">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="40867-273">Prerequisites</span></span>

[!INCLUDE [ref-arch-prerequisites.md](../../../includes/ref-arch-prerequisites.md)]

### <a name="deploy-the-solution"></a><span data-ttu-id="40867-274">A megoldás üzembe helyezése</span><span class="sxs-lookup"><span data-stu-id="40867-274">Deploy the solution</span></span>

1. <span data-ttu-id="40867-275">A következő paranccsal hozzon létre egy erőforráscsoportot.</span><span class="sxs-lookup"><span data-stu-id="40867-275">Run the following command to create a resource group.</span></span>

    ```bash
    az group create --location <location> --name <resource-group-name>
    ```

2. <span data-ttu-id="40867-276">A következő parancsot a Felhőbeli tanúsító a Storage-fiók létrehozása.</span><span class="sxs-lookup"><span data-stu-id="40867-276">Run the following command to create a Storage account for the Cloud Witness.</span></span>

    ```bash
    az storage account create --location <location> \
      --name <storage-account-name> \
      --resource-group <resource-group-name> \
      --sku Standard_LRS
    ```

3. <span data-ttu-id="40867-277">Keresse meg a `virtual-machines\n-tier-windows` referencia architektúrák GitHub-adattár mappát.</span><span class="sxs-lookup"><span data-stu-id="40867-277">Navigate to the `virtual-machines\n-tier-windows` folder of the reference architectures GitHub repository.</span></span>

4. <span data-ttu-id="40867-278">Nyissa meg az `n-tier-windows.json` fájlt.</span><span class="sxs-lookup"><span data-stu-id="40867-278">Open the `n-tier-windows.json` file.</span></span> 

5. <span data-ttu-id="40867-279">Keresse meg az "witnessStorageBlobEndPoint" összes példányát, és cserélje le a helyőrző szöveg a 2. lépés a tárfiók nevére.</span><span class="sxs-lookup"><span data-stu-id="40867-279">Search for all instances of "witnessStorageBlobEndPoint" and replace the placeholder text with the name of the Storage account from step 2.</span></span>

    ```json
    "witnessStorageBlobEndPoint": "https://[replace-with-storageaccountname].blob.core.windows.net",
    ```

6. <span data-ttu-id="40867-280">A következő parancsot a tárfiók fiók kulcsainak listázása.</span><span class="sxs-lookup"><span data-stu-id="40867-280">Run the following command to list the account keys for the storage account.</span></span>

    ```bash
    az storage account keys list \
      --account-name <storage-account-name> \
      --resource-group <resource-group-name>
    ```

    <span data-ttu-id="40867-281">A kimenet a következőhöz hasonlóan kell kinéznie.</span><span class="sxs-lookup"><span data-stu-id="40867-281">The output should look like the following.</span></span> <span data-ttu-id="40867-282">Másolja a `key1` értékét.</span><span class="sxs-lookup"><span data-stu-id="40867-282">Copy the value of `key1`.</span></span>

    ```json
    [
    {
        "keyName": "key1",
        "permissions": "Full",
        "value": "..."
    },
    {
        "keyName": "key2",
        "permissions": "Full",
        "value": "..."
    }
    ]
    ```

7. <span data-ttu-id="40867-283">Az a `n-tier-windows.json` fájlt, keressen a "witnessStorageAccountKey", és illessze be a fiókkulcsot.</span><span class="sxs-lookup"><span data-stu-id="40867-283">In the `n-tier-windows.json` file, search for all instances of "witnessStorageAccountKey" and paste in the account key.</span></span>

    ```json
    "witnessStorageAccountKey": "[replace-with-storagekey]"
    ```

8. <span data-ttu-id="40867-284">Az a `n-tier-windows.json` fájlt, a Keresés az összes példány `testPassw0rd!23`, `test$!Passw0rd111`, és `AweS0me@SQLServicePW`.</span><span class="sxs-lookup"><span data-stu-id="40867-284">In the `n-tier-windows.json` file, search for all instances `testPassw0rd!23`, `test$!Passw0rd111`, and `AweS0me@SQLServicePW`.</span></span> <span data-ttu-id="40867-285">Le kell cserélni a saját jelszavát, és mentse a fájlt.</span><span class="sxs-lookup"><span data-stu-id="40867-285">Replace them with your own passwords and save the file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="40867-286">Ha módosítja a rendszergazdai felhasználónevet, frissíteni kell a `extensions` letiltja a JSON-fájlban.</span><span class="sxs-lookup"><span data-stu-id="40867-286">If you change the adminstrator user name, you must also update the `extensions` blocks in the JSON file.</span></span> 

9. <span data-ttu-id="40867-287">Futtassa a következő parancsot az architektúra üzembe helyezéséhez.</span><span class="sxs-lookup"><span data-stu-id="40867-287">Run the following command to deploy the architecture.</span></span>

    ```bash
    azbb -s <your subscription_id> -g <resource_group_name> -l <location> -p n-tier-windows.json --deploy
    ```

<span data-ttu-id="40867-288">A mintául szolgáló referenciaarchitektúra Azure-építőelemekkel történő üzembe helyezéséről további információkat a [GitHub-adattárban][git] talál.</span><span class="sxs-lookup"><span data-stu-id="40867-288">For more information on deploying this sample reference architecture using Azure Building Blocks, visit the [GitHub repository][git].</span></span>


<!-- links -->
[dmz]: ../dmz/secure-vnet-dmz.md
[multi-dc]: multi-region-sql-server.md
[n-tier]: n-tier.md
[azure-administration]: /azure/automation/automation-intro
[azure-availability-sets]: /azure/virtual-machines/virtual-machines-windows-manage-availability#configure-each-application-tier-into-separate-availability-sets
[azure-cli]: /azure/virtual-machines-command-line-tools
[azure-dns]: /azure/dns/dns-overview
[azure-key-vault]: https://azure.microsoft.com/services/key-vault
[bástyagazdagép]: https://en.wikipedia.org/wiki/Bastion_host
[bastion host]: https://en.wikipedia.org/wiki/Bastion_host
[cidr]: https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing
[chef]: https://www.chef.io/solutions/azure/
[git]: https://github.com/mspnp/template-building-blocks
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/virtual-machines/n-tier-windows
[lb-external-create]: /azure/load-balancer/load-balancer-get-started-internet-portal
[lb-internal-create]: /azure/load-balancer/load-balancer-get-started-ilb-arm-portal
[load-balancer-external]: /azure/load-balancer/load-balancer-internet-overview
[load-balancer-internal]: /azure/load-balancer/load-balancer-internal-overview
[nsg]: /azure/virtual-network/virtual-networks-nsg
[operations-management-suite]: https://www.microsoft.com/server-cloud/operations-management-suite/overview.aspx
[plan-network]: /azure/virtual-network/virtual-network-vnet-plan-design-arm
[private-ip-space]: https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
[nyilvános IP-cím]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[public IP address]: /azure/virtual-network/virtual-network-ip-addresses-overview-arm
[puppet]: https://puppetlabs.com/blog/managing-azure-virtual-machines-puppet
[sql-alwayson]: https://msdn.microsoft.com/library/hh510230.aspx
[sql-alwayson-force-failover]: https://msdn.microsoft.com/library/ff877957.aspx
[sql-alwayson-getting-started]: https://msdn.microsoft.com/library/gg509118.aspx
[sql-alwayson-ilb]: /azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-alwayson-int-listener
[sql-alwayson-listeners]: https://msdn.microsoft.com/library/hh213417.aspx
[sql-alwayson-read-only-routing]: https://technet.microsoft.com/library/hh213417.aspx#ConnectToSecondary
[sql-keyvault]: /azure/virtual-machines/virtual-machines-windows-ps-sql-keyvault
[vm-sla]: https://azure.microsoft.com/support/legal/sla/virtual-machines
[vnet faq]: /azure/virtual-network/virtual-networks-faq
[wsfc-whats-new]: https://technet.microsoft.com/windows-server-docs/failover-clustering/whats-new-in-failover-clustering
[Nagios]: https://www.nagios.org/
[Zabbix]: http://www.zabbix.com/
[Icinga]: http://www.icinga.org/
[visio-download]: https://archcenter.blob.core.windows.net/cdn/vm-reference-architectures.vsdx
[0]: ./images/n-tier-sql-server.png "N szintű architektúra a Microsoft Azure használatával"
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview 
[vmss]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview
[load-balancer]: /azure/load-balancer/load-balancer-get-started-internet-arm-cli
[load-balancer-hashing]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[vmss-design]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview
[subscription-limits]: /azure/azure-subscription-service-limits
[availability-set]: /azure/virtual-machines/virtual-machines-windows-manage-availability
[health-probes]: /azure/load-balancer/load-balancer-overview#load-balancer-features
[health-probe-log]: /azure/load-balancer/load-balancer-monitor-log
[health-probe-ip]: /azure/virtual-network/virtual-networks-nsg#special-rules
[network-security]: /azure/best-practices-network-security
