---
title: "Jogcím-alapú identitásokat a több-bérlős alkalmazások használata"
description: "Hogyan használja a jogcím-a kibocsátó érvényesítése és az engedélyezés"
author: MikeWasson
ms:date: 07/21/2017
pnp.series.title: Manage Identity in Multitenant Applications
pnp.series.prev: authenticate
pnp.series.next: signup
ms.openlocfilehash: 61788d9759715b21ef1bdda59c5b54d923fd8f62
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 11/14/2017
---
# <a name="work-with-claims-based-identities"></a><span data-ttu-id="a06e2-103">Jogcímalapú identitás használata</span><span class="sxs-lookup"><span data-stu-id="a06e2-103">Work with claims-based identities</span></span>

<span data-ttu-id="a06e2-104">[![GitHub](../_images/github.png) példakód][sample application]</span><span class="sxs-lookup"><span data-stu-id="a06e2-104">[![GitHub](../_images/github.png) Sample code][sample application]</span></span>

## <a name="claims-in-azure-ad"></a><span data-ttu-id="a06e2-105">Jogcímek, az Azure ad-ben</span><span class="sxs-lookup"><span data-stu-id="a06e2-105">Claims in Azure AD</span></span>
<span data-ttu-id="a06e2-106">Amikor egy felhasználó bejelentkezik, az Azure AD küld Azonosítót jogkivonatban a felhasználóval kapcsolatos jogcímek egy készletét tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="a06e2-106">When a user signs in, Azure AD sends an ID token that contains a set of claims about the user.</span></span> <span data-ttu-id="a06e2-107">A jogcím egyszerűen egy, a kulcs/érték pár kifejezve.</span><span class="sxs-lookup"><span data-stu-id="a06e2-107">A claim is simply a piece of information, expressed as a key/value pair.</span></span> <span data-ttu-id="a06e2-108">Például `email` = `bob@contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="a06e2-108">For example, `email`=`bob@contoso.com`.</span></span>  <span data-ttu-id="a06e2-109">Jogcímek rendelkezik egy kibocsátó &mdash; ebben az esetben az Azure AD &mdash; Ez az az entitás, amely hitelesíti a felhasználót, és a jogcímeket hoz létre.</span><span class="sxs-lookup"><span data-stu-id="a06e2-109">Claims have an issuer &mdash; in this case, Azure AD &mdash; which is the entity that authenticates the user and creates the claims.</span></span> <span data-ttu-id="a06e2-110">A jogcímek megbízik, mivel a kibocsátó megbízik.</span><span class="sxs-lookup"><span data-stu-id="a06e2-110">You trust the claims because you trust the issuer.</span></span> <span data-ttu-id="a06e2-111">(Ezzel szemben, ha nem bízik meg a kiállító, nem megbízható jogcímeket!)</span><span class="sxs-lookup"><span data-stu-id="a06e2-111">(Conversely, if you don't trust the issuer, don't trust the claims!)</span></span>

<span data-ttu-id="a06e2-112">Magas szinten:</span><span class="sxs-lookup"><span data-stu-id="a06e2-112">At a high level:</span></span>

1. <span data-ttu-id="a06e2-113">A felhasználó hitelesíti magát.</span><span class="sxs-lookup"><span data-stu-id="a06e2-113">The user authenticates.</span></span>
2. <span data-ttu-id="a06e2-114">Az IDP elküldi a jogcímek egy készletét.</span><span class="sxs-lookup"><span data-stu-id="a06e2-114">The IDP sends a set of claims.</span></span>
3. <span data-ttu-id="a06e2-115">Az alkalmazás normalizálja vagy szabályozva az információhasználat a jogcímeket (nem kötelező).</span><span class="sxs-lookup"><span data-stu-id="a06e2-115">The app normalizes or augments the claims (optional).</span></span>
4. <span data-ttu-id="a06e2-116">Az alkalmazás a jogcímek használja az engedélyezéshez.</span><span class="sxs-lookup"><span data-stu-id="a06e2-116">The app uses the claims to make authorization decisions.</span></span>

<span data-ttu-id="a06e2-117">Az OpenID Connect, a kapott jogcímek készlete vezérli a [hatókör-paramétert] a hitelesítési kérelem.</span><span class="sxs-lookup"><span data-stu-id="a06e2-117">In OpenID Connect, the set of claims that you get is controlled by the [scope parameter] of the authentication request.</span></span> <span data-ttu-id="a06e2-118">Azonban az Azure AD kibocsát egy korlátozott körét jogcímek továbbítása OpenID Connect; Lásd: [támogatott jogkivonat és jogcímtípusok].</span><span class="sxs-lookup"><span data-stu-id="a06e2-118">However, Azure AD issues a limited set of claims through OpenID Connect; see [Supported Token and Claim Types].</span></span> <span data-ttu-id="a06e2-119">Ha azt szeretné, hogy a felhasználó további információt, meg kell az Azure AD Graph API-val.</span><span class="sxs-lookup"><span data-stu-id="a06e2-119">If you want more information about the user, you'll need to use the Azure AD Graph API.</span></span>

<span data-ttu-id="a06e2-120">Íme néhány a jogcímeket, előfordulhat, hogy általában fontos egy alkalmazás aad-ben:</span><span class="sxs-lookup"><span data-stu-id="a06e2-120">Here are some of the claims from AAD that an app might typically care about:</span></span>

| <span data-ttu-id="a06e2-121">Az Azonosítót jogkivonatban a jogcím típusa</span><span class="sxs-lookup"><span data-stu-id="a06e2-121">Claim type in ID token</span></span> | <span data-ttu-id="a06e2-122">Leírás</span><span class="sxs-lookup"><span data-stu-id="a06e2-122">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a06e2-123">és</span><span class="sxs-lookup"><span data-stu-id="a06e2-123">aud</span></span> |<span data-ttu-id="a06e2-124">Ki a token ki.</span><span class="sxs-lookup"><span data-stu-id="a06e2-124">Who the token was issued for.</span></span> <span data-ttu-id="a06e2-125">Ez lesz az alkalmazás ügyfél-azonosítót.</span><span class="sxs-lookup"><span data-stu-id="a06e2-125">This will be the application's client ID.</span></span> <span data-ttu-id="a06e2-126">Általában nem szükséges foglalkoznia az ezt a kérelmet, mert a köztes automatikusan érvényesíti azt.</span><span class="sxs-lookup"><span data-stu-id="a06e2-126">Generally, you shouldn't need to worry about this claim, because the middleware automatically validates it.</span></span> <span data-ttu-id="a06e2-127">Példa:`"91464657-d17a-4327-91f3-2ed99386406f"`</span><span class="sxs-lookup"><span data-stu-id="a06e2-127">Example:  `"91464657-d17a-4327-91f3-2ed99386406f"`</span></span> |
| <span data-ttu-id="a06e2-128">csoportok</span><span class="sxs-lookup"><span data-stu-id="a06e2-128">groups</span></span> |<span data-ttu-id="a06e2-129">AAD-csoportokat, amelyek a felhasználó tagja listáját.</span><span class="sxs-lookup"><span data-stu-id="a06e2-129">A list of AAD groups of which the user is a member.</span></span> <span data-ttu-id="a06e2-130">Példa:`["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span><span class="sxs-lookup"><span data-stu-id="a06e2-130">Example: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span></span> |
| <span data-ttu-id="a06e2-131">iss</span><span class="sxs-lookup"><span data-stu-id="a06e2-131">iss</span></span> |<span data-ttu-id="a06e2-132">A [kibocsátó] OIDC jogkivonat.</span><span class="sxs-lookup"><span data-stu-id="a06e2-132">The [issuer] of the OIDC token.</span></span> <span data-ttu-id="a06e2-133">Példa:`https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span><span class="sxs-lookup"><span data-stu-id="a06e2-133">Example: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span></span> |
| <span data-ttu-id="a06e2-134">név</span><span class="sxs-lookup"><span data-stu-id="a06e2-134">name</span></span> |<span data-ttu-id="a06e2-135">A felhasználó megjelenített neve.</span><span class="sxs-lookup"><span data-stu-id="a06e2-135">The user's display name.</span></span> <span data-ttu-id="a06e2-136">Példa:`"Alice A."`</span><span class="sxs-lookup"><span data-stu-id="a06e2-136">Example: `"Alice A."`</span></span> |
| <span data-ttu-id="a06e2-137">OID</span><span class="sxs-lookup"><span data-stu-id="a06e2-137">oid</span></span> |<span data-ttu-id="a06e2-138">Az aad-ben a felhasználó objektum azonosítója.</span><span class="sxs-lookup"><span data-stu-id="a06e2-138">The object identifier for the user in AAD.</span></span> <span data-ttu-id="a06e2-139">Ez az érték a felhasználó nem módosítható, és egyszer használatos azonosító érték.</span><span class="sxs-lookup"><span data-stu-id="a06e2-139">This value is the immutable and non-reusable identifier of the user.</span></span> <span data-ttu-id="a06e2-140">Ezen a érték, nem e-mailt, egy egyedi azonosítóként felhasználó használhatja; e-mail címet használva módosítható.</span><span class="sxs-lookup"><span data-stu-id="a06e2-140">Use this value, not email, as a unique identifier for users; email addresses can change.</span></span> <span data-ttu-id="a06e2-141">Ha az alkalmazás az Azure AD Graph API-t használ, objektumazonosító: adott profil adatlekérdezés használt érték.</span><span class="sxs-lookup"><span data-stu-id="a06e2-141">If you use the Azure AD Graph API in your app, object ID is that value used to query profile information.</span></span> <span data-ttu-id="a06e2-142">Példa:`"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span><span class="sxs-lookup"><span data-stu-id="a06e2-142">Example: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span></span> |
| <span data-ttu-id="a06e2-143">roles</span><span class="sxs-lookup"><span data-stu-id="a06e2-143">roles</span></span> |<span data-ttu-id="a06e2-144">A felhasználó alkalmazás szerepkörök listáját.</span><span class="sxs-lookup"><span data-stu-id="a06e2-144">A list of app roles for the user.</span></span>    <span data-ttu-id="a06e2-145">Példa:`["SurveyCreator"]`</span><span class="sxs-lookup"><span data-stu-id="a06e2-145">Example: `["SurveyCreator"]`</span></span> |
| <span data-ttu-id="a06e2-146">TID</span><span class="sxs-lookup"><span data-stu-id="a06e2-146">tid</span></span> |<span data-ttu-id="a06e2-147">Bérlő azonosítója.</span><span class="sxs-lookup"><span data-stu-id="a06e2-147">Tenant ID.</span></span> <span data-ttu-id="a06e2-148">Az értéke a bérlő egyedi azonosítója az Azure ad-ben.</span><span class="sxs-lookup"><span data-stu-id="a06e2-148">This value is a unique identifier for the tenant in Azure AD.</span></span> <span data-ttu-id="a06e2-149">Példa:`"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span><span class="sxs-lookup"><span data-stu-id="a06e2-149">Example: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span></span> |
| <span data-ttu-id="a06e2-150">unique_name</span><span class="sxs-lookup"><span data-stu-id="a06e2-150">unique_name</span></span> |<span data-ttu-id="a06e2-151">A felhasználó emberi olvasható megjelenítendő neve.</span><span class="sxs-lookup"><span data-stu-id="a06e2-151">A human readable display name of the user.</span></span> <span data-ttu-id="a06e2-152">Példa:`"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="a06e2-152">Example: `"alice@contoso.com"`</span></span> |
| <span data-ttu-id="a06e2-153">egyszerű felhasználónév</span><span class="sxs-lookup"><span data-stu-id="a06e2-153">upn</span></span> |<span data-ttu-id="a06e2-154">Egyszerű felhasználónév.</span><span class="sxs-lookup"><span data-stu-id="a06e2-154">User principal name.</span></span> <span data-ttu-id="a06e2-155">Példa:`"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="a06e2-155">Example: `"alice@contoso.com"`</span></span> |

<span data-ttu-id="a06e2-156">Ebben a táblázatban jelennek meg az Azonosítót jogkivonatban a jogcím-típusok található.</span><span class="sxs-lookup"><span data-stu-id="a06e2-156">This table lists the claim types as they appear in the ID token.</span></span> <span data-ttu-id="a06e2-157">Az ASP.NET Core az OpenID Connect köztes alakítja át a jogcímek valamelyikének, amikor a felhasználó egyszerű jogcímek gyűjteményében feltölt:</span><span class="sxs-lookup"><span data-stu-id="a06e2-157">In ASP.NET Core, the OpenID Connect middleware converts some of the claim types when it populates the Claims collection for the user principal:</span></span>

* <span data-ttu-id="a06e2-158">OID >`http://schemas.microsoft.com/identity/claims/objectidentifier`</span><span class="sxs-lookup"><span data-stu-id="a06e2-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span></span>
* <span data-ttu-id="a06e2-159">TID >`http://schemas.microsoft.com/identity/claims/tenantid`</span><span class="sxs-lookup"><span data-stu-id="a06e2-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span></span>
* <span data-ttu-id="a06e2-160">unique_name >`http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span><span class="sxs-lookup"><span data-stu-id="a06e2-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span></span>
* <span data-ttu-id="a06e2-161">egyszerű felhasználónév >`http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span><span class="sxs-lookup"><span data-stu-id="a06e2-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span></span>

## <a name="claims-transformations"></a><span data-ttu-id="a06e2-162">A jogcímek átalakítása</span><span class="sxs-lookup"><span data-stu-id="a06e2-162">Claims transformations</span></span>
<span data-ttu-id="a06e2-163">A hitelesítési folyamat során előfordulhat, hogy szeretné a jogcímeket, hogy a kiállító terjesztési hely módosítása.</span><span class="sxs-lookup"><span data-stu-id="a06e2-163">During the authentication flow, you might want to modify the claims that you get from the IDP.</span></span> <span data-ttu-id="a06e2-164">Az ASP.NET Core jogcímek átalakítása belül végezheti el a **AuthenticationValidated** az OpenID Connect köztes eseményt.</span><span class="sxs-lookup"><span data-stu-id="a06e2-164">In ASP.NET Core, you can perform claims transformation inside of the **AuthenticationValidated** event from the OpenID Connect middleware.</span></span> <span data-ttu-id="a06e2-165">(Lásd: [hitelesítési események].)</span><span class="sxs-lookup"><span data-stu-id="a06e2-165">(See [Authentication events].)</span></span>

<span data-ttu-id="a06e2-166">Bármely során hozzáadott jogcím **AuthenticationValidated** a munkamenet hitelesítési cookie tárolja.</span><span class="sxs-lookup"><span data-stu-id="a06e2-166">Any claims that you add during **AuthenticationValidated** are stored in the session authentication cookie.</span></span> <span data-ttu-id="a06e2-167">Ezek nem get leküldött vissza az Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a06e2-167">They don't get pushed back to Azure AD.</span></span>

<span data-ttu-id="a06e2-168">Íme néhány példa a jogcímek átalakításáról:</span><span class="sxs-lookup"><span data-stu-id="a06e2-168">Here are some examples of claims transformation:</span></span>

* <span data-ttu-id="a06e2-169">**Jogcím-normalizálási**, vagy a jogcímek konzisztens felhasználók között.</span><span class="sxs-lookup"><span data-stu-id="a06e2-169">**Claims normalization**, or making claims consistent across users.</span></span> <span data-ttu-id="a06e2-170">Ez különösen fontos, ha több IDPs, használhatja a különböző jogcímtípusok hasonló információk a jogcímek kap.</span><span class="sxs-lookup"><span data-stu-id="a06e2-170">This is particularly relevant if you are getting claims from multiple IDPs, which might use different claim types for similar information.</span></span>
  <span data-ttu-id="a06e2-171">Az Azure AD például egy "" jogcím, amely tartalmazza a felhasználói e-mailt küld.</span><span class="sxs-lookup"><span data-stu-id="a06e2-171">For example, Azure AD sends a "upn" claim that contains the user's email.</span></span> <span data-ttu-id="a06e2-172">Más IDPs előfordulhat, hogy az "e-mail" jogcímet küld ki.</span><span class="sxs-lookup"><span data-stu-id="a06e2-172">Other IDPs might send an "email" claim.</span></span> <span data-ttu-id="a06e2-173">A következő kód egy "e-mail" jogcímet alakítja át a "" jogcím:</span><span class="sxs-lookup"><span data-stu-id="a06e2-173">The following code converts the "upn" claim into an "email" claim:</span></span>
  
  ```csharp
  var email = principal.FindFirst(ClaimTypes.Upn)?.Value;
  if (!string.IsNullOrWhiteSpace(email))
  {
      identity.AddClaim(new Claim(ClaimTypes.Email, email));
  }
  ```
* <span data-ttu-id="a06e2-174">Adja hozzá **alapértelmezett jogcímértékek** a jogcímek, amelyek nem &mdash; például egy felhasználó hozzárendelése egy alapértelmezett szerepkör.</span><span class="sxs-lookup"><span data-stu-id="a06e2-174">Add **default claim values** for claims that aren't present &mdash; for example, assigning a user to a default role.</span></span> <span data-ttu-id="a06e2-175">Egyes esetekben ez egyszerűbbé teszi hitelesítési logikát.</span><span class="sxs-lookup"><span data-stu-id="a06e2-175">In some cases this can simplify authorization logic.</span></span>
* <span data-ttu-id="a06e2-176">Adja hozzá **egyéni jogcímtípusok** az a felhasználó az alkalmazás-specifikus adatait.</span><span class="sxs-lookup"><span data-stu-id="a06e2-176">Add **custom claim types** with application-specific information about the user.</span></span> <span data-ttu-id="a06e2-177">Például előfordulhat, hogy tárolja a felhasználó adatait adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="a06e2-177">For example, you might store some information about the user in a database.</span></span> <span data-ttu-id="a06e2-178">A hitelesítési jegy hozzáadhatja ezeket az adatokat egy egyéni jogcímleírásokat.</span><span class="sxs-lookup"><span data-stu-id="a06e2-178">You could add a custom claim with this information to the authentication ticket.</span></span> <span data-ttu-id="a06e2-179">A jogcím egy cookie-ban tárolja, így csak akkor kell töltse le innen bejelentkezési munkamenetenként egyszer az adatbázisból.</span><span class="sxs-lookup"><span data-stu-id="a06e2-179">The claim is stored in a cookie, so you only need to get it from the database once per login session.</span></span> <span data-ttu-id="a06e2-180">Másrészről érdemes ne hozzon létre túl nagy a cookie-k, ezért figyelembe kell vennie a kompromisszum közötti adatbázis-keresések és cookie-méretet.</span><span class="sxs-lookup"><span data-stu-id="a06e2-180">On the other hand, you also want to avoid creating excessively large cookies, so you need to consider the trade-off between cookie size versus database lookups.</span></span>   

<span data-ttu-id="a06e2-181">A hitelesítési folyamat befejezése után a rendszer a jogcímeket érhetők el `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="a06e2-181">After the authentication flow is complete, the claims are available in `HttpContext.User`.</span></span> <span data-ttu-id="a06e2-182">Ezen a ponton kell tekinteni őket egy csak olvasható gyűjteményként &mdash; pl., amelyekkel engedélyezési döntésekhez.</span><span class="sxs-lookup"><span data-stu-id="a06e2-182">At that point, you should treat them as a read-only collection &mdash; e.g., use them to make authorization decisions.</span></span>

## <a name="issuer-validation"></a><span data-ttu-id="a06e2-183">Kibocsátó érvényesítése</span><span class="sxs-lookup"><span data-stu-id="a06e2-183">Issuer validation</span></span>
<span data-ttu-id="a06e2-184">Az OpenID Connect a kibocsátó jogcím ("iss") a kiállító terjesztési hely a azonosító jogkivonatot kibocsátó azonosítja.</span><span class="sxs-lookup"><span data-stu-id="a06e2-184">In OpenID Connect, the issuer claim ("iss") identifies the IDP that issued the ID token.</span></span> <span data-ttu-id="a06e2-185">Győződjön meg arról, hogy a kibocsátó jogcím egyezik a tényleges kibocsátó OIDC hitelesítési folyamatának részeként is.</span><span class="sxs-lookup"><span data-stu-id="a06e2-185">Part of the OIDC authentication flow is to verify that the issuer claim matches the actual issuer.</span></span> <span data-ttu-id="a06e2-186">A OIDC köztes kezeli ezt meg.</span><span class="sxs-lookup"><span data-stu-id="a06e2-186">The OIDC middleware handles this for you.</span></span>

<span data-ttu-id="a06e2-187">Az Azure ad-ben, a kibocsátó értéke egyedi AD bérlőnként (`https://sts.windows.net/<tenantID>`).</span><span class="sxs-lookup"><span data-stu-id="a06e2-187">In Azure AD, the issuer value is unique per AD tenant (`https://sts.windows.net/<tenantID>`).</span></span> <span data-ttu-id="a06e2-188">Ezért az alkalmazás tegyen egy további ellenőrzést, győződjön meg arról, hogy a kibocsátó képviseli azt, hogy jelentkezzen be az alkalmazás a bérlő számára.</span><span class="sxs-lookup"><span data-stu-id="a06e2-188">Therefore, an application should do an additional check, to make sure the issuer represents a tenant that is allowed to sign in to the app.</span></span>

<span data-ttu-id="a06e2-189">Single-bérlő alkalmazáshoz csak ellenőrizheti, hogy a kibocsátó-e saját bérlőt.</span><span class="sxs-lookup"><span data-stu-id="a06e2-189">For a single-tenant application, you can just check that the issuer is your own tenant.</span></span> <span data-ttu-id="a06e2-190">Valójában a OIDC köztes automatikusan elvégzi ezt alapértelmezés szerint.</span><span class="sxs-lookup"><span data-stu-id="a06e2-190">In fact, the OIDC middleware does this automatically by default.</span></span> <span data-ttu-id="a06e2-191">Egy több-bérlős alkalmazásban, engedélyeznie kell a több kiállítók, a különböző bérlőkhöz tartozó.</span><span class="sxs-lookup"><span data-stu-id="a06e2-191">In a multi-tenant app, you need to allow for multiple issuers, corresponding to the different tenants.</span></span> <span data-ttu-id="a06e2-192">Ez egy általános módszer használatához:</span><span class="sxs-lookup"><span data-stu-id="a06e2-192">Here is a general approach to use:</span></span>

* <span data-ttu-id="a06e2-193">Állítsa be az OIDC köztes beállításai **ValidateIssuer** false értékre.</span><span class="sxs-lookup"><span data-stu-id="a06e2-193">In the OIDC middleware options, set **ValidateIssuer** to false.</span></span> <span data-ttu-id="a06e2-194">Ez kikapcsolja az automatikus ellenőrzést.</span><span class="sxs-lookup"><span data-stu-id="a06e2-194">This turns off the automatic check.</span></span>
* <span data-ttu-id="a06e2-195">Amikor a bérlő előfizet, a felhasználói adatbázis tárolja a bérlő és a kibocsátó.</span><span class="sxs-lookup"><span data-stu-id="a06e2-195">When a tenant signs up, store the tenant and the issuer in your user DB.</span></span>
* <span data-ttu-id="a06e2-196">Amikor egy felhasználó bejelentkezik, keresse meg a kibocsátó adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="a06e2-196">Whenever a user signs in, look up the issuer in the database.</span></span> <span data-ttu-id="a06e2-197">Ha a kibocsátó nem található, az azt jelenti, hogy a bérlő még nem regisztrált.</span><span class="sxs-lookup"><span data-stu-id="a06e2-197">If the issuer isn't found, it means that tenant hasn't signed up.</span></span> <span data-ttu-id="a06e2-198">Akkor is átirányítja őket egy bejelentkezési oldalára.</span><span class="sxs-lookup"><span data-stu-id="a06e2-198">You can redirect them to a sign up page.</span></span>
* <span data-ttu-id="a06e2-199">Ön is volt tiltólistára egyes bérlők; például az ügyfelek, amelyek nem kell fizetnie az előfizetését.</span><span class="sxs-lookup"><span data-stu-id="a06e2-199">You could also blacklist certain tenants; for example, for customers that didn't pay their subscription.</span></span>

<span data-ttu-id="a06e2-200">További részletes tárgyalását lásd: [-előfizetés és a bérlők egy több-bérlős alkalmazásban bevezetési][signup].</span><span class="sxs-lookup"><span data-stu-id="a06e2-200">For a more detailed discussion, see [Sign-up and tenant onboarding in a multitenant application][signup].</span></span>

## <a name="using-claims-for-authorization"></a><span data-ttu-id="a06e2-201">A hitelesítéshez jogcímeket használó</span><span class="sxs-lookup"><span data-stu-id="a06e2-201">Using claims for authorization</span></span>
<span data-ttu-id="a06e2-202">A jogcímek, az a felhasználói identitás már nincs egységes entitás.</span><span class="sxs-lookup"><span data-stu-id="a06e2-202">With claims, a user's identity is no longer a monolithic entity.</span></span> <span data-ttu-id="a06e2-203">A felhasználó Előfordulhat például, e-mail címét, telefonszámát, születési, nemét, stb. Lehet, hogy a felhasználó IDP az összes olyan tárolja ezeket az információkat.</span><span class="sxs-lookup"><span data-stu-id="a06e2-203">For example, a user might have an email address, phone number, birthday, gender, etc. Maybe the user's IDP stores all of this information.</span></span> <span data-ttu-id="a06e2-204">De ha hitelesíteni a felhasználót, általában kap egy részét, ezek jogcímekként.</span><span class="sxs-lookup"><span data-stu-id="a06e2-204">But when you authenticate the user, you'll typically get a subset of these as claims.</span></span> <span data-ttu-id="a06e2-205">Ebben a modellben a felhasználó identitását a jogcímek egyszerűen egy kötegelt.</span><span class="sxs-lookup"><span data-stu-id="a06e2-205">In this model, the user's identity is simply a bundle of claims.</span></span> <span data-ttu-id="a06e2-206">Amikor engedélyezéshez felhasználókkal kapcsolatos, adott beállítása jogcímek fogja keresni.</span><span class="sxs-lookup"><span data-stu-id="a06e2-206">When you make authorization decisions about a user, you will look for particular sets of claims.</span></span> <span data-ttu-id="a06e2-207">Más szóval a kérdés végső soron "Nem felhasználói X rendelkezik igény Z" "X felhasználói művelet végrehajtása Y" lesz.</span><span class="sxs-lookup"><span data-stu-id="a06e2-207">In other words, the question "Can user X perform action Y" ultimately becomes "Does user X have claim Z".</span></span>

<span data-ttu-id="a06e2-208">Az alábbiakban néhány alapvető mintázatokból jogcímek ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="a06e2-208">Here are some basic patterns for checking claims.</span></span>

* <span data-ttu-id="a06e2-209">Ellenőrizze, hogy a felhasználó rendelkezik-e egy adott jogcímet, és az egy adott értéket:</span><span class="sxs-lookup"><span data-stu-id="a06e2-209">To check that the user has a particular claim with a particular value:</span></span>
  
   ```csharp
   if (User.HasClaim(ClaimTypes.Role, "Admin")) { ... }
   ```
   <span data-ttu-id="a06e2-210">Ez a kód ellenőrzi, hogy a felhasználó rendelkezik-e a szerepkör jogcím "Rendszergazda" értékű.</span><span class="sxs-lookup"><span data-stu-id="a06e2-210">This code checks whether the user has a Role claim with the value "Admin".</span></span> <span data-ttu-id="a06e2-211">Megfelelően kezeli az esetben, ha a felhasználó nincs szerepkör jogcím vagy több szerepkör jogcím rendelkezik-e.</span><span class="sxs-lookup"><span data-stu-id="a06e2-211">It correctly handles the case where the user has no Role claim or multiple Role claims.</span></span>
  
   <span data-ttu-id="a06e2-212">A **ClaimTypes** osztály állandók a gyakran használt jogcímtípusok meghatározása.</span><span class="sxs-lookup"><span data-stu-id="a06e2-212">The **ClaimTypes** class defines constants for commonly-used claim types.</span></span> <span data-ttu-id="a06e2-213">Azonban a jogcímtípus bármilyen karakterlánc típusú értéket is használhatja.</span><span class="sxs-lookup"><span data-stu-id="a06e2-213">However, you can use any string value for the claim type.</span></span>
* <span data-ttu-id="a06e2-214">Ha több érték nagyobb, mint tudjanak várhatóan egyetlen érték lekérése a jogcím típusa:</span><span class="sxs-lookup"><span data-stu-id="a06e2-214">To get a single value for a claim type, when you expect there to be at most one value:</span></span>
  
  ```csharp
  string email = User.FindFirst(ClaimTypes.Email)?.Value;
  ```
* <span data-ttu-id="a06e2-215">Összes érték lekérése a jogcím típusa:</span><span class="sxs-lookup"><span data-stu-id="a06e2-215">To get all the values for a claim type:</span></span>
  
  ```csharp
  IEnumerable<Claim> groups = User.FindAll("groups");
  ```

<span data-ttu-id="a06e2-216">További információkért lásd: [több-bérlős alkalmazásokhoz a szerepkör- és erőforrás-alapú engedélyezési][authorization].</span><span class="sxs-lookup"><span data-stu-id="a06e2-216">For more information, see [Role-based and resource-based authorization in multitenant applications][authorization].</span></span>

<span data-ttu-id="a06e2-217">[**Következő**][signup]</span><span class="sxs-lookup"><span data-stu-id="a06e2-217">[**Next**][signup]</span></span>


<!-- Links -->

[hatókör-paramétert]: http://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[támogatott jogkivonat és jogcímtípusok]: /azure/active-directory/active-directory-token-and-claims/
[kibocsátó]: http://openid.net/specs/openid-connect-core-1_0.html#IDToken
[hitelesítési események]: authenticate.md#authentication-events
[signup]: signup.md
[Claims-Based Authorization]: /aspnet/core/security/authorization/claims
[sample application]: https://github.com/mspnp/multitenant-saas-guidance
[authorization]: authorize.md
