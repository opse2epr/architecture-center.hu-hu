---
title: Több-bérlős alkalmazásokban jogcímalapú identitások használata
description: Hogyan használja a kibocsátó érvényesítése és az engedélyezés jogcímek.
author: MikeWasson
ms.date: 07/21/2017
pnp.series.title: Manage Identity in Multitenant Applications
pnp.series.prev: authenticate
pnp.series.next: signup
ms.openlocfilehash: ffaa6085dd9ca9ddec203e6661575e984b2e25e0
ms.sourcegitcommit: 1f4cdb08fe73b1956e164ad692f792f9f635b409
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 01/08/2019
ms.locfileid: "54113586"
---
# <a name="work-with-claims-based-identities"></a><span data-ttu-id="1bb32-103">Jogcímalapú identitások használata</span><span class="sxs-lookup"><span data-stu-id="1bb32-103">Work with claims-based identities</span></span>

<span data-ttu-id="1bb32-104">[![GitHub](../_images/github.png) Mintakód][sample application]</span><span class="sxs-lookup"><span data-stu-id="1bb32-104">[![GitHub](../_images/github.png) Sample code][sample application]</span></span>

## <a name="claims-in-azure-ad"></a><span data-ttu-id="1bb32-105">Jogcímek, az Azure ad-ben</span><span class="sxs-lookup"><span data-stu-id="1bb32-105">Claims in Azure AD</span></span>

<span data-ttu-id="1bb32-106">Amikor egy felhasználó bejelentkezik, az Azure AD elküldi egy azonosító jogkivonat, amely a felhasználóval kapcsolatos jogcímek egy készletét tartalmazza.</span><span class="sxs-lookup"><span data-stu-id="1bb32-106">When a user signs in, Azure AD sends an ID token that contains a set of claims about the user.</span></span> <span data-ttu-id="1bb32-107">Jogcím egyszerűen egy információt egy kulcs/érték pár kifejezve.</span><span class="sxs-lookup"><span data-stu-id="1bb32-107">A claim is simply a piece of information, expressed as a key/value pair.</span></span> <span data-ttu-id="1bb32-108">Például: `email`=`bob@contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="1bb32-108">For example, `email`=`bob@contoso.com`.</span></span>  <span data-ttu-id="1bb32-109">Jogcímek rendelkezik egy kibocsátó &mdash; ebben az esetben az Azure AD &mdash; Ez az a entitás, amely hitelesíti a felhasználót, és a jogcímeket hoz létre.</span><span class="sxs-lookup"><span data-stu-id="1bb32-109">Claims have an issuer &mdash; in this case, Azure AD &mdash; which is the entity that authenticates the user and creates the claims.</span></span> <span data-ttu-id="1bb32-110">Megbízik a jogcímeket, mivel a kibocsátó megbízik.</span><span class="sxs-lookup"><span data-stu-id="1bb32-110">You trust the claims because you trust the issuer.</span></span> <span data-ttu-id="1bb32-111">(Ezzel szemben, ha a kiállító nem megbízható, nem megbízható jogcímeket!)</span><span class="sxs-lookup"><span data-stu-id="1bb32-111">(Conversely, if you don't trust the issuer, don't trust the claims!)</span></span>

<span data-ttu-id="1bb32-112">Magas szintű:</span><span class="sxs-lookup"><span data-stu-id="1bb32-112">At a high level:</span></span>

1. <span data-ttu-id="1bb32-113">A felhasználó hitelesíti magát.</span><span class="sxs-lookup"><span data-stu-id="1bb32-113">The user authenticates.</span></span>
2. <span data-ttu-id="1bb32-114">Az Identitásszolgáltató elküldi a jogcímeket.</span><span class="sxs-lookup"><span data-stu-id="1bb32-114">The IDP sends a set of claims.</span></span>
3. <span data-ttu-id="1bb32-115">Az alkalmazás normalizálja, vagy úgy bővíti a jogcímek (nem kötelező).</span><span class="sxs-lookup"><span data-stu-id="1bb32-115">The app normalizes or augments the claims (optional).</span></span>
4. <span data-ttu-id="1bb32-116">Az alkalmazás használ a jogcímek engedélyezési döntésekhez.</span><span class="sxs-lookup"><span data-stu-id="1bb32-116">The app uses the claims to make authorization decisions.</span></span>

<span data-ttu-id="1bb32-117">Az OpenID Connect, kap jogcímkészletet vezérli a [hatókör-paramétert] a hitelesítési kérelem.</span><span class="sxs-lookup"><span data-stu-id="1bb32-117">In OpenID Connect, the set of claims that you get is controlled by the [scope parameter] of the authentication request.</span></span> <span data-ttu-id="1bb32-118">Azonban az Azure AD kibocsát egy korlátozott számú OpenID Connect; keresztül áramló jogcímeket Lásd: [Támogatott token- és jogcímtípusok].</span><span class="sxs-lookup"><span data-stu-id="1bb32-118">However, Azure AD issues a limited set of claims through OpenID Connect; see [Supported Token and Claim Types].</span></span> <span data-ttu-id="1bb32-119">Ha azt szeretné, hogy a felhasználó további információt, szüksége lesz az Azure AD Graph API.</span><span class="sxs-lookup"><span data-stu-id="1bb32-119">If you want more information about the user, you'll need to use the Azure AD Graph API.</span></span>

<span data-ttu-id="1bb32-120">Íme néhány a jogcímek, az aad-ből, amelyek az alkalmazás általában előfordulhat, hogy érdeklik:</span><span class="sxs-lookup"><span data-stu-id="1bb32-120">Here are some of the claims from AAD that an app might typically care about:</span></span>

| <span data-ttu-id="1bb32-121">Azonosító jogkivonat a jogcím típusa</span><span class="sxs-lookup"><span data-stu-id="1bb32-121">Claim type in ID token</span></span> | <span data-ttu-id="1bb32-122">Leírás</span><span class="sxs-lookup"><span data-stu-id="1bb32-122">Description</span></span> |
| --- | --- |
| <span data-ttu-id="1bb32-123">AUD</span><span class="sxs-lookup"><span data-stu-id="1bb32-123">aud</span></span> |<span data-ttu-id="1bb32-124">Akik a jogkivonat van kiadva.</span><span class="sxs-lookup"><span data-stu-id="1bb32-124">Who the token was issued for.</span></span> <span data-ttu-id="1bb32-125">Ez lesz az alkalmazás ügyfél-azonosítót.</span><span class="sxs-lookup"><span data-stu-id="1bb32-125">This will be the application's client ID.</span></span> <span data-ttu-id="1bb32-126">Általában nem kell aggódnia a kérelmet, mert az a közbenső automatikusan érvényesíti.</span><span class="sxs-lookup"><span data-stu-id="1bb32-126">Generally, you shouldn't need to worry about this claim, because the middleware automatically validates it.</span></span> <span data-ttu-id="1bb32-127">Példa:  `"91464657-d17a-4327-91f3-2ed99386406f"`</span><span class="sxs-lookup"><span data-stu-id="1bb32-127">Example:  `"91464657-d17a-4327-91f3-2ed99386406f"`</span></span> |
| <span data-ttu-id="1bb32-128">csoportok</span><span class="sxs-lookup"><span data-stu-id="1bb32-128">groups</span></span> |<span data-ttu-id="1bb32-129">AAD-csoportokat, amely tagja a felhasználó listáját.</span><span class="sxs-lookup"><span data-stu-id="1bb32-129">A list of AAD groups of which the user is a member.</span></span> <span data-ttu-id="1bb32-130">Például: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span><span class="sxs-lookup"><span data-stu-id="1bb32-130">Example: `["93e8f556-8661-4955-87b6-890bc043c30f", "fc781505-18ef-4a31-a7d5-7d931d7b857e"]`</span></span> |
| <span data-ttu-id="1bb32-131">iss</span><span class="sxs-lookup"><span data-stu-id="1bb32-131">iss</span></span> |<span data-ttu-id="1bb32-132">A [Kiállító] OIDC jogkivonat.</span><span class="sxs-lookup"><span data-stu-id="1bb32-132">The [issuer] of the OIDC token.</span></span> <span data-ttu-id="1bb32-133">Például: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span><span class="sxs-lookup"><span data-stu-id="1bb32-133">Example: `https://sts.windows.net/b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4/`</span></span> |
| <span data-ttu-id="1bb32-134">név</span><span class="sxs-lookup"><span data-stu-id="1bb32-134">name</span></span> |<span data-ttu-id="1bb32-135">A felhasználó megjelenített neve.</span><span class="sxs-lookup"><span data-stu-id="1bb32-135">The user's display name.</span></span> <span data-ttu-id="1bb32-136">Például: `"Alice A."`</span><span class="sxs-lookup"><span data-stu-id="1bb32-136">Example: `"Alice A."`</span></span> |
| <span data-ttu-id="1bb32-137">objektumazonosító</span><span class="sxs-lookup"><span data-stu-id="1bb32-137">oid</span></span> |<span data-ttu-id="1bb32-138">Az aad-ben a felhasználói objektum azonosítója.</span><span class="sxs-lookup"><span data-stu-id="1bb32-138">The object identifier for the user in AAD.</span></span> <span data-ttu-id="1bb32-139">Ez az érték a felhasználó azonosítója nem módosítható és nem újrahasználható.</span><span class="sxs-lookup"><span data-stu-id="1bb32-139">This value is the immutable and non-reusable identifier of the user.</span></span> <span data-ttu-id="1bb32-140">Az érték, email, használja a felhasználók számára; egyedi azonosítóként e-mail-címet használva módosítható.</span><span class="sxs-lookup"><span data-stu-id="1bb32-140">Use this value, not email, as a unique identifier for users; email addresses can change.</span></span> <span data-ttu-id="1bb32-141">Az Azure AD Graph API használata az alkalmazásban, objektumazonosító:-e a lekérdezés profiladatok használt érték.</span><span class="sxs-lookup"><span data-stu-id="1bb32-141">If you use the Azure AD Graph API in your app, object ID is that value used to query profile information.</span></span> <span data-ttu-id="1bb32-142">Például: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span><span class="sxs-lookup"><span data-stu-id="1bb32-142">Example: `"59f9d2dc-995a-4ddf-915e-b3bb314a7fa4"`</span></span> |
| <span data-ttu-id="1bb32-143">roles</span><span class="sxs-lookup"><span data-stu-id="1bb32-143">roles</span></span> |<span data-ttu-id="1bb32-144">A felhasználó alkalmazás-szerepkörök listáját.</span><span class="sxs-lookup"><span data-stu-id="1bb32-144">A list of app roles for the user.</span></span>    <span data-ttu-id="1bb32-145">Például: `["SurveyCreator"]`</span><span class="sxs-lookup"><span data-stu-id="1bb32-145">Example: `["SurveyCreator"]`</span></span> |
| <span data-ttu-id="1bb32-146">TID</span><span class="sxs-lookup"><span data-stu-id="1bb32-146">tid</span></span> |<span data-ttu-id="1bb32-147">Bérlő azonosítója.</span><span class="sxs-lookup"><span data-stu-id="1bb32-147">Tenant ID.</span></span> <span data-ttu-id="1bb32-148">Ezt az értéket az Azure AD-ben az egyedi azonosító a bérlő számára.</span><span class="sxs-lookup"><span data-stu-id="1bb32-148">This value is a unique identifier for the tenant in Azure AD.</span></span> <span data-ttu-id="1bb32-149">Például: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span><span class="sxs-lookup"><span data-stu-id="1bb32-149">Example: `"b9bd2162-77ac-4fb2-8254-5c36e9c0a9c4"`</span></span> |
| <span data-ttu-id="1bb32-150">unique_name</span><span class="sxs-lookup"><span data-stu-id="1bb32-150">unique_name</span></span> |<span data-ttu-id="1bb32-151">A felhasználó az emberi olvasható megjelenített neve.</span><span class="sxs-lookup"><span data-stu-id="1bb32-151">A human readable display name of the user.</span></span> <span data-ttu-id="1bb32-152">Például: `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="1bb32-152">Example: `"alice@contoso.com"`</span></span> |
| <span data-ttu-id="1bb32-153">egyszerű felhasználónév</span><span class="sxs-lookup"><span data-stu-id="1bb32-153">upn</span></span> |<span data-ttu-id="1bb32-154">Egyszerű felhasználónév.</span><span class="sxs-lookup"><span data-stu-id="1bb32-154">User principal name.</span></span> <span data-ttu-id="1bb32-155">Például: `"alice@contoso.com"`</span><span class="sxs-lookup"><span data-stu-id="1bb32-155">Example: `"alice@contoso.com"`</span></span> |

<span data-ttu-id="1bb32-156">Ez a táblázat felsorolja a jogcímtípusok, ahogy azok megjelennek a azonosító jogkivonat.</span><span class="sxs-lookup"><span data-stu-id="1bb32-156">This table lists the claim types as they appear in the ID token.</span></span> <span data-ttu-id="1bb32-157">Az ASP.NET Core az OpenID Connect közbenső szoftvert átalakítja a jogcím-típusok amikor feltölti a jogcím-gyűjtemény a felhasználó rendszerbiztonsági tag:</span><span class="sxs-lookup"><span data-stu-id="1bb32-157">In ASP.NET Core, the OpenID Connect middleware converts some of the claim types when it populates the Claims collection for the user principal:</span></span>

* <span data-ttu-id="1bb32-158">OID > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span><span class="sxs-lookup"><span data-stu-id="1bb32-158">oid > `http://schemas.microsoft.com/identity/claims/objectidentifier`</span></span>
* <span data-ttu-id="1bb32-159">TID > `http://schemas.microsoft.com/identity/claims/tenantid`</span><span class="sxs-lookup"><span data-stu-id="1bb32-159">tid > `http://schemas.microsoft.com/identity/claims/tenantid`</span></span>
* <span data-ttu-id="1bb32-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span><span class="sxs-lookup"><span data-stu-id="1bb32-160">unique_name > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name`</span></span>
* <span data-ttu-id="1bb32-161">egyszerű felhasználónév > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span><span class="sxs-lookup"><span data-stu-id="1bb32-161">upn > `http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn`</span></span>

## <a name="claims-transformations"></a><span data-ttu-id="1bb32-162">A jogcímek átalakítása</span><span class="sxs-lookup"><span data-stu-id="1bb32-162">Claims transformations</span></span>

<span data-ttu-id="1bb32-163">A hitelesítési folyamat során érdemes módosítani a jogcímek, az Identitásszolgáltató képest.</span><span class="sxs-lookup"><span data-stu-id="1bb32-163">During the authentication flow, you might want to modify the claims that you get from the IDP.</span></span> <span data-ttu-id="1bb32-164">ASP.NET Core, a jogcímek átalakításáról található hajthat végre a **AuthenticationValidated** eseményt az OpenID Connect közbenső szoftvert.</span><span class="sxs-lookup"><span data-stu-id="1bb32-164">In ASP.NET Core, you can perform claims transformation inside of the **AuthenticationValidated** event from the OpenID Connect middleware.</span></span> <span data-ttu-id="1bb32-165">(Lásd: [hitelesítési események].)</span><span class="sxs-lookup"><span data-stu-id="1bb32-165">(See [Authentication events].)</span></span>

<span data-ttu-id="1bb32-166">Bármely során hozzáadott jogcím **AuthenticationValidated** a munkamenet hitelesítési cookie vannak tárolva.</span><span class="sxs-lookup"><span data-stu-id="1bb32-166">Any claims that you add during **AuthenticationValidated** are stored in the session authentication cookie.</span></span> <span data-ttu-id="1bb32-167">Ezek nem get küldi vissza az Azure ad-hez.</span><span class="sxs-lookup"><span data-stu-id="1bb32-167">They don't get pushed back to Azure AD.</span></span>

<span data-ttu-id="1bb32-168">Íme néhány példa a jogcímek átalakításáról:</span><span class="sxs-lookup"><span data-stu-id="1bb32-168">Here are some examples of claims transformation:</span></span>

* <span data-ttu-id="1bb32-169">**Jogcím-normalizálási**, vagy a jogcímszolgáltatói konzisztens felhasználók között.</span><span class="sxs-lookup"><span data-stu-id="1bb32-169">**Claims normalization**, or making claims consistent across users.</span></span> <span data-ttu-id="1bb32-170">Ez akkor különösen fontos, ha a több identitásszolgáltató használatát, amely használható különböző jogcímtípusok hasonló információkat kap jogcímeket.</span><span class="sxs-lookup"><span data-stu-id="1bb32-170">This is particularly relevant if you are getting claims from multiple IDPs, which might use different claim types for similar information.</span></span> <span data-ttu-id="1bb32-171">Például az Azure AD elküldi egy "egyszerű felhasználónév" jogcímet, amely tartalmazza a felhasználó e-mail címe.</span><span class="sxs-lookup"><span data-stu-id="1bb32-171">For example, Azure AD sends a "upn" claim that contains the user's email.</span></span> <span data-ttu-id="1bb32-172">Más identitásszolgáltató küldhet egy "e-mail" jogcímet.</span><span class="sxs-lookup"><span data-stu-id="1bb32-172">Other IDPs might send an "email" claim.</span></span> <span data-ttu-id="1bb32-173">A következő kódot egy "e-mail" jogcímet a "egyszerű" jogcím alakítja át:</span><span class="sxs-lookup"><span data-stu-id="1bb32-173">The following code converts the "upn" claim into an "email" claim:</span></span>

  ```csharp
  var email = principal.FindFirst(ClaimTypes.Upn)?.Value;
  if (!string.IsNullOrWhiteSpace(email))
  {
      identity.AddClaim(new Claim(ClaimTypes.Email, email));
  }
  ```

* <span data-ttu-id="1bb32-174">Adjon hozzá **alapértelmezett jogcímértékek** , amelyek nincsenek jelen jogcímek &mdash; például egy felhasználó egy alapértelmezett szerepkör hozzárendelése.</span><span class="sxs-lookup"><span data-stu-id="1bb32-174">Add **default claim values** for claims that aren't present &mdash; for example, assigning a user to a default role.</span></span> <span data-ttu-id="1bb32-175">Bizonyos esetekben ez egyszerűsítheti a hitelesítési logikát.</span><span class="sxs-lookup"><span data-stu-id="1bb32-175">In some cases this can simplify authorization logic.</span></span>
* <span data-ttu-id="1bb32-176">Adjon hozzá **egyéni jogcímtípusok** a felhasználó alkalmazás-specifikus információkat.</span><span class="sxs-lookup"><span data-stu-id="1bb32-176">Add **custom claim types** with application-specific information about the user.</span></span> <span data-ttu-id="1bb32-177">Például előfordulhat, hogy tárolja a felhasználó adatait egy adatbázist.</span><span class="sxs-lookup"><span data-stu-id="1bb32-177">For example, you might store some information about the user in a database.</span></span> <span data-ttu-id="1bb32-178">A hitelesítési jegy hozzáadhatja ezeket az információkat az egyéni jogcím.</span><span class="sxs-lookup"><span data-stu-id="1bb32-178">You could add a custom claim with this information to the authentication ticket.</span></span> <span data-ttu-id="1bb32-179">A jogcím tárolja a cookie-k, így csak az egyszeri bejelentkezési munkamenetenként adatbázisból való beolvasásához szükséges.</span><span class="sxs-lookup"><span data-stu-id="1bb32-179">The claim is stored in a cookie, so you only need to get it from the database once per login session.</span></span> <span data-ttu-id="1bb32-180">Másrészről is érdemes kerülje a túl nagy a cookie-k, ezért érdemes kompromisszumot kötni a cookie-k méretének és adatbázis-keresések között kell.</span><span class="sxs-lookup"><span data-stu-id="1bb32-180">On the other hand, you also want to avoid creating excessively large cookies, so you need to consider the trade-off between cookie size versus database lookups.</span></span>

<span data-ttu-id="1bb32-181">A hitelesítési folyamat befejezése után a jogcímek érhetők el a `HttpContext.User`.</span><span class="sxs-lookup"><span data-stu-id="1bb32-181">After the authentication flow is complete, the claims are available in `HttpContext.User`.</span></span> <span data-ttu-id="1bb32-182">Ezen a ponton kezelje őket egy csak olvasható gyűjteményként &mdash; például ezek segítségével engedélyezési döntésekhez.</span><span class="sxs-lookup"><span data-stu-id="1bb32-182">At that point, you should treat them as a read-only collection &mdash; e.g., use them to make authorization decisions.</span></span>

## <a name="issuer-validation"></a><span data-ttu-id="1bb32-183">Kibocsátó érvényesítése</span><span class="sxs-lookup"><span data-stu-id="1bb32-183">Issuer validation</span></span>

<span data-ttu-id="1bb32-184">Az OpenID Connect a kiállító ("iss") jogcím azonosítja az Identitásszolgáltató az azonosító jogkivonat kibocsátó.</span><span class="sxs-lookup"><span data-stu-id="1bb32-184">In OpenID Connect, the issuer claim ("iss") identifies the IDP that issued the ID token.</span></span> <span data-ttu-id="1bb32-185">OIDC hitelesítési folyamat része, hogy ellenőrizze, hogy a kibocsátó jogcím megegyezik-e a tényleges kibocsátó.</span><span class="sxs-lookup"><span data-stu-id="1bb32-185">Part of the OIDC authentication flow is to verify that the issuer claim matches the actual issuer.</span></span> <span data-ttu-id="1bb32-186">A OIDC közbenső kezeli Ez az Ön számára.</span><span class="sxs-lookup"><span data-stu-id="1bb32-186">The OIDC middleware handles this for you.</span></span>

<span data-ttu-id="1bb32-187">Az Azure AD-ben a kibocsátó értékét az AD-bérlő minden egyedi (`https://sts.windows.net/<tenantID>`).</span><span class="sxs-lookup"><span data-stu-id="1bb32-187">In Azure AD, the issuer value is unique per AD tenant (`https://sts.windows.net/<tenantID>`).</span></span> <span data-ttu-id="1bb32-188">Ezért egy alkalmazás egy további ellenőrzés, hogy a kibocsátó képviseli azt, hogy jelentkezzen be az alkalmazás egy bérlőt kell tennie.</span><span class="sxs-lookup"><span data-stu-id="1bb32-188">Therefore, an application should do an additional check, to make sure the issuer represents a tenant that is allowed to sign in to the app.</span></span>

<span data-ttu-id="1bb32-189">Egybérlős alkalmazás esetében egyszerűen ellenőrizhető, hogy a kibocsátó-e a saját bérlő.</span><span class="sxs-lookup"><span data-stu-id="1bb32-189">For a single-tenant application, you can just check that the issuer is your own tenant.</span></span> <span data-ttu-id="1bb32-190">Valójában a OIDC közbenső automatikusan elvégzi ezt alapértelmezés szerint.</span><span class="sxs-lookup"><span data-stu-id="1bb32-190">In fact, the OIDC middleware does this automatically by default.</span></span> <span data-ttu-id="1bb32-191">Egy több-bérlős alkalmazásban több kiállítók, a különböző bérlőkhöz tartozó engedélyeznie kell.</span><span class="sxs-lookup"><span data-stu-id="1bb32-191">In a multi-tenant app, you need to allow for multiple issuers, corresponding to the different tenants.</span></span> <span data-ttu-id="1bb32-192">Íme egy általános módszer használatához:</span><span class="sxs-lookup"><span data-stu-id="1bb32-192">Here is a general approach to use:</span></span>

* <span data-ttu-id="1bb32-193">A közbenső beállításokat OIDC, állítsa be **ValidateIssuer** hamis értékre.</span><span class="sxs-lookup"><span data-stu-id="1bb32-193">In the OIDC middleware options, set **ValidateIssuer** to false.</span></span> <span data-ttu-id="1bb32-194">Ez az automatikus ellenőrzés kikapcsolása.</span><span class="sxs-lookup"><span data-stu-id="1bb32-194">This turns off the automatic check.</span></span>
* <span data-ttu-id="1bb32-195">Amikor egy bérlő regisztrál, a felhasználói adatbázis tárolja a bérlő és a kibocsátó.</span><span class="sxs-lookup"><span data-stu-id="1bb32-195">When a tenant signs up, store the tenant and the issuer in your user DB.</span></span>
* <span data-ttu-id="1bb32-196">Minden alkalommal, amikor egy felhasználó bejelentkezik, keresse meg a kibocsátó adatbázisban.</span><span class="sxs-lookup"><span data-stu-id="1bb32-196">Whenever a user signs in, look up the issuer in the database.</span></span> <span data-ttu-id="1bb32-197">Ha a kiállító nem található, azt jelenti, hogy a bérlő még nem regisztrált.</span><span class="sxs-lookup"><span data-stu-id="1bb32-197">If the issuer isn't found, it means that tenant hasn't signed up.</span></span> <span data-ttu-id="1bb32-198">Átirányíthatja azokat egy bejelentkezési oldalára.</span><span class="sxs-lookup"><span data-stu-id="1bb32-198">You can redirect them to a sign up page.</span></span>
* <span data-ttu-id="1bb32-199">Ön is volt tiltólistára egyes bérlők; például az ügyfelek, amelyek az előfizetés nem fizet.</span><span class="sxs-lookup"><span data-stu-id="1bb32-199">You could also blacklist certain tenants; for example, for customers that didn't pay their subscription.</span></span>

<span data-ttu-id="1bb32-200">További részletes tárgyalását lásd: [előfizetési és bérlőfelvétel egy több-bérlős alkalmazásban][signup].</span><span class="sxs-lookup"><span data-stu-id="1bb32-200">For a more detailed discussion, see [Sign-up and tenant onboarding in a multitenant application][signup].</span></span>

## <a name="using-claims-for-authorization"></a><span data-ttu-id="1bb32-201">Engedélyezési jogcímek használata</span><span class="sxs-lookup"><span data-stu-id="1bb32-201">Using claims for authorization</span></span>

<span data-ttu-id="1bb32-202">A jogcímek, az a felhasználó identitását, már nem egy monolitikus entitást.</span><span class="sxs-lookup"><span data-stu-id="1bb32-202">With claims, a user's identity is no longer a monolithic entity.</span></span> <span data-ttu-id="1bb32-203">Például egy felhasználó lehet e-mail cím, telefonszám, születésnap, nemét, stb. A felhasználó Identitásszolgáltató talán összes ezeket az információkat tárolja.</span><span class="sxs-lookup"><span data-stu-id="1bb32-203">For example, a user might have an email address, phone number, birthday, gender, etc. Maybe the user's IDP stores all of this information.</span></span> <span data-ttu-id="1bb32-204">De hitelesíteni a felhasználót, amikor általában kap egy része, ezek jogcímekként.</span><span class="sxs-lookup"><span data-stu-id="1bb32-204">But when you authenticate the user, you'll typically get a subset of these as claims.</span></span> <span data-ttu-id="1bb32-205">Ebben a modellben a felhasználó identitását a jogcímek egyszerűen egy kötegelt.</span><span class="sxs-lookup"><span data-stu-id="1bb32-205">In this model, the user's identity is simply a bundle of claims.</span></span> <span data-ttu-id="1bb32-206">Amikor engedélyezéshez felhasználókkal kapcsolatos, adott részhalmazához jogcímek fogja keresni.</span><span class="sxs-lookup"><span data-stu-id="1bb32-206">When you make authorization decisions about a user, you will look for particular sets of claims.</span></span> <span data-ttu-id="1bb32-207">Más szóval a kérdés végső soron "Nem felhasználói X rendelkezik igény Z" "X felhasználó művelet hajtható végre, Y" lesz.</span><span class="sxs-lookup"><span data-stu-id="1bb32-207">In other words, the question "Can user X perform action Y" ultimately becomes "Does user X have claim Z".</span></span>

<span data-ttu-id="1bb32-208">Az alábbiakban néhány alapvető mintázatokból jogcímek ellenőrzéséhez.</span><span class="sxs-lookup"><span data-stu-id="1bb32-208">Here are some basic patterns for checking claims.</span></span>

* <span data-ttu-id="1bb32-209">Ellenőrizze, hogy a felhasználó rendelkezik-e egy adott jogcím egy adott értékkel:</span><span class="sxs-lookup"><span data-stu-id="1bb32-209">To check that the user has a particular claim with a particular value:</span></span>

   ```csharp
   if (User.HasClaim(ClaimTypes.Role, "Admin")) { ... }
   ```

   <span data-ttu-id="1bb32-210">Ez a kód ellenőrzi, hogy a felhasználó rendelkezik-e a szerepkör jogcím "Rendszergazda" értékű.</span><span class="sxs-lookup"><span data-stu-id="1bb32-210">This code checks whether the user has a Role claim with the value "Admin".</span></span> <span data-ttu-id="1bb32-211">Az eset, amelyhez a felhasználónak nincs szerepkör jogcím vagy több szerepkör jogcím van-e megfelelően kezeli.</span><span class="sxs-lookup"><span data-stu-id="1bb32-211">It correctly handles the case where the user has no Role claim or multiple Role claims.</span></span>
  
   <span data-ttu-id="1bb32-212">A **ClaimTypes** osztály jogcímtípusok gyakran használt állandókat határozza meg.</span><span class="sxs-lookup"><span data-stu-id="1bb32-212">The **ClaimTypes** class defines constants for commonly-used claim types.</span></span> <span data-ttu-id="1bb32-213">Bármilyen karakterlánc típusú értéket használhatja azonban a jogcímtípushoz.</span><span class="sxs-lookup"><span data-stu-id="1bb32-213">However, you can use any string value for the claim type.</span></span>
* <span data-ttu-id="1bb32-214">Ha itt nem legfeljebb egy értéket várt egyetlen érték lekéréséhez a jogcím típusa:</span><span class="sxs-lookup"><span data-stu-id="1bb32-214">To get a single value for a claim type, when you expect there to be at most one value:</span></span>

  ```csharp
  string email = User.FindFirst(ClaimTypes.Email)?.Value;
  ```

* <span data-ttu-id="1bb32-215">Egy jogcímtípust értékek lekéréséhez:</span><span class="sxs-lookup"><span data-stu-id="1bb32-215">To get all the values for a claim type:</span></span>

  ```csharp
  IEnumerable<Claim> groups = User.FindAll("groups");
  ```

<span data-ttu-id="1bb32-216">További információkért lásd: [szerepkör- és erőforrás-alapú hitelesítés több-bérlős alkalmazásokban][authorization].</span><span class="sxs-lookup"><span data-stu-id="1bb32-216">For more information, see [Role-based and resource-based authorization in multitenant applications][authorization].</span></span>

<span data-ttu-id="1bb32-217">[**Tovább**][signup]</span><span class="sxs-lookup"><span data-stu-id="1bb32-217">[**Next**][signup]</span></span>

<!-- links -->

[hatókör-paramétert]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[scope parameter]: https://nat.sakimura.org/2012/01/26/scopes-and-claims-in-openid-connect/
[Támogatott token- és jogcímtípusok]: /azure/active-directory/active-directory-token-and-claims/
[Supported Token and Claim Types]: /azure/active-directory/active-directory-token-and-claims/
[Kiállító]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[issuer]: https://openid.net/specs/openid-connect-core-1_0.html#IDToken
[Hitelesítési események]: authenticate.md#authentication-events
[Authentication events]: authenticate.md#authentication-events
[signup]: signup.md
[Claims-Based Authorization]: /aspnet/core/security/authorization/claims
[sample application]: https://github.com/mspnp/multitenant-saas-guidance
[authorization]: authorize.md
