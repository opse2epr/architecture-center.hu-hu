---
title: Teljesítménnyel kapcsolatos hibaelhárítás az Azure Databricksbe az Azure Monitor használatával
titleSuffix: ''
description: Grafana irányítópultok használatával kapcsolatos problémák elhárítása az Azure Databricksben
author: petertaylor9999
ms.date: 04/02/2019
ms.topic: ''
ms.service: ''
ms.subservice: ''
ms.openlocfilehash: 49ec63d0c45ab388ca83b3ab0562428327539619
ms.sourcegitcommit: 1a3cc91530d56731029ea091db1f15d41ac056af
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 04/03/2019
ms.locfileid: "58888011"
---
# <a name="troubleshoot-performance-bottlenecks-in-azure-databricks"></a><span data-ttu-id="214b9-103">Az Azure Databricksben a teljesítmény szűk hibaelhárítása</span><span class="sxs-lookup"><span data-stu-id="214b9-103">Troubleshoot performance bottlenecks in Azure Databricks</span></span>

<span data-ttu-id="214b9-104">Ez a cikk ismerteti a figyelési irányítópult használata a teljesítmény szűk megkereséséhez az Azure Databricks Spark-feladatok.</span><span class="sxs-lookup"><span data-stu-id="214b9-104">This article describes how to use monitoring dashboards to find performance bottlenecks in Spark jobs on Azure Databricks.</span></span>

<span data-ttu-id="214b9-105">[Az Azure Databricks](/azure/azure-databricks/) van egy [Apache Spark](https://spark.apache.org/)– elemzési szolgáltatás, amely megkönnyíti az gyors fejlesztése és üzembe helyezése a big data koncepción alapuló.</span><span class="sxs-lookup"><span data-stu-id="214b9-105">[Azure Databricks](/azure/azure-databricks/) is an [Apache Spark](https://spark.apache.org/)–based analytics service that makes it easy to rapidly develop and deploy big data analytics.</span></span> <span data-ttu-id="214b9-106">Megfigyelés és hibaelhárítás a teljesítménnyel kapcsolatos problémák esetén egy kritikus fontosságú Azure Databricks éles üzemi.</span><span class="sxs-lookup"><span data-stu-id="214b9-106">Monitoring and troubleshooting performance issues is a critical when operating production Azure Databricks workloads.</span></span> <span data-ttu-id="214b9-107">Gyakori teljesítményproblémák azonosításához, hasznos lehet a telemetriai adatok alapján figyelési Vizualizációk használatára.</span><span class="sxs-lookup"><span data-stu-id="214b9-107">To identify common performance issues, it's helpful to use monitoring visualizations based on telemetry data.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="214b9-108">Előfeltételek</span><span class="sxs-lookup"><span data-stu-id="214b9-108">Prerequisites</span></span>

<span data-ttu-id="214b9-109">Ebben a cikkben látható a Grafana az irányítópultok beállításához:</span><span class="sxs-lookup"><span data-stu-id="214b9-109">To set up the Grafana dashboards shown in this article:</span></span>

- <span data-ttu-id="214b9-110">Konfigurálja a Databricks-fürtön, hogy telemetriát küldjön egy Log Analytics-munkaterületet, az Azure Databricks-figyelő könyvtár használatával.</span><span class="sxs-lookup"><span data-stu-id="214b9-110">Configure your Databricks cluster to send telemetry to a Log Analytics workspace, using the Azure Databricks Monitoring Library.</span></span> <span data-ttu-id="214b9-111">További információkért lásd: [konfigurálása az Azure Databricks mérőszámok küldése az Azure monitornak](./configure-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="214b9-111">For details, see [Configure Azure Databricks to send metrics to Azure Monitor](./configure-cluster.md).</span></span>

- <span data-ttu-id="214b9-112">Egy virtuális gépet üzembe helyezni a Grafana.</span><span class="sxs-lookup"><span data-stu-id="214b9-112">Deploy Grafana in a virtual machine.</span></span> <span data-ttu-id="214b9-113">Lásd: [irányítópultok használatával jelenítheti meg az Azure Databricks-metrikák](./dashboards.md).</span><span class="sxs-lookup"><span data-stu-id="214b9-113">See [Use dashboards to visualize Azure Databricks metrics](./dashboards.md).</span></span>

<span data-ttu-id="214b9-114">Az üzembe helyezett lesz a Grafana irányítópultja egy idősorozat-vizualizációkat tartalmaz.</span><span class="sxs-lookup"><span data-stu-id="214b9-114">The Grafana dashboard that is deployed includes a set of time-series visualizations.</span></span> <span data-ttu-id="214b9-115">Az egyes egy Apache Spark-feladat kapcsolatos metrikákat a feladatokat és a tevékenységeket, minden egyes szakaszhoz alkotó fázisa az idősorozat-diagram.</span><span class="sxs-lookup"><span data-stu-id="214b9-115">Each graph is time-series plot of metrics related to an Apache Spark job, the stages of the job, and tasks that make up each stage.</span></span>

## <a name="azure-databricks-performance-overview"></a><span data-ttu-id="214b9-116">Az Azure Databricks teljesítmény áttekintése</span><span class="sxs-lookup"><span data-stu-id="214b9-116">Azure Databricks performance overview</span></span>

<span data-ttu-id="214b9-117">Az Azure Databricks az Apache Spark egy általános célú elosztott számítási rendszer alapul.</span><span class="sxs-lookup"><span data-stu-id="214b9-117">Azure Databricks is based on Apache Spark, a general-purpose distributed computing system.</span></span> <span data-ttu-id="214b9-118">Alkalmazáskód, más néven egy **feladat**, végrehajtja az Apache Spark-fürt, a kezelő feladata.</span><span class="sxs-lookup"><span data-stu-id="214b9-118">Application code, known as a **job**, executes on an Apache Spark cluster, coordinated by the cluster manager.</span></span> <span data-ttu-id="214b9-119">Egy feladat általában a legmagasabb szintű számítási egységek.</span><span class="sxs-lookup"><span data-stu-id="214b9-119">In general, a job is the highest-level unit of computation.</span></span> <span data-ttu-id="214b9-120">Egy feladat jelöli a Spark-alkalmazás által végrehajtott művelet befejezéséhez.</span><span class="sxs-lookup"><span data-stu-id="214b9-120">A job represents the complete operation performed by the Spark application.</span></span> <span data-ttu-id="214b9-121">Végrehajtott egy szokásos műveletet tartalmaz az adatok olvasása a forrásból, adatátalakítások alkalmazása és az eredmények olvasást a tárolón vagy a másik célhelyet.</span><span class="sxs-lookup"><span data-stu-id="214b9-121">A typical operation includes reading data from a source, applying data transformations, and writing the results to storage or another destination.</span></span>

<span data-ttu-id="214b9-122">Feladatok részletezhetők **szakaszok**.</span><span class="sxs-lookup"><span data-stu-id="214b9-122">Jobs are broken down into **stages**.</span></span> <span data-ttu-id="214b9-123">A feladat aknázhatja nyújtotta fejlett lehetőségeket a szakaszok keresztül egymás után, ami azt jelenti, hogy a későbbi szakaszokra kell várnia a korábbi fázisokban végrehajtásához.</span><span class="sxs-lookup"><span data-stu-id="214b9-123">The job advances through the stages sequentially, which means that later stages must wait for earlier stages to complete.</span></span> <span data-ttu-id="214b9-124">Szakaszok tartalmazzák az azonos csoportok **feladatok** , amely a Spark-fürtben több csomóponton párhuzamosan hajtható végre.</span><span class="sxs-lookup"><span data-stu-id="214b9-124">Stages contain groups of identical **tasks** that can be executed in parallel on multiple nodes of the Spark cluster.</span></span> <span data-ttu-id="214b9-125">Feladatok olyan végrehajtási zajló az adatok egy részét a legrészletesebb egysége.</span><span class="sxs-lookup"><span data-stu-id="214b9-125">Tasks are the most granular unit of execution taking place on a subset of the data.</span></span>

<span data-ttu-id="214b9-126">A következő szakaszokban néhány irányítópult-Vizualizációk, amelyek hasznosak a teljesítménnyel kapcsolatos hibaelhárítás.</span><span class="sxs-lookup"><span data-stu-id="214b9-126">The next sections describe some dashboard visualizations that are useful for performance troubleshooting.</span></span>

## <a name="job-and-stage-latency"></a><span data-ttu-id="214b9-127">Feladat vagy előkészítési fázisban késés</span><span class="sxs-lookup"><span data-stu-id="214b9-127">Job and stage latency</span></span>

<span data-ttu-id="214b9-128">Feldolgozás késéssel az az időtartam, a feladat végrehajtása a, amíg be nem fejezi indításakor.</span><span class="sxs-lookup"><span data-stu-id="214b9-128">Job latency is the duration of a job execution from when it starts until it completes.</span></span> <span data-ttu-id="214b9-129">Akkor jelenik meg. percentilisei / fürt és -Azonosítóját, a feladat végrehajtása, hogy a Vizualizáció a kiugró értékek.</span><span class="sxs-lookup"><span data-stu-id="214b9-129">It is shown as percentiles of a job execution per cluster and application ID, to allow the visualization of outliers.</span></span> <span data-ttu-id="214b9-130">A következő diagram bemutatja a Feladatelőzmény egy feladat, a 90. százalékértékre elérte a 50 másodperc, annak ellenére, hogy az 50. percentilis következetesen körülbelül 10 másodpercig volt.</span><span class="sxs-lookup"><span data-stu-id="214b9-130">The following graph shows a job history where the 90th percentile reached 50 seconds, even though the 50th percentile was consistently around 10 seconds.</span></span>

![Feldolgozás késéssel ábrázoló grafikon](./_images/grafana-job-latency.png)

<span data-ttu-id="214b9-132">Keresse meg a feladat végrehajtása a fürt és az alkalmazások, a késés az adatforgalmi csúcsokhoz keres.</span><span class="sxs-lookup"><span data-stu-id="214b9-132">Investigate job execution by cluster and application, looking for spikes in latency.</span></span> <span data-ttu-id="214b9-133">Fürtökkel és alkalmazásokkal rendelkező nagy késleltetésű azonosítás után folytassa a szakasz késés vizsgálatára.</span><span class="sxs-lookup"><span data-stu-id="214b9-133">Once clusters and applications with high latency are identified, move on to investigate stage latency.</span></span>

<span data-ttu-id="214b9-134">Fázis késés is jelenik meg. percentilisei, hogy a Vizualizáció a kiugró értékeket.</span><span class="sxs-lookup"><span data-stu-id="214b9-134">Stage latency is also shown as percentiles to allow the visualization of outliers.</span></span> <span data-ttu-id="214b9-135">Fázis várakozási ideje szerint a fürt, az alkalmazás és a fázis neve van szétbontva.</span><span class="sxs-lookup"><span data-stu-id="214b9-135">Stage latency is broken out by cluster, application, and stage name.</span></span> <span data-ttu-id="214b9-136">A meghatározásához, hogy milyen feladatokat vissza a fázis befejezése után tárolnak a grafikon a feladat késés azonosítsa az adatforgalmi csúcsokhoz.</span><span class="sxs-lookup"><span data-stu-id="214b9-136">Identify spikes in task latency in the graph to determine which tasks are holding back completion of the stage.</span></span>

![A grafikont fázis késés](./_images/grafana-stage-latency.png)

<span data-ttu-id="214b9-138">A fürt átviteli graph feladatok szakaszok és percenként elvégzett feladatok számát jeleníti meg.</span><span class="sxs-lookup"><span data-stu-id="214b9-138">The cluster throughput graph shows the number of jobs, stages, and tasks completed per minute.</span></span> <span data-ttu-id="214b9-139">Ez segít, hogy jobban megismerhesse a munkaterhelés-szakaszok és műveletek feladatonként relatív számának tekintetében.</span><span class="sxs-lookup"><span data-stu-id="214b9-139">This helps you to understand the workload in terms of the relative number of stages and tasks per job.</span></span> <span data-ttu-id="214b9-140">Itt láthatja, hogy a feladatok percenkénti számát címtartományok 2. és 6 közötti szintjeinek száma pedig körülbelül 12 &ndash; 24 / perc.</span><span class="sxs-lookup"><span data-stu-id="214b9-140">Here you can see that the number of jobs per minute ranges between 2 and 6, while the number of stages is about 12 &ndash; 24 per minute.</span></span>

![Graph megjelenítő fürt átviteli sebesség](./_images/grafana-cluster-throughput.png)

## <a name="sum-of-task-execution-latency"></a><span data-ttu-id="214b9-142">A feladat-végrehajtási késés összege</span><span class="sxs-lookup"><span data-stu-id="214b9-142">Sum of task execution latency</span></span>

<span data-ttu-id="214b9-143">Ezt a vizualizációt gazdagépenként egy fürtön futó feladat végrehajtási késés az összegét mutatja.</span><span class="sxs-lookup"><span data-stu-id="214b9-143">This visualization shows the sum of task execution latency per host running on a cluster.</span></span> <span data-ttu-id="214b9-144">Futó feladatok lassan lelassítja a gazdagép miatt a fürt vagy a feladatokat végrehajtó kiszolgálónként képtelenségében észleléséhez használni ehhez a diagramhoz.</span><span class="sxs-lookup"><span data-stu-id="214b9-144">Use this graph to detect tasks that run slowly due to the host slowing down on a cluster, or a misallocation of tasks per executor.</span></span> <span data-ttu-id="214b9-145">Az alábbi diagramon az állomások a legtöbb rendelkezik körülbelül 30 másodpercet összege.</span><span class="sxs-lookup"><span data-stu-id="214b9-145">In the following graph, most of the hosts have a sum of about 30 seconds.</span></span> <span data-ttu-id="214b9-146">Azonban két gazdagép rendelkezik, amely körülbelül 10 percet vigye összegeket.</span><span class="sxs-lookup"><span data-stu-id="214b9-146">However, two of the hosts have sums that hover around 10 minutes.</span></span> <span data-ttu-id="214b9-147">A gazdagépek lassan futnak, vagy a végrehajtó / feladatok számát misallocated van.</span><span class="sxs-lookup"><span data-stu-id="214b9-147">Either the hosts are running slow or the number of tasks per executor is misallocated.</span></span>

![A feladat a végrehajtás gazdagépenként Graph ábrázoló összege](./_images/grafana-sum-task-exec.png)

<span data-ttu-id="214b9-149">A végrehajtó / feladatok számát mutatja, hogy két végrehajtóval rendelt feladatok, aránytalanul nagy számú szűk keresztmetszetet okoz.</span><span class="sxs-lookup"><span data-stu-id="214b9-149">The number of tasks per executor shows that two executors are assigned a disproportionate number of tasks, causing a bottleneck.</span></span>

![A grafikont feladatokat végrehajtó kiszolgálónként](./_images/grafana-tasks-per-exec.png)

## <a name="task-metrics-per-stage"></a><span data-ttu-id="214b9-151">A feladat metrika. fázis</span><span class="sxs-lookup"><span data-stu-id="214b9-151">Task metrics per stage</span></span>

<span data-ttu-id="214b9-152">A feladat metrikák Vizualizáció egy feladat a végrehajtás megtalálható a költségek részletezése.</span><span class="sxs-lookup"><span data-stu-id="214b9-152">The task metrics visualization gives the cost breakdown for a task execution.</span></span> <span data-ttu-id="214b9-153">Ezzel a relatív időt töltött lásd a feladatokat, köztük a szerializálást és deszerializálást.</span><span class="sxs-lookup"><span data-stu-id="214b9-153">You can use it see the relative time spent on tasks such as serialization and deserialization.</span></span> <span data-ttu-id="214b9-154">Ezek az adatok optimalizálása a lehetőségek előfordulhat, hogy megjelenítése &mdash; használatával például [változók szórási](https://spark.apache.org/docs/2.2.0/rdd-programming-guide.html#broadcast-variables) szállítási adatok elkerülése érdekében.</span><span class="sxs-lookup"><span data-stu-id="214b9-154">This data might show opportunities to optimize &mdash; for example, by using [broadcast variables](https://spark.apache.org/docs/2.2.0/rdd-programming-guide.html#broadcast-variables) to avoid shipping data.</span></span> <span data-ttu-id="214b9-155">A feladat metrikák is megjelenítheti az shuffle mérete egy feladat, és a shuffle írási és olvasási alkalommal.</span><span class="sxs-lookup"><span data-stu-id="214b9-155">The task metrics also show the shuffle data size for a task, and the shuffle read and write times.</span></span> <span data-ttu-id="214b9-156">Ha ezeket az értékeket magas, azt jelenti, hogy nagy mennyiségű adatot helyez át a hálózaton keresztül.</span><span class="sxs-lookup"><span data-stu-id="214b9-156">If these values are high, it means that a lot of data is moving across the network.</span></span>

<span data-ttu-id="214b9-157">Egy másik feladat metrika a scheduler késleltetés, amely méri, hogy mennyi ideig tart a feladat ütemezését.</span><span class="sxs-lookup"><span data-stu-id="214b9-157">Another task metric is the scheduler delay, which measures how long it takes to schedule a task.</span></span> <span data-ttu-id="214b9-158">Ideális esetben ez az érték legyen, valójában a feladat végrehajtása végrehajtó számítási időért képest, amely az az idő töltött.</span><span class="sxs-lookup"><span data-stu-id="214b9-158">Ideally, this value should be low compared to the executor compute time, which is the time spent actually executing the task.</span></span>

<span data-ttu-id="214b9-159">Az alábbi grafikonon látható scheduler késleltetési idő (3.7 s), amely meghaladja a végrehajtó számítási idő (1.1-es s).</span><span class="sxs-lookup"><span data-stu-id="214b9-159">The following graph shows a scheduler delay time (3.7 s) that exceeds the executor compute time (1.1 s).</span></span> <span data-ttu-id="214b9-160">Ez azt jelenti, hogy több időt vesz igénybe, mint a tényleges munkát végző ütemezett tevékenységek.</span><span class="sxs-lookup"><span data-stu-id="214b9-160">That means more time is spent waiting for tasks to be scheduled than doing the actual work.</span></span>

![Grafikont a feladat metrika. fázis](./_images/grafana-metrics-per-stage.png)

<span data-ttu-id="214b9-162">Ebben az esetben a probléma okozta túl sok partíció, amely számos olyan ráfordításokat okozta.</span><span class="sxs-lookup"><span data-stu-id="214b9-162">In this case, the problem was caused by having too many partitions, which caused a lot of overhead.</span></span> <span data-ttu-id="214b9-163">A scheduler késleltetési időt a partíciók számának csökkentését csökken.</span><span class="sxs-lookup"><span data-stu-id="214b9-163">Reducing the number of partitions lowered the scheduler delay time.</span></span> <span data-ttu-id="214b9-164">A következő diagram azt mutatja be, hogy a legtöbbször a rendszer tölt a feladat végrehajtása.</span><span class="sxs-lookup"><span data-stu-id="214b9-164">The next graph shows that most of the time is spent executing the task.</span></span>

![Grafikont a feladat metrika. fázis](./_images/grafana-metrics-per-stage2.png)

## <a name="streaming-throughput-and-latency"></a><span data-ttu-id="214b9-166">Folyamatos átviteli teljesítménye és adatelérési sebessége</span><span class="sxs-lookup"><span data-stu-id="214b9-166">Streaming throughput and latency</span></span>

<span data-ttu-id="214b9-167">A strukturált streamelésbe közvetlenül kapcsolódik a folyamatos átviteli sebességet.</span><span class="sxs-lookup"><span data-stu-id="214b9-167">Streaming throughput is directly related to structured streaming.</span></span> <span data-ttu-id="214b9-168">Nincsenek társított streamelés sebességének két fontos metrikákat: A bemeneti sorok száma másodpercenként a második és a feldolgozott sorokat.</span><span class="sxs-lookup"><span data-stu-id="214b9-168">There are two important metrics associated with streaming throughput: Input rows per second and processed rows per second.</span></span> <span data-ttu-id="214b9-169">Ha másodpercenkénti bemeneti sorok outpaces másodpercenként feldolgozott sorok, az azt jelenti, a streamfeldolgozó rendszer elmaradásban van.</span><span class="sxs-lookup"><span data-stu-id="214b9-169">If input rows per second outpaces processed rows per second, it means the stream processing system is falling behind.</span></span> <span data-ttu-id="214b9-170">Is ha a bemeneti adatokat az Event Hubs és a Kafka származik, majd másodpercenkénti bemeneti sorok kell tartani az előtér adatok feldolgozási sebességét.</span><span class="sxs-lookup"><span data-stu-id="214b9-170">Also, if the input data comes from Event Hubs or Kafka, then input rows per second should keep up with the data ingestion rate at the front end.</span></span>

<span data-ttu-id="214b9-171">Két feladatot hasonló fürt átviteli sebesség, de különböző streamelési metrikák is rendelkezhet.</span><span class="sxs-lookup"><span data-stu-id="214b9-171">Two jobs can have similar cluster throughput but very different streaming metrics.</span></span> <span data-ttu-id="214b9-172">Az alábbi képernyőfelvételen két különböző számítási feladatokhoz.</span><span class="sxs-lookup"><span data-stu-id="214b9-172">The following screenshot shows two different workloads.</span></span> <span data-ttu-id="214b9-173">Azok a hasonló tekintetében fürt átviteli sebesség (feladatok, szakaszok és feladatok / perc).</span><span class="sxs-lookup"><span data-stu-id="214b9-173">They are similar in terms of cluster throughput (jobs, stages, and tasks per minute).</span></span> <span data-ttu-id="214b9-174">De a második Futtatás dolgozza fel a 12 000 sor/mp és 4000 sor/mp-ben.</span><span class="sxs-lookup"><span data-stu-id="214b9-174">But the second run processes 12,000 rows/sec versus 4,000 rows/sec.</span></span>

![Streamelés sebességének Graph-megjelenítő](./_images/grafana-streaming-throughput.png)

<span data-ttu-id="214b9-176">Streamelési átviteli sebesség gyakran egy jobb üzleti mérőszám, mint a fürt átviteli sebesség, mert azt feldolgozott adatfelderítési rekordok számát méri.</span><span class="sxs-lookup"><span data-stu-id="214b9-176">Streaming throughput is often a better business metric than cluster throughput, because it measures the number of data records that are processed.</span></span>

## <a name="resource-consumption-per-executor"></a><span data-ttu-id="214b9-177">Erőforrás-használatot végrehajtó</span><span class="sxs-lookup"><span data-stu-id="214b9-177">Resource consumption per executor</span></span>

<span data-ttu-id="214b9-178">A metrikák segítenek megérteni a munkát, amely minden egyes végrehajtó hajt végre.</span><span class="sxs-lookup"><span data-stu-id="214b9-178">These metrics help to understand the work that each executor performs.</span></span>

<span data-ttu-id="214b9-179">**Százalékos metrikák** mérheti, hogy mennyi idő végrehajtó foglalkozik a különböző dolgokat kifejezve egy általános végrehajtó számítási idő töltött idő aránya.</span><span class="sxs-lookup"><span data-stu-id="214b9-179">**Percentage metrics** measure how much time an executor spends on various things, expressed as a ratio of time spent versus the overall executor compute time.</span></span> <span data-ttu-id="214b9-180">A mérőszámok a következők:</span><span class="sxs-lookup"><span data-stu-id="214b9-180">The metrics are:</span></span>

- <span data-ttu-id="214b9-181">A(z) % szerializálni idő</span><span class="sxs-lookup"><span data-stu-id="214b9-181">% Serialize time</span></span>
- <span data-ttu-id="214b9-182">A(z) % deszerializálási ideje</span><span class="sxs-lookup"><span data-stu-id="214b9-182">% Deserialize time</span></span>
- <span data-ttu-id="214b9-183">% CPU-végrehajtó idő</span><span class="sxs-lookup"><span data-stu-id="214b9-183">% CPU executor time</span></span>
- <span data-ttu-id="214b9-184">Idő %-ban JVM</span><span class="sxs-lookup"><span data-stu-id="214b9-184">% JVM time</span></span>

<span data-ttu-id="214b9-185">Ezek a Vizualizációk megjelenítése mennyi egyes metrikák hozzájárul általános végrehajtó feldolgozása.</span><span class="sxs-lookup"><span data-stu-id="214b9-185">These visualizations show how much each of these metrics contributes to overall executor processing.</span></span>

![A grafikont százalékos metrikák](./_images/grafana-percentage.png)

<span data-ttu-id="214b9-187">**Metrikák shuffle** metrikák kapcsolódó adatok újbóli felosztás a végrehajtóval között.</span><span class="sxs-lookup"><span data-stu-id="214b9-187">**Shuffle metrics** are metrics related to data shuffling across the executors.</span></span>

- <span data-ttu-id="214b9-188">Shuffle i/o</span><span class="sxs-lookup"><span data-stu-id="214b9-188">Shuffle I/O</span></span>
- <span data-ttu-id="214b9-189">Shuffle memória</span><span class="sxs-lookup"><span data-stu-id="214b9-189">Shuffle memory</span></span>
- <span data-ttu-id="214b9-190">Fájlrendszerhasználat</span><span class="sxs-lookup"><span data-stu-id="214b9-190">File system usage</span></span>
- <span data-ttu-id="214b9-191">Lemezhasználat</span><span class="sxs-lookup"><span data-stu-id="214b9-191">Disk usage</span></span>

## <a name="common-performance-bottlenecks"></a><span data-ttu-id="214b9-192">Gyakran a teljesítmény szűk</span><span class="sxs-lookup"><span data-stu-id="214b9-192">Common performance bottlenecks</span></span>

<span data-ttu-id="214b9-193">Két gyakori teljesítmény szűk keresztmetszeteinek megszüntetéséhez Spark vannak *elvetésének feladat* és a egy *partíciók száma nem optimális shuffle*.</span><span class="sxs-lookup"><span data-stu-id="214b9-193">Two common performance bottlenecks in Spark are *task stragglers* and a *non-optimal shuffle partition count*.</span></span>

### <a name="task-stragglers"></a><span data-ttu-id="214b9-194">A feladat elvetésének</span><span class="sxs-lookup"><span data-stu-id="214b9-194">Task stragglers</span></span>

<span data-ttu-id="214b9-195">Egy feladat szakaszai megadott sorrendben hajtja végre blokkolja a későbbi szakaszokra korábbi szakaszaiban.</span><span class="sxs-lookup"><span data-stu-id="214b9-195">The stages in a job are executed sequentially, with earlier stages blocking later stages.</span></span> <span data-ttu-id="214b9-196">Egy tevékenység más feladatok lassabban végrehajtja a shuffle partíció, ha a fürt összes feladatot a lassú feladat fejezheti be a fázis előtt olvasásra kell várni.</span><span class="sxs-lookup"><span data-stu-id="214b9-196">If one task executes a shuffle partition more slowly than other tasks, all tasks in the cluster must wait for the slow task to catch up before the stage can end.</span></span> <span data-ttu-id="214b9-197">Ez akkor fordulhat elő, a következő okok miatt:</span><span class="sxs-lookup"><span data-stu-id="214b9-197">This can happen for the following reasons:</span></span>

1. <span data-ttu-id="214b9-198">Egy gazdagép vagy gazdagépek nincs lassan futnak.</span><span class="sxs-lookup"><span data-stu-id="214b9-198">A host or group of hosts are running slow.</span></span> <span data-ttu-id="214b9-199">Tünetek: Magas feladat, a szakaszban vagy feldolgozás késéssel és a fürt alacsony átviteli sebesség.</span><span class="sxs-lookup"><span data-stu-id="214b9-199">Symptoms: High task, stage, or job latency and low cluster throughput.</span></span> <span data-ttu-id="214b9-200">A feladatok késések gazdagépenként háttéradatok nem lehet egyenletesen oszlik el.</span><span class="sxs-lookup"><span data-stu-id="214b9-200">The summation of tasks latencies per host won't be evenly distributed.</span></span> <span data-ttu-id="214b9-201">Azonban erőforrás-használat egyenletesen között szétosztani végrehajtóval.</span><span class="sxs-lookup"><span data-stu-id="214b9-201">However, resource consumption will be evenly distributed across executors.</span></span>

1. <span data-ttu-id="214b9-202">Feladatok végrehajtásához (adatok eltorzítják) költséges összesítést rendelkeznek.</span><span class="sxs-lookup"><span data-stu-id="214b9-202">Tasks have an expensive aggregation to execute (data skewing).</span></span> <span data-ttu-id="214b9-203">Tünetek: Magas feladat, a fázis, vagy a feladat és a fürt alacsony átviteli sebesség, de az késleltetések gazdagépenként háttéradatok egyenletesen vannak elosztva.</span><span class="sxs-lookup"><span data-stu-id="214b9-203">Symptoms: High task, stage, or job and low cluster throughput, but the summation of latencies per host is evenly distributed.</span></span> <span data-ttu-id="214b9-204">Erőforrás-használat végrehajtóval között egyenlően szétosztani.</span><span class="sxs-lookup"><span data-stu-id="214b9-204">Resource consumption will be evenly distributed across executors.</span></span>

1. <span data-ttu-id="214b9-205">Ha a partíciók nem egyenlő méretű, egy nagyobb partíció egyenetlen feladat a végrehajtás (partíció eltorzítják) vezethet.</span><span class="sxs-lookup"><span data-stu-id="214b9-205">If partitions are of unequal size, a larger partition may cause unbalanced task execution (partition skewing).</span></span> <span data-ttu-id="214b9-206">Tünetek: Erőforrás-használat végrehajtó túl magas a fürtben futó más végrehajtóval képest.</span><span class="sxs-lookup"><span data-stu-id="214b9-206">Symptoms: Executor resource consumption is high compared to other executors running on the cluster.</span></span> <span data-ttu-id="214b9-207">A végrehajtó futó összes feladat lassú végrehajtását, és a szakasz végrehajtása tartsa a folyamat.</span><span class="sxs-lookup"><span data-stu-id="214b9-207">All tasks running on that executor will run slow and hold the stage execution in the pipeline.</span></span> <span data-ttu-id="214b9-208">Szakaszokban vannak szólt kell *korlátok előkészítése*.</span><span class="sxs-lookup"><span data-stu-id="214b9-208">Those stages are said to be *stage barriers*.</span></span>

### <a name="non-optimal-shuffle-partition-count"></a><span data-ttu-id="214b9-209">A nem optimális shuffle partíciók száma</span><span class="sxs-lookup"><span data-stu-id="214b9-209">Non-optimal shuffle partition count</span></span>

<span data-ttu-id="214b9-210">Strukturált streamelési lekérdezés alatt egy tevékenység-végrehajtó történő, hozzárendelését egy erőforrás-igényes művelet, a fürt számára.</span><span class="sxs-lookup"><span data-stu-id="214b9-210">During a structured streaming query, the assignment of a task to an executor is a resource-intensive operation for the cluster.</span></span> <span data-ttu-id="214b9-211">A shuffle adatok nem optimális mérete, ha a feladat késleltetése mennyisége negatív hatással átviteli sebességgel és késéssel.</span><span class="sxs-lookup"><span data-stu-id="214b9-211">If the shuffle data isn't the optimal size, the amount of delay for a task will negatively impact throughput and latency.</span></span> <span data-ttu-id="214b9-212">Ha túl kevés partíciókat, a Processzormagok száma a fürtben fog kell eredményeztek ennek eredményeként elégtelenségekkel feldolgozása.</span><span class="sxs-lookup"><span data-stu-id="214b9-212">If there are too few partitions, the cores in the cluster will be underutilized which can result in processing inefficiency.</span></span> <span data-ttu-id="214b9-213">Ezzel szemben ha túl sok partíció van, nincs terhelés kevés számú feladat-kezelés nagy fokú.</span><span class="sxs-lookup"><span data-stu-id="214b9-213">Conversely, if there are too many partitions, there's a great deal of management overhead for a small number of tasks.</span></span>

<span data-ttu-id="214b9-214">Az erőforrás-felhasználási mérőszámok használatával a partíció eltorzítják és végrehajtóval a fürtön, képtelenségében hibaelhárítása.</span><span class="sxs-lookup"><span data-stu-id="214b9-214">Use the resource consumption metrics to troubleshoot partition skewing and misallocation of executors on the cluster.</span></span> <span data-ttu-id="214b9-215">Ha egy partíció torzítja van, akkor végrehajtó erőforrásokat a fürtben futó más végrehajtóval támogatáshoz képest korlátozottabb emelt szintű.</span><span class="sxs-lookup"><span data-stu-id="214b9-215">If a partition is skewed, executor resources will be elevated in comparison to other executors running on the cluster.</span></span>

<span data-ttu-id="214b9-216">Például a következő diagram azt mutatja, hogy az első két végrehajtóval az újbóli felosztás által felhasznált memória X nagyobb, mint a többi végrehajtóval 90:</span><span class="sxs-lookup"><span data-stu-id="214b9-216">For example, the following graph shows that the memory used by shuffling on the first two executors is 90X bigger than the other executors:</span></span>

![A grafikont százalékos metrikák](./_images/grafana-shuffle-memory.png)