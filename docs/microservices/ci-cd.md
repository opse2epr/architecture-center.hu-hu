---
title: CI/CD-mikroszolgáltatások
description: Folyamatos integráció és folyamatos készregyártás a mikroszolgáltatásokat.
author: MikeWasson
ms.date: 10/23/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: microservices
ms.openlocfilehash: 219c50fb002a97874310b76de6f3bdbc34eaac6d
ms.sourcegitcommit: c053e6edb429299a0ad9b327888d596c48859d4a
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 03/20/2019
ms.locfileid: "58298593"
---
# <a name="designing-microservices-continuous-integration"></a><span data-ttu-id="89bec-103">Mikroszolgáltatások tervezése: Folyamatos integráció</span><span class="sxs-lookup"><span data-stu-id="89bec-103">Designing microservices: Continuous integration</span></span>

<span data-ttu-id="89bec-104">Folyamatos integráció és folyamatos készregyártás (CI/CD) egy kulcsfontosságú követelmény az sikeres a mikroszolgáltatás-alapú eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="89bec-104">Continuous integration and continuous delivery (CI/CD) are a key requirement for achieving success with microservices.</span></span> <span data-ttu-id="89bec-105">Egy jó CI/CD-folyamat nélkül, nem éri el a rugalmasságot, mellyel a mikroszolgáltatások garantálniuk.</span><span class="sxs-lookup"><span data-stu-id="89bec-105">Without a good CI/CD process, you will not achieve the agility that microservices promise.</span></span> <span data-ttu-id="89bec-106">Néhány a mikroszolgáltatások a CI/CD kapcsolatban felmerülő kihívások merülnek fel, több kódbázissal és életciklusainak buildkörnyezeteket, a különböző szolgáltatások esetében nem.</span><span class="sxs-lookup"><span data-stu-id="89bec-106">Some of the CI/CD challenges for microservices arise from having multiple code bases and heterogenous build environments for the various services.</span></span> <span data-ttu-id="89bec-107">Ez a cikk a kihívásokat ismerteti, és javasolja a probléma néhány olyan módszert.</span><span class="sxs-lookup"><span data-stu-id="89bec-107">This article describes the challenges and recommends some approaches to the problem.</span></span>

![CI/CD a mikroszolgáltatásokat ábrája](./images/ci-cd.png)

<span data-ttu-id="89bec-109">Gyorsabb kiadási ciklusokhoz a legnagyobb okai a mikroszolgáltatási architektúra elfogadására.</span><span class="sxs-lookup"><span data-stu-id="89bec-109">Faster release cycles are one of the biggest reasons to adopt a microservices architecture.</span></span>

<span data-ttu-id="89bec-110">A tisztán monolitikus alkalmazások esetén nincs egy egyetlen build folyamatot, amelynek a kimenete az alkalmazás futtatható.</span><span class="sxs-lookup"><span data-stu-id="89bec-110">In a purely monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="89bec-111">Minden fejlesztési munka hírcsatornák a folyamatba.</span><span class="sxs-lookup"><span data-stu-id="89bec-111">All development work feeds into this pipeline.</span></span> <span data-ttu-id="89bec-112">Ha egy magas prioritású hiba található, a javítás kell lennie integrált, tesztelését és kiadását, amely késleltetheti-e új funkciók megjelenésével.</span><span class="sxs-lookup"><span data-stu-id="89bec-112">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="89bec-113">IGAZ, hogy ezek a problémák csökkentheti jól faktorált modulokat, és a szolgáltatás ágak használatával kódmódosításokat minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="89bec-113">It's true that you can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="89bec-114">Azonban, ha az alkalmazás összetettebb növekszik, és további szolgáltatások lesznek hozzáadva, mikroszolgáltatásokká kiadási folyamata általában törékennyé teszi és valószínűleg érvényteleníteni válik.</span><span class="sxs-lookup"><span data-stu-id="89bec-114">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span>

<span data-ttu-id="89bec-115">A mikroszolgáltatások filozófia a következő soha nem kell egy hosszú kibocsátási train, ahol minden egyes csapat beolvasása a sor van.</span><span class="sxs-lookup"><span data-stu-id="89bec-115">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="89bec-116">"A" módosításait a szolgáltatás részeként történik, hogy a "B" várakozás nélkül is megjelenhetnek egy tetszőleges időpontban, frissítési szolgáltatás hangolt tesztelését és üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="89bec-116">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span> <span data-ttu-id="89bec-117">A CI/CD-folyamat fontos a megoldáson.</span><span class="sxs-lookup"><span data-stu-id="89bec-117">The CI/CD process is critical to making this possible.</span></span> <span data-ttu-id="89bec-118">Úgy, hogy a frissítések telepítése a kockázatát, így a lehető legkisebb a kibocsátási folyamat automatizált és nagy megbízhatóságú, kell lennie.</span><span class="sxs-lookup"><span data-stu-id="89bec-118">Your release pipeline must be automated and highly reliable, so that the risks of deploying updates are minimized.</span></span> <span data-ttu-id="89bec-119">Ha naponta vagy naponta több alkalommal felszabadítása vannak az éles környezetbe, regressziót vagy szolgáltatáskimaradás nagyon ritkán kell lennie.</span><span class="sxs-lookup"><span data-stu-id="89bec-119">If you are releasing to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="89bec-120">Egyszerre egy rossz frissítés üzembe helyezése, ha rendelkeznie kell egy megbízható módszerre gyorsan visszaállni vagy előregörgethet egy korábbi verzióját, a szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="89bec-120">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

![CI/CD mikroszolgáltatásokká ábrája](./images/cicd-monolith.png)

<span data-ttu-id="89bec-122">Amikor a CI/CD, valóban beszélünk számos kapcsolódó folyamatok: Folyamatos integráció, a folyamatos teljesítés és a folyamatos üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="89bec-122">When we talk about CI/CD, we are really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="89bec-123">Folyamatos integráció, hogy a kód módosítása gyakran egyesítve a fő ágat, automatizált összeállítási, és győződjön meg arról, hogy kódot a fő ág mindig gyártási minőségű folyamatok tesztelése jelenti.</span><span class="sxs-lookup"><span data-stu-id="89bec-123">Continuous integration means that code changes are frequently merged into the main branch, using automated build and test processes to ensure that code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="89bec-124">Folyamatos készregyártás, az azt jelenti, hogy a kód módosítása, hogy a CI folyamat automatikusan közzéteszi az utolsóig üzemi környezetben.</span><span class="sxs-lookup"><span data-stu-id="89bec-124">Continuous delivery means that code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="89bec-125">Az élő éles környezetben való üzembe helyezés manuális jóváhagyásra lehet szükség, de egyébként automatizált.</span><span class="sxs-lookup"><span data-stu-id="89bec-125">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="89bec-126">Az a célja, hogy a kód mindig legyen *készen* helyezheti éles üzembe.</span><span class="sxs-lookup"><span data-stu-id="89bec-126">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="89bec-127">Folyamatos üzembe helyezés azt jelenti, kódmódosítás, hogy a CI/CD-folyamat automatikusan telepített éles környezetbe.</span><span class="sxs-lookup"><span data-stu-id="89bec-127">Continuous deployment means that code changes that pass the CI/CD process are automatically deployed into production.</span></span>

<span data-ttu-id="89bec-128">Kubernetes- és mikroszolgáltatás-alapú környezetében a Konfigurációelem fázis üzemidejére létrehozása és tesztelése a tárolórendszerképek és ezen rendszerképek leküldése egy tároló-beállításjegyzéket.</span><span class="sxs-lookup"><span data-stu-id="89bec-128">In the context of Kubernetes and microservices, the CI stage is concerned with building and testing container images, and pushing those images to a container registry.</span></span> <span data-ttu-id="89bec-129">A központi telepítési fázisban a pod vonatkozó műszaki adatok frissülnek, hogy folytattuk a munkát a legújabb termelési rendszerképet.</span><span class="sxs-lookup"><span data-stu-id="89bec-129">In the deployment stage, pod specs are updated to pick up the latest production image.</span></span>

## <a name="challenges"></a><span data-ttu-id="89bec-130">Problémák</span><span class="sxs-lookup"><span data-stu-id="89bec-130">Challenges</span></span>

- <span data-ttu-id="89bec-131">**Sok kis független kódbázissal**.</span><span class="sxs-lookup"><span data-stu-id="89bec-131">**Many small independent code bases**.</span></span> <span data-ttu-id="89bec-132">Minden egyes csapat felelős a saját szolgáltatás, amelynek a saját build folyamat létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-132">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="89bec-133">Egyes szervezetekben a csapat a előfordulhat, hogy külön kódtárházak.</span><span class="sxs-lookup"><span data-stu-id="89bec-133">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="89bec-134">Ez a helyzet, ahol az ismeretek, hogyan hozhat létre a rendszer a csapatok között megoszlik, és a szervezet senki sem tudja, hogy a teljes alkalmazás üzembe helyezése vezethet.</span><span class="sxs-lookup"><span data-stu-id="89bec-134">This could lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="89bec-135">Például mi történik, a vész-helyreállítási helyzetekre, ha gyorsan üzembe helyezhet egy új fürtre van szüksége?</span><span class="sxs-lookup"><span data-stu-id="89bec-135">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>

- <span data-ttu-id="89bec-136">**Több nyelv és keretrendszer**.</span><span class="sxs-lookup"><span data-stu-id="89bec-136">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="89bec-137">Az egyes csapata a saját technológiák vegyítése használatával nehézkes lehet a szervezet egészében működő egyetlen buildelési folyamat létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-137">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="89bec-138">A létrehozási folyamat kellően rugalmas ahhoz, hogy minden egyes csapat tesztkörnyezetéhez, az általuk választott nyelvet vagy keretrendszert kell lennie.</span><span class="sxs-lookup"><span data-stu-id="89bec-138">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span>

- <span data-ttu-id="89bec-139">**Integráció és a load testing**.</span><span class="sxs-lookup"><span data-stu-id="89bec-139">**Integration and load testing**.</span></span> <span data-ttu-id="89bec-140">Csapatok számára a saját tempójában frissítéseket ad ki ez kihívást jelenthet robusztus – teljes körű tesztelés, különösen ha szolgáltatások függőségekkel rendelkezik más szolgáltatások tervezéséhez.</span><span class="sxs-lookup"><span data-stu-id="89bec-140">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="89bec-141">Ezen felül egy teljes éles fürtöt futtat költséges lehet, ezért nem valószínű, hogy minden egyes csapat fogja tudni a saját teljes fürtöt futtat, éles skálázását követve rugalmasan méretezhető, csak teszteléshez.</span><span class="sxs-lookup"><span data-stu-id="89bec-141">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will be able to run its own full cluster at production scales, just for testing.</span></span>

- <span data-ttu-id="89bec-142">**Kiadáskezelés**.</span><span class="sxs-lookup"><span data-stu-id="89bec-142">**Release management**.</span></span> <span data-ttu-id="89bec-143">Minden team kell az éles környezetbe helyezheti üzembe az alkalmazásokat egy frissítést.</span><span class="sxs-lookup"><span data-stu-id="89bec-143">Every team should have the ability to deploy an update to production.</span></span> <span data-ttu-id="89bec-144">Ez nem jelenti azt, hogy minden csapattag engedélyekkel rendelkezik-e.</span><span class="sxs-lookup"><span data-stu-id="89bec-144">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="89bec-145">Azonban egy központosított Kiadáskezelő szerepkör kellene csökkentheti a központi telepítések adatról van szó.</span><span class="sxs-lookup"><span data-stu-id="89bec-145">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span> <span data-ttu-id="89bec-146">A további, hogy a CI/CD-folyamat automatikus, és megbízható, a kevésbé ott kell lennie egy központi hatóság szüksége.</span><span class="sxs-lookup"><span data-stu-id="89bec-146">The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="89bec-147">Ugyanakkor előfordulhat, hogy kisebb hibajavítások és a főbb funkciókat frissítések kiadása különböző házirendeket.</span><span class="sxs-lookup"><span data-stu-id="89bec-147">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="89bec-148">Folyamatban decentralizált jelenti azt, hogy nulla cégirányítási kell lennie.</span><span class="sxs-lookup"><span data-stu-id="89bec-148">Being decentralized does not mean there should be zero governance.</span></span>

- <span data-ttu-id="89bec-149">**Tároló-lemezkép versioning**.</span><span class="sxs-lookup"><span data-stu-id="89bec-149">**Container image versioning**.</span></span> <span data-ttu-id="89bec-150">A fejlesztési és tesztelési ciklus során a CI/CD-folyamat számos tárolórendszerképek fog létrehozni.</span><span class="sxs-lookup"><span data-stu-id="89bec-150">During the development and test cycle, the CI/CD process will build many container images.</span></span> <span data-ttu-id="89bec-151">Csak a kiadásban a deduplikációra olyanokat is, majd csak néhányat ezen kiadás jelöltek fog első leküldött éles környezetbe.</span><span class="sxs-lookup"><span data-stu-id="89bec-151">Only some of those are candidates for release, and then only some of those release candidates will get pushed into production.</span></span> <span data-ttu-id="89bec-152">Egy világos verziókezelési stratégiát kell, hogy tudja, melyik képek az éles környezetben jelenleg telepítve vannak, és vissza lehet vonni egy korábbi verziót, ha szükséges.</span><span class="sxs-lookup"><span data-stu-id="89bec-152">You should have a clear versioning strategy, so that you know which images are currently deployed to production, and can roll back to a previous version if necessary.</span></span>

- <span data-ttu-id="89bec-153">**Szolgáltatási hírek**.</span><span class="sxs-lookup"><span data-stu-id="89bec-153">**Service updates**.</span></span> <span data-ttu-id="89bec-154">Amikor új verzióra frissít egy szolgáltatás, azt más a tőle függő szolgáltatások nem szünet.</span><span class="sxs-lookup"><span data-stu-id="89bec-154">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span> <span data-ttu-id="89bec-155">Ha így tesz, a működés közbeni frissítés, bizonyos idő különböző verzióit vegyesen futtatásakor lesz.</span><span class="sxs-lookup"><span data-stu-id="89bec-155">If you do a rolling update, there will be a period of time when a mix of versions is running.</span></span>

<span data-ttu-id="89bec-156">Ezek a kihívások alapvető feszültség tükrözik.</span><span class="sxs-lookup"><span data-stu-id="89bec-156">These challenges reflect a fundamental tension.</span></span> <span data-ttu-id="89bec-157">Csapatok, másrészt kell működjön, egymástól függetlenül, amennyire csak lehetséges.</span><span class="sxs-lookup"><span data-stu-id="89bec-157">On the one hand, teams need to work as independently as possible.</span></span> <span data-ttu-id="89bec-158">Néhány koordinálása, másrészt van szükség, hogy egyetlen személy teheti a feladatokat, mint egy integrációs teszt futtatása, újbóli üzembe helyezés a teljes megoldás egy új fürtre vagy egy rossz frissítés visszaállítása.</span><span class="sxs-lookup"><span data-stu-id="89bec-158">On the other hand, some coordination is needed so that a single person can do tasks like running an integration test, redeploying the entire solution to a new cluster, or rolling back a bad update.</span></span>

## <a name="cicd-approaches-for-microservices"></a><span data-ttu-id="89bec-159">A mikroszolgáltatásokat megközelíti a CI/CD</span><span class="sxs-lookup"><span data-stu-id="89bec-159">CI/CD approaches for microservices</span></span>

<span data-ttu-id="89bec-160">Ajánlott minden service csapata igény szerint tárolóalapúvá alakíthatja az összeállító környezetet.</span><span class="sxs-lookup"><span data-stu-id="89bec-160">It's a good practice for every service team to containerize their build environment.</span></span> <span data-ttu-id="89bec-161">Ez a tároló az összes szükséges hozhat létre a szolgáltatásukhoz kód összetevők build eszköz rendelkezhet.</span><span class="sxs-lookup"><span data-stu-id="89bec-161">This container should have all of the build tools necessary to build the code artifacts for their service.</span></span> <span data-ttu-id="89bec-162">Gyakran a nyelv és keretrendszer hivatalos Docker-rendszerképet is megtalálhatja.</span><span class="sxs-lookup"><span data-stu-id="89bec-162">Often you can find an official Docker image for your language and framework.</span></span> <span data-ttu-id="89bec-163">Ezt követően használhatja `docker run` vagy a Docker Compose, a build futtatásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-163">Then you can use `docker run` or Docker Compose to run the build.</span></span>

<span data-ttu-id="89bec-164">Ezzel a módszerrel nagyon egyszerű, egy új build-környezetet.</span><span class="sxs-lookup"><span data-stu-id="89bec-164">With this approach, it's trivial to set up a new build environment.</span></span> <span data-ttu-id="89bec-165">Fejlesztőként szeretne a kód felépítéséhez nem kell telepítenie a build-eszközöket, de egyszerűen futtatja a tároló rendszerképét.</span><span class="sxs-lookup"><span data-stu-id="89bec-165">A developer who wants to build your code doesn't need to install a set of build tools, but simply runs the container image.</span></span> <span data-ttu-id="89bec-166">Talán még fontosabb, a build kiszolgáló beállítható úgy, a végre ugyanezt.</span><span class="sxs-lookup"><span data-stu-id="89bec-166">Perhaps more importantly, your build server can be configured to do the same thing.</span></span> <span data-ttu-id="89bec-167">Ezzel a módszerrel, nem kell telepíteni ezeket az eszközöket a build-kiszolgálóba, vagy az eszközök ütköző verziók kezelése.</span><span class="sxs-lookup"><span data-stu-id="89bec-167">That way, you don't need to install those tools onto the build server, or manage conflicting versions of tools.</span></span>

<span data-ttu-id="89bec-168">Helyi fejlesztési és tesztelési a Docker használatával futtatni a szolgáltatást a tárolókon belül.</span><span class="sxs-lookup"><span data-stu-id="89bec-168">For local development and testing, use Docker to run the service inside a container.</span></span> <span data-ttu-id="89bec-169">Ez a folyamat részeként szükség lehet más utánzatként funkcionáló szolgáltatások vagy helyi teszteléshez szükséges tesztelési adatbázisok rendelkező tárolók futtatásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-169">As part of this process, you may need to run other containers that have mock services or test databases needed for local testing.</span></span> <span data-ttu-id="89bec-170">Ezek a tárolók összehangolása a Docker Compose használatával, vagy helyileg történő futtatása a Kubernetes Minikube használatával.</span><span class="sxs-lookup"><span data-stu-id="89bec-170">You could use Docker Compose to coordinate these containers, or use Minikube to run Kubernetes locally.</span></span>

<span data-ttu-id="89bec-171">Amikor készen áll a kód, nyisson meg egy pull-kérelem és egyesítés főágba be.</span><span class="sxs-lookup"><span data-stu-id="89bec-171">When the code is ready, open a pull request and merge into master.</span></span> <span data-ttu-id="89bec-172">Ez feladatot indít el a build-kiszolgálón:</span><span class="sxs-lookup"><span data-stu-id="89bec-172">This will start a job on the build server:</span></span>

1. <span data-ttu-id="89bec-173">A kód eszközöket hozhat létre.</span><span class="sxs-lookup"><span data-stu-id="89bec-173">Build the code assets.</span></span>
2. <span data-ttu-id="89bec-174">Egység tesztek futtatásához a kódot.</span><span class="sxs-lookup"><span data-stu-id="89bec-174">Run unit tests against the code.</span></span>
3. <span data-ttu-id="89bec-175">A tárolólemezkép létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-175">Build the container image.</span></span>
4. <span data-ttu-id="89bec-176">Ellenőrizze a tároló rendszerképét a funkcionális tesztek futtatása a futó tárolót.</span><span class="sxs-lookup"><span data-stu-id="89bec-176">Test the container image by running functional tests on a running container.</span></span> <span data-ttu-id="89bec-177">Ebben a lépésben a Docker-fájl, például a rossz belépési pont hibáinak használhatják fel őket.</span><span class="sxs-lookup"><span data-stu-id="89bec-177">This step can catch errors in the Docker file, such as a bad entry point.</span></span>
5. <span data-ttu-id="89bec-178">A rendszerkép leküldése egy tároló-beállításjegyzéket.</span><span class="sxs-lookup"><span data-stu-id="89bec-178">Push the image to a container registry.</span></span>
6. <span data-ttu-id="89bec-179">A test-fürt frissítése az új lemezkép integrációs tesztek futtatásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-179">Update the test cluster with the new image to run integration tests.</span></span>

<span data-ttu-id="89bec-180">Amikor a lemezkép készen áll, éles környezetben, frissítse az üzembe helyezési fájlokat a legújabb rendszerképet, beleértve a Kubernetes konfigurációs fájlok megadásához szükség szerint.</span><span class="sxs-lookup"><span data-stu-id="89bec-180">When the image is ready to go into production, update the deployment files as needed to specify the latest image, including any Kubernetes configuration files.</span></span> <span data-ttu-id="89bec-181">Ezután alkalmazza a frissítést az éles fürtöt.</span><span class="sxs-lookup"><span data-stu-id="89bec-181">Then apply the update to the production cluster.</span></span>

<span data-ttu-id="89bec-182">Az alábbiakban néhány javaslat megbízhatóbb végzett központi telepítések:</span><span class="sxs-lookup"><span data-stu-id="89bec-182">Here are some recommendations for making deployments more reliable:</span></span>

- <span data-ttu-id="89bec-183">Adja meg a szervezeti szintű szabályai tároló címkék, verziószámozása és a fürthöz (podok, szolgáltatások és így tovább) üzembe helyezett erőforrások elnevezési szabályainak.</span><span class="sxs-lookup"><span data-stu-id="89bec-183">Define organization-wide conventions for container tags, versioning, and naming conventions for resources deployed to the cluster (pods, services, and so on).</span></span> <span data-ttu-id="89bec-184">Amely megkönnyítheti a üzembe helyezési problémák diagnosztizálásához.</span><span class="sxs-lookup"><span data-stu-id="89bec-184">That can make it easier to diagnose deployment issues.</span></span>

- <span data-ttu-id="89bec-185">Hozzon létre két külön tároló-beállításjegyzékek, egyet a fejlesztési-tesztelési és éles környezetben.</span><span class="sxs-lookup"><span data-stu-id="89bec-185">Create two separate container registries, one for development/testing and one for production.</span></span> <span data-ttu-id="89bec-186">Nem rendszerkép leküldése a termelési beállításjegyzék, amíg készen áll az éles üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="89bec-186">Don't push an image to the production registry until you're ready to deploy it into production.</span></span> <span data-ttu-id="89bec-187">Ha ez az eljárás kombinálva a tárolórendszerképek Szemantikus verziószámozást, csökkentheti az esélye, hogy véletlenül üzembe helyezése egy olyanra, amely a kiadás nem lett jóváhagyva.</span><span class="sxs-lookup"><span data-stu-id="89bec-187">If you combine this practice with semantic versioning of container images, it can reduce the chance of accidentally deploying a version that wasn't approved for release.</span></span>

## <a name="updating-services"></a><span data-ttu-id="89bec-188">Szolgáltatás frissítése</span><span class="sxs-lookup"><span data-stu-id="89bec-188">Updating services</span></span>

<span data-ttu-id="89bec-189">Számos különféle stratégiát, amely már éles környezetben a szolgáltatás frissítése.</span><span class="sxs-lookup"><span data-stu-id="89bec-189">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="89bec-190">Itt három általános beállítások tárgyaljuk: A működés közbeni frissítés, a kék-zöld üzembe helyezés és a canary kiadás.</span><span class="sxs-lookup"><span data-stu-id="89bec-190">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-update"></a><span data-ttu-id="89bec-191">A működés közbeni frissítés</span><span class="sxs-lookup"><span data-stu-id="89bec-191">Rolling update</span></span>

<span data-ttu-id="89bec-192">A működés közbeni frissítés a szolgáltatás új példányok üzembe helyezésekor, és az új példányok, indítsa el azonnal a kérelmek fogadására.</span><span class="sxs-lookup"><span data-stu-id="89bec-192">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="89bec-193">Az új példányok merülnek fel, mint az előző példányok törlődnek.</span><span class="sxs-lookup"><span data-stu-id="89bec-193">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="89bec-194">Működés közbeni frissítései az alapértelmezett viselkedést, a Kubernetes üzembe helyezéséhez a pod specifikációja frissítésekor.</span><span class="sxs-lookup"><span data-stu-id="89bec-194">Rolling updates are the default behavior in Kubernetes when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="89bec-195">A központi telepítési vezérlő hoz létre egy új ReplicaSet a frissített podok számára.</span><span class="sxs-lookup"><span data-stu-id="89bec-195">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="89bec-196">Ezután a méretezés során az új ReplicaSet vertikális leskálázást a régit, a kívánt replikáinak száma fenntartása közben.</span><span class="sxs-lookup"><span data-stu-id="89bec-196">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="89bec-197">Régi podok azzal nem törli, amíg készen áll az újakat.</span><span class="sxs-lookup"><span data-stu-id="89bec-197">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="89bec-198">Kubernetes előzményeket a frissítést, így a kubectl használatával visszavonhat egy frissítést szükség esetén.</span><span class="sxs-lookup"><span data-stu-id="89bec-198">Kubernetes keeps a history of the update, so you can use kubectl to roll back an update if needed.</span></span>

<span data-ttu-id="89bec-199">Ha a szolgáltatás egy hosszú indítási feladat végez, meghatározhatja egy készenlét.</span><span class="sxs-lookup"><span data-stu-id="89bec-199">If your service performs a long startup task, you can define a readiness probe.</span></span> <span data-ttu-id="89bec-200">A végrehajtandó készenléti teszt jelenti a forgalmat fogadó megkezdheti a tároló esetén.</span><span class="sxs-lookup"><span data-stu-id="89bec-200">The readiness probe reports when the container is ready to start receiving traffic.</span></span> <span data-ttu-id="89bec-201">Kubernetes nem küldhetnek forgalmat a pod, amíg a mintavétel sikeres befejezést jelent.</span><span class="sxs-lookup"><span data-stu-id="89bec-201">Kubernetes won't send traffic to the pod until the probe reports success.</span></span>

<span data-ttu-id="89bec-202">Egy igazi kihívást a működés közbeni frissítés, hogy a frissítési folyamat alatt vegyesen a régi és új verziókat futtató és forgalmat fogadó.</span><span class="sxs-lookup"><span data-stu-id="89bec-202">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="89bec-203">Ebben az időszakban bármilyen kérést sikerült irányítva a két verzió valamelyikéhez.</span><span class="sxs-lookup"><span data-stu-id="89bec-203">During this period, any request could get routed to either of the two versions.</span></span> <span data-ttu-id="89bec-204">Előfordulhat, hogy, amely, vagy nem problémát okozhatnak, a két verziója közötti különbségek függően.</span><span class="sxs-lookup"><span data-stu-id="89bec-204">That may or may not cause problems, depending on the scope of the changes between the two versions.</span></span>

### <a name="blue-green-deployment"></a><span data-ttu-id="89bec-205">Kék-zöld üzembe helyezés</span><span class="sxs-lookup"><span data-stu-id="89bec-205">Blue-green deployment</span></span>

<span data-ttu-id="89bec-206">A kék-zöld üzembe helyezés helyezi üzembe az új verziót az előző verzió mellett.</span><span class="sxs-lookup"><span data-stu-id="89bec-206">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="89bec-207">Ellenőrizze, hogy az új verziót, akkor váltson egyszerre az előző verzióhoz képest az új verzió minden forgalmat.</span><span class="sxs-lookup"><span data-stu-id="89bec-207">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="89bec-208">A váltás után az alkalmazás kapcsolatos problémákat figyeli.</span><span class="sxs-lookup"><span data-stu-id="89bec-208">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="89bec-209">Ha hiba lép fel, kicserélheti az a korábbi verzióra.</span><span class="sxs-lookup"><span data-stu-id="89bec-209">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="89bec-210">Ha nem talált nincs probléma, törölheti a régi verzióját.</span><span class="sxs-lookup"><span data-stu-id="89bec-210">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="89bec-211">Egy hagyományos monolitikus vagy N szintű alkalmazáshoz a kék-zöld üzembe helyezés általában kizárólag két azonos környezet kiépítése.</span><span class="sxs-lookup"><span data-stu-id="89bec-211">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="89bec-212">Szeretné az új verzió üzembe helyezése átmeneti környezetben, akkor az átmeneti ügyfél forgalom átirányítása &mdash; például virtuális IP-CÍMEK felcserélésével címek.</span><span class="sxs-lookup"><span data-stu-id="89bec-212">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span>

<span data-ttu-id="89bec-213">A Kubernetes nem kell tennie a kék-zöld üzembe önálló fürt üzembe helyezése.</span><span class="sxs-lookup"><span data-stu-id="89bec-213">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="89bec-214">Ehelyett kihasználhatja a választók.</span><span class="sxs-lookup"><span data-stu-id="89bec-214">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="89bec-215">Hozzon létre egy új központi telepítési erőforrás egy új pod specifikációja és címkék külön készletét.</span><span class="sxs-lookup"><span data-stu-id="89bec-215">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="89bec-216">Hozza létre a központi telepítés nélkül a korábbi központi telepítés törlését vagy módosítását a szolgáltatás, amely azt mutat.</span><span class="sxs-lookup"><span data-stu-id="89bec-216">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="89bec-217">Miután az új podok is futnak, frissítheti a szolgáltatás választóra felel meg az új központi telepítés.</span><span class="sxs-lookup"><span data-stu-id="89bec-217">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span>

<span data-ttu-id="89bec-218">Kék-zöld üzembe előnye, hogy a szolgáltatás minden podok átvált egy időben.</span><span class="sxs-lookup"><span data-stu-id="89bec-218">An advantage of blue-green deployments is that the service switches all the pods at the same time.</span></span> <span data-ttu-id="89bec-219">A szolgáltatás frissítése után minden új kérés van irányítva az új verzióra.</span><span class="sxs-lookup"><span data-stu-id="89bec-219">After the service is updated, all new requests get routed to the new version.</span></span> <span data-ttu-id="89bec-220">Egyik hátránya, hogy a frissítés során futtatja kétszer, számos podok a szolgáltatáshoz (az aktuális és a következő).</span><span class="sxs-lookup"><span data-stu-id="89bec-220">One drawback is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="89bec-221">Ha a podok sok CPU és memória-erőforrások, szükség lehet horizontális felskálázása a fürt ideiglenesen az erőforrás-használat kezelésére.</span><span class="sxs-lookup"><span data-stu-id="89bec-221">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span>

### <a name="canary-release"></a><span data-ttu-id="89bec-222">Canary kiadás</span><span class="sxs-lookup"><span data-stu-id="89bec-222">Canary release</span></span>

<span data-ttu-id="89bec-223">Canary kiadás, a bevezetés során fokozatosan egy frissített verziót egy kis mennyiségű ügyfelet.</span><span class="sxs-lookup"><span data-stu-id="89bec-223">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="89bec-224">Az új service viselkedését majd mielőtt megvalósítaná minden ügyfélnek figyeli.</span><span class="sxs-lookup"><span data-stu-id="89bec-224">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="89bec-225">Ez lehetővé teszi egy lassú bevezetés, mégpedig szabályozott módon tegye, tekintse át az adatokon, és helyszíni problémák előtt az összes érintett felhasználókat.</span><span class="sxs-lookup"><span data-stu-id="89bec-225">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="89bec-226">Canary kiadás meg kell dinamikusan irányíthatja a kérelmeket a szolgáltatás különböző verzióit azért bonyolultabb, mint kék-zöld vagy a működés közbeni frissítés kezeléséhez.</span><span class="sxs-lookup"><span data-stu-id="89bec-226">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span> <span data-ttu-id="89bec-227">A Kubernetes konfigurálhatja egy szolgáltatás span két replikakészletekhez (egy minden verzió esetében) és a replika számát manuálisan módosíthatja.</span><span class="sxs-lookup"><span data-stu-id="89bec-227">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="89bec-228">Azonban ez a megközelítés inkább coarse-grained, Kubernetes betöltése módja miatt elosztja a podok között.</span><span class="sxs-lookup"><span data-stu-id="89bec-228">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="89bec-229">Például ha tíz replikák összesen, akkor is csak áthelyezni a forgalmat 10 %-os lépésekben.</span><span class="sxs-lookup"><span data-stu-id="89bec-229">For example, if you have a total of ten replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="89bec-230">Egy szolgáltatás háló használja, ha a szolgáltatás háló útválasztási szabályok segítségével canary kiadás ennél kifinomultabb stratégiát megvalósítása.</span><span class="sxs-lookup"><span data-stu-id="89bec-230">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span> <span data-ttu-id="89bec-231">Az alábbiakban néhány forrásanyagot, amelyek hasznosak lehetnek:</span><span class="sxs-lookup"><span data-stu-id="89bec-231">Here are some resources that may be helpful:</span></span>

- <span data-ttu-id="89bec-232">Kubernetes szolgáltatás háló nélkül: [Canary központi telepítések](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span><span class="sxs-lookup"><span data-stu-id="89bec-232">Kubernetes without service mesh: [Canary deployments](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span></span>
- <span data-ttu-id="89bec-233">Linkerd: [A dinamikus alkalmazáskérelmek irányítása](https://linkerd.io/features/routing/)</span><span class="sxs-lookup"><span data-stu-id="89bec-233">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/)</span></span>
- <span data-ttu-id="89bec-234">Istio: [Canary központi telepítések Istio használatával](https://istio.io/blog/canary-deployments-using-istio.html)</span><span class="sxs-lookup"><span data-stu-id="89bec-234">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html)</span></span>

## <a name="conclusion"></a><span data-ttu-id="89bec-235">Összegzés</span><span class="sxs-lookup"><span data-stu-id="89bec-235">Conclusion</span></span>

<span data-ttu-id="89bec-236">Az utóbbi években, egy tenger változás történt az iparág létrehozását egy adatátviteli *rekord rendszerek* az épület *együttműködés rendszerek*.</span><span class="sxs-lookup"><span data-stu-id="89bec-236">In recent years, there has been a sea change in the industry, a movement from building *systems of record* to building *systems of engagement*.</span></span>

<span data-ttu-id="89bec-237">Rekord rendszereket hagyományos háttérrendszerhez adatkezelési alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="89bec-237">Systems of record are traditional back-office data management applications.</span></span> <span data-ttu-id="89bec-238">Ezek a rendszerek középpontjában van gyakran helyezkedik el egy relációsadatbázis-kezelő rendszer, amely az egyetlen hiteles forrásaként.</span><span class="sxs-lookup"><span data-stu-id="89bec-238">At the heart of these systems there often sits an RDBMS that is the single source of truth.</span></span> <span data-ttu-id="89bec-239">A 2011 tanulmányában "engagement rendszer" kifejezés igényért az Geoffrey Moore, *rendszerek az Engagement és a jövőben nagyvállalati informatikai*.</span><span class="sxs-lookup"><span data-stu-id="89bec-239">The term "system of engagement" is credited to Geoffrey Moore, in his 2011 paper *Systems of Engagement and the Future of Enterprise IT*.</span></span> <span data-ttu-id="89bec-240">Együttműködés rendszereket összpontosított kommunikációs és együttműködési alkalmazásokat.</span><span class="sxs-lookup"><span data-stu-id="89bec-240">Systems of engagement are applications focused on communication and collaboration.</span></span> <span data-ttu-id="89bec-241">Valós idejű személyek csatlakoznak.</span><span class="sxs-lookup"><span data-stu-id="89bec-241">They connect people in real time.</span></span> <span data-ttu-id="89bec-242">Rendelkezésre álló 24/7 kell lenniük.</span><span class="sxs-lookup"><span data-stu-id="89bec-242">They must be available 24/7.</span></span> <span data-ttu-id="89bec-243">Új funkciók jelennek meg rendszeresen, az alkalmazás offline állapotba helyezése nélkül.</span><span class="sxs-lookup"><span data-stu-id="89bec-243">New features are introduced regularly without taking the application offline.</span></span> <span data-ttu-id="89bec-244">Felhasználók várhatóan további és kevesebb nem várt késedelem és leállás, kis türelmet.</span><span class="sxs-lookup"><span data-stu-id="89bec-244">Users expect more and are less patient of unexpected delays or downtime.</span></span>

<span data-ttu-id="89bec-245">A felhasználói térben jobb felhasználói élményt rendelkezhet mérhető üzleti értéket.</span><span class="sxs-lookup"><span data-stu-id="89bec-245">In the consumer space, a better user experience can have measurable business value.</span></span> <span data-ttu-id="89bec-246">Az, hogy mennyi ideig felhasználó folytat egy alkalmazással a előfordulhat, hogy közvetlenül a bevétel fordítja le.</span><span class="sxs-lookup"><span data-stu-id="89bec-246">The amount of time that a user engages with an application may translate directly into revenue.</span></span> <span data-ttu-id="89bec-247">És abban a tartományban, üzleti rendszereket, a felhasználói elvárásoknak megváltoztak.</span><span class="sxs-lookup"><span data-stu-id="89bec-247">And in the realm of business systems, users' expectations have changed.</span></span> <span data-ttu-id="89bec-248">Ezek a rendszerek az a célja, hogy a kommunikációs és együttműködési alakíthatott ki, ha azok a felhasználók felé néző alkalmazások köteg kell végrehajtaniuk.</span><span class="sxs-lookup"><span data-stu-id="89bec-248">If these systems aim to foster communication and collaboration, they must take their cue from consumer-facing applications.</span></span>

<span data-ttu-id="89bec-249">Mikroszolgáltatások a változó fekvő választ.</span><span class="sxs-lookup"><span data-stu-id="89bec-249">Microservices are a response to this changing landscape.</span></span> <span data-ttu-id="89bec-250">Által decomposing a monolitikus alkalmazásokat felbonthatja lazán kapcsolódó szolgáltatásokra, azt is szabályozhatja az egyes szolgáltatásokat a kiadási ciklus, és lehetővé teszi a gyakori frissítések nélkül állásidő és a használhatatlanná tévő változásai.</span><span class="sxs-lookup"><span data-stu-id="89bec-250">By decomposing a monolithic application into a group of loosely coupled services, we can control the release cycle of each service, and enable frequent updates without downtime or breaking changes.</span></span> <span data-ttu-id="89bec-251">Mikroszolgáltatások a méretezhetőség, a hiba elkülönítési és a rugalmasság is segítenek.</span><span class="sxs-lookup"><span data-stu-id="89bec-251">Microservices also help with scalability, failure isolation, and resiliency.</span></span> <span data-ttu-id="89bec-252">Eközben felhőplatformjain vannak így könnyebben hozhat létre és futtassa a mikroszolgáltatások, a számítási erőforrások automatikus üzembe helyezést, a szolgáltatás, valamint az eseményvezérelt, kiszolgáló nélküli környezetben tárolóvezénylőt.</span><span class="sxs-lookup"><span data-stu-id="89bec-252">Meanwhile, cloud platforms are making it easier to build and run microservices, with automated provisioning of compute resources, container orchestrators as a service, and event-driven serverless environments.</span></span>

<span data-ttu-id="89bec-253">De mivel úgy tapasztaltuk, kihívások rengeteg lehetőség van mikroszolgáltatás-architektúrákat.</span><span class="sxs-lookup"><span data-stu-id="89bec-253">But as we've seen, microservices architectures also being a lot of challenges.</span></span> <span data-ttu-id="89bec-254">A művelet sikeres elvégzéséhez kell elindítania egy alapos terv.</span><span class="sxs-lookup"><span data-stu-id="89bec-254">To succeed, you must start from a solid design.</span></span> <span data-ttu-id="89bec-255">A tartomány elemzése, technológiák kiválasztása, modellezési adatok, API-k tervezése és készítése egy fejlett DevOps-kultúra tanulmányozásakor kell tenni.</span><span class="sxs-lookup"><span data-stu-id="89bec-255">You must put careful thought into analyzing the domain, choosing technologies, modeling data, designing APIs, and building a mature DevOps culture.</span></span> <span data-ttu-id="89bec-256">Reméljük, hogy ez az útmutató és a kísérő [megvalósítási hivatkozhat](https://github.com/mspnp/microservices-reference-implementation), a szállítás megvilágítására segített.</span><span class="sxs-lookup"><span data-stu-id="89bec-256">We hope that this guide, and the accompanying [reference implementation](https://github.com/mspnp/microservices-reference-implementation), has helped to illuminate the journey.</span></span>
