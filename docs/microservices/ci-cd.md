---
title: CI/CD-mikroszolgáltatások
description: A folyamatos integrációt és teljesítést mikroszolgáltatások
author: MikeWasson
ms.date: 10/23/2018
ms.openlocfilehash: b411e687a111e55a5821d4fdc66975e80f73584b
ms.sourcegitcommit: fdcacbfdc77370532a4dde776c5d9b82227dff2d
ms.translationtype: MT
ms.contentlocale: hu-HU
ms.lasthandoff: 10/24/2018
ms.locfileid: "49962857"
---
# <a name="designing-microservices-continuous-integration"></a><span data-ttu-id="4b93c-103">Mikroszolgáltatások tervezése: folyamatos integráció</span><span class="sxs-lookup"><span data-stu-id="4b93c-103">Designing microservices: Continuous integration</span></span>

<span data-ttu-id="4b93c-104">Folyamatos integráció és folyamatos készregyártás (CI/CD) egy kulcsfontosságú követelmény az sikeres a mikroszolgáltatás-alapú eléréséhez.</span><span class="sxs-lookup"><span data-stu-id="4b93c-104">Continuous integration and continuous delivery (CI/CD) are a key requirement for achieving success with microservices.</span></span> <span data-ttu-id="4b93c-105">Egy jó CI/CD-folyamat nélkül, nem éri el a rugalmasságot, mellyel a mikroszolgáltatások garantálniuk.</span><span class="sxs-lookup"><span data-stu-id="4b93c-105">Without a good CI/CD process, you will not achieve the agility that microservices promise.</span></span> <span data-ttu-id="4b93c-106">Néhány a mikroszolgáltatások a CI/CD kapcsolatban felmerülő kihívások merülnek fel, több kódbázissal és életciklusainak buildkörnyezeteket, a különböző szolgáltatások esetében nem.</span><span class="sxs-lookup"><span data-stu-id="4b93c-106">Some of the CI/CD challenges for microservices arise from having multiple code bases and heterogenous build environments for the various services.</span></span> <span data-ttu-id="4b93c-107">Ez a fejezet a kihívásokat ismerteti, és javasolja a probléma néhány olyan módszert.</span><span class="sxs-lookup"><span data-stu-id="4b93c-107">This chapter describes the challenges and recommends some approaches to the problem.</span></span>

![](./images/ci-cd.png)

<span data-ttu-id="4b93c-108">Gyorsabb kiadási ciklusokhoz a legnagyobb okai a mikroszolgáltatási architektúra elfogadására.</span><span class="sxs-lookup"><span data-stu-id="4b93c-108">Faster release cycles are one of the biggest reasons to adopt a microservices architecture.</span></span> 

<span data-ttu-id="4b93c-109">A tisztán monolitikus alkalmazások esetén nincs egy egyetlen build folyamatot, amelynek a kimenete az alkalmazás futtatható.</span><span class="sxs-lookup"><span data-stu-id="4b93c-109">In a purely monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="4b93c-110">Minden fejlesztési munka hírcsatornák a folyamatba.</span><span class="sxs-lookup"><span data-stu-id="4b93c-110">All development work feeds into this pipeline.</span></span> <span data-ttu-id="4b93c-111">Ha egy magas prioritású hiba található, a javítás kell lennie integrált, tesztelését és kiadását, amely késleltetheti-e új funkciók megjelenésével.</span><span class="sxs-lookup"><span data-stu-id="4b93c-111">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="4b93c-112">IGAZ, hogy ezek a problémák csökkentheti jól faktorált modulokat, és a szolgáltatás ágak használatával kódmódosításokat minimalizálása érdekében.</span><span class="sxs-lookup"><span data-stu-id="4b93c-112">It's true that you can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="4b93c-113">Azonban, ha az alkalmazás összetettebb növekszik, és további szolgáltatások lesznek hozzáadva, mikroszolgáltatásokká kiadási folyamata általában törékennyé teszi és valószínűleg érvényteleníteni válik.</span><span class="sxs-lookup"><span data-stu-id="4b93c-113">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span> 

<span data-ttu-id="4b93c-114">A mikroszolgáltatások filozófia a következő soha nem kell egy hosszú kibocsátási train, ahol minden egyes csapat beolvasása a sor van.</span><span class="sxs-lookup"><span data-stu-id="4b93c-114">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="4b93c-115">"A" módosításait a szolgáltatás részeként történik, hogy a "B" várakozás nélkül is megjelenhetnek egy tetszőleges időpontban, frissítési szolgáltatás hangolt tesztelését és üzembe helyezve.</span><span class="sxs-lookup"><span data-stu-id="4b93c-115">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span> <span data-ttu-id="4b93c-116">A CI/CD-folyamat fontos a megoldáson.</span><span class="sxs-lookup"><span data-stu-id="4b93c-116">The CI/CD process is critical to making this possible.</span></span> <span data-ttu-id="4b93c-117">Úgy, hogy a frissítések telepítése a kockázatát, így a lehető legkisebb a kibocsátási folyamat automatizált és nagy megbízhatóságú, kell lennie.</span><span class="sxs-lookup"><span data-stu-id="4b93c-117">Your release pipeline must be automated and highly reliable, so that the risks of deploying updates are minimized.</span></span> <span data-ttu-id="4b93c-118">Ha naponta vagy naponta több alkalommal felszabadítása vannak az éles környezetbe, regressziót vagy szolgáltatáskimaradás nagyon ritkán kell lennie.</span><span class="sxs-lookup"><span data-stu-id="4b93c-118">If you are releasing to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="4b93c-119">Egyszerre egy rossz frissítés üzembe helyezése, ha rendelkeznie kell egy megbízható módszerre gyorsan visszaállni vagy előregörgethet egy korábbi verzióját, a szolgáltatás.</span><span class="sxs-lookup"><span data-stu-id="4b93c-119">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

![](./images/cicd-monolith.png)

<span data-ttu-id="4b93c-120">Amikor a CI/CD, valóban beszélünk számos kapcsolódó folyamatok: folyamatos integráció, a folyamatos teljesítés és a folyamatos üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="4b93c-120">When we talk about CI/CD, we are really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="4b93c-121">Folyamatos integráció, hogy a kód módosítása gyakran egyesítve a fő ágat, automatizált összeállítási, és győződjön meg arról, hogy kódot a fő ág mindig gyártási minőségű folyamatok tesztelése jelenti.</span><span class="sxs-lookup"><span data-stu-id="4b93c-121">Continuous integration means that code changes are frequently merged into the main branch, using automated build and test processes to ensure that  code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="4b93c-122">Folyamatos készregyártás, az azt jelenti, hogy a kód módosítása, hogy a CI folyamat automatikusan közzéteszi az utolsóig üzemi környezetben.</span><span class="sxs-lookup"><span data-stu-id="4b93c-122">Continuous delivery means that code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="4b93c-123">Az élő éles környezetben való üzembe helyezés manuális jóváhagyásra lehet szükség, de egyébként automatizált.</span><span class="sxs-lookup"><span data-stu-id="4b93c-123">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="4b93c-124">Az a célja, hogy a kód mindig legyen *készen* helyezheti éles üzembe.</span><span class="sxs-lookup"><span data-stu-id="4b93c-124">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="4b93c-125">Folyamatos üzembe helyezés azt jelenti, kódmódosítás, hogy a CI/CD-folyamat automatikusan telepített éles környezetbe.</span><span class="sxs-lookup"><span data-stu-id="4b93c-125">Continuous deployment means that code changes that pass the CI/CD process are automatically deployed into production.</span></span>

<span data-ttu-id="4b93c-126">Kubernetes- és mikroszolgáltatás-alapú környezetében a Konfigurációelem fázis üzemidejére létrehozása és tesztelése a tárolórendszerképek és ezen rendszerképek leküldése egy tároló-beállításjegyzéket.</span><span class="sxs-lookup"><span data-stu-id="4b93c-126">In the context of Kubernetes and microservices, the CI stage is concerned with building and testing container images, and pushing those images to a container registry.</span></span> <span data-ttu-id="4b93c-127">A központi telepítési fázisban a pod vonatkozó műszaki adatok frissülnek, hogy folytattuk a munkát a legújabb termelési rendszerképet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-127">In the deployment stage, pod specs are updated to pick up the latest production image.</span></span>

## <a name="challenges"></a><span data-ttu-id="4b93c-128">Problémák</span><span class="sxs-lookup"><span data-stu-id="4b93c-128">Challenges</span></span>

- <span data-ttu-id="4b93c-129">**Sok kis független kódbázissal**.</span><span class="sxs-lookup"><span data-stu-id="4b93c-129">**Many small independent code bases**.</span></span> <span data-ttu-id="4b93c-130">Minden egyes csapat felelős a saját szolgáltatás, amelynek a saját build folyamat létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-130">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="4b93c-131">Egyes szervezetekben a csapat a előfordulhat, hogy külön kódtárházak.</span><span class="sxs-lookup"><span data-stu-id="4b93c-131">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="4b93c-132">Ez a helyzet, ahol az ismeretek, hogyan hozhat létre a rendszer a csapatok között megoszlik, és a szervezet senki sem tudja, hogy a teljes alkalmazás üzembe helyezése vezethet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-132">This could lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="4b93c-133">Például mi történik, a vész-helyreállítási helyzetekre, ha gyorsan üzembe helyezhet egy új fürtre van szüksége?</span><span class="sxs-lookup"><span data-stu-id="4b93c-133">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>   

- <span data-ttu-id="4b93c-134">**Több nyelv és keretrendszer**.</span><span class="sxs-lookup"><span data-stu-id="4b93c-134">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="4b93c-135">Az egyes csapata a saját technológiák vegyítése használatával nehézkes lehet a szervezet egészében működő egyetlen buildelési folyamat létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-135">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="4b93c-136">A létrehozási folyamat kellően rugalmas ahhoz, hogy minden egyes csapat tesztkörnyezetéhez, az általuk választott nyelvet vagy keretrendszert kell lennie.</span><span class="sxs-lookup"><span data-stu-id="4b93c-136">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span> 

- <span data-ttu-id="4b93c-137">**Integráció és a load testing**.</span><span class="sxs-lookup"><span data-stu-id="4b93c-137">**Integration and load testing**.</span></span> <span data-ttu-id="4b93c-138">Csapatok számára a saját tempójában frissítéseket ad ki ez kihívást jelenthet robusztus – teljes körű tesztelés, különösen ha szolgáltatások függőségekkel rendelkezik más szolgáltatások tervezéséhez.</span><span class="sxs-lookup"><span data-stu-id="4b93c-138">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="4b93c-139">Ezen felül egy teljes éles fürtöt futtat költséges lehet, ezért nem valószínű, hogy minden egyes csapat fogja tudni a saját teljes fürtöt futtat, éles skálázását követve rugalmasan méretezhető, csak teszteléshez.</span><span class="sxs-lookup"><span data-stu-id="4b93c-139">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will be able to run its own full cluster at production scales, just for testing.</span></span> 

- <span data-ttu-id="4b93c-140">**Kiadáskezelés**.</span><span class="sxs-lookup"><span data-stu-id="4b93c-140">**Release management**.</span></span> <span data-ttu-id="4b93c-141">Minden team kell az éles környezetbe helyezheti üzembe az alkalmazásokat egy frissítést.</span><span class="sxs-lookup"><span data-stu-id="4b93c-141">Every team should have the ability to deploy an update to production.</span></span> <span data-ttu-id="4b93c-142">Ez nem jelenti azt, hogy minden csapattag engedélyekkel rendelkezik-e.</span><span class="sxs-lookup"><span data-stu-id="4b93c-142">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="4b93c-143">Azonban egy központosított Kiadáskezelő szerepkör kellene csökkentheti a központi telepítések adatról van szó.</span><span class="sxs-lookup"><span data-stu-id="4b93c-143">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span> <span data-ttu-id="4b93c-144">A további, hogy a CI/CD-folyamat automatikus, és megbízható, a kevésbé ott kell lennie egy központi hatóság szüksége.</span><span class="sxs-lookup"><span data-stu-id="4b93c-144">The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="4b93c-145">Ugyanakkor előfordulhat, hogy kisebb hibajavítások és a főbb funkciókat frissítések kiadása különböző házirendeket.</span><span class="sxs-lookup"><span data-stu-id="4b93c-145">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="4b93c-146">Folyamatban decentralizált jelenti azt, hogy nulla cégirányítási kell lennie.</span><span class="sxs-lookup"><span data-stu-id="4b93c-146">Being decentralized does not mean there should be zero governance.</span></span>

- <span data-ttu-id="4b93c-147">**Tároló-lemezkép versioning**.</span><span class="sxs-lookup"><span data-stu-id="4b93c-147">**Container image versioning**.</span></span> <span data-ttu-id="4b93c-148">A fejlesztési és tesztelési ciklus során a CI/CD-folyamat számos tárolórendszerképek fog létrehozni.</span><span class="sxs-lookup"><span data-stu-id="4b93c-148">During the development and test cycle, the CI/CD process will build many container images.</span></span> <span data-ttu-id="4b93c-149">Csak a kiadásban a deduplikációra olyanokat is, majd csak néhányat ezen kiadás jelöltek fog első leküldött éles környezetbe.</span><span class="sxs-lookup"><span data-stu-id="4b93c-149">Only some of those are candidates for release, and then only some of those release candidates will get pushed into production.</span></span> <span data-ttu-id="4b93c-150">Egy világos verziókezelési stratégiát kell, hogy tudja, melyik képek az éles környezetben jelenleg telepítve vannak, és vissza lehet vonni egy korábbi verziót, ha szükséges.</span><span class="sxs-lookup"><span data-stu-id="4b93c-150">You should have a clear versioning strategy, so that you know which images are currently deployed to production, and can roll back to a previous version if necessary.</span></span> 

- <span data-ttu-id="4b93c-151">**Szolgáltatási hírek**.</span><span class="sxs-lookup"><span data-stu-id="4b93c-151">**Service updates**.</span></span> <span data-ttu-id="4b93c-152">Amikor új verzióra frissít egy szolgáltatás, azt más a tőle függő szolgáltatások nem szünet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-152">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span> <span data-ttu-id="4b93c-153">Ha így tesz, a működés közbeni frissítés, bizonyos idő különböző verzióit vegyesen futtatásakor lesz.</span><span class="sxs-lookup"><span data-stu-id="4b93c-153">If you do a rolling update, there will be a period of time when a mix of versions is running.</span></span> 
 
<span data-ttu-id="4b93c-154">Ezek a kihívások alapvető feszültség tükrözik.</span><span class="sxs-lookup"><span data-stu-id="4b93c-154">These challenges reflect a fundamental tension.</span></span> <span data-ttu-id="4b93c-155">Csapatok, másrészt kell működjön, egymástól függetlenül, amennyire csak lehetséges.</span><span class="sxs-lookup"><span data-stu-id="4b93c-155">On the one hand, teams need to work as independently as possible.</span></span> <span data-ttu-id="4b93c-156">Néhány koordinálása, másrészt van szükség, hogy egyetlen személy teheti a feladatokat, mint egy integrációs teszt futtatása, újbóli üzembe helyezés a teljes megoldás egy új fürtre vagy egy rossz frissítés visszaállítása.</span><span class="sxs-lookup"><span data-stu-id="4b93c-156">On the other hand, some coordination is needed so that a single person can do tasks like running an integration test, redeploying the entire solution to a new cluster, or rolling back a bad update.</span></span> 
 
## <a name="cicd-approaches-for-microservices"></a><span data-ttu-id="4b93c-157">A mikroszolgáltatásokat megközelíti a CI/CD</span><span class="sxs-lookup"><span data-stu-id="4b93c-157">CI/CD approaches for microservices</span></span>

<span data-ttu-id="4b93c-158">Ajánlott minden service csapata igény szerint tárolóalapúvá alakíthatja az összeállító környezetet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-158">It's a good practice for every service team to containerize their build environment.</span></span> <span data-ttu-id="4b93c-159">Ez a tároló az összes szükséges hozhat létre a szolgáltatásukhoz kód összetevők build eszköz rendelkezhet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-159">This container should have all of the build tools necessary to build the code artifacts for their service.</span></span> <span data-ttu-id="4b93c-160">Gyakran a nyelv és keretrendszer hivatalos Docker-rendszerképet is megtalálhatja.</span><span class="sxs-lookup"><span data-stu-id="4b93c-160">Often you can find an official Docker image for your language and framework.</span></span> <span data-ttu-id="4b93c-161">Ezt követően használhatja `docker run` vagy a Docker Compose, a build futtatásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-161">Then you can use `docker run` or Docker Compose to run the build.</span></span> 

<span data-ttu-id="4b93c-162">Ezzel a módszerrel nagyon egyszerű, egy új build-környezetet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-162">With this approach, it's trivial to set up a new build environment.</span></span> <span data-ttu-id="4b93c-163">Fejlesztőként szeretne a kód felépítéséhez nem kell telepítenie a build-eszközöket, de egyszerűen futtatja a tároló rendszerképét.</span><span class="sxs-lookup"><span data-stu-id="4b93c-163">A developer who wants to build your code doesn't need to install a set of build tools, but simply runs the container image.</span></span> <span data-ttu-id="4b93c-164">Talán még fontosabb, a build kiszolgáló beállítható úgy, a végre ugyanezt.</span><span class="sxs-lookup"><span data-stu-id="4b93c-164">Perhaps more importantly, your build server can be configured to do the same thing.</span></span> <span data-ttu-id="4b93c-165">Ezzel a módszerrel, nem kell telepíteni ezeket az eszközöket a build-kiszolgálóba, vagy az eszközök ütköző verziók kezelése.</span><span class="sxs-lookup"><span data-stu-id="4b93c-165">That way, you don't need to install those tools onto the build server, or manage conflicting versions of tools.</span></span> 

<span data-ttu-id="4b93c-166">Helyi fejlesztési és tesztelési a Docker használatával futtatni a szolgáltatást a tárolókon belül.</span><span class="sxs-lookup"><span data-stu-id="4b93c-166">For local development and testing, use Docker to run the service inside a container.</span></span> <span data-ttu-id="4b93c-167">Ez a folyamat részeként szükség lehet más utánzatként funkcionáló szolgáltatások vagy helyi teszteléshez szükséges tesztelési adatbázisok rendelkező tárolók futtatásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-167">As part of this process, you may need to run other containers that have mock services or test databases needed for local testing.</span></span> <span data-ttu-id="4b93c-168">Ezek a tárolók összehangolása a Docker Compose használatával, vagy helyileg történő futtatása a Kubernetes Minikube használatával.</span><span class="sxs-lookup"><span data-stu-id="4b93c-168">You could use Docker Compose to coordinate these containers, or use Minikube to run Kubernetes locally.</span></span> 

<span data-ttu-id="4b93c-169">Amikor készen áll a kód, nyisson meg egy pull-kérelem és egyesítés főágba be.</span><span class="sxs-lookup"><span data-stu-id="4b93c-169">When the code is ready, open a pull request and merge into master.</span></span> <span data-ttu-id="4b93c-170">Ez feladatot indít el a build-kiszolgálón:</span><span class="sxs-lookup"><span data-stu-id="4b93c-170">This will start a job on the build server:</span></span>

1. <span data-ttu-id="4b93c-171">A kód eszközöket hozhat létre.</span><span class="sxs-lookup"><span data-stu-id="4b93c-171">Build the code assets.</span></span> 
2. <span data-ttu-id="4b93c-172">Egység tesztek futtatásához a kódot.</span><span class="sxs-lookup"><span data-stu-id="4b93c-172">Run unit tests against the code.</span></span>
3. <span data-ttu-id="4b93c-173">A tárolólemezkép létrehozásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-173">Build the container image.</span></span>
4. <span data-ttu-id="4b93c-174">Ellenőrizze a tároló rendszerképét a funkcionális tesztek futtatása a futó tárolót.</span><span class="sxs-lookup"><span data-stu-id="4b93c-174">Test the container image by running functional tests on a running container.</span></span> <span data-ttu-id="4b93c-175">Ebben a lépésben a Docker-fájl, például a rossz belépési pont hibáinak használhatják fel őket.</span><span class="sxs-lookup"><span data-stu-id="4b93c-175">This step can catch errors in the Docker file, such as a bad entry point.</span></span>
5. <span data-ttu-id="4b93c-176">A rendszerkép leküldése egy tároló-beállításjegyzéket.</span><span class="sxs-lookup"><span data-stu-id="4b93c-176">Push the image to a container registry.</span></span>
6. <span data-ttu-id="4b93c-177">A test-fürt frissítése az új lemezkép integrációs tesztek futtatásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-177">Update the test cluster with the new image to run integration tests.</span></span>

<span data-ttu-id="4b93c-178">Amikor a lemezkép készen áll, éles környezetben, frissítse az üzembe helyezési fájlokat a legújabb rendszerképet, beleértve a Kubernetes konfigurációs fájlok megadásához szükség szerint.</span><span class="sxs-lookup"><span data-stu-id="4b93c-178">When the image is ready to go into production, update the deployment files as needed to specify the latest image, including any Kubernetes configuration files.</span></span> <span data-ttu-id="4b93c-179">Ezután alkalmazza a frissítést az éles fürtöt.</span><span class="sxs-lookup"><span data-stu-id="4b93c-179">Then apply the update to the production cluster.</span></span>

<span data-ttu-id="4b93c-180">Az alábbiakban néhány javaslat megbízhatóbb végzett központi telepítések:</span><span class="sxs-lookup"><span data-stu-id="4b93c-180">Here are some recommendations for making deployments more reliable:</span></span>
 
- <span data-ttu-id="4b93c-181">Adja meg a szervezeti szintű szabályai tároló címkék, verziószámozása és a fürthöz (podok, szolgáltatások és így tovább) üzembe helyezett erőforrások elnevezési szabályainak.</span><span class="sxs-lookup"><span data-stu-id="4b93c-181">Define organization-wide conventions for container tags, versioning, and naming conventions for resources deployed to the cluster (pods, services, and so on).</span></span> <span data-ttu-id="4b93c-182">Amely megkönnyítheti a üzembe helyezési problémák diagnosztizálásához.</span><span class="sxs-lookup"><span data-stu-id="4b93c-182">That can make it easier to diagnose deployment issues.</span></span> 

- <span data-ttu-id="4b93c-183">Hozzon létre két külön tároló-beállításjegyzékek, egyet a fejlesztési-tesztelési és éles környezetben.</span><span class="sxs-lookup"><span data-stu-id="4b93c-183">Create two separate container registries, one for development/testing and one for production.</span></span> <span data-ttu-id="4b93c-184">Nem rendszerkép leküldése a termelési beállításjegyzék, amíg készen áll az éles üzembe helyezés.</span><span class="sxs-lookup"><span data-stu-id="4b93c-184">Don't push an image to the production registry until you're ready to deploy it into production.</span></span> <span data-ttu-id="4b93c-185">Ha ez az eljárás kombinálva a tárolórendszerképek Szemantikus verziószámozást, csökkentheti az esélye, hogy véletlenül üzembe helyezése egy olyanra, amely a kiadás nem lett jóváhagyva.</span><span class="sxs-lookup"><span data-stu-id="4b93c-185">If you combine this practice with semantic versioning of container images, it can reduce the chance of accidentally deploying a version that wasn't approved for release.</span></span>

## <a name="updating-services"></a><span data-ttu-id="4b93c-186">Szolgáltatás frissítése</span><span class="sxs-lookup"><span data-stu-id="4b93c-186">Updating services</span></span>

<span data-ttu-id="4b93c-187">Számos különféle stratégiát, amely már éles környezetben a szolgáltatás frissítése.</span><span class="sxs-lookup"><span data-stu-id="4b93c-187">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="4b93c-188">Itt három általános beállítások tárgyaljuk: a működés közbeni frissítés, a kék-zöld üzembe helyezés és a canary kiadás.</span><span class="sxs-lookup"><span data-stu-id="4b93c-188">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-update"></a><span data-ttu-id="4b93c-189">A működés közbeni frissítés</span><span class="sxs-lookup"><span data-stu-id="4b93c-189">Rolling update</span></span> 

<span data-ttu-id="4b93c-190">A működés közbeni frissítés a szolgáltatás új példányok üzembe helyezésekor, és az új példányok, indítsa el azonnal a kérelmek fogadására.</span><span class="sxs-lookup"><span data-stu-id="4b93c-190">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="4b93c-191">Az új példányok merülnek fel, mint az előző példányok törlődnek.</span><span class="sxs-lookup"><span data-stu-id="4b93c-191">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="4b93c-192">Működés közbeni frissítései az alapértelmezett viselkedést, a Kubernetes üzembe helyezéséhez a pod specifikációja frissítésekor.</span><span class="sxs-lookup"><span data-stu-id="4b93c-192">Rolling updates are the default behavior in Kubernetes when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="4b93c-193">A központi telepítési vezérlő hoz létre egy új ReplicaSet a frissített podok számára.</span><span class="sxs-lookup"><span data-stu-id="4b93c-193">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="4b93c-194">Ezután a méretezés során az új ReplicaSet vertikális leskálázást a régit, a kívánt replikáinak száma fenntartása közben.</span><span class="sxs-lookup"><span data-stu-id="4b93c-194">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="4b93c-195">Régi podok azzal nem törli, amíg készen áll az újakat.</span><span class="sxs-lookup"><span data-stu-id="4b93c-195">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="4b93c-196">Kubernetes előzményeket a frissítést, így a kubectl használatával visszavonhat egy frissítést szükség esetén.</span><span class="sxs-lookup"><span data-stu-id="4b93c-196">Kubernetes keeps a history of the update, so you can use kubectl to roll back an update if needed.</span></span> 

<span data-ttu-id="4b93c-197">Ha a szolgáltatás egy hosszú indítási feladat végez, meghatározhatja egy készenlét.</span><span class="sxs-lookup"><span data-stu-id="4b93c-197">If your service performs a long startup task, you can define a readiness probe.</span></span> <span data-ttu-id="4b93c-198">A végrehajtandó készenléti teszt jelenti a forgalmat fogadó megkezdheti a tároló esetén.</span><span class="sxs-lookup"><span data-stu-id="4b93c-198">The readiness probe reports when the container is ready to start receiving traffic.</span></span> <span data-ttu-id="4b93c-199">Kubernetes nem küldhetnek forgalmat a pod, amíg a mintavétel sikeres befejezést jelent.</span><span class="sxs-lookup"><span data-stu-id="4b93c-199">Kubernetes won't send traffic to the pod until the probe reports success.</span></span> 

<span data-ttu-id="4b93c-200">Egy igazi kihívást a működés közbeni frissítés, hogy a frissítési folyamat alatt vegyesen a régi és új verziókat futtató és forgalmat fogadó.</span><span class="sxs-lookup"><span data-stu-id="4b93c-200">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="4b93c-201">Ebben az időszakban bármilyen kérést sikerült irányítva a két verzió valamelyikéhez.</span><span class="sxs-lookup"><span data-stu-id="4b93c-201">During this period, any request could get routed to either of the two versions.</span></span> <span data-ttu-id="4b93c-202">Előfordulhat, hogy, amely, vagy nem problémát okozhatnak, a két verziója közötti különbségek függően.</span><span class="sxs-lookup"><span data-stu-id="4b93c-202">That may or may not cause problems, depending on the scope of the changes between the two versions.</span></span> 

### <a name="blue-green-deployment"></a><span data-ttu-id="4b93c-203">Kék-zöld üzembe helyezés</span><span class="sxs-lookup"><span data-stu-id="4b93c-203">Blue-green deployment</span></span>

<span data-ttu-id="4b93c-204">A kék-zöld üzembe helyezés helyezi üzembe az új verziót az előző verzió mellett.</span><span class="sxs-lookup"><span data-stu-id="4b93c-204">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="4b93c-205">Ellenőrizze, hogy az új verziót, akkor váltson egyszerre az előző verzióhoz képest az új verzió minden forgalmat.</span><span class="sxs-lookup"><span data-stu-id="4b93c-205">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="4b93c-206">A váltás után az alkalmazás kapcsolatos problémákat figyeli.</span><span class="sxs-lookup"><span data-stu-id="4b93c-206">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="4b93c-207">Ha hiba lép fel, kicserélheti az a korábbi verzióra.</span><span class="sxs-lookup"><span data-stu-id="4b93c-207">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="4b93c-208">Ha nem talált nincs probléma, törölheti a régi verzióját.</span><span class="sxs-lookup"><span data-stu-id="4b93c-208">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="4b93c-209">Egy hagyományos monolitikus vagy N szintű alkalmazáshoz a kék-zöld üzembe helyezés általában kizárólag két azonos környezet kiépítése.</span><span class="sxs-lookup"><span data-stu-id="4b93c-209">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="4b93c-210">Szeretné az új verzió üzembe helyezése átmeneti környezetben, akkor az átmeneti ügyfél forgalom átirányítása &mdash; például virtuális IP-CÍMEK felcserélésével címek.</span><span class="sxs-lookup"><span data-stu-id="4b93c-210">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span>

<span data-ttu-id="4b93c-211">A Kubernetes nem kell tennie a kék-zöld üzembe önálló fürt üzembe helyezése.</span><span class="sxs-lookup"><span data-stu-id="4b93c-211">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="4b93c-212">Ehelyett kihasználhatja a választók.</span><span class="sxs-lookup"><span data-stu-id="4b93c-212">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="4b93c-213">Hozzon létre egy új központi telepítési erőforrás egy új pod specifikációja és címkék külön készletét.</span><span class="sxs-lookup"><span data-stu-id="4b93c-213">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="4b93c-214">Hozza létre a központi telepítés nélkül a korábbi központi telepítés törlését vagy módosítását a szolgáltatás, amely azt mutat.</span><span class="sxs-lookup"><span data-stu-id="4b93c-214">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="4b93c-215">Miután az új podok is futnak, frissítheti a szolgáltatás választóra felel meg az új központi telepítés.</span><span class="sxs-lookup"><span data-stu-id="4b93c-215">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span> 

<span data-ttu-id="4b93c-216">Kék-zöld üzembe előnye, hogy a szolgáltatás minden podok átvált egy időben.</span><span class="sxs-lookup"><span data-stu-id="4b93c-216">An advantage of blue-green deployments is that the service switches all the pods at the same time.</span></span> <span data-ttu-id="4b93c-217">A szolgáltatás frissítése után minden új kérés van irányítva az új verzióra.</span><span class="sxs-lookup"><span data-stu-id="4b93c-217">After the service is updated, all new requests get routed to the new version.</span></span> <span data-ttu-id="4b93c-218">Egyik hátránya, hogy a frissítés során futtatja kétszer, számos podok a szolgáltatáshoz (az aktuális és a következő).</span><span class="sxs-lookup"><span data-stu-id="4b93c-218">One drawback is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="4b93c-219">Ha a podok sok CPU és memória-erőforrások, szükség lehet horizontális felskálázása a fürt ideiglenesen az erőforrás-használat kezelésére.</span><span class="sxs-lookup"><span data-stu-id="4b93c-219">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span> 

### <a name="canary-release"></a><span data-ttu-id="4b93c-220">Canary kiadás</span><span class="sxs-lookup"><span data-stu-id="4b93c-220">Canary release</span></span>

<span data-ttu-id="4b93c-221">Canary kiadás, a bevezetés során fokozatosan egy frissített verziót egy kis mennyiségű ügyfelet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-221">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="4b93c-222">Az új service viselkedését majd mielőtt megvalósítaná minden ügyfélnek figyeli.</span><span class="sxs-lookup"><span data-stu-id="4b93c-222">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="4b93c-223">Ez lehetővé teszi egy lassú bevezetés, mégpedig szabályozott módon tegye, tekintse át az adatokon, és helyszíni problémák előtt az összes érintett felhasználókat.</span><span class="sxs-lookup"><span data-stu-id="4b93c-223">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="4b93c-224">Canary kiadás meg kell dinamikusan irányíthatja a kérelmeket a szolgáltatás különböző verzióit azért bonyolultabb, mint kék-zöld vagy a működés közbeni frissítés kezeléséhez.</span><span class="sxs-lookup"><span data-stu-id="4b93c-224">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span> <span data-ttu-id="4b93c-225">A Kubernetes konfigurálhatja egy szolgáltatás span két replikakészletekhez (egy minden verzió esetében) és a replika számát manuálisan módosíthatja.</span><span class="sxs-lookup"><span data-stu-id="4b93c-225">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="4b93c-226">Azonban ez a megközelítés inkább coarse-grained, Kubernetes betöltése módja miatt elosztja a podok között.</span><span class="sxs-lookup"><span data-stu-id="4b93c-226">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="4b93c-227">Például ha tíz replikák összesen, akkor is csak áthelyezni a forgalmat 10 %-os lépésekben.</span><span class="sxs-lookup"><span data-stu-id="4b93c-227">For example, if you have a total of ten replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="4b93c-228">Egy szolgáltatás háló használja, ha a szolgáltatás háló útválasztási szabályok segítségével canary kiadás ennél kifinomultabb stratégiát megvalósítása.</span><span class="sxs-lookup"><span data-stu-id="4b93c-228">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span> <span data-ttu-id="4b93c-229">Az alábbiakban néhány forrásanyagot, amelyek hasznosak lehetnek:</span><span class="sxs-lookup"><span data-stu-id="4b93c-229">Here are some resources that may be helpful:</span></span>

- <span data-ttu-id="4b93c-230">Kubernetes szolgáltatás háló nélkül: [Tesztcsoportos központi telepítések](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span><span class="sxs-lookup"><span data-stu-id="4b93c-230">Kubernetes without service mesh: [Canary deployments](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span></span>
- <span data-ttu-id="4b93c-231">Linkerd: [dinamikus alkalmazáskérelmek irányítása](https://linkerd.io/features/routing/)</span><span class="sxs-lookup"><span data-stu-id="4b93c-231">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/)</span></span>
- <span data-ttu-id="4b93c-232">Istio: [Istio használatával Tesztcsoportos központi telepítések](https://istio.io/blog/canary-deployments-using-istio.html)</span><span class="sxs-lookup"><span data-stu-id="4b93c-232">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html)</span></span>

## <a name="conclusion"></a><span data-ttu-id="4b93c-233">Összegzés</span><span class="sxs-lookup"><span data-stu-id="4b93c-233">Conclusion</span></span>

<span data-ttu-id="4b93c-234">Az utóbbi években, egy tenger változás történt az iparág létrehozását egy adatátviteli *rekord rendszerek* az épület *együttműködés rendszerek*.</span><span class="sxs-lookup"><span data-stu-id="4b93c-234">In recent years, there has been a sea change in the industry, a movement from building *systems of record* to building *systems of engagement*.</span></span>

<span data-ttu-id="4b93c-235">Rekord rendszereket hagyományos háttérrendszerhez adatkezelési alkalmazások.</span><span class="sxs-lookup"><span data-stu-id="4b93c-235">Systems of record are traditional back-office data management applications.</span></span> <span data-ttu-id="4b93c-236">Ezek a rendszerek középpontjában van gyakran helyezkedik el egy relációsadatbázis-kezelő rendszer, amely az egyetlen hiteles forrásaként.</span><span class="sxs-lookup"><span data-stu-id="4b93c-236">At the heart of these systems there often sits an RDBMS that is the single source of truth.</span></span> <span data-ttu-id="4b93c-237">A 2011 tanulmányában "engagement rendszer" kifejezés igényért az Geoffrey Moore, *rendszerek az Engagement és a jövőben nagyvállalati informatikai*.</span><span class="sxs-lookup"><span data-stu-id="4b93c-237">The term "system of engagement" is credited to Geoffrey Moore, in his 2011 paper *Systems of Engagement and the Future of Enterprise IT*.</span></span> <span data-ttu-id="4b93c-238">Együttműködés rendszereket összpontosított kommunikációs és együttműködési alkalmazásokat.</span><span class="sxs-lookup"><span data-stu-id="4b93c-238">Systems of engagement are applications focused on communication and collaboration.</span></span> <span data-ttu-id="4b93c-239">Valós idejű személyek csatlakoznak.</span><span class="sxs-lookup"><span data-stu-id="4b93c-239">They connect people in real time.</span></span> <span data-ttu-id="4b93c-240">Rendelkezésre álló 24/7 kell lenniük.</span><span class="sxs-lookup"><span data-stu-id="4b93c-240">They must be available 24/7.</span></span> <span data-ttu-id="4b93c-241">Új funkciók jelennek meg rendszeresen, az alkalmazás offline állapotba helyezése nélkül.</span><span class="sxs-lookup"><span data-stu-id="4b93c-241">New features are introduced regularly without taking the application offline.</span></span> <span data-ttu-id="4b93c-242">Felhasználók várhatóan további és kevesebb nem várt késedelem és leállás, kis türelmet.</span><span class="sxs-lookup"><span data-stu-id="4b93c-242">Users expect more and are less patient of unexpected delays or downtime.</span></span>

<span data-ttu-id="4b93c-243">A felhasználói térben jobb felhasználói élményt rendelkezhet mérhető üzleti értéket.</span><span class="sxs-lookup"><span data-stu-id="4b93c-243">In the consumer space, a better user experience can have measurable business value.</span></span> <span data-ttu-id="4b93c-244">Az, hogy mennyi ideig felhasználó folytat egy alkalmazással a előfordulhat, hogy közvetlenül a bevétel fordítja le.</span><span class="sxs-lookup"><span data-stu-id="4b93c-244">The amount of time that a user engages with an application may translate directly into revenue.</span></span> <span data-ttu-id="4b93c-245">És abban a tartományban, üzleti rendszereket, a felhasználói elvárásoknak megváltoztak.</span><span class="sxs-lookup"><span data-stu-id="4b93c-245">And in the realm of business systems, users' expectations have changed.</span></span> <span data-ttu-id="4b93c-246">Ezek a rendszerek az a célja, hogy a kommunikációs és együttműködési alakíthatott ki, ha azok a felhasználók felé néző alkalmazások köteg kell végrehajtaniuk.</span><span class="sxs-lookup"><span data-stu-id="4b93c-246">If these systems aim to foster communication and collaboration, they must take their cue from consumer-facing applications.</span></span>

<span data-ttu-id="4b93c-247">Mikroszolgáltatások a változó fekvő választ.</span><span class="sxs-lookup"><span data-stu-id="4b93c-247">Microservices are a response to this changing landscape.</span></span> <span data-ttu-id="4b93c-248">Által decomposing a monolitikus alkalmazásokat felbonthatja lazán kapcsolódó szolgáltatásokra, azt is szabályozhatja az egyes szolgáltatásokat a kiadási ciklus, és lehetővé teszi a gyakori frissítések nélkül állásidő és a használhatatlanná tévő változásai.</span><span class="sxs-lookup"><span data-stu-id="4b93c-248">By decomposing a monolithic application into a group of loosely coupled services, we can control the release cycle of each service, and enable frequent updates without downtime or breaking changes.</span></span> <span data-ttu-id="4b93c-249">Mikroszolgáltatások a méretezhetőség, a hiba elkülönítési és a rugalmasság is segítenek.</span><span class="sxs-lookup"><span data-stu-id="4b93c-249">Microservices also help with scalability, failure isolation, and resiliency.</span></span> <span data-ttu-id="4b93c-250">Eközben felhőplatformjain vannak így könnyebben hozhat létre és futtassa a mikroszolgáltatások, a számítási erőforrások automatikus üzembe helyezést, a szolgáltatás, valamint az eseményvezérelt, kiszolgáló nélküli környezetben tárolóvezénylőt.</span><span class="sxs-lookup"><span data-stu-id="4b93c-250">Meanwhile, cloud platforms are making it easier to build and run microservices, with automated provisioning of compute resources, container orchestrators as a service, and event-driven serverless environments.</span></span>

<span data-ttu-id="4b93c-251">De mivel úgy tapasztaltuk, kihívások rengeteg lehetőség van mikroszolgáltatás-architektúrákat.</span><span class="sxs-lookup"><span data-stu-id="4b93c-251">But as we've seen, microservices architectures also being a lot of challenges.</span></span> <span data-ttu-id="4b93c-252">A művelet sikeres elvégzéséhez kell elindítania egy alapos terv.</span><span class="sxs-lookup"><span data-stu-id="4b93c-252">To succeed, you must start from a solid design.</span></span> <span data-ttu-id="4b93c-253">A tartomány elemzése, technológiák kiválasztása, modellezési adatok, API-k tervezése és készítése egy fejlett DevOps-kultúra tanulmányozásakor kell tenni.</span><span class="sxs-lookup"><span data-stu-id="4b93c-253">You must put careful thought into analyzing the domain, choosing technologies, modeling data, designing APIs, and building a mature DevOps culture.</span></span> <span data-ttu-id="4b93c-254">Reméljük, hogy ez az útmutató és a kísérő [megvalósítási hivatkozhat](https://github.com/mspnp/microservices-reference-implementation), a szállítás megvilágítására segített.</span><span class="sxs-lookup"><span data-stu-id="4b93c-254">We hope that this guide, and the accompanying [reference implementation](https://github.com/mspnp/microservices-reference-implementation), has helped to illuminate the journey.</span></span> 

